(self.webpackChunkol_nextjs_starter=self.webpackChunkol_nextjs_starter||[]).push([[584],{"./node_modules/css-loader/dist/runtime/api.js":module=>{"use strict";module.exports=function(cssWithMappingToString){var list=[];return list.toString=function toString(){return this.map((function(item){var content="",needLayer=void 0!==item[5];return item[4]&&(content+="@supports (".concat(item[4],") {")),item[2]&&(content+="@media ".concat(item[2]," {")),needLayer&&(content+="@layer".concat(item[5].length>0?" ".concat(item[5]):""," {")),content+=cssWithMappingToString(item),needLayer&&(content+="}"),item[2]&&(content+="}"),item[4]&&(content+="}"),content})).join("")},list.i=function i(modules,media,dedupe,supports,layer){"string"==typeof modules&&(modules=[[null,modules,void 0]]);var alreadyImportedModules={};if(dedupe)for(var k=0;k<this.length;k++){var id=this[k][0];null!=id&&(alreadyImportedModules[id]=!0)}for(var _k=0;_k<modules.length;_k++){var item=[].concat(modules[_k]);dedupe&&alreadyImportedModules[item[0]]||(void 0!==layer&&(void 0===item[5]||(item[1]="@layer".concat(item[5].length>0?" ".concat(item[5]):""," {").concat(item[1],"}")),item[5]=layer),media&&(item[2]?(item[1]="@media ".concat(item[2]," {").concat(item[1],"}"),item[2]=media):item[2]=media),supports&&(item[4]?(item[1]="@supports (".concat(item[4],") {").concat(item[1],"}"),item[4]=supports):item[4]="".concat(supports)),list.push(item))}},list}},"./node_modules/css-loader/dist/runtime/sourceMaps.js":module=>{"use strict";module.exports=function(item){var content=item[1],cssMapping=item[3];if(!cssMapping)return content;if("function"==typeof btoa){var base64=btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping)))),data="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(base64),sourceMapping="/*# ".concat(data," */");return[content].concat([sourceMapping]).join("\n")}return[content].join("\n")}},"./node_modules/file-saver/dist/FileSaver.min.js":function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,console=__webpack_require__("./node_modules/console-browserify/index.js");__WEBPACK_AMD_DEFINE_ARRAY__=[],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=function(){"use strict";function b(a,b){return void 0===b?b={autoBom:!1}:"object"!=typeof b&&(console.warn("Deprecated: Expected third argument to be a object"),b={autoBom:!b}),b.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\ufeff",a],{type:a.type}):a}function c(a,b,c){var d=new XMLHttpRequest;d.open("GET",a),d.responseType="blob",d.onload=function(){g(d.response,b,c)},d.onerror=function(){console.error("could not download file")},d.send()}function d(a){var b=new XMLHttpRequest;b.open("HEAD",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent("click"))}catch(c){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof __webpack_require__.g&&__webpack_require__.g.global===__webpack_require__.g?__webpack_require__.g:void 0,a=f.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=f.saveAs||("object"!=typeof window||window!==f?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement("a");g=g||b.name||"download",j.download=g,j.rel="noopener","string"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target="_blank")):(j.href=i.createObjectURL(b),setTimeout((function(){i.revokeObjectURL(j.href)}),4e4),setTimeout((function(){e(j)}),0))}:"msSaveOrOpenBlob"in navigator?function(f,g,h){if(g=g||f.name||"download","string"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement("a");i.href=f,i.target="_blank",setTimeout((function(){e(i)}))}}:function(b,d,e,g){if((g=g||open("","_blank"))&&(g.document.title=g.document.body.innerText="downloading..."),"string"==typeof b)return c(b,d,e);var h="application/octet-stream"===b.type,i=/constructor/i.test(f.HTMLElement)||f.safari,j=/CriOS\/[\d]+/.test(navigator.userAgent);if((j||h&&i||a)&&"undefined"!=typeof FileReader){var k=new FileReader;k.onloadend=function(){var a=k.result;a=j?a:a.replace(/^data:[^;]*;/,"data:attachment/file;"),g?g.location.href=a:location=a,g=null},k.readAsDataURL(b)}else{var l=f.URL||f.webkitURL,m=l.createObjectURL(b);g?g.location=m:location.href=m,g=null,setTimeout((function(){l.revokeObjectURL(m)}),4e4)}});f.saveAs=g.saveAs=g,module.exports=g})?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},"./node_modules/paper/dist/paper-full.js":function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_RESULT__;(function(self,undefined){var window=(self=self||__webpack_require__("?974e")).window,document=self.document,Base=new function(){var hidden=/^(statics|enumerable|beans|preserve)$/,array=[],slice=array.slice,create=Object.create,describe=Object.getOwnPropertyDescriptor,define=Object.defineProperty,forEach=array.forEach||function(iter,bind){for(var i=0,l=this.length;i<l;i++)iter.call(bind,this[i],i,this)},forIn=function(iter,bind){for(var i in this)this.hasOwnProperty(i)&&iter.call(bind,this[i],i,this)},set=Object.assign||function(dst){for(var i=1,l=arguments.length;i<l;i++){var src=arguments[i];for(var key in src)src.hasOwnProperty(key)&&(dst[key]=src[key])}return dst},each=function(obj,iter,bind){if(obj){var desc=describe(obj,"length");(desc&&"number"==typeof desc.value?forEach:forIn).call(obj,iter,bind=bind||obj)}return bind};function inject(dest,src,enumerable,beans,preserve){var beansNames={};function field(name,val){"string"==typeof(val=val||(val=describe(src,name))&&(val.get?val:val.value))&&"#"===val[0]&&(val=dest[val.substring(1)]||val);var bean,isFunc="function"==typeof val,res=val,prev=preserve||isFunc&&!val.base?val&&val.get?name in dest:dest[name]:null;preserve&&prev||(isFunc&&prev&&(val.base=prev),isFunc&&!1!==beans&&(bean=name.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(beansNames[bean[3].toLowerCase()+bean[4]]=bean[2]),res&&!isFunc&&res.get&&"function"==typeof res.get&&Base.isPlainObject(res)||(res={value:res,writable:!0}),(describe(dest,name)||{configurable:!0}).configurable&&(res.configurable=!0,res.enumerable=null!=enumerable?enumerable:!bean),define(dest,name,res))}if(src){for(var name in src)src.hasOwnProperty(name)&&!hidden.test(name)&&field(name);for(var name in beansNames){var part=beansNames[name],set=dest["set"+part],get=dest["get"+part]||set&&dest["is"+part];!get||!0!==beans&&0!==get.length||field(name,{get,set})}}return dest}function Base(){for(var i=0,l=arguments.length;i<l;i++){var src=arguments[i];src&&set(this,src)}return this}return inject(Base,{inject:function(src){if(src){var statics=!0===src.statics?src:src.statics,beans=src.beans,preserve=src.preserve;statics!==src&&inject(this.prototype,src,src.enumerable,beans,preserve),inject(this,statics,null,beans,preserve)}for(var i=1,l=arguments.length;i<l;i++)this.inject(arguments[i]);return this},extend:function(){for(var ctor,proto,obj,base=this,i=0,l=arguments.length;i<l&&(!ctor||!proto);i++)obj=arguments[i],ctor=ctor||obj.initialize,proto=proto||obj.prototype;return ctor=ctor||function(){base.apply(this,arguments)},proto=ctor.prototype=proto||create(this.prototype),define(proto,"constructor",{value:ctor,writable:!0,configurable:!0}),inject(ctor,this),arguments.length&&this.inject.apply(ctor,arguments),ctor.base=base,ctor}}).inject({enumerable:!1,initialize:Base,set:Base,inject:function(){for(var i=0,l=arguments.length;i<l;i++){var src=arguments[i];src&&inject(this,src,src.enumerable,src.beans,src.preserve)}return this},extend:function(){var res=create(this);return res.inject.apply(res,arguments)},each:function(iter,bind){return each(this,iter,bind)},clone:function(){return new this.constructor(this)},statics:{set,each,create,define,describe,clone:function(obj){return set(new obj.constructor,obj)},isPlainObject:function(obj){var ctor=null!=obj&&obj.constructor;return ctor&&(ctor===Object||ctor===Base||"Object"===ctor.name)},pick:function(a,b){return a!==undefined?a:b},slice:function(list,begin,end){return slice.call(list,begin,end)}}})};module.exports=Base,Base.inject({enumerable:!1,toString:function(){return null!=this._id?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+Base.each(this,(function(value,key){if(!/^_/.test(key)){var type=typeof value;this.push(key+": "+("number"===type?Formatter.instance.number(value):"string"===type?"'"+value+"'":value))}}),[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(json){return Base.importJSON(json,this)},exportJSON:function(options){return Base.exportJSON(this,options)},toJSON:function(){return Base.serialize(this)},set:function(props,exclude){return props&&Base.filter(this,props,exclude,this._prioritize),this}},{beans:!1,statics:{exports:{},extend:function extend(){var res=extend.base.apply(this,arguments),name=res.prototype._class;return name&&!Base.exports[name]&&(Base.exports[name]=res),res},equals:function(obj1,obj2){if(obj1===obj2)return!0;if(obj1&&obj1.equals)return obj1.equals(obj2);if(obj2&&obj2.equals)return obj2.equals(obj1);if(obj1&&obj2&&"object"==typeof obj1&&"object"==typeof obj2){if(Array.isArray(obj1)&&Array.isArray(obj2)){if((length=obj1.length)!==obj2.length)return!1;for(;length--;)if(!Base.equals(obj1[length],obj2[length]))return!1}else{var length,keys=Object.keys(obj1);if((length=keys.length)!==Object.keys(obj2).length)return!1;for(;length--;){var key=keys[length];if(!obj2.hasOwnProperty(key)||!Base.equals(obj1[key],obj2[key]))return!1}}return!0}return!1},read:function(list,start,options,amount){if(this===Base){var value=this.peek(list,start);return list.__index++,value}var proto=this.prototype,readIndex=proto._readIndex,begin=start||readIndex&&list.__index||0,length=list.length,obj=list[begin];if(amount=amount||length-begin,obj instanceof this||options&&options.readNull&&null==obj&&amount<=1)return readIndex&&(list.__index=begin+1),obj&&options&&options.clone?obj.clone():obj;if(obj=Base.create(proto),readIndex&&(obj.__read=!0),obj=obj.initialize.apply(obj,begin>0||begin+amount<length?Base.slice(list,begin,begin+amount):list)||obj,readIndex){list.__index=begin+obj.__read;var filtered=obj.__filtered;filtered&&(list.__filtered=filtered,obj.__filtered=undefined),obj.__read=undefined}return obj},peek:function(list,start){return list[list.__index=start||list.__index||0]},remain:function(list){return list.length-(list.__index||0)},readList:function(list,start,options,amount){for(var entry,res=[],begin=start||0,end=amount?begin+amount:list.length,i=begin;i<end;i++)res.push(Array.isArray(entry=list[i])?this.read(entry,0,options):this.read(list,i,options,1));return res},readNamed:function(list,name,start,options,amount){var value=this.getNamed(list,name),hasValue=value!==undefined;if(hasValue){var filtered=list.__filtered;if(!filtered){var source=this.getSource(list);(filtered=list.__filtered=Base.create(source)).__unfiltered=source}filtered[name]=undefined}return this.read(hasValue?[value]:list,start,options,amount)},readSupported:function(list,dest){var source=this.getSource(list),that=this,read=!1;return source&&Object.keys(source).forEach((function(key){if(key in dest){var value=that.readNamed(list,key);value!==undefined&&(dest[key]=value),read=!0}})),read},getSource:function(list){var source=list.__source;if(source===undefined){var arg=1===list.length&&list[0];source=list.__source=arg&&Base.isPlainObject(arg)?arg:null}return source},getNamed:function(list,name){var source=this.getSource(list);if(source)return name?source[name]:list.__filtered||source},hasNamed:function(list,name){return!!this.getNamed(list,name)},filter:function(dest,source,exclude,prioritize){var processed;function handleKey(key){if(!(exclude&&key in exclude||processed&&key in processed)){var value=source[key];value!==undefined&&(dest[key]=value)}}if(prioritize){for(var key,keys={},i=0,l=prioritize.length;i<l;i++)(key=prioritize[i])in source&&(handleKey(key),keys[key]=!0);processed=keys}return Object.keys(source.__unfiltered||source).forEach(handleKey),dest},isPlainValue:function(obj,asString){return Base.isPlainObject(obj)||Array.isArray(obj)||asString&&"string"==typeof obj},serialize:function(obj,options,compact,dictionary){options=options||{};var res,isRoot=!dictionary;if(isRoot&&(options.formatter=new Formatter(options.precision),dictionary={length:0,definitions:{},references:{},add:function(item,create){var id="#"+item._id,ref=this.references[id];if(!ref){this.length++;var res=create.call(item),name=item._class;name&&res[0]!==name&&res.unshift(name),this.definitions[id]=res,ref=this.references[id]=[id]}return ref}}),obj&&obj._serialize){res=obj._serialize(options,dictionary);var name=obj._class;!name||obj._compactSerialize||!isRoot&&compact||res[0]===name||res.unshift(name)}else if(Array.isArray(obj)){res=[];for(var i=0,l=obj.length;i<l;i++)res[i]=Base.serialize(obj[i],options,compact,dictionary)}else if(Base.isPlainObject(obj)){res={};var keys=Object.keys(obj);for(i=0,l=keys.length;i<l;i++){var key=keys[i];res[key]=Base.serialize(obj[key],options,compact,dictionary)}}else res="number"==typeof obj?options.formatter.number(obj,options.precision):obj;return isRoot&&dictionary.length>0?[["dictionary",dictionary.definitions],res]:res},deserialize:function(json,create,_data,_setDictionary,_isRoot){var res=json,isFirst=!_data,hasDictionary=isFirst&&json&&json.length&&"dictionary"===json[0][0];if(_data=_data||{},Array.isArray(json)){var type=json[0],isDictionary="dictionary"===type;if(1==json.length&&/^#/.test(type))return _data.dictionary[type];res=[];for(var i=(type=Base.exports[type])?1:0,l=json.length;i<l;i++)res.push(Base.deserialize(json[i],create,_data,isDictionary,hasDictionary));if(type){var args=res;res=create?create(type,args,isFirst||_isRoot):new type(args)}}else if(Base.isPlainObject(json))for(var key in res={},_setDictionary&&(_data.dictionary=res),json)res[key]=Base.deserialize(json[key],create,_data);return hasDictionary?res[1]:res},exportJSON:function(obj,options){var json=Base.serialize(obj,options);return options&&0==options.asString?json:JSON.stringify(json)},importJSON:function(json,target){return Base.deserialize("string"==typeof json?JSON.parse(json):json,(function(ctor,args,isRoot){var useTarget=isRoot&&target&&target.constructor===ctor,obj=useTarget?target:Base.create(ctor.prototype);if(1===args.length&&obj instanceof Item&&(useTarget||!(obj instanceof Layer))){var arg=args[0];Base.isPlainObject(arg)&&(arg.insert=!1,useTarget&&(args=args.concat([Item.INSERT])))}return(useTarget?obj.set:ctor).apply(obj,args),useTarget&&(target=null),obj}))},push:function(list,items){var itemsLength=items.length;if(itemsLength<4096)list.push.apply(list,items);else{var startLength=list.length;list.length+=itemsLength;for(var i=0;i<itemsLength;i++)list[startLength+i]=items[i]}return list},splice:function(list,items,index,remove){var amount=items&&items.length,append=index===undefined;(index=append?list.length:index)>list.length&&(index=list.length);for(var i=0;i<amount;i++)items[i]._index=index+i;if(append)return Base.push(list,items),[];var args=[index,remove];items&&Base.push(args,items);for(var removed=list.splice.apply(list,args),l=(i=0,removed.length);i<l;i++)removed[i]._index=undefined;for(i=index+amount,l=list.length;i<l;i++)list[i]._index=i;return removed},capitalize:function(str){return str.replace(/\b[a-z]/g,(function(match){return match.toUpperCase()}))},camelize:function(str){return str.replace(/-(.)/g,(function(match,chr){return chr.toUpperCase()}))},hyphenate:function(str){return str.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var Emitter={on:function(type,func){if("string"!=typeof type)Base.each(type,(function(value,key){this.on(key,value)}),this);else{var types=this._eventTypes,entry=types&&types[type],handlers=this._callbacks=this._callbacks||{};-1===(handlers=handlers[type]=handlers[type]||[]).indexOf(func)&&(handlers.push(func),entry&&entry.install&&1===handlers.length&&entry.install.call(this,type))}return this},off:function(type,func){if("string"==typeof type){var index,types=this._eventTypes,entry=types&&types[type],handlers=this._callbacks&&this._callbacks[type];return handlers&&(!func||-1!==(index=handlers.indexOf(func))&&1===handlers.length?(entry&&entry.uninstall&&entry.uninstall.call(this,type),delete this._callbacks[type]):-1!==index&&handlers.splice(index,1)),this}Base.each(type,(function(value,key){this.off(key,value)}),this)},once:function(type,func){return this.on(type,(function handler(){func.apply(this,arguments),this.off(type,handler)}))},emit:function(type,event){var handlers=this._callbacks&&this._callbacks[type];if(!handlers)return!1;var args=Base.slice(arguments,1),setTarget=event&&event.target&&!event.currentTarget;handlers=handlers.slice(),setTarget&&(event.currentTarget=this);for(var i=0,l=handlers.length;i<l;i++)if(0==handlers[i].apply(this,args)){event&&event.stop&&event.stop();break}return setTarget&&delete event.currentTarget,!0},responds:function(type){return!(!this._callbacks||!this._callbacks[type])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(install){var types=this._eventTypes,handlers=this._callbacks,key=install?"install":"uninstall";if(types)for(var type in handlers)if(handlers[type].length>0){var entry=types[type],func=entry&&entry[key];func&&func.call(this,type)}},statics:{inject:function inject(src){var events=src._events;if(events){var types={};Base.each(events,(function(entry,key){var isString="string"==typeof entry,name=isString?entry:key,part=Base.capitalize(name),type=name.substring(2).toLowerCase();types[type]=isString?{}:entry,name="_"+name,src["get"+part]=function(){return this[name]},src["set"+part]=function(func){var prev=this[name];prev&&this.off(type,prev),func&&this.on(type,func),this[name]=func}})),src._eventTypes=types}return inject.base.apply(this,arguments)}}},PaperScope=Base.extend({_class:"PaperScope",initialize:function PaperScope(){paper=this,this.settings=new Base({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this._id=PaperScope._id++,PaperScope._scopes[this._id]=this;var proto=PaperScope.prototype;if(!this.support){var ctx=CanvasProvider.getContext(1,1)||{};proto.support={nativeDash:"setLineDash"in ctx||"mozDash"in ctx,nativeBlendModes:BlendMode.nativeModes},CanvasProvider.release(ctx)}if(!this.agent){var user=self.navigator.userAgent.toLowerCase(),os=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(user)||[])[0],platform="darwin"===os?"mac":os,agent=proto.agent=proto.browser={platform};platform&&(agent[platform]=!0),user.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node|jsdom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,(function(match,n,v1,v2,rv){if(!agent.chrome){var v="opera"===n?v2:/^(node|trident)$/.test(n)?rv:v1;agent.version=v,agent.versionNumber=parseFloat(v),n={trident:"msie",jsdom:"node"}[n]||n,agent.name=n,agent[n]=!0}})),agent.chrome&&delete agent.webkit,agent.atom&&delete agent.chrome}},version:"0.12.17",getView:function(){var project=this.project;return project&&project._view},getPaper:function(){return this},execute:function(code,options){var exports=paper.PaperScript.execute(code,this,options);return View.updateFocus(),exports},install:function(scope){var that=this;for(var key in Base.each(["project","view","tool"],(function(key){Base.define(scope,key,{configurable:!0,get:function(){return that[key]}})})),this)!/^_/.test(key)&&this[key]&&(scope[key]=this[key])},setup:function(element){return paper=this,this.project=new Project(element),this},createCanvas:function(width,height){return CanvasProvider.getCanvas(width,height)},activate:function(){paper=this},clear:function(){for(var projects=this.projects,tools=this.tools,i=projects.length-1;i>=0;i--)projects[i].remove();for(i=tools.length-1;i>=0;i--)tools[i].remove()},remove:function(){this.clear(),delete PaperScope._scopes[this._id]},statics:new function(){function handleAttribute(name){return name+="Attribute",function(el,attr){return el[name](attr)||el[name]("data-paper-"+attr)}}return{_scopes:{},_id:0,get:function(id){return this._scopes[id]||null},getAttribute:handleAttribute("get"),hasAttribute:handleAttribute("has")}}}),PaperScopeItem=Base.extend(Emitter,{initialize:function(activate){this._scope=paper,this._index=this._scope[this._list].push(this)-1,!activate&&this._scope[this._reference]||this.activate()},activate:function(){if(!this._scope)return!1;var prev=this._scope[this._reference];return prev&&prev!==this&&prev.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",prev),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return null!=this._index&&(Base.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)},getView:function(){return this._scope.getView()}}),CollisionDetection={findItemBoundsCollisions:function(items1,items2,tolerance){function getBounds(items){for(var bounds=new Array(items.length),i=0;i<items.length;i++){var rect=items[i].getBounds();bounds[i]=[rect.left,rect.top,rect.right,rect.bottom]}return bounds}var bounds1=getBounds(items1),bounds2=items2&&items2!==items1?getBounds(items2):bounds1;return this.findBoundsCollisions(bounds1,bounds2,tolerance||0)},findCurveBoundsCollisions:function(curves1,curves2,tolerance,bothAxis){function getBounds(curves){for(var min=Math.min,max=Math.max,bounds=new Array(curves.length),i=0;i<curves.length;i++){var v=curves[i];bounds[i]=[min(v[0],v[2],v[4],v[6]),min(v[1],v[3],v[5],v[7]),max(v[0],v[2],v[4],v[6]),max(v[1],v[3],v[5],v[7])]}return bounds}var bounds1=getBounds(curves1),bounds2=curves2&&curves2!==curves1?getBounds(curves2):bounds1;if(bothAxis){for(var hor=this.findBoundsCollisions(bounds1,bounds2,tolerance||0,!1,!0),ver=this.findBoundsCollisions(bounds1,bounds2,tolerance||0,!0,!0),list=[],i=0,l=hor.length;i<l;i++)list[i]={hor:hor[i],ver:ver[i]};return list}return this.findBoundsCollisions(bounds1,bounds2,tolerance||0)},findBoundsCollisions:function(boundsA,boundsB,tolerance,sweepVertical,onlySweepAxisCollisions){var self=!boundsB||boundsA===boundsB,allBounds=self?boundsA:boundsA.concat(boundsB),lengthA=boundsA.length,lengthAll=allBounds.length;function binarySearch(indices,coord,value){for(var lo=0,hi=indices.length;lo<hi;){var mid=hi+lo>>>1;allBounds[indices[mid]][coord]<value?lo=mid+1:hi=mid}return lo-1}for(var pri0=sweepVertical?1:0,pri1=pri0+2,sec0=sweepVertical?0:1,sec1=sec0+2,allIndicesByPri0=new Array(lengthAll),i=0;i<lengthAll;i++)allIndicesByPri0[i]=i;allIndicesByPri0.sort((function(i1,i2){return allBounds[i1][pri0]-allBounds[i2][pri0]}));var activeIndicesByPri1=[],allCollisions=new Array(lengthA);for(i=0;i<lengthAll;i++){var curIndex=allIndicesByPri0[i],curBounds=allBounds[curIndex],origIndex=self?curIndex:curIndex-lengthA,isCurrentA=curIndex<lengthA,isCurrentB=self||!isCurrentA,curCollisions=isCurrentA?[]:null;if(activeIndicesByPri1.length){var pruneCount=binarySearch(activeIndicesByPri1,pri1,curBounds[pri0]-tolerance)+1;if(activeIndicesByPri1.splice(0,pruneCount),self&&onlySweepAxisCollisions){curCollisions=curCollisions.concat(activeIndicesByPri1);for(var j=0;j<activeIndicesByPri1.length;j++){allCollisions[activeIndex=activeIndicesByPri1[j]].push(origIndex)}}else{var curSec1=curBounds[sec1],curSec0=curBounds[sec0];for(j=0;j<activeIndicesByPri1.length;j++){var activeIndex=activeIndicesByPri1[j],activeBounds=allBounds[activeIndex],isActiveA=activeIndex<lengthA,isActiveB=self||activeIndex>=lengthA;(onlySweepAxisCollisions||(isCurrentA&&isActiveB||isCurrentB&&isActiveA)&&curSec1>=activeBounds[sec0]-tolerance&&curSec0<=activeBounds[sec1]+tolerance)&&(isCurrentA&&isActiveB&&curCollisions.push(self?activeIndex:activeIndex-lengthA),isCurrentB&&isActiveA&&allCollisions[activeIndex].push(origIndex))}}}if(isCurrentA&&(boundsA===boundsB&&curCollisions.push(curIndex),allCollisions[curIndex]=curCollisions),activeIndicesByPri1.length){var index=binarySearch(activeIndicesByPri1,pri1,curBounds[pri1]);activeIndicesByPri1.splice(index+1,0,curIndex)}else activeIndicesByPri1.push(curIndex)}for(i=0;i<allCollisions.length;i++){var collisions=allCollisions[i];collisions&&collisions.sort((function(i1,i2){return i1-i2}))}return allCollisions}},Formatter=Base.extend({initialize:function(precision){this.precision=Base.pick(precision,5),this.multiplier=Math.pow(10,this.precision)},number:function(val){return this.precision<16?Math.round(val*this.multiplier)/this.multiplier:val},pair:function(val1,val2,separator){return this.number(val1)+(separator||",")+this.number(val2)},point:function(val,separator){return this.number(val.x)+(separator||",")+this.number(val.y)},size:function(val,separator){return this.number(val.width)+(separator||",")+this.number(val.height)},rectangle:function(val,separator){return this.point(val,separator)+(separator||",")+this.size(val,separator)}});Formatter.instance=new Formatter;var Numerical=new function(){var abscissas=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],weights=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],abs=Math.abs,sqrt=Math.sqrt,pow=Math.pow,log2=Math.log2||function(x){return Math.log(x)*Math.LOG2E};function clamp(value,min,max){return value<min?min:value>max?max:value}function getDiscriminant(a,b,c){function split(v){var x=134217729*v,hi=v-x+x;return[hi,v-hi]}var D=b*b-a*c,E=b*b+a*c;if(3*abs(D)<E){var ad=split(a),bd=split(b),cd=split(c),p=b*b,q=a*c;D=p-q+(bd[0]*bd[0]-p+2*bd[0]*bd[1]+bd[1]*bd[1]-(ad[0]*cd[0]-q+ad[0]*cd[1]+ad[1]*cd[0]+ad[1]*cd[1]))}return D}function getNormalizationFactor(){var norm=Math.max.apply(Math,arguments);return norm&&(norm<1e-8||norm>1e8)?pow(2,-Math.round(log2(norm))):0}return{EPSILON:1e-12,MACHINE_EPSILON:112e-18,CURVETIME_EPSILON:1e-8,GEOMETRIC_EPSILON:1e-7,TRIGONOMETRIC_EPSILON:1e-8,ANGULAR_EPSILON:1e-5,KAPPA:4*(sqrt(2)-1)/3,isZero:function(val){return val>=-1e-12&&val<=1e-12},isMachineZero:function(val){return val>=-112e-18&&val<=112e-18},clamp,integrate:function(f,a,b,n){for(var x=abscissas[n-2],w=weights[n-2],A=.5*(b-a),B=A+a,i=0,m=n+1>>1,sum=1&n?w[i++]*f(B):0;i<m;){var Ax=A*x[i];sum+=w[i++]*(f(B+Ax)+f(B-Ax))}return A*sum},findRoot:function(f,df,x,a,b,n,tolerance){for(var i=0;i<n;i++){var fx=f(x),dx=fx/df(x),nx=x-dx;if(abs(dx)<tolerance){x=nx;break}fx>0?(b=x,x=nx<=a?.5*(a+b):nx):(a=x,x=nx>=b?.5*(a+b):nx)}return clamp(x,a,b)},solveQuadratic:function(a,b,c,roots,min,max){var x1,x2=1/0;if(abs(a)<1e-12){if(abs(b)<1e-12)return abs(c)<1e-12?-1:0;x1=-c/b}else{var D=getDiscriminant(a,b*=-.5,c);if(D&&abs(D)<112e-18){var f=getNormalizationFactor(abs(a),abs(b),abs(c));f&&(D=getDiscriminant(a*=f,b*=f,c*=f))}if(D>=-112e-18){var Q=D<0?0:sqrt(D),R=b+(b<0?-Q:Q);0===R?x2=-(x1=c/a):(x1=R/a,x2=c/R)}}var count=0,boundless=null==min,minB=min-1e-12,maxB=max+1e-12;return isFinite(x1)&&(boundless||x1>minB&&x1<maxB)&&(roots[count++]=boundless?x1:clamp(x1,min,max)),x2!==x1&&isFinite(x2)&&(boundless||x2>minB&&x2<maxB)&&(roots[count++]=boundless?x2:clamp(x2,min,max)),count},solveCubic:function(a,b,c,d,roots,min,max){var x,b1,c2,qd,q,f=getNormalizationFactor(abs(a),abs(b),abs(c),abs(d));function evaluate(x0){var tmp=a*(x=x0);qd=(tmp+(b1=tmp+b))*x+(c2=b1*x+c),q=c2*x+d}if(f&&(a*=f,b*=f,c*=f,d*=f),abs(a)<1e-12)a=b,b1=c,c2=d,x=1/0;else if(abs(d)<1e-12)b1=b,c2=c,x=0;else{evaluate(-b/a/3);var t=q/a,r=pow(abs(t),1/3),s=t<0?-1:1,td=-qd/a,rd=td>0?1.324717957244746*Math.max(r,sqrt(td)):r,x0=x-s*rd;if(x0!==x){do{evaluate(x0),x0=0===qd?x:x-q/qd/(1+112e-18)}while(s*x0>s*x);abs(a)*x*x>abs(d/x)&&(b1=((c2=-d/x)-c)/x)}}var count=Numerical.solveQuadratic(a,b1,c2,roots,min,max),boundless=null==min;return isFinite(x)&&(0===count||count>0&&x!==roots[0]&&x!==roots[1])&&(boundless||x>min-1e-12&&x<max+1e-12)&&(roots[count++]=boundless?x:clamp(x,min,max)),count}}},UID={_id:1,_pools:{},get:function(name){if(name){var pool=this._pools[name];return pool||(pool=this._pools[name]={_id:1}),pool._id++}return this._id++}},Point=Base.extend({_class:"Point",_readIndex:!0,initialize:function Point(arg0,arg1){var type=typeof arg0,reading=this.__read,read=0;if("number"===type){var hasY="number"==typeof arg1;this._set(arg0,hasY?arg1:arg0),reading&&(read=hasY?2:1)}else if("undefined"===type||null===arg0)this._set(0,0),reading&&(read=null===arg0?1:0);else{var obj="string"===type?arg0.split(/[\s,]+/)||[]:arg0;read=1,Array.isArray(obj)?this._set(+obj[0],+(obj.length>1?obj[1]:obj[0])):"x"in obj?this._set(obj.x||0,obj.y||0):"width"in obj?this._set(obj.width||0,obj.height||0):"angle"in obj?(this._set(obj.length||0,0),this.setAngle(obj.angle||0)):(this._set(0,0),read=0)}return reading&&(this.__read=read),this},set:"#initialize",_set:function(x,y){return this.x=x,this.y=y,this},equals:function(point){return this===point||point&&(this.x===point.x&&this.y===point.y||Array.isArray(point)&&this.x===point[0]&&this.y===point[1])||!1},clone:function(){return new Point(this.x,this.y)},toString:function(){var f=Formatter.instance;return"{ x: "+f.number(this.x)+", y: "+f.number(this.y)+" }"},_serialize:function(options){var f=options.formatter;return[f.number(this.x),f.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(length){if(this.isZero()){var angle=this._angle||0;this._set(Math.cos(angle)*length,Math.sin(angle)*length)}else{var scale=length/this.getLength();Numerical.isZero(scale)&&this.getAngle(),this._set(this.x*scale,this.y*scale)}},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(angle){this.setAngleInRadians.call(this,angle*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var point=Point.read(arguments),div=this.getLength()*point.getLength();if(Numerical.isZero(div))return NaN;var a=this.dot(point)/div;return Math.acos(a<-1?-1:a>1?1:a)}return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(angle){if(this._angle=angle,!this.isZero()){var length=this.getLength();this._set(Math.cos(angle)*length,Math.sin(angle)*length)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var point=Point.read(arguments);return 180*Math.atan2(this.cross(point),this.dot(point))/Math.PI},getDistance:function(){var args=arguments,point=Point.read(args),x=point.x-this.x,y=point.y-this.y,d=x*x+y*y;return Base.read(args)?d:Math.sqrt(d)},normalize:function(length){length===undefined&&(length=1);var current=this.getLength(),scale=0!==current?length/current:0,point=new Point(this.x*scale,this.y*scale);return scale>=0&&(point._angle=this._angle),point},rotate:function(angle,center){if(0===angle)return this.clone();angle=angle*Math.PI/180;var point=center?this.subtract(center):this,sin=Math.sin(angle),cos=Math.cos(angle);return point=new Point(point.x*cos-point.y*sin,point.x*sin+point.y*cos),center?point.add(center):point},transform:function(matrix){return matrix?matrix._transformPoint(this):this},add:function(){var point=Point.read(arguments);return new Point(this.x+point.x,this.y+point.y)},subtract:function(){var point=Point.read(arguments);return new Point(this.x-point.x,this.y-point.y)},multiply:function(){var point=Point.read(arguments);return new Point(this.x*point.x,this.y*point.y)},divide:function(){var point=Point.read(arguments);return new Point(this.x/point.x,this.y/point.y)},modulo:function(){var point=Point.read(arguments);return new Point(this.x%point.x,this.y%point.y)},negate:function(){return new Point(-this.x,-this.y)},isInside:function(){return Rectangle.read(arguments).contains(this)},isClose:function(){var args=arguments,point=Point.read(args),tolerance=Base.read(args);return this.getDistance(point)<=tolerance},isCollinear:function(){var point=Point.read(arguments);return Point.isCollinear(this.x,this.y,point.x,point.y)},isColinear:"#isCollinear",isOrthogonal:function(){var point=Point.read(arguments);return Point.isOrthogonal(this.x,this.y,point.x,point.y)},isZero:function(){var isZero=Numerical.isZero;return isZero(this.x)&&isZero(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(q){return this.x*(q>1&&q<4?-1:1)>=0&&this.y*(q>2?-1:1)>=0},dot:function(){var point=Point.read(arguments);return this.x*point.x+this.y*point.y},cross:function(){var point=Point.read(arguments);return this.x*point.y-this.y*point.x},project:function(){var point=Point.read(arguments),scale=point.isZero()?0:this.dot(point)/point.dot(point);return new Point(point.x*scale,point.y*scale)},statics:{min:function(){var args=arguments,point1=Point.read(args),point2=Point.read(args);return new Point(Math.min(point1.x,point2.x),Math.min(point1.y,point2.y))},max:function(){var args=arguments,point1=Point.read(args),point2=Point.read(args);return new Point(Math.max(point1.x,point2.x),Math.max(point1.y,point2.y))},random:function(){return new Point(Math.random(),Math.random())},isCollinear:function(x1,y1,x2,y2){return Math.abs(x1*y2-y1*x2)<=1e-8*Math.sqrt((x1*x1+y1*y1)*(x2*x2+y2*y2))},isOrthogonal:function(x1,y1,x2,y2){return Math.abs(x1*x2+y1*y2)<=1e-8*Math.sqrt((x1*x1+y1*y1)*(x2*x2+y2*y2))}}},Base.each(["round","ceil","floor","abs"],(function(key){var op=Math[key];this[key]=function(){return new Point(op(this.x),op(this.y))}}),{})),LinkedPoint=Point.extend({initialize:function Point(x,y,owner,setter){this._x=x,this._y=y,this._owner=owner,this._setter=setter},_set:function(x,y,_dontNotify){return this._x=x,this._y=y,_dontNotify||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(x){this._x=x,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(y){this._y=y,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(selected){this._owner._changeSelection(this._getSelection(),selected)},_getSelection:function(){return"setPosition"===this._setter?4:0}}),Size=Base.extend({_class:"Size",_readIndex:!0,initialize:function Size(arg0,arg1){var type=typeof arg0,reading=this.__read,read=0;if("number"===type){var hasHeight="number"==typeof arg1;this._set(arg0,hasHeight?arg1:arg0),reading&&(read=hasHeight?2:1)}else if("undefined"===type||null===arg0)this._set(0,0),reading&&(read=null===arg0?1:0);else{var obj="string"===type?arg0.split(/[\s,]+/)||[]:arg0;read=1,Array.isArray(obj)?this._set(+obj[0],+(obj.length>1?obj[1]:obj[0])):"width"in obj?this._set(obj.width||0,obj.height||0):"x"in obj?this._set(obj.x||0,obj.y||0):(this._set(0,0),read=0)}return reading&&(this.__read=read),this},set:"#initialize",_set:function(width,height){return this.width=width,this.height=height,this},equals:function(size){return size===this||size&&(this.width===size.width&&this.height===size.height||Array.isArray(size)&&this.width===size[0]&&this.height===size[1])||!1},clone:function(){return new Size(this.width,this.height)},toString:function(){var f=Formatter.instance;return"{ width: "+f.number(this.width)+", height: "+f.number(this.height)+" }"},_serialize:function(options){var f=options.formatter;return[f.number(this.width),f.number(this.height)]},add:function(){var size=Size.read(arguments);return new Size(this.width+size.width,this.height+size.height)},subtract:function(){var size=Size.read(arguments);return new Size(this.width-size.width,this.height-size.height)},multiply:function(){var size=Size.read(arguments);return new Size(this.width*size.width,this.height*size.height)},divide:function(){var size=Size.read(arguments);return new Size(this.width/size.width,this.height/size.height)},modulo:function(){var size=Size.read(arguments);return new Size(this.width%size.width,this.height%size.height)},negate:function(){return new Size(-this.width,-this.height)},isZero:function(){var isZero=Numerical.isZero;return isZero(this.width)&&isZero(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(size1,size2){return new Size(Math.min(size1.width,size2.width),Math.min(size1.height,size2.height))},max:function(size1,size2){return new Size(Math.max(size1.width,size2.width),Math.max(size1.height,size2.height))},random:function(){return new Size(Math.random(),Math.random())}}},Base.each(["round","ceil","floor","abs"],(function(key){var op=Math[key];this[key]=function(){return new Size(op(this.width),op(this.height))}}),{})),LinkedSize=Size.extend({initialize:function Size(width,height,owner,setter){this._width=width,this._height=height,this._owner=owner,this._setter=setter},_set:function(width,height,_dontNotify){return this._width=width,this._height=height,_dontNotify||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(width){this._width=width,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(height){this._height=height,this._owner[this._setter](this)}}),Rectangle=Base.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function Rectangle(arg0,arg1,arg2,arg3){var read,args=arguments,type=typeof arg0;if("number"===type?(this._set(arg0,arg1,arg2,arg3),read=4):"undefined"===type||null===arg0?(this._set(0,0,0,0),read=null===arg0?1:0):1===args.length&&(Array.isArray(arg0)?(this._set.apply(this,arg0),read=1):arg0.x!==undefined||arg0.width!==undefined?(this._set(arg0.x||0,arg0.y||0,arg0.width||0,arg0.height||0),read=1):arg0.from===undefined&&arg0.to===undefined&&(this._set(0,0,0,0),Base.readSupported(args,this)&&(read=1))),read===undefined){var width,height,frm=Point.readNamed(args,"from"),next=Base.peek(args),x=frm.x,y=frm.y;if(next&&next.x!==undefined||Base.hasNamed(args,"to")){var to=Point.readNamed(args,"to");width=to.x-x,height=to.y-y,width<0&&(x=to.x,width=-width),height<0&&(y=to.y,height=-height)}else{var size=Size.read(args);width=size.width,height=size.height}this._set(x,y,width,height),read=args.__index}var filtered=args.__filtered;return filtered&&(this.__filtered=filtered),this.__read&&(this.__read=read),this},set:"#initialize",_set:function(x,y,width,height){return this.x=x,this.y=y,this.width=width,this.height=height,this},clone:function(){return new Rectangle(this.x,this.y,this.width,this.height)},equals:function(rect){var rt=Base.isPlainValue(rect)?Rectangle.read(arguments):rect;return rt===this||rt&&this.x===rt.x&&this.y===rt.y&&this.width===rt.width&&this.height===rt.height||!1},toString:function(){var f=Formatter.instance;return"{ x: "+f.number(this.x)+", y: "+f.number(this.y)+", width: "+f.number(this.width)+", height: "+f.number(this.height)+" }"},_serialize:function(options){var f=options.formatter;return[f.number(this.x),f.number(this.y),f.number(this.width),f.number(this.height)]},getPoint:function(_dontLink){return new(_dontLink?Point:LinkedPoint)(this.x,this.y,this,"setPoint")},setPoint:function(){var point=Point.read(arguments);this.x=point.x,this.y=point.y},getSize:function(_dontLink){return new(_dontLink?Size:LinkedSize)(this.width,this.height,this,"setSize")},_fw:1,_fh:1,setSize:function(){var size=Size.read(arguments),sx=this._sx,sy=this._sy,w=size.width,h=size.height;sx&&(this.x+=(this.width-w)*sx),sy&&(this.y+=(this.height-h)*sy),this.width=w,this.height=h,this._fw=this._fh=1},getLeft:function(){return this.x},setLeft:function(left){if(!this._fw){var amount=left-this.x;this.width-=.5===this._sx?2*amount:amount}this.x=left,this._sx=this._fw=0},getTop:function(){return this.y},setTop:function(top){if(!this._fh){var amount=top-this.y;this.height-=.5===this._sy?2*amount:amount}this.y=top,this._sy=this._fh=0},getRight:function(){return this.x+this.width},setRight:function(right){if(!this._fw){var amount=right-this.x;this.width=.5===this._sx?2*amount:amount}this.x=right-this.width,this._sx=1,this._fw=0},getBottom:function(){return this.y+this.height},setBottom:function(bottom){if(!this._fh){var amount=bottom-this.y;this.height=.5===this._sy?2*amount:amount}this.y=bottom-this.height,this._sy=1,this._fh=0},getCenterX:function(){return this.x+this.width/2},setCenterX:function(x){this._fw||.5===this._sx?this.x=x-this.width/2:(this._sx&&(this.x+=2*(x-this.x)*this._sx),this.width=2*(x-this.x)),this._sx=.5,this._fw=0},getCenterY:function(){return this.y+this.height/2},setCenterY:function(y){this._fh||.5===this._sy?this.y=y-this.height/2:(this._sy&&(this.y+=2*(y-this.y)*this._sy),this.height=2*(y-this.y)),this._sy=.5,this._fh=0},getCenter:function(_dontLink){return new(_dontLink?Point:LinkedPoint)(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var point=Point.read(arguments);return this.setCenterX(point.x),this.setCenterY(point.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(arg){return arg&&arg.width!==undefined||4===(Array.isArray(arg)?arg:arguments).length?this._containsRectangle(Rectangle.read(arguments)):this._containsPoint(Point.read(arguments))},_containsPoint:function(point){var x=point.x,y=point.y;return x>=this.x&&y>=this.y&&x<=this.x+this.width&&y<=this.y+this.height},_containsRectangle:function(rect){var x=rect.x,y=rect.y;return x>=this.x&&y>=this.y&&x+rect.width<=this.x+this.width&&y+rect.height<=this.y+this.height},intersects:function(){var rect=Rectangle.read(arguments),epsilon=Base.read(arguments)||0;return rect.x+rect.width>this.x-epsilon&&rect.y+rect.height>this.y-epsilon&&rect.x<this.x+this.width+epsilon&&rect.y<this.y+this.height+epsilon},intersect:function(){var rect=Rectangle.read(arguments),x1=Math.max(this.x,rect.x),y1=Math.max(this.y,rect.y),x2=Math.min(this.x+this.width,rect.x+rect.width),y2=Math.min(this.y+this.height,rect.y+rect.height);return new Rectangle(x1,y1,x2-x1,y2-y1)},unite:function(){var rect=Rectangle.read(arguments),x1=Math.min(this.x,rect.x),y1=Math.min(this.y,rect.y),x2=Math.max(this.x+this.width,rect.x+rect.width),y2=Math.max(this.y+this.height,rect.y+rect.height);return new Rectangle(x1,y1,x2-x1,y2-y1)},include:function(){var point=Point.read(arguments),x1=Math.min(this.x,point.x),y1=Math.min(this.y,point.y),x2=Math.max(this.x+this.width,point.x),y2=Math.max(this.y+this.height,point.y);return new Rectangle(x1,y1,x2-x1,y2-y1)},expand:function(){var amount=Size.read(arguments),hor=amount.width,ver=amount.height;return new Rectangle(this.x-hor/2,this.y-ver/2,this.width+hor,this.height+ver)},scale:function(hor,ver){return this.expand(this.width*hor-this.width,this.height*(ver===undefined?hor:ver)-this.height)}},Base.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],(function(parts,index){var part=parts.join(""),xFirst=/^[RL]/.test(part);index>=4&&(parts[1]+=xFirst?"Y":"X");var x=parts[xFirst?0:1],y=parts[xFirst?1:0],getX="get"+x,getY="get"+y,setX="set"+x,setY="set"+y,set="set"+part;this["get"+part]=function(_dontLink){return new(_dontLink?Point:LinkedPoint)(this[getX](),this[getY](),this,set)},this[set]=function(){var point=Point.read(arguments);this[setX](point.x),this[setY](point.y)}}),{beans:!0})),LinkedRectangle=Rectangle.extend({initialize:function Rectangle(x,y,width,height,owner,setter){this._set(x,y,width,height,!0),this._owner=owner,this._setter=setter},_set:function(x,y,width,height,_dontNotify){return this._x=x,this._y=y,this._width=width,this._height=height,_dontNotify||this._owner[this._setter](this),this}},new function(){var proto=Rectangle.prototype;return Base.each(["x","y","width","height"],(function(key){var part=Base.capitalize(key),internal="_"+key;this["get"+part]=function(){return this[internal]},this["set"+part]=function(value){this[internal]=value,this._dontNotify||this._owner[this._setter](this)}}),Base.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],(function(key){var name="set"+key;this[name]=function(){this._dontNotify=!0,proto[name].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}}),{isSelected:function(){return!!(2&this._owner._selection)},setSelected:function(selected){var owner=this._owner;owner._changeSelection&&owner._changeSelection(2,selected)}}))}),Matrix=Base.extend({_class:"Matrix",initialize:function Matrix(arg,_dontNotify){var args=arguments,count=args.length,ok=!0;if(count>=6?this._set.apply(this,args):1===count||2===count?arg instanceof Matrix?this._set(arg._a,arg._b,arg._c,arg._d,arg._tx,arg._ty,_dontNotify):Array.isArray(arg)?this._set.apply(this,_dontNotify?arg.concat([_dontNotify]):arg):ok=!1:count?ok=!1:this.reset(),!ok)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(a,b,c,d,tx,ty,_dontNotify){return this._a=a,this._b=b,this._c=c,this._d=d,this._tx=tx,this._ty=ty,_dontNotify||this._changed(),this},_serialize:function(options,dictionary){return Base.serialize(this.getValues(),options,!0,dictionary)},_changed:function(){var owner=this._owner;owner&&(owner._applyMatrix?owner.transform(null,!0):owner._changed(25))},clone:function(){return new Matrix(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(mx){return mx===this||mx&&this._a===mx._a&&this._b===mx._b&&this._c===mx._c&&this._d===mx._d&&this._tx===mx._tx&&this._ty===mx._ty},toString:function(){var f=Formatter.instance;return"[["+[f.number(this._a),f.number(this._c),f.number(this._tx)].join(", ")+"], ["+[f.number(this._b),f.number(this._d),f.number(this._ty)].join(", ")+"]]"},reset:function(_dontNotify){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,_dontNotify||this._changed(),this},apply:function(recursively,_setApplyMatrix){var owner=this._owner;return!!owner&&(owner.transform(null,Base.pick(recursively,!0),_setApplyMatrix),this.isIdentity())},translate:function(){var point=Point.read(arguments),x=point.x,y=point.y;return this._tx+=x*this._a+y*this._c,this._ty+=x*this._b+y*this._d,this._changed(),this},scale:function(){var args=arguments,scale=Point.read(args),center=Point.read(args,0,{readNull:!0});return center&&this.translate(center),this._a*=scale.x,this._b*=scale.x,this._c*=scale.y,this._d*=scale.y,center&&this.translate(center.negate()),this._changed(),this},rotate:function(angle){angle*=Math.PI/180;var center=Point.read(arguments,1),x=center.x,y=center.y,cos=Math.cos(angle),sin=Math.sin(angle),tx=x-x*cos+y*sin,ty=y-x*sin-y*cos,a=this._a,b=this._b,c=this._c,d=this._d;return this._a=cos*a+sin*c,this._b=cos*b+sin*d,this._c=-sin*a+cos*c,this._d=-sin*b+cos*d,this._tx+=tx*a+ty*c,this._ty+=tx*b+ty*d,this._changed(),this},shear:function(){var args=arguments,shear=Point.read(args),center=Point.read(args,0,{readNull:!0});center&&this.translate(center);var a=this._a,b=this._b;return this._a+=shear.y*this._c,this._b+=shear.y*this._d,this._c+=shear.x*a,this._d+=shear.x*b,center&&this.translate(center.negate()),this._changed(),this},skew:function(){var args=arguments,skew=Point.read(args),center=Point.read(args,0,{readNull:!0}),toRadians=Math.PI/180,shear=new Point(Math.tan(skew.x*toRadians),Math.tan(skew.y*toRadians));return this.shear(shear,center)},append:function(mx,_dontNotify){if(mx){var a1=this._a,b1=this._b,c1=this._c,d1=this._d,a2=mx._a,b2=mx._c,c2=mx._b,d2=mx._d,tx2=mx._tx,ty2=mx._ty;this._a=a2*a1+c2*c1,this._c=b2*a1+d2*c1,this._b=a2*b1+c2*d1,this._d=b2*b1+d2*d1,this._tx+=tx2*a1+ty2*c1,this._ty+=tx2*b1+ty2*d1,_dontNotify||this._changed()}return this},prepend:function(mx,_dontNotify){if(mx){var a1=this._a,b1=this._b,c1=this._c,d1=this._d,tx1=this._tx,ty1=this._ty,a2=mx._a,b2=mx._c,c2=mx._b,d2=mx._d,tx2=mx._tx,ty2=mx._ty;this._a=a2*a1+b2*b1,this._c=a2*c1+b2*d1,this._b=c2*a1+d2*b1,this._d=c2*c1+d2*d1,this._tx=a2*tx1+b2*ty1+tx2,this._ty=c2*tx1+d2*ty1+ty2,_dontNotify||this._changed()}return this},appended:function(mx){return this.clone().append(mx)},prepended:function(mx){return this.clone().prepend(mx)},invert:function(){var a=this._a,b=this._b,c=this._c,d=this._d,tx=this._tx,ty=this._ty,det=a*d-b*c,res=null;return det&&!isNaN(det)&&isFinite(tx)&&isFinite(ty)&&(this._a=d/det,this._b=-b/det,this._c=-c/det,this._d=a/det,this._tx=(c*ty-d*tx)/det,this._ty=(b*tx-a*ty)/det,res=this),res},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new Matrix(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return 1===this._a&&0===this._b&&0===this._c&&1===this._d&&0===this._tx&&0===this._ty},isInvertible:function(){var det=this._a*this._d-this._c*this._b;return det&&!isNaN(det)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(src,dst,count){return arguments.length<3?this._transformPoint(Point.read(arguments)):this._transformCoordinates(src,dst,count)},_transformPoint:function(point,dest,_dontNotify){var x=point.x,y=point.y;return dest||(dest=new Point),dest._set(x*this._a+y*this._c+this._tx,x*this._b+y*this._d+this._ty,_dontNotify)},_transformCoordinates:function(src,dst,count){for(var i=0,max=2*count;i<max;i+=2){var x=src[i],y=src[i+1];dst[i]=x*this._a+y*this._c+this._tx,dst[i+1]=x*this._b+y*this._d+this._ty}return dst},_transformCorners:function(rect){var x1=rect.x,y1=rect.y,x2=x1+rect.width,y2=y1+rect.height,coords=[x1,y1,x2,y1,x2,y2,x1,y2];return this._transformCoordinates(coords,coords,4)},_transformBounds:function(bounds,dest,_dontNotify){for(var coords=this._transformCorners(bounds),min=coords.slice(0,2),max=min.slice(),i=2;i<8;i++){var val=coords[i],j=1&i;val<min[j]?min[j]=val:val>max[j]&&(max[j]=val)}return dest||(dest=new Rectangle),dest._set(min[0],min[1],max[0]-min[0],max[1]-min[1],_dontNotify)},inverseTransform:function(){return this._inverseTransform(Point.read(arguments))},_inverseTransform:function(point,dest,_dontNotify){var a=this._a,b=this._b,c=this._c,d=this._d,tx=this._tx,ty=this._ty,det=a*d-b*c,res=null;if(det&&!isNaN(det)&&isFinite(tx)&&isFinite(ty)){var x=point.x-this._tx,y=point.y-this._ty;dest||(dest=new Point),res=dest._set((x*d-y*c)/det,(y*a-x*b)/det,_dontNotify)}return res},decompose:function(){var rotate,scale,skew,a=this._a,b=this._b,c=this._c,d=this._d,det=a*d-b*c,sqrt=Math.sqrt,atan2=Math.atan2,degrees=180/Math.PI;if(0!==a||0!==b){var r=sqrt(a*a+b*b);rotate=Math.acos(a/r)*(b>0?1:-1),scale=[r,det/r],skew=[atan2(a*c+b*d,r*r),0]}else if(0!==c||0!==d){var s=sqrt(c*c+d*d);rotate=Math.asin(c/s)*(d>0?1:-1),scale=[det/s,s],skew=[0,atan2(a*c+b*d,s*s)]}else rotate=0,skew=scale=[0,0];return{translation:this.getTranslation(),rotation:rotate*degrees,scaling:new Point(scale),skewing:new Point(skew[0]*degrees,skew[1]*degrees)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new Point(this._tx,this._ty)},getScaling:function(){return this.decompose().scaling},getRotation:function(){return this.decompose().rotation},applyToContext:function(ctx){this.isIdentity()||ctx.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},Base.each(["a","b","c","d","tx","ty"],(function(key){var part=Base.capitalize(key),prop="_"+key;this["get"+part]=function(){return this[prop]},this["set"+part]=function(value){this[prop]=value,this._changed()}}),{})),Line=Base.extend({_class:"Line",initialize:function Line(arg0,arg1,arg2,arg3,arg4){var asVector=!1;arguments.length>=4?(this._px=arg0,this._py=arg1,this._vx=arg2,this._vy=arg3,asVector=arg4):(this._px=arg0.x,this._py=arg0.y,this._vx=arg1.x,this._vy=arg1.y,asVector=arg2),asVector||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new Point(this._px,this._py)},getVector:function(){return new Point(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(line,isInfinite){return Line.intersect(this._px,this._py,this._vx,this._vy,line._px,line._py,line._vx,line._vy,!0,isInfinite)},getSide:function(point,isInfinite){return Line.getSide(this._px,this._py,this._vx,this._vy,point.x,point.y,!0,isInfinite)},getDistance:function(point){return Math.abs(this.getSignedDistance(point))},getSignedDistance:function(point){return Line.getSignedDistance(this._px,this._py,this._vx,this._vy,point.x,point.y,!0)},isCollinear:function(line){return Point.isCollinear(this._vx,this._vy,line._vx,line._vy)},isOrthogonal:function(line){return Point.isOrthogonal(this._vx,this._vy,line._vx,line._vy)},statics:{intersect:function(p1x,p1y,v1x,v1y,p2x,p2y,v2x,v2y,asVector,isInfinite){asVector||(v1x-=p1x,v1y-=p1y,v2x-=p2x,v2y-=p2y);var cross=v1x*v2y-v1y*v2x;if(!Numerical.isMachineZero(cross)){var dx=p1x-p2x,dy=p1y-p2y,u1=(v2x*dy-v2y*dx)/cross,u2=(v1x*dy-v1y*dx)/cross,uMax=1+1e-12;if(isInfinite||-1e-12<u1&&u1<uMax&&-1e-12<u2&&u2<uMax)return isInfinite||(u1=u1<=0?0:u1>=1?1:u1),new Point(p1x+u1*v1x,p1y+u1*v1y)}},getSide:function(px,py,vx,vy,x,y,asVector,isInfinite){asVector||(vx-=px,vy-=py);var v2x=x-px,ccw=v2x*vy-(y-py)*vx;return!isInfinite&&Numerical.isMachineZero(ccw)&&(ccw=(v2x*vx+v2x*vx)/(vx*vx+vy*vy))>=0&&ccw<=1&&(ccw=0),ccw<0?-1:ccw>0?1:0},getSignedDistance:function(px,py,vx,vy,x,y,asVector){return asVector||(vx-=px,vy-=py),0===vx?vy>0?x-px:px-x:0===vy?vx<0?y-py:py-y:((x-px)*vy-(y-py)*vx)/(vy>vx?vy*Math.sqrt(1+vx*vx/(vy*vy)):vx*Math.sqrt(1+vy*vy/(vx*vx)))},getDistance:function(px,py,vx,vy,x,y,asVector){return Math.abs(Line.getSignedDistance(px,py,vx,vy,x,y,asVector))}}}),Project=PaperScopeItem.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function Project(element){PaperScopeItem.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new Style(null,null,this),this._view=View.create(this,element||CanvasProvider.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(options,dictionary){return Base.serialize(this._children,options,!0,dictionary)},_changed:function(flags,item){if(1&flags){var view=this._view;view&&(view._needsUpdate=!0,!view._requested&&view._autoUpdate&&view.requestUpdate())}var changes=this._changes;if(changes&&item){var changesById=this._changesById,id=item._id,entry=changesById[id];entry?entry.flags|=flags:changes.push(changesById[id]={item,flags})}},clear:function(){for(var children=this._children,i=children.length-1;i>=0;i--)children[i].remove()},isEmpty:function(){return!this._children.length},remove:function remove(){return!!remove.base.call(this)&&(this._view&&this._view.remove(),!0)},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(style){this._currentStyle.set(style)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new Layer({project:this,insert:!0})},getSymbolDefinitions:function(){var definitions=[],ids={};return this.getItems({class:SymbolItem,match:function(item){var definition=item._definition,id=definition._id;return ids[id]||(ids[id]=!0,definitions.push(definition)),!1}}),definitions},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var selectionItems=this._selectionItems,items=[];for(var id in selectionItems){var item=selectionItems[id],selection=item._selection;1&selection&&item.isInserted()?items.push(item):selection||this._updateSelection(item)}return items},_updateSelection:function(item){var id=item._id,selectionItems=this._selectionItems;item._selection?selectionItems[id]!==item&&(this._selectionCount++,selectionItems[id]=item):selectionItems[id]===item&&(this._selectionCount--,delete selectionItems[id])},selectAll:function(){for(var children=this._children,i=0,l=children.length;i<l;i++)children[i].setFullySelected(!0)},deselectAll:function(){var selectionItems=this._selectionItems;for(var i in selectionItems)selectionItems[i].setFullySelected(!1)},addLayer:function(layer){return this.insertLayer(undefined,layer)},insertLayer:function(index,layer){if(layer instanceof Layer){layer._remove(!1,!0),Base.splice(this._children,[layer],index,0),layer._setProject(this,!0);var name=layer._name;name&&layer.setName(name),this._changes&&layer._changed(5),this._activeLayer||(this._activeLayer=layer)}else layer=null;return layer},_insertItem:function(index,item,_created){return item=this.insertLayer(index,item)||(this._activeLayer||this._insertItem(undefined,new Layer(Item.NO_INSERT),!0)).insertChild(index,item),_created&&item.activate&&item.activate(),item},getItems:function(options){return Item._getItems(this,options)},getItem:function(options){return Item._getItems(this,options,null,null,!0)[0]||null},importJSON:function(json){this.activate();var layer=this._activeLayer;return Base.importJSON(json,layer&&layer.isEmpty()&&layer)},removeOn:function(type){var sets=this._removeSets;if(sets){"mouseup"===type&&(sets.mousedrag=null);var set=sets[type];if(set){for(var id in set){var item=set[id];for(var key in sets){var other=sets[key];other&&other!=set&&delete other[item._id]}item.remove()}sets[type]=null}}},draw:function(ctx,matrix,pixelRatio){this._updateVersion++,ctx.save(),matrix.applyToContext(ctx);for(var children=this._children,param=new Base({offset:new Point(0,0),pixelRatio,viewMatrix:matrix.isIdentity()?null:matrix,matrices:[new Matrix],updateMatrix:!0}),i=0,l=children.length;i<l;i++)children[i].draw(ctx,param);if(ctx.restore(),this._selectionCount>0){ctx.save(),ctx.strokeWidth=1;var items=this._selectionItems,size=this._scope.settings.handleSize,version=this._updateVersion;for(var id in items)items[id]._drawSelection(ctx,matrix,size,items,version);ctx.restore()}}}),Item=Base.extend(Emitter,{statics:{extend:function extend(src){return src._serializeFields&&(src._serializeFields=Base.set({},this.prototype._serializeFields,src._serializeFields)),extend.base.apply(this,arguments)},INSERT:{insert:!0},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new Matrix,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var handlers=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return Base.each(handlers,(function(name){this._events[name]={install:function(type){this.getView()._countItemEvent(type,1)},uninstall:function(type){this.getView()._countItemEvent(type,-1)}}}),{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:handlers}})},{initialize:function Item(){},_initialize:function(props,point){var hasProps=props&&Base.isPlainObject(props),internal=hasProps&&!0===props.internal,matrix=this._matrix=new Matrix,project=hasProps&&props.project||paper.project,settings=paper.settings;return this._id=internal?null:UID.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&settings.applyMatrix,point&&matrix.translate(point),matrix._owner=this,this._style=new Style(project._currentStyle,this,project),internal||hasProps&&0==props.insert||!settings.insertItems&&(!hasProps||1!=props.insert)?this._setProject(project):(hasProps&&props.parent||project)._insertItem(undefined,this,!0),hasProps&&props!==Item.NO_INSERT&&props!==Item.INSERT&&this.set(props,{internal:!0,insert:!0,project:!0,parent:!0}),hasProps},_serialize:function(options,dictionary){var props={},that=this;function serialize(fields){for(var key in fields){var value=that[key];Base.equals(value,"leading"===key?1.2*fields.fontSize:fields[key])||(props[key]=Base.serialize(value,options,"data"!==key,dictionary))}}return serialize(this._serializeFields),this instanceof Group||serialize(this._style._defaults),[this._class,props]},_changed:function(flags){var symbol=this._symbol,cacheParent=this._parent||symbol,project=this._project;8&flags&&(this._bounds=this._position=this._decomposed=undefined),16&flags&&(this._globalMatrix=undefined),cacheParent&&72&flags&&Item._clearBoundsCache(cacheParent),2&flags&&Item._clearBoundsCache(this),project&&project._changed(flags,this),symbol&&symbol._changed(flags)},getId:function(){return this._id},getName:function(){return this._name},setName:function(name){if(this._name&&this._removeNamed(),name===+name+"")throw new Error("Names consisting only of numbers are not supported.");var owner=this._getOwner();if(name&&owner){var children=owner._children,namedChildren=owner._namedChildren;(namedChildren[name]=namedChildren[name]||[]).push(this),name in children||(children[name]=this)}this._name=name||undefined,this._changed(256)},getStyle:function(){return this._style},setStyle:function(style){this.getStyle().set(style)}},Base.each(["locked","visible","blendMode","opacity","guide"],(function(name){var part=Base.capitalize(name),key="_"+name,flags={locked:256,visible:265};this["get"+part]=function(){return this[key]},this["set"+part]=function(value){value!=this[key]&&(this[key]=value,this._changed(flags[name]||257))}}),{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(selection){if(selection!==this._selection){this._selection=selection;var project=this._project;project&&(project._updateSelection(this),this._changed(257))}},_changeSelection:function(flag,selected){var selection=this._selection;this.setSelection(selected?selection|flag:selection&~flag)},isSelected:function(){if(this._selectChildren)for(var children=this._children,i=0,l=children.length;i<l;i++)if(children[i].isSelected())return!0;return!!(1&this._selection)},setSelected:function(selected){if(this._selectChildren)for(var children=this._children,i=0,l=children.length;i<l;i++)children[i].setSelected(selected);this._changeSelection(1,selected)},isFullySelected:function(){var children=this._children,selected=!!(1&this._selection);if(children&&selected){for(var i=0,l=children.length;i<l;i++)if(!children[i].isFullySelected())return!1;return!0}return selected},setFullySelected:function(selected){var children=this._children;if(children)for(var i=0,l=children.length;i<l;i++)children[i].setFullySelected(selected);this._changeSelection(1,selected)},isClipMask:function(){return this._clipMask},setClipMask:function(clipMask){this._clipMask!=(clipMask=!!clipMask)&&(this._clipMask=clipMask,clipMask&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(257),this._parent&&this._parent._changed(2048))},getData:function(){return this._data||(this._data={}),this._data},setData:function(data){this._data=data},getPosition:function(_dontLink){var ctor=_dontLink?Point:LinkedPoint,position=this._position||(this._position=this._getPositionFromBounds());return new ctor(position.x,position.y,this,"setPosition")},setPosition:function(){this.translate(Point.read(arguments).subtract(this.getPosition(!0)))},_getPositionFromBounds:function(bounds){return this._pivot?this._matrix._transformPoint(this._pivot):(bounds||this.getBounds()).getCenter(!0)},getPivot:function(){var pivot=this._pivot;return pivot?new LinkedPoint(pivot.x,pivot.y,this,"setPivot"):null},setPivot:function(){this._pivot=Point.read(arguments,0,{clone:!0,readNull:!0}),this._position=undefined}},Base.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},(function(options,key){this[key]=function(matrix){return this.getBounds(matrix,options)}}),{beans:!0,getBounds:function(matrix,options){var hasMatrix=options||matrix instanceof Matrix,opts=Base.set({},hasMatrix?options:matrix,this._boundsOptions);opts.stroke&&!this.getStrokeScaling()||(opts.cacheItem=this);var rect=this._getCachedBounds(hasMatrix&&matrix,opts).rect;return arguments.length?rect:new LinkedRectangle(rect.x,rect.y,rect.width,rect.height,this,"setBounds")},setBounds:function(){var rect=Rectangle.read(arguments),bounds=this.getBounds(),_matrix=this._matrix,matrix=new Matrix,center=rect.getCenter();matrix.translate(center),rect.width==bounds.width&&rect.height==bounds.height||(_matrix.isInvertible()||(_matrix.set(_matrix._backup||(new Matrix).translate(_matrix.getTranslation())),bounds=this.getBounds()),matrix.scale(0!==bounds.width?rect.width/bounds.width:0,0!==bounds.height?rect.height/bounds.height:0)),center=bounds.getCenter(),matrix.translate(-center.x,-center.y),this.transform(matrix)},_getBounds:function(matrix,options){var children=this._children;return children&&children.length?(Item._updateBoundsCache(this,options.cacheItem),Item._getBounds(children,matrix,options)):new Rectangle},_getBoundsCacheKey:function(options,internal){return[options.stroke?1:0,options.handle?1:0,internal?1:0].join("")},_getCachedBounds:function(matrix,options,noInternal){matrix=matrix&&matrix._orNullIfIdentity();var internal=options.internal&&!noInternal,cacheItem=options.cacheItem,_matrix=internal?null:this._matrix._orNullIfIdentity(),cacheKey=cacheItem&&(!matrix||matrix.equals(_matrix))&&this._getBoundsCacheKey(options,internal),bounds=this._bounds;if(Item._updateBoundsCache(this._parent||this._symbol,cacheItem),cacheKey&&bounds&&cacheKey in bounds)return{rect:(cached=bounds[cacheKey]).rect.clone(),nonscaling:cached.nonscaling};var res=this._getBounds(matrix||_matrix,options),rect=res.rect||res,style=this._style,nonscaling=res.nonscaling||style.hasStroke()&&!style.getStrokeScaling();if(cacheKey){bounds||(this._bounds=bounds={});var cached=bounds[cacheKey]={rect:rect.clone(),nonscaling,internal}}return{rect,nonscaling}},_getStrokeMatrix:function(matrix,options){var parent=this.getStrokeScaling()?null:options&&options.internal?this:this._parent||this._symbol&&this._symbol._item,mx=parent?parent.getViewMatrix().invert():matrix;return mx&&mx._shiftless()},statics:{_updateBoundsCache:function(parent,item){if(parent&&item){var id=item._id,ref=parent._boundsCache=parent._boundsCache||{ids:{},list:[]};ref.ids[id]||(ref.list.push(item),ref.ids[id]=item)}},_clearBoundsCache:function(item){var cache=item._boundsCache;if(cache){item._bounds=item._position=item._boundsCache=undefined;for(var i=0,list=cache.list,l=list.length;i<l;i++){var other=list[i];other!==item&&(other._bounds=other._position=undefined,other._boundsCache&&Item._clearBoundsCache(other))}}},_getBounds:function(items,matrix,options){var x1=1/0,x2=-x1,y1=x1,y2=x2,nonscaling=!1;options=options||{};for(var i=0,l=items.length;i<l;i++){var item=items[i];if(item._visible&&!item.isEmpty(!0)){var bounds=item._getCachedBounds(matrix&&matrix.appended(item._matrix),options,!0),rect=bounds.rect;x1=Math.min(rect.x,x1),y1=Math.min(rect.y,y1),x2=Math.max(rect.x+rect.width,x2),y2=Math.max(rect.y+rect.height,y2),bounds.nonscaling&&(nonscaling=!0)}}return{rect:isFinite(x1)?new Rectangle(x1,y1,x2-x1,y2-y1):new Rectangle,nonscaling}}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var decomposed=this._decompose();return decomposed?decomposed.rotation:0},setRotation:function(rotation){var current=this.getRotation();if(null!=current&&null!=rotation){var decomposed=this._decomposed;this.rotate(rotation-current),decomposed&&(decomposed.rotation=rotation,this._decomposed=decomposed)}},getScaling:function(){var decomposed=this._decompose(),s=decomposed&&decomposed.scaling;return new LinkedPoint(s?s.x:1,s?s.y:1,this,"setScaling")},setScaling:function(){var current=this.getScaling(),scaling=Point.read(arguments,0,{clone:!0,readNull:!0});if(current&&scaling&&!current.equals(scaling)){var rotation=this.getRotation(),decomposed=this._decomposed,matrix=new Matrix,isZero=Numerical.isZero;if(isZero(current.x)||isZero(current.y))matrix.translate(decomposed.translation),rotation&&matrix.rotate(rotation),matrix.scale(scaling.x,scaling.y),this._matrix.set(matrix);else{var center=this.getPosition(!0);matrix.translate(center),rotation&&matrix.rotate(rotation),matrix.scale(scaling.x/current.x,scaling.y/current.y),rotation&&matrix.rotate(-rotation),matrix.translate(center.negate()),this.transform(matrix)}decomposed&&(decomposed.scaling=scaling,this._decomposed=decomposed)}},getMatrix:function(){return this._matrix},setMatrix:function(){var matrix=this._matrix;matrix.set.apply(matrix,arguments)},getGlobalMatrix:function(_dontClone){var matrix=this._globalMatrix;if(matrix)for(var parent=this._parent,parents=[];parent;){if(!parent._globalMatrix){matrix=null;for(var i=0,l=parents.length;i<l;i++)parents[i]._globalMatrix=null;break}parents.push(parent),parent=parent._parent}matrix||(matrix=this._globalMatrix=this._matrix.clone(),(parent=this._parent)&&matrix.prepend(parent.getGlobalMatrix(!0)));return _dontClone?matrix:matrix.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(apply){(this._applyMatrix=this._canApplyMatrix&&!!apply)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(project,installEvents){if(this._project!==project){this._project&&this._installEvents(!1),this._project=project;for(var children=this._children,i=0,l=children&&children.length;i<l;i++)children[i]._setProject(project);installEvents=!0}installEvents&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function _installEvents(install){_installEvents.base.call(this,install);for(var children=this._children,i=0,l=children&&children.length;i<l;i++)children[i]._installEvents(install)},getLayer:function(){for(var parent=this;parent=parent._parent;)if(parent instanceof Layer)return parent;return null},getParent:function(){return this._parent},setParent:function(item){return item.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(items){this.removeChildren(),this.addChildren(items)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var owner=this._getOwner();return owner&&owner._children[this._index+1]||null},getPreviousSibling:function(){var owner=this._getOwner();return owner&&owner._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(item){return item===this||item&&this._class===item._class&&this._style.equals(item._style)&&this._matrix.equals(item._matrix)&&this._locked===item._locked&&this._visible===item._visible&&this._blendMode===item._blendMode&&this._opacity===item._opacity&&this._clipMask===item._clipMask&&this._guide===item._guide&&this._equals(item)||!1},_equals:function(item){return Base.equals(this._children,item._children)},clone:function(options){var copy=new this.constructor(Item.NO_INSERT),children=this._children,insert=Base.pick(options?options.insert:undefined,options===undefined||!0===options),deep=Base.pick(options?options.deep:undefined,!0);children&&copy.copyAttributes(this),children&&!deep||copy.copyContent(this),children||copy.copyAttributes(this),insert&&copy.insertAbove(this);var name=this._name,parent=this._parent;if(name&&parent){children=parent._children;for(var orig=name,i=1;children[name];)name=orig+" "+i++;name!==orig&&copy.setName(name)}return copy},copyContent:function(source){for(var children=source._children,i=0,l=children&&children.length;i<l;i++)this.addChild(children[i].clone(!1),!0)},copyAttributes:function(source,excludeMatrix){this.setStyle(source._style);for(var keys=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],i=0,l=keys.length;i<l;i++){var key=keys[i];source.hasOwnProperty(key)&&(this[key]=source[key])}excludeMatrix||this._matrix.set(source._matrix,!0),this.setApplyMatrix(source._applyMatrix),this.setPivot(source._pivot),this.setSelection(source._selection);var data=source._data,name=source._name;this._data=data?Base.clone(data):null,name&&this.setName(name)},rasterize:function(arg0,arg1){var resolution,insert,raster;Base.isPlainObject(arg0)?(resolution=arg0.resolution,insert=arg0.insert,raster=arg0.raster):(resolution=arg0,insert=arg1),raster||(raster=new Raster(Item.NO_INSERT));var bounds=this.getStrokeBounds(),scale=(resolution||this.getView().getResolution())/72,topLeft=bounds.getTopLeft().floor(),bottomRight=bounds.getBottomRight().ceil(),boundsSize=new Size(bottomRight.subtract(topLeft)),rasterSize=boundsSize.multiply(scale);if(raster.setSize(rasterSize,!0),!rasterSize.isZero()){var ctx=raster.getContext(!0),matrix=(new Matrix).scale(scale).translate(topLeft.negate());ctx.save(),matrix.applyToContext(ctx),this.draw(ctx,new Base({matrices:[matrix]})),ctx.restore()}return raster._matrix.set((new Matrix).translate(topLeft.add(boundsSize.divide(2))).scale(1/scale)),(insert===undefined||insert)&&raster.insertAbove(this),raster},contains:function(){var matrix=this._matrix;return matrix.isInvertible()&&!!this._contains(matrix._inverseTransform(Point.read(arguments)))},_contains:function(point){var children=this._children;if(children){for(var i=children.length-1;i>=0;i--)if(children[i].contains(point))return!0;return!1}return point.isInside(this.getInternalBounds())},isInside:function(){return Rectangle.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new Path.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(item,_matrix){return item instanceof Item&&this._asPathItem().getIntersections(item._asPathItem(),null,_matrix,!0).length>0}},new function(){function hitTest(){var args=arguments;return this._hitTest(Point.read(args),HitResult.getOptions(args))}function hitTestAll(){var args=arguments,point=Point.read(args),options=HitResult.getOptions(args),all=[];return this._hitTest(point,new Base({all},options)),all}function hitTestChildren(point,options,viewMatrix,_exclude){var children=this._children;if(children)for(var i=children.length-1;i>=0;i--){var child=children[i],res=child!==_exclude&&child._hitTest(point,options,viewMatrix);if(res&&!options.all)return res}return null}return Project.inject({hitTest,hitTestAll,_hitTest:hitTestChildren}),{hitTest,hitTestAll,_hitTestChildren:hitTestChildren}},{_hitTest:function(point,options,parentViewMatrix){if(this._locked||!this._visible||this._guide&&!options.guides||this.isEmpty())return null;var matrix=this._matrix,viewMatrix=parentViewMatrix?parentViewMatrix.appended(matrix):this.getGlobalMatrix().prepend(this.getView()._matrix),tolerance=Math.max(options.tolerance,1e-12),tolerancePadding=options._tolerancePadding=new Size(Path._getStrokePadding(tolerance,matrix._shiftless().invert()));if(!(point=matrix._inverseTransform(point))||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(tolerancePadding.multiply(2))._containsPoint(point))return null;var bounds,res,checkSelf=!(options.guides&&!this._guide||options.selected&&!this.isSelected()||options.type&&options.type!==Base.hyphenate(this._class)||options.class&&!(this instanceof options.class)),match=options.match,that=this;function filter(hit){return hit&&match&&!match(hit)&&(hit=null),hit&&options.all&&options.all.push(hit),hit}function checkPoint(type,part){var pt=part?bounds["get"+part]():that.getPosition();if(point.subtract(pt).divide(tolerancePadding).length<=1)return new HitResult(type,that,{name:part?Base.hyphenate(part):type,point:pt})}var checkPosition=options.position,checkCenter=options.center,checkBounds=options.bounds;if(checkSelf&&this._parent&&(checkPosition||checkCenter||checkBounds)){if((checkCenter||checkBounds)&&(bounds=this.getInternalBounds()),!(res=checkPosition&&checkPoint("position")||checkCenter&&checkPoint("center","Center"))&&checkBounds)for(var points=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],i=0;i<8&&!res;i++)res=checkPoint("bounds",points[i]);res=filter(res)}return res||(res=this._hitTestChildren(point,options,viewMatrix)||checkSelf&&filter(this._hitTestSelf(point,options,viewMatrix,this.getStrokeScaling()?null:viewMatrix._shiftless().invert()))||null),res&&res.point&&(res.point=matrix.transform(res.point)),res},_hitTestSelf:function(point,options){if(options.fill&&this.hasFill()&&this._contains(point))return new HitResult("fill",this)},matches:function(name,compare){var type=typeof name;if("object"===type){for(var key in name)if(name.hasOwnProperty(key)&&!this.matches(key,name[key]))return!1;return!0}if("function"===type)return name(this);if("match"===name)return compare(this);var value=/^(empty|editable)$/.test(name)?this["is"+Base.capitalize(name)]():"type"===name?Base.hyphenate(this._class):this[name];if("class"===name){if("function"==typeof compare)return this instanceof compare;value=this._class}if("function"==typeof compare)return!!compare(value);if(compare){if(compare.test)return compare.test(value);if(Base.isPlainObject(compare))return function matchObject(obj1,obj2){for(var i in obj1)if(obj1.hasOwnProperty(i)){var val1=obj1[i],val2=obj2[i];if(Base.isPlainObject(val1)&&Base.isPlainObject(val2)){if(!matchObject(val1,val2))return!1}else if(!Base.equals(val1,val2))return!1}return!0}(compare,value)}return Base.equals(value,compare)},getItems:function(options){return Item._getItems(this,options,this._matrix)},getItem:function(options){return Item._getItems(this,options,this._matrix,null,!0)[0]||null},statics:{_getItems:function _getItems(item,options,matrix,param,firstOnly){if(!param){var obj="object"==typeof options&&options,overlapping=obj&&obj.overlapping,inside=obj&&obj.inside,rect=(bounds=overlapping||inside)&&Rectangle.read([bounds]);param={items:[],recursive:obj&&!1!==obj.recursive,inside:!!inside,overlapping:!!overlapping,rect,path:overlapping&&new Path.Rectangle({rectangle:rect,insert:!1})},obj&&(options=Base.filter({},options,{recursive:!0,inside:!0,overlapping:!0}))}var children=item._children,items=param.items;matrix=(rect=param.rect)&&(matrix||new Matrix);for(var i=0,l=children&&children.length;i<l;i++){var child=children[i],childMatrix=matrix&&matrix.appended(child._matrix),add=!0;if(rect){var bounds=child.getBounds(childMatrix);if(!rect.intersects(bounds))continue;rect.contains(bounds)||param.overlapping&&(bounds.contains(rect)||param.path.intersects(child,childMatrix))||(add=!1)}if(add&&child.matches(options)&&(items.push(child),firstOnly))break;if(!1!==param.recursive&&_getItems(child,options,childMatrix,param,firstOnly),firstOnly&&items.length>0)break}return items}}},{importJSON:function(json){var res=Base.importJSON(json,this);return res!==this?this.addChild(res):res},addChild:function(item){return this.insertChild(undefined,item)},insertChild:function(index,item){var res=item?this.insertChildren(index,[item]):null;return res&&res[0]},addChildren:function(items){return this.insertChildren(this._children.length,items)},insertChildren:function(index,items){var children=this._children;if(children&&items&&items.length>0){for(var inserted={},i=(items=Base.slice(items)).length-1;i>=0;i--){var id=(item=items[i])&&item._id;!item||inserted[id]?items.splice(i,1):(item._remove(!1,!0),inserted[id]=!0)}Base.splice(children,items,index,0);for(var project=this._project,notifySelf=project._changes,l=(i=0,items.length);i<l;i++){var item,name=(item=items[i])._name;item._parent=this,item._setProject(project,!0),name&&item.setName(name),notifySelf&&item._changed(5)}this._changed(11)}else items=null;return items},_insertItem:"#insertChild",_insertAt:function(item,offset){var owner=item&&item._getOwner(),res=item!==this&&owner?this:null;return res&&(res._remove(!1,!0),owner._insertItem(item._index+offset,res)),res},insertAbove:function(item){return this._insertAt(item,1)},insertBelow:function(item){return this._insertAt(item,0)},sendToBack:function(){var owner=this._getOwner();return owner?owner._insertItem(0,this):null},bringToFront:function(){var owner=this._getOwner();return owner?owner._insertItem(undefined,this):null},appendTop:"#addChild",appendBottom:function(item){return this.insertChild(0,item)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",addTo:function(owner){return owner._insertItem(undefined,this)},copyTo:function(owner){return this.clone(!1).addTo(owner)},reduce:function(options){var children=this._children;if(children&&1===children.length){var child=children[0].reduce(options);return this._parent?(child.insertAbove(this),this.remove()):child.remove(),child}return this},_removeNamed:function(){var owner=this._getOwner();if(owner){var children=owner._children,namedChildren=owner._namedChildren,name=this._name,namedArray=namedChildren[name],index=namedArray?namedArray.indexOf(this):-1;-1!==index&&(children[name]==this&&delete children[name],namedArray.splice(index,1),namedArray.length?children[name]=namedArray[0]:delete namedChildren[name])}},_remove:function(notifySelf,notifyParent){var owner=this._getOwner(),project=this._project,index=this._index;return this._style&&this._style._dispose(),!!owner&&(this._name&&this._removeNamed(),null!=index&&(project._activeLayer===this&&(project._activeLayer=this.getNextSibling()||this.getPreviousSibling()),Base.splice(owner._children,null,index,1)),this._installEvents(!1),notifySelf&&project._changes&&this._changed(5),notifyParent&&owner._changed(11,this),this._parent=null,!0)},remove:function(){return this._remove(!0,!0)},replaceWith:function(item){var ok=item&&item.insertBelow(this);return ok&&this.remove(),ok},removeChildren:function(start,end){if(!this._children)return null;start=start||0,end=Base.pick(end,this._children.length);for(var removed=Base.splice(this._children,null,start,end-start),i=removed.length-1;i>=0;i--)removed[i]._remove(!0,!1);return removed.length>0&&this._changed(11),removed},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var i=0,l=this._children.length;i<l;i++)this._children[i]._index=i;this._changed(11)}},isEmpty:function(recursively){var children=this._children,numChildren=children?children.length:0;if(recursively){for(var i=0;i<numChildren;i++)if(!children[i].isEmpty(recursively))return!1;return!0}return!numChildren},isEditable:function(){for(var item=this;item;){if(!item._visible||item._locked)return!1;item=item._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(item){function getList(item){var list=[];do{list.unshift(item)}while(item=item._parent);return list}for(var list1=getList(this),list2=getList(item),i=0,l=Math.min(list1.length,list2.length);i<l;i++)if(list1[i]!=list2[i])return list1[i]._index<list2[i]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return!!this._parent&&this._parent.isInserted()},isAbove:function(item){return-1===this._getOrder(item)},isBelow:function(item){return 1===this._getOrder(item)},isParent:function(item){return this._parent===item},isChild:function(item){return item&&item._parent===this},isDescendant:function(item){for(var parent=this;parent=parent._parent;)if(parent===item)return!0;return!1},isAncestor:function(item){return!!item&&item.isDescendant(this)},isSibling:function(item){return this._parent===item._parent},isGroupedWith:function(item){for(var parent=this._parent;parent;){if(parent._parent&&/^(Group|Layer|CompoundPath)$/.test(parent._class)&&item.isDescendant(parent))return!0;parent=parent._parent}return!1}},Base.each(["rotate","scale","shear","skew"],(function(key){var rotate="rotate"===key;this[key]=function(){var args=arguments,value=(rotate?Base:Point).read(args),center=Point.read(args,0,{readNull:!0});return this.transform((new Matrix)[key](value,center||this.getPosition(!0)))}}),{translate:function(){var mx=new Matrix;return this.transform(mx.translate.apply(mx,arguments))},transform:function(matrix,_applyRecursively,_setApplyMatrix){var _matrix=this._matrix,transformMatrix=matrix&&!matrix.isIdentity(),applyMatrix=_setApplyMatrix&&this._canApplyMatrix||this._applyMatrix&&(transformMatrix||!_matrix.isIdentity()||_applyRecursively&&this._children);if(!transformMatrix&&!applyMatrix)return this;if(transformMatrix){!matrix.isInvertible()&&_matrix.isInvertible()&&(_matrix._backup=_matrix.getValues()),_matrix.prepend(matrix,!0);var style=this._style,fillColor=style.getFillColor(!0),strokeColor=style.getStrokeColor(!0);fillColor&&fillColor.transform(matrix),strokeColor&&strokeColor.transform(matrix)}if(applyMatrix&&(applyMatrix=this._transformContent(_matrix,_applyRecursively,_setApplyMatrix))){var pivot=this._pivot;pivot&&_matrix._transformPoint(pivot,pivot,!0),_matrix.reset(!0),_setApplyMatrix&&this._canApplyMatrix&&(this._applyMatrix=!0)}var bounds=this._bounds,position=this._position;(transformMatrix||applyMatrix)&&this._changed(25);var decomp=transformMatrix&&bounds&&matrix.decompose();if(decomp&&decomp.skewing.isZero()&&decomp.rotation%90==0){for(var key in bounds){var cache=bounds[key];if(cache.nonscaling)delete bounds[key];else if(applyMatrix||!cache.internal){var rect=cache.rect;matrix._transformBounds(rect,rect)}}this._bounds=bounds;var cached=bounds[this._getBoundsCacheKey(this._boundsOptions||{})];cached&&(this._position=this._getPositionFromBounds(cached.rect))}else transformMatrix&&position&&this._pivot&&(this._position=matrix._transformPoint(position,position));return this},_transformContent:function(matrix,applyRecursively,setApplyMatrix){var children=this._children;if(children){for(var i=0,l=children.length;i<l;i++)children[i].transform(matrix,applyRecursively,setApplyMatrix);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(Point.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(Point.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(Point.read(arguments))},localToParent:function(){return this._matrix._transformPoint(Point.read(arguments))},fitBounds:function(rectangle,fill){rectangle=Rectangle.read(arguments);var bounds=this.getBounds(),itemRatio=bounds.height/bounds.width,rectRatio=rectangle.height/rectangle.width,scale=(fill?itemRatio>rectRatio:itemRatio<rectRatio)?rectangle.width/bounds.width:rectangle.height/bounds.height,newBounds=new Rectangle(new Point,new Size(bounds.width*scale,bounds.height*scale));newBounds.setCenter(rectangle.getCenter()),this.setBounds(newBounds)}}),{_setStyles:function(ctx,param,viewMatrix){var style=this._style,matrix=this._matrix;if(style.hasFill()&&(ctx.fillStyle=style.getFillColor().toCanvasStyle(ctx,matrix)),style.hasStroke()){ctx.strokeStyle=style.getStrokeColor().toCanvasStyle(ctx,matrix),ctx.lineWidth=style.getStrokeWidth();var strokeJoin=style.getStrokeJoin(),strokeCap=style.getStrokeCap(),miterLimit=style.getMiterLimit();if(strokeJoin&&(ctx.lineJoin=strokeJoin),strokeCap&&(ctx.lineCap=strokeCap),miterLimit&&(ctx.miterLimit=miterLimit),paper.support.nativeDash){var dashArray=style.getDashArray(),dashOffset=style.getDashOffset();dashArray&&dashArray.length&&("setLineDash"in ctx?(ctx.setLineDash(dashArray),ctx.lineDashOffset=dashOffset):(ctx.mozDash=dashArray,ctx.mozDashOffset=dashOffset))}}if(style.hasShadow()){var pixelRatio=param.pixelRatio||1,mx=viewMatrix._shiftless().prepend((new Matrix).scale(pixelRatio,pixelRatio)),blur=mx.transform(new Point(style.getShadowBlur(),0)),offset=mx.transform(this.getShadowOffset());ctx.shadowColor=style.getShadowColor().toCanvasStyle(ctx),ctx.shadowBlur=blur.getLength(),ctx.shadowOffsetX=offset.x,ctx.shadowOffsetY=offset.y}},draw:function(ctx,param,parentStrokeMatrix){this._updateVersion=this._project._updateVersion;if(this._visible&&0!==this._opacity){var matrices=param.matrices,viewMatrix=param.viewMatrix,matrix=this._matrix,globalMatrix=matrices[matrices.length-1].appended(matrix);if(globalMatrix.isInvertible()){viewMatrix=viewMatrix?viewMatrix.appended(globalMatrix):globalMatrix,matrices.push(globalMatrix),param.updateMatrix&&(this._globalMatrix=globalMatrix);var mainCtx,itemOffset,prevOffset,blendMode=this._blendMode,opacity=Numerical.clamp(this._opacity,0,1),normalBlend="normal"===blendMode,nativeBlend=BlendMode.nativeModes[blendMode],direct=normalBlend&&1===opacity||param.dontStart||param.clip||(nativeBlend||normalBlend&&opacity<1)&&this._canComposite(),pixelRatio=param.pixelRatio||1;if(!direct){var bounds=this.getStrokeBounds(viewMatrix);if(!bounds.width||!bounds.height)return void matrices.pop();prevOffset=param.offset,itemOffset=param.offset=bounds.getTopLeft().floor(),mainCtx=ctx,ctx=CanvasProvider.getContext(bounds.getSize().ceil().add(1).multiply(pixelRatio)),1!==pixelRatio&&ctx.scale(pixelRatio,pixelRatio)}ctx.save();var strokeMatrix=parentStrokeMatrix?parentStrokeMatrix.appended(matrix):this._canScaleStroke&&!this.getStrokeScaling(!0)&&viewMatrix,clip=!direct&&param.clipItem,transform=!strokeMatrix||clip;if(direct?(ctx.globalAlpha=opacity,nativeBlend&&(ctx.globalCompositeOperation=blendMode)):transform&&ctx.translate(-itemOffset.x,-itemOffset.y),transform&&(direct?matrix:viewMatrix).applyToContext(ctx),clip&&param.clipItem.draw(ctx,param.extend({clip:!0})),strokeMatrix){ctx.setTransform(pixelRatio,0,0,pixelRatio,0,0);var offset=param.offset;offset&&ctx.translate(-offset.x,-offset.y)}this._draw(ctx,param,viewMatrix,strokeMatrix),ctx.restore(),matrices.pop(),param.clip&&!param.dontFinish&&ctx.clip(this.getFillRule()),direct||(BlendMode.process(blendMode,ctx,mainCtx,opacity,itemOffset.subtract(prevOffset).multiply(pixelRatio)),CanvasProvider.release(ctx),param.offset=prevOffset)}}},_isUpdated:function(updateVersion){var parent=this._parent;if(parent instanceof CompoundPath)return parent._isUpdated(updateVersion);var updated=this._updateVersion===updateVersion;return!updated&&parent&&parent._visible&&parent._isUpdated(updateVersion)&&(this._updateVersion=updateVersion,updated=!0),updated},_drawSelection:function(ctx,matrix,size,selectionItems,updateVersion){var selection=this._selection,itemSelected=1&selection,boundsSelected=2&selection||itemSelected&&this._selectBounds,positionSelected=4&selection;if(this._drawSelected||(itemSelected=!1),(itemSelected||boundsSelected||positionSelected)&&this._isUpdated(updateVersion)){var layer,color=this.getSelectedColor(!0)||(layer=this.getLayer())&&layer.getSelectedColor(!0),mx=matrix.appended(this.getGlobalMatrix(!0)),half=size/2;if(ctx.strokeStyle=ctx.fillStyle=color?color.toCanvasStyle(ctx):"#009dec",itemSelected&&this._drawSelected(ctx,mx,selectionItems),positionSelected){var pos=this.getPosition(!0),parent=this._parent,point=parent?parent.localToGlobal(pos):pos,x=point.x,y=point.y;ctx.beginPath(),ctx.arc(x,y,half,0,2*Math.PI,!0),ctx.stroke();for(var deltas=[[0,-1],[1,0],[0,1],[-1,0]],start=half,end=size+1,i=0;i<4;i++){var delta=deltas[i],dx=delta[0],dy=delta[1];ctx.moveTo(x+dx*start,y+dy*start),ctx.lineTo(x+dx*end,y+dy*end),ctx.stroke()}}if(boundsSelected){var coords=mx._transformCorners(this.getInternalBounds());ctx.beginPath();for(i=0;i<8;i++)ctx[i?"lineTo":"moveTo"](coords[i],coords[++i]);ctx.closePath(),ctx.stroke();for(i=0;i<8;i++)ctx.fillRect(coords[i]-half,coords[++i]-half,size,size)}}},_canComposite:function(){return!1}},Base.each(["down","drag","up","move"],(function(key){this["removeOn"+Base.capitalize(key)]=function(){var hash={};return hash[key]=!0,this.removeOn(hash)}}),{removeOn:function(obj){for(var name in obj)if(obj[name]){var key="mouse"+name,project=this._project,sets=project._removeSets=project._removeSets||{};sets[key]=sets[key]||{},sets[key][this._id]=this}return this}}),{tween:function(from,to,options){options||(options=to,to=from,from=null,options||(options=to,to=null));var easing=options&&options.easing,start=options&&options.start,duration=null!=options&&("number"==typeof options?options:options.duration),tween=new Tween(this,from,to,duration,easing,start);return duration&&this.on("frame",(function onFrame(event){tween._handleFrame(1e3*event.time),tween.running||this.off("frame",onFrame)})),tween},tweenTo:function(to,options){return this.tween(null,to,options)},tweenFrom:function(from,options){return this.tween(from,null,options)}}),Group=Item.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function Group(arg){this._children=[],this._namedChildren={},this._initialize(arg)||this.addChildren(Array.isArray(arg)?arg:arguments)},_changed:function _changed(flags){_changed.base.call(this,flags),2050&flags&&(this._clipItem=undefined)},_getClipItem:function(){var clipItem=this._clipItem;if(clipItem===undefined){clipItem=null;for(var children=this._children,i=0,l=children.length;i<l;i++)if(children[i]._clipMask){clipItem=children[i];break}this._clipItem=clipItem}return clipItem},isClipped:function(){return!!this._getClipItem()},setClipped:function(clipped){var child=this.getFirstChild();child&&child.setClipMask(clipped)},_getBounds:function _getBounds(matrix,options){var clipItem=this._getClipItem();return clipItem?clipItem._getCachedBounds(clipItem._matrix.prepended(matrix),Base.set({},options,{stroke:!1})):_getBounds.base.call(this,matrix,options)},_hitTestChildren:function _hitTestChildren(point,options,viewMatrix){var clipItem=this._getClipItem();return(!clipItem||clipItem.contains(point))&&_hitTestChildren.base.call(this,point,options,viewMatrix,clipItem)},_draw:function(ctx,param){var clip=param.clip,clipItem=!clip&&this._getClipItem();param=param.extend({clipItem,clip:!1}),clip?(ctx.beginPath(),param.dontStart=param.dontFinish=!0):clipItem&&clipItem.draw(ctx,param.extend({clip:!0}));for(var children=this._children,i=0,l=children.length;i<l;i++){var item=children[i];item!==clipItem&&item.draw(ctx,param)}}}),Layer=Group.extend({_class:"Layer",initialize:function Layer(){Group.apply(this,arguments)},_getOwner:function(){return this._parent||null!=this._index&&this._project},isInserted:function isInserted(){return this._parent?isInserted.base.call(this):null!=this._index},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),Shape=Item.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function Shape(props,point){this._initialize(props,point)},_equals:function(item){return this._type===item._type&&this._size.equals(item._size)&&Base.equals(this._radius,item._radius)},copyContent:function(source){this.setType(source._type),this.setSize(source._size),this.setRadius(source._radius)},getType:function(){return this._type},setType:function(type){this._type=type},getShape:"#getType",setShape:"#setType",getSize:function(){var size=this._size;return new LinkedSize(size.width,size.height,this,"setSize")},setSize:function(){var size=Size.read(arguments);if(this._size){if(!this._size.equals(size)){var type=this._type,width=size.width,height=size.height;"rectangle"===type?this._radius.set(Size.min(this._radius,size.divide(2).abs())):"circle"===type?(width=height=(width+height)/2,this._radius=width/2):"ellipse"===type&&this._radius._set(width/2,height/2),this._size._set(width,height),this._changed(9)}}else this._size=size.clone()},getRadius:function(){var rad=this._radius;return"circle"===this._type?rad:new LinkedSize(rad.width,rad.height,this,"setRadius")},setRadius:function(radius){var type=this._type;if("circle"===type){if(radius===this._radius)return;var size=2*radius;this._radius=radius,this._size._set(size,size)}else if(radius=Size.read(arguments),this._radius){if(this._radius.equals(radius))return;if(this._radius.set(radius),"rectangle"===type){size=Size.max(this._size,radius.multiply(2));this._size.set(size)}else"ellipse"===type&&this._size._set(2*radius.width,2*radius.height)}else this._radius=radius.clone();this._changed(9)},isEmpty:function(){return!1},toPath:function(insert){var path=new(Path[Base.capitalize(this._type)])({center:new Point,size:this._size,radius:this._radius,insert:!1});return path.copyAttributes(this),paper.settings.applyMatrix&&path.setApplyMatrix(!0),(insert===undefined||insert)&&path.insertAbove(this),path},toShape:"#clone",_asPathItem:function(){return this.toPath(!1)},_draw:function(ctx,param,viewMatrix,strokeMatrix){var style=this._style,hasFill=style.hasFill(),hasStroke=style.hasStroke(),dontPaint=param.dontFinish||param.clip,untransformed=!strokeMatrix;if(hasFill||hasStroke||dontPaint){var type=this._type,radius=this._radius,isCircle="circle"===type;if(param.dontStart||ctx.beginPath(),untransformed&&isCircle)ctx.arc(0,0,radius,0,2*Math.PI,!0);else{var rx=isCircle?radius:radius.width,ry=isCircle?radius:radius.height,size=this._size,width=size.width,height=size.height;if(untransformed&&"rectangle"===type&&0===rx&&0===ry)ctx.rect(-width/2,-height/2,width,height);else{var x=width/2,y=height/2,kappa=.44771525016920644,cx=rx*kappa,cy=ry*kappa,c=[-x,-y+ry,-x,-y+cy,-x+cx,-y,-x+rx,-y,x-rx,-y,x-cx,-y,x,-y+cy,x,-y+ry,x,y-ry,x,y-cy,x-cx,y,x-rx,y,-x+rx,y,-x+cx,y,-x,y-cy,-x,y-ry];strokeMatrix&&strokeMatrix.transform(c,c,32),ctx.moveTo(c[0],c[1]),ctx.bezierCurveTo(c[2],c[3],c[4],c[5],c[6],c[7]),x!==rx&&ctx.lineTo(c[8],c[9]),ctx.bezierCurveTo(c[10],c[11],c[12],c[13],c[14],c[15]),y!==ry&&ctx.lineTo(c[16],c[17]),ctx.bezierCurveTo(c[18],c[19],c[20],c[21],c[22],c[23]),x!==rx&&ctx.lineTo(c[24],c[25]),ctx.bezierCurveTo(c[26],c[27],c[28],c[29],c[30],c[31])}}ctx.closePath()}dontPaint||!hasFill&&!hasStroke||(this._setStyles(ctx,param,viewMatrix),hasFill&&(ctx.fill(style.getFillRule()),ctx.shadowColor="rgba(0,0,0,0)"),hasStroke&&ctx.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(matrix,options){var rect=new Rectangle(this._size).setCenter(0,0),style=this._style,strokeWidth=options.stroke&&style.hasStroke()&&style.getStrokeWidth();return matrix&&(rect=matrix._transformBounds(rect)),strokeWidth?rect.expand(Path._getStrokePadding(strokeWidth,this._getStrokeMatrix(matrix,options))):rect}},new function(){function getCornerCenter(that,point,expand){var radius=that._radius;if(!radius.isZero())for(var halfSize=that._size.divide(2),q=1;q<=4;q++){var dir=new Point(q>1&&q<4?-1:1,q>2?-1:1),corner=dir.multiply(halfSize),center=corner.subtract(dir.multiply(radius));if(new Rectangle(expand?corner.add(dir.multiply(expand)):corner,center).contains(point))return{point:center,quadrant:q}}}function isOnEllipseStroke(point,radius,padding,quadrant){var vector=point.divide(radius);return(!quadrant||vector.isInQuadrant(quadrant))&&vector.subtract(vector.normalize()).multiply(radius).divide(padding).length<=1}return{_contains:function _contains(point){if("rectangle"===this._type){var center=getCornerCenter(this,point);return center?point.subtract(center.point).divide(this._radius).getLength()<=1:_contains.base.call(this,point)}return point.divide(this.size).getLength()<=.5},_hitTestSelf:function _hitTestSelf(point,options,viewMatrix,strokeMatrix){var hit=!1,style=this._style,hitStroke=options.stroke&&style.hasStroke(),hitFill=options.fill&&style.hasFill();if(hitStroke||hitFill){var type=this._type,radius=this._radius,strokeRadius=hitStroke?style.getStrokeWidth()/2:0,strokePadding=options._tolerancePadding.add(Path._getStrokePadding(strokeRadius,!style.getStrokeScaling()&&strokeMatrix));if("rectangle"===type){var padding=strokePadding.multiply(2),center=getCornerCenter(this,point,padding);if(center)hit=isOnEllipseStroke(point.subtract(center.point),radius,strokePadding,center.quadrant);else{var rect=new Rectangle(this._size).setCenter(0,0),outer=rect.expand(padding),inner=rect.expand(padding.negate());hit=outer._containsPoint(point)&&!inner._containsPoint(point)}}else hit=isOnEllipseStroke(point,radius,strokePadding)}return hit?new HitResult(hitStroke?"stroke":"fill",this):_hitTestSelf.base.apply(this,arguments)}}},{statics:new function(){function createShape(type,point,size,radius,args){var item=Base.create(Shape.prototype);return item._type=type,item._size=size,item._radius=radius,item._initialize(Base.getNamed(args),point),item}return{Circle:function(){var args=arguments,center=Point.readNamed(args,"center"),radius=Base.readNamed(args,"radius");return createShape("circle",center,new Size(2*radius),radius,args)},Rectangle:function(){var args=arguments,rect=Rectangle.readNamed(args,"rectangle"),radius=Size.min(Size.readNamed(args,"radius"),rect.getSize(!0).divide(2));return createShape("rectangle",rect.getCenter(!0),rect.getSize(!0),radius,args)},Ellipse:function(){var args=arguments,ellipse=Shape._readEllipse(args),radius=ellipse.radius;return createShape("ellipse",ellipse.center,radius.multiply(2),radius,args)},_readEllipse:function(args){var center,radius;if(Base.hasNamed(args,"radius"))center=Point.readNamed(args,"center"),radius=Size.readNamed(args,"radius");else{var rect=Rectangle.readNamed(args,"rectangle");center=rect.getCenter(!0),radius=rect.getSize(!0).divide(2)}return{center,radius}}}}}),Raster=Item.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],_smoothing:"low",beans:!0,initialize:function Raster(source,position){if(!this._initialize(source,position!==undefined&&Point.read(arguments))){var image,type=typeof source,object="string"===type?document.getElementById(source):"object"===type?source:null;if(object&&object!==Item.NO_INSERT)if(object.getContext||null!=object.naturalHeight)image=object;else if(object){var size=Size.read(arguments);size.isZero()||(image=CanvasProvider.getCanvas(size))}image?this.setImage(image):this.setSource(source)}this._size||(this._size=new Size,this._loaded=!1)},_equals:function(item){return this.getSource()===item.getSource()},copyContent:function(source){var image=source._image,canvas=source._canvas;if(image)this._setImage(image);else if(canvas){var copyCanvas=CanvasProvider.getCanvas(source._size);copyCanvas.getContext("2d").drawImage(canvas,0,0),this._setImage(copyCanvas)}this._crossOrigin=source._crossOrigin},getSize:function(){var size=this._size;return new LinkedSize(size?size.width:0,size?size.height:0,this,"setSize")},setSize:function(_size,_clear){var size=Size.read(arguments);if(size.equals(this._size))_clear&&this.clear();else if(size.width>0&&size.height>0){var element=!_clear&&this.getElement();this._setImage(CanvasProvider.getCanvas(size)),element&&this.getContext(!0).drawImage(element,0,0,size.width,size.height)}else this._canvas&&CanvasProvider.release(this._canvas),this._size=size.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(width){this.setSize(width,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(height){this.setSize(this.getWidth(),height)},getLoaded:function(){return this._loaded},isEmpty:function(){var size=this._size;return!size||0===size.width&&0===size.height},getResolution:function(){var matrix=this._matrix,orig=new Point(0,0).transform(matrix),u=new Point(1,0).transform(matrix).subtract(orig),v=new Point(0,1).transform(matrix).subtract(orig);return new Size(72/u.getLength(),72/v.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(image){var that=this;function emit(event){var view=that.getView(),type=event&&event.type||"load";view&&that.responds(type)&&(paper=view._scope,that.emit(type,new Event(event)))}this._setImage(image),this._loaded?setTimeout(emit,0):image&&DomEvent.add(image,{load:function(event){that._setImage(image),emit(event)},error:emit})},_setImage:function(image){this._canvas&&CanvasProvider.release(this._canvas),image&&image.getContext?(this._image=null,this._canvas=image,this._loaded=!0):(this._image=image,this._canvas=null,this._loaded=!!(image&&image.src&&image.complete)),this._size=new Size(image?image.naturalWidth||image.width:0,image?image.naturalHeight||image.height:0),this._context=null,this._changed(1033)},getCanvas:function(){if(!this._canvas){var ctx=CanvasProvider.getContext(this._size);try{this._image&&ctx.drawImage(this._image,0,0),this._canvas=ctx.canvas}catch(e){CanvasProvider.release(ctx)}}return this._canvas},setCanvas:"#setImage",getContext:function(_change){return this._context||(this._context=this.getCanvas().getContext("2d")),_change&&(this._image=null,this._changed(1025)),this._context},setContext:function(context){this._context=context},getSource:function(){var image=this._image;return image&&image.src||this.toDataURL()},setSource:function(src){var image=new self.Image,crossOrigin=this._crossOrigin;crossOrigin&&(image.crossOrigin=crossOrigin),src&&(image.src=src),this.setImage(image)},getCrossOrigin:function(){var image=this._image;return image&&image.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(crossOrigin){this._crossOrigin=crossOrigin;var image=this._image;image&&(image.crossOrigin=crossOrigin)},getSmoothing:function(){return this._smoothing},setSmoothing:function(smoothing){this._smoothing="string"==typeof smoothing?smoothing:smoothing?"low":"off",this._changed(257)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var rect=Rectangle.read(arguments),ctx=CanvasProvider.getContext(rect.getSize());return ctx.drawImage(this.getCanvas(),rect.x,rect.y,rect.width,rect.height,0,0,rect.width,rect.height),ctx.canvas},getSubRaster:function(){var rect=Rectangle.read(arguments),raster=new Raster(Item.NO_INSERT);return raster._setImage(this.getSubCanvas(rect)),raster.translate(rect.getCenter().subtract(this.getSize().divide(2))),raster._matrix.prepend(this._matrix),raster.insertAbove(this),raster},toDataURL:function(){var image=this._image,src=image&&image.src;if(/^data:/.test(src))return src;var canvas=this.getCanvas();return canvas?canvas.toDataURL.apply(canvas,arguments):null},drawImage:function(image){var point=Point.read(arguments,1);this.getContext(!0).drawImage(image,point.x,point.y)},getAverageColor:function(object){var bounds,path;if(object?object instanceof PathItem?(path=object,bounds=object.getBounds()):"object"==typeof object&&("width"in object?bounds=new Rectangle(object):"x"in object&&(bounds=new Rectangle(object.x-.5,object.y-.5,1,1))):bounds=this.getBounds(),!bounds)return null;var width=Math.min(bounds.width,32),height=Math.min(bounds.height,32),ctx=Raster._sampleContext;ctx?ctx.clearRect(0,0,33,33):ctx=Raster._sampleContext=CanvasProvider.getContext(new Size(32)),ctx.save();var matrix=(new Matrix).scale(width/bounds.width,height/bounds.height).translate(-bounds.x,-bounds.y);matrix.applyToContext(ctx),path&&path.draw(ctx,new Base({clip:!0,matrices:[matrix]})),this._matrix.applyToContext(ctx);var element=this.getElement(),size=this._size;element&&ctx.drawImage(element,-size.width/2,-size.height/2),ctx.restore();for(var pixels=ctx.getImageData(.5,.5,Math.ceil(width),Math.ceil(height)).data,channels=[0,0,0],total=0,i=0,l=pixels.length;i<l;i+=4){var alpha=pixels[i+3];total+=alpha,alpha/=255,channels[0]+=pixels[i]*alpha,channels[1]+=pixels[i+1]*alpha,channels[2]+=pixels[i+2]*alpha}for(i=0;i<3;i++)channels[i]/=total;return total?Color.read(channels):null},getPixel:function(){var point=Point.read(arguments),data=this.getContext().getImageData(point.x,point.y,1,1).data;return new Color("rgb",[data[0]/255,data[1]/255,data[2]/255],data[3]/255)},setPixel:function(){var args=arguments,point=Point.read(args),color=Color.read(args),components=color._convert("rgb"),alpha=color._alpha,ctx=this.getContext(!0),imageData=ctx.createImageData(1,1),data=imageData.data;data[0]=255*components[0],data[1]=255*components[1],data[2]=255*components[2],data[3]=null!=alpha?255*alpha:255,ctx.putImageData(imageData,point.x,point.y)},clear:function(){var size=this._size;this.getContext(!0).clearRect(0,0,size.width+1,size.height+1)},createImageData:function(){var size=Size.read(arguments);return this.getContext().createImageData(size.width,size.height)},getImageData:function(){var rect=Rectangle.read(arguments);return rect.isEmpty()&&(rect=new Rectangle(this._size)),this.getContext().getImageData(rect.x,rect.y,rect.width,rect.height)},putImageData:function(data){var point=Point.read(arguments,1);this.getContext(!0).putImageData(data,point.x,point.y)},setImageData:function(data){this.setSize(data),this.getContext(!0).putImageData(data,0,0)},_getBounds:function(matrix,options){var rect=new Rectangle(this._size).setCenter(0,0);return matrix?matrix._transformBounds(rect):rect},_hitTestSelf:function(point){if(this._contains(point)){var that=this;return new HitResult("pixel",that,{offset:point.add(that._size.divide(2)).round(),color:{get:function(){return that.getPixel(this.offset)}}})}},_draw:function(ctx,param,viewMatrix){var element=this.getElement();if(element&&element.width>0&&element.height>0){ctx.globalAlpha=Numerical.clamp(this._opacity,0,1),this._setStyles(ctx,param,viewMatrix);var smoothing=this._smoothing,disabled="off"===smoothing;DomElement.setPrefixed(ctx,disabled?"imageSmoothingEnabled":"imageSmoothingQuality",!disabled&&smoothing),ctx.drawImage(element,-this._size.width/2,-this._size.height/2)}},_canComposite:function(){return!0}}),SymbolItem=Item.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function SymbolItem(arg0,arg1){this._initialize(arg0,arg1!==undefined&&Point.read(arguments,1))||this.setDefinition(arg0 instanceof SymbolDefinition?arg0:new SymbolDefinition(arg0))},_equals:function(item){return this._definition===item._definition},copyContent:function(source){this.setDefinition(source._definition)},getDefinition:function(){return this._definition},setDefinition:function(definition){this._definition=definition,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(matrix,options){var item=this._definition._item;return item._getCachedBounds(item._matrix.prepended(matrix),options)},_hitTestSelf:function(point,options,viewMatrix){var opts=options.extend({all:!1}),res=this._definition._item._hitTest(point,opts,viewMatrix);return res&&(res.item=this),res},_draw:function(ctx,param){this._definition._item.draw(ctx,param)}}),SymbolDefinition=Base.extend({_class:"SymbolDefinition",initialize:function SymbolDefinition(item,dontCenter){this._id=UID.get(),this.project=paper.project,item&&this.setItem(item,dontCenter)},_serialize:function(options,dictionary){return dictionary.add(this,(function(){return Base.serialize([this._class,this._item],options,!1,dictionary)}))},_changed:function(flags){8&flags&&Item._clearBoundsCache(this),1&flags&&this.project._changed(flags)},getItem:function(){return this._item},setItem:function(item,_dontCenter){item._symbol&&(item=item.clone()),this._item&&(this._item._symbol=null),this._item=item,item.remove(),item.setSelected(!1),_dontCenter||item.setPosition(new Point),item._symbol=this,this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(position){return new SymbolItem(this,position)},clone:function(){return new SymbolDefinition(this._item.clone(!1))},equals:function(symbol){return symbol===this||symbol&&this._item.equals(symbol._item)||!1}}),HitResult=Base.extend({_class:"HitResult",initialize:function HitResult(type,item,values){this.type=type,this.item=item,values&&this.inject(values)},statics:{getOptions:function(args){var options=args&&Base.read(args);return new Base({type:null,tolerance:paper.settings.hitTolerance,fill:!options,stroke:!options,segments:!options,handles:!1,ends:!1,position:!1,center:!1,bounds:!1,guides:!1,selected:!1},options)}}}),Segment=Base.extend({_class:"Segment",beans:!0,_selection:0,initialize:function Segment(arg0,arg1,arg2,arg3,arg4,arg5){var point,handleIn,handleOut,selection,count=arguments.length;count>0&&(null==arg0||"object"==typeof arg0?1===count&&arg0&&"point"in arg0?(point=arg0.point,handleIn=arg0.handleIn,handleOut=arg0.handleOut,selection=arg0.selection):(point=arg0,handleIn=arg1,handleOut=arg2,selection=arg3):(point=[arg0,arg1],handleIn=arg2!==undefined?[arg2,arg3]:null,handleOut=arg4!==undefined?[arg4,arg5]:null)),new SegmentPoint(point,this,"_point"),new SegmentPoint(handleIn,this,"_handleIn"),new SegmentPoint(handleOut,this,"_handleOut"),selection&&this.setSelection(selection)},_serialize:function(options,dictionary){var point=this._point,selection=this._selection,obj=selection||this.hasHandles()?[point,this._handleIn,this._handleOut]:point;return selection&&obj.push(selection),Base.serialize(obj,options,!0,dictionary)},_changed:function(point){var path=this._path;if(path){var curve,curves=path._curves,index=this._index;curves&&(point&&point!==this._point&&point!==this._handleIn||!(curve=index>0?curves[index-1]:path._closed?curves[curves.length-1]:null)||curve._changed(),point&&point!==this._point&&point!==this._handleOut||!(curve=curves[index])||curve._changed()),path._changed(41)}},getPoint:function(){return this._point},setPoint:function(){this._point.set(Point.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(Point.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(Point.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var handleIn=this._handleIn,handleOut=this._handleOut;return!handleIn.isZero()&&!handleOut.isZero()&&handleIn.isCollinear(handleOut)},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(selection){var oldSelection=this._selection,path=this._path;this._selection=selection=selection||0,path&&selection!==oldSelection&&(path._updateSelection(this,oldSelection,selection),path._changed(257))},_changeSelection:function(flag,selected){var selection=this._selection;this.setSelection(selected?selection|flag:selection&~flag)},isSelected:function(){return!!(7&this._selection)},setSelected:function(selected){this._changeSelection(7,selected)},getIndex:function(){return this._index!==undefined?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var path=this._path,index=this._index;return path?(index>0&&!path._closed&&index===path._segments.length-1&&index--,path.getCurves()[index]||null):null},getLocation:function(){var curve=this.getCurve();return curve?new CurveLocation(curve,this===curve._segment1?0:1):null},getNext:function(){var segments=this._path&&this._path._segments;return segments&&(segments[this._index+1]||this._path._closed&&segments[0])||null},smooth:function(options,_first,_last){var opts=options||{},type=opts.type,factor=opts.factor,prev=this.getPrevious(),next=this.getNext(),p0=(prev||this)._point,p1=this._point,p2=(next||this)._point,d1=p0.getDistance(p1),d2=p1.getDistance(p2);if(type&&"catmull-rom"!==type){if("geometric"!==type)throw new Error("Smoothing method '"+type+"' not supported.");if(prev&&next){var vector=p0.subtract(p2),t=factor===undefined?.4:factor,k=t*d1/(d1+d2);_first||this.setHandleIn(vector.multiply(k)),_last||this.setHandleOut(vector.multiply(k-t))}}else{var a=factor===undefined?.5:factor,d1_a=Math.pow(d1,a),d1_2a=d1_a*d1_a,d2_a=Math.pow(d2,a),d2_2a=d2_a*d2_a;if(!_first&&prev){var A=2*d2_2a+3*d2_a*d1_a+d1_2a,N=3*d2_a*(d2_a+d1_a);this.setHandleIn(0!==N?new Point((d2_2a*p0._x+A*p1._x-d1_2a*p2._x)/N-p1._x,(d2_2a*p0._y+A*p1._y-d1_2a*p2._y)/N-p1._y):new Point)}if(!_last&&next){A=2*d1_2a+3*d1_a*d2_a+d2_2a,N=3*d1_a*(d1_a+d2_a);this.setHandleOut(0!==N?new Point((d1_2a*p2._x+A*p1._x-d2_2a*p0._x)/N-p1._x,(d1_2a*p2._y+A*p1._y-d2_2a*p0._y)/N-p1._y):new Point)}}},getPrevious:function(){var segments=this._path&&this._path._segments;return segments&&(segments[this._index-1]||this._path._closed&&segments[segments.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var path=this._path;return path&&this._index===path._segments.length-1||!1},reverse:function(){var handleIn=this._handleIn,handleOut=this._handleOut,tmp=handleIn.clone();handleIn.set(handleOut),handleOut.set(tmp)},reversed:function(){return new Segment(this._point,this._handleOut,this._handleIn)},remove:function(){return!!this._path&&!!this._path.removeSegment(this._index)},clone:function(){return new Segment(this._point,this._handleIn,this._handleOut)},equals:function(segment){return segment===this||segment&&this._class===segment._class&&this._point.equals(segment._point)&&this._handleIn.equals(segment._handleIn)&&this._handleOut.equals(segment._handleOut)||!1},toString:function(){var parts=["point: "+this._point];return this._handleIn.isZero()||parts.push("handleIn: "+this._handleIn),this._handleOut.isZero()||parts.push("handleOut: "+this._handleOut),"{ "+parts.join(", ")+" }"},transform:function(matrix){this._transformCoordinates(matrix,new Array(6),!0),this._changed()},interpolate:function(from,to,factor){var u=1-factor,v=factor,point1=from._point,point2=to._point,handleIn1=from._handleIn,handleIn2=to._handleIn,handleOut2=to._handleOut,handleOut1=from._handleOut;this._point._set(u*point1._x+v*point2._x,u*point1._y+v*point2._y,!0),this._handleIn._set(u*handleIn1._x+v*handleIn2._x,u*handleIn1._y+v*handleIn2._y,!0),this._handleOut._set(u*handleOut1._x+v*handleOut2._x,u*handleOut1._y+v*handleOut2._y,!0),this._changed()},_transformCoordinates:function(matrix,coords,change){var point=this._point,handleIn=change&&this._handleIn.isZero()?null:this._handleIn,handleOut=change&&this._handleOut.isZero()?null:this._handleOut,x=point._x,y=point._y,i=2;return coords[0]=x,coords[1]=y,handleIn&&(coords[i++]=handleIn._x+x,coords[i++]=handleIn._y+y),handleOut&&(coords[i++]=handleOut._x+x,coords[i++]=handleOut._y+y),matrix&&(matrix._transformCoordinates(coords,coords,i/2),x=coords[0],y=coords[1],change?(point._x=x,point._y=y,i=2,handleIn&&(handleIn._x=coords[i++]-x,handleIn._y=coords[i++]-y),handleOut&&(handleOut._x=coords[i++]-x,handleOut._y=coords[i++]-y)):(handleIn||(coords[i++]=x,coords[i++]=y),handleOut||(coords[i++]=x,coords[i++]=y))),coords}}),SegmentPoint=Point.extend({initialize:function SegmentPoint(point,owner,key){var x,y,selected;if(point)if((x=point[0])!==undefined)y=point[1];else{var pt=point;(x=pt.x)===undefined&&(x=(pt=Point.read(arguments)).x),y=pt.y,selected=pt.selected}else x=y=0;this._x=x,this._y=y,this._owner=owner,owner[key]=this,selected&&this.setSelected(!0)},_set:function(x,y){return this._x=x,this._y=y,this._owner._changed(this),this},getX:function(){return this._x},setX:function(x){this._x=x,this._owner._changed(this)},getY:function(){return this._y},setY:function(y){this._y=y,this._owner._changed(this)},isZero:function(){var isZero=Numerical.isZero;return isZero(this._x)&&isZero(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(selected){this._owner._changeSelection(this._getSelection(),selected)},_getSelection:function(){var owner=this._owner;return this===owner._point?1:this===owner._handleIn?2:this===owner._handleOut?4:0}}),Curve=Base.extend({_class:"Curve",beans:!0,initialize:function Curve(arg0,arg1,arg2,arg3,arg4,arg5,arg6,arg7){var seg1,seg2,point1,point2,handle1,handle2,count=arguments.length;3===count?(this._path=arg0,seg1=arg1,seg2=arg2):count?1===count?"segment1"in arg0?(seg1=new Segment(arg0.segment1),seg2=new Segment(arg0.segment2)):"point1"in arg0?(point1=arg0.point1,handle1=arg0.handle1,handle2=arg0.handle2,point2=arg0.point2):Array.isArray(arg0)&&(point1=[arg0[0],arg0[1]],point2=[arg0[6],arg0[7]],handle1=[arg0[2]-arg0[0],arg0[3]-arg0[1]],handle2=[arg0[4]-arg0[6],arg0[5]-arg0[7]]):2===count?(seg1=new Segment(arg0),seg2=new Segment(arg1)):4===count?(point1=arg0,handle1=arg1,handle2=arg2,point2=arg3):8===count&&(point1=[arg0,arg1],point2=[arg6,arg7],handle1=[arg2-arg0,arg3-arg1],handle2=[arg4-arg6,arg5-arg7]):(seg1=new Segment,seg2=new Segment),this._segment1=seg1||new Segment(point1,null,handle1),this._segment2=seg2||new Segment(point2,handle2,null)},_serialize:function(options,dictionary){return Base.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],options,!0,dictionary)},_changed:function(){this._length=this._bounds=undefined},clone:function(){return new Curve(this._segment1,this._segment2)},toString:function(){var parts=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||parts.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||parts.push("handle2: "+this._segment2._handleIn),parts.push("point2: "+this._segment2._point),"{ "+parts.join(", ")+" }"},classify:function(){return Curve.classify(this.getValues())},remove:function(){var removed=!1;if(this._path){var segment2=this._segment2,handleOut=segment2._handleOut;(removed=segment2.remove())&&this._segment1._handleOut.set(handleOut)}return removed},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(Point.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(Point.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(Point.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(Point.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var curves=this._path&&this._path._curves;return curves&&(curves[this._segment1._index+1]||this._path._closed&&curves[0])||null},getPrevious:function(){var curves=this._path&&this._path._curves;return curves&&(curves[this._segment1._index-1]||this._path._closed&&curves[curves.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var path=this._path;return path&&this._segment1._index===path._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle1().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(selected){this.getPoint1().setSelected(selected),this.getHandle1().setSelected(selected),this.getHandle2().setSelected(selected),this.getPoint2().setSelected(selected)},getValues:function(matrix){return Curve.getValues(this._segment1,this._segment2,matrix)},getPoints:function(){for(var coords=this.getValues(),points=[],i=0;i<8;i+=2)points.push(new Point(coords[i],coords[i+1]));return points}},{getLength:function(){return null==this._length&&(this._length=Curve.getLength(this.getValues(),0,1)),this._length},getArea:function(){return Curve.getArea(this.getValues())},getLine:function(){return new Line(this._segment1._point,this._segment2._point)},getPart:function(from,to){return new Curve(Curve.getPart(this.getValues(),from,to))},getPartLength:function(from,to){return Curve.getLength(this.getValues(),from,to)},divideAt:function(location){return this.divideAtTime(location&&location.curve===this?location.time:this.getTimeAt(location))},divideAtTime:function(time,_setHandles){var res=null;if(time>=1e-8&&time<=.99999999){var parts=Curve.subdivide(this.getValues(),time),left=parts[0],right=parts[1],setHandles=_setHandles||this.hasHandles(),seg1=this._segment1,seg2=this._segment2,path=this._path;setHandles&&(seg1._handleOut._set(left[2]-left[0],left[3]-left[1]),seg2._handleIn._set(right[4]-right[6],right[5]-right[7]));var x=left[6],y=left[7],segment=new Segment(new Point(x,y),setHandles&&new Point(left[4]-x,left[5]-y),setHandles&&new Point(right[2]-x,right[3]-y));path?(path.insert(seg1._index+1,segment),res=this.getNext()):(this._segment2=segment,this._changed(),res=new Curve(segment,seg2))}return res},splitAt:function(location){var path=this._path;return path?path.splitAt(location):null},splitAtTime:function(time){return this.splitAt(this.getLocationAtTime(time))},divide:function(offset,isTime){return this.divideAtTime(offset===undefined?.5:isTime?offset:this.getTimeAt(offset))},split:function(offset,isTime){return this.splitAtTime(offset===undefined?.5:isTime?offset:this.getTimeAt(offset))},reversed:function(){return new Curve(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(segment1,segment2,matrix,straight){var p1=segment1._point,h1=segment1._handleOut,h2=segment2._handleIn,p2=segment2._point,x1=p1.x,y1=p1.y,x2=p2.x,y2=p2.y,values=straight?[x1,y1,x1,y1,x2,y2,x2,y2]:[x1,y1,x1+h1._x,y1+h1._y,x2+h2._x,y2+h2._y,x2,y2];return matrix&&matrix._transformCoordinates(values,values,4),values},subdivide:function(v,t){var x0=v[0],y0=v[1],x1=v[2],y1=v[3],x2=v[4],y2=v[5],x3=v[6],y3=v[7];t===undefined&&(t=.5);var u=1-t,x4=u*x0+t*x1,y4=u*y0+t*y1,x5=u*x1+t*x2,y5=u*y1+t*y2,x6=u*x2+t*x3,y6=u*y2+t*y3,x7=u*x4+t*x5,y7=u*y4+t*y5,x8=u*x5+t*x6,y8=u*y5+t*y6,x9=u*x7+t*x8,y9=u*y7+t*y8;return[[x0,y0,x4,y4,x7,y7,x9,y9],[x9,y9,x8,y8,x6,y6,x3,y3]]},getMonoCurves:function(v,dir){var curves=[],io=dir?0:1,o0=v[io+0],o1=v[io+2],o2=v[io+4],o3=v[io+6];if(o0>=o1==o1>=o2&&o1>=o2==o2>=o3||Curve.isStraight(v))curves.push(v);else{var a=3*(o1-o2)-o0+o3,b=2*(o0+o2)-4*o1,c=o1-o0,roots=[],n=Numerical.solveQuadratic(a,b,c,roots,1e-8,.99999999);if(n){roots.sort();var t=roots[0],parts=Curve.subdivide(v,t);curves.push(parts[0]),n>1&&(t=(roots[1]-t)/(1-t),parts=Curve.subdivide(parts[1],t),curves.push(parts[0])),curves.push(parts[1])}else curves.push(v)}return curves},solveCubic:function(v,coord,val,roots,min,max){var v0=v[coord],v1=v[coord+2],v2=v[coord+4],v3=v[coord+6],res=0;if(!(v0<val&&v3<val&&v1<val&&v2<val||v0>val&&v3>val&&v1>val&&v2>val)){var c=3*(v1-v0),b=3*(v2-v1)-c,a=v3-v0-c-b;res=Numerical.solveCubic(a,b,c,v0-val,roots,min,max)}return res},getTimeOf:function(v,point){var p0=new Point(v[0],v[1]),p3=new Point(v[6],v[7]);if(null===(point.isClose(p0,1e-12)?0:point.isClose(p3,1e-12)?1:null))for(var coords=[point.x,point.y],roots=[],c=0;c<2;c++)for(var count=Curve.solveCubic(v,c,coords[c],roots,0,1),i=0;i<count;i++){var u=roots[i];if(point.isClose(Curve.getPoint(v,u),1e-7))return u}return point.isClose(p0,1e-7)?0:point.isClose(p3,1e-7)?1:null},getNearestTime:function(v,point){if(Curve.isStraight(v)){var x0=v[0],y0=v[1],vx=v[6]-x0,vy=v[7]-y0,det=vx*vx+vy*vy;if(0===det)return 0;var u=((point.x-x0)*vx+(point.y-y0)*vy)/det;return u<1e-12?0:u>.999999999999?1:Curve.getTimeOf(v,new Point(x0+u*vx,y0+u*vy))}var minDist=1/0,minT=0;function refine(t){if(t>=0&&t<=1){var dist=point.getDistance(Curve.getPoint(v,t),!0);if(dist<minDist)return minDist=dist,minT=t,!0}}for(var i=0;i<=100;i++)refine(i/100);for(var step=.005;step>1e-8;)refine(minT-step)||refine(minT+step)||(step/=2);return minT},getPart:function(v,from,to){var flip=from>to;if(flip){var tmp=from;from=to,to=tmp}return from>0&&(v=Curve.subdivide(v,from)[1]),to<1&&(v=Curve.subdivide(v,(to-from)/(1-from))[0]),flip?[v[6],v[7],v[4],v[5],v[2],v[3],v[0],v[1]]:v},isFlatEnough:function(v,flatness){var x0=v[0],y0=v[1],x1=v[2],y1=v[3],x2=v[4],y2=v[5],x3=v[6],y3=v[7],ux=3*x1-2*x0-x3,uy=3*y1-2*y0-y3,vx=3*x2-2*x3-x0,vy=3*y2-2*y3-y0;return Math.max(ux*ux,vx*vx)+Math.max(uy*uy,vy*vy)<=16*flatness*flatness},getArea:function(v){var x0=v[0],y0=v[1],x1=v[2],y1=v[3],x2=v[4],y2=v[5],x3=v[6],y3=v[7];return 3*((y3-y0)*(x1+x2)-(x3-x0)*(y1+y2)+y1*(x0-x2)-x1*(y0-y2)+y3*(x2+x0/3)-x3*(y2+y0/3))/20},getBounds:function(v){for(var min=v.slice(0,2),max=min.slice(),roots=[0,0],i=0;i<2;i++)Curve._addBounds(v[i],v[i+2],v[i+4],v[i+6],i,0,min,max,roots);return new Rectangle(min[0],min[1],max[0]-min[0],max[1]-min[1])},_addBounds:function(v0,v1,v2,v3,coord,padding,min,max,roots){function add(value,padding){var left=value-padding,right=value+padding;left<min[coord]&&(min[coord]=left),right>max[coord]&&(max[coord]=right)}padding/=2;var minPad=min[coord]+padding,maxPad=max[coord]-padding;if(v0<minPad||v1<minPad||v2<minPad||v3<minPad||v0>maxPad||v1>maxPad||v2>maxPad||v3>maxPad)if(v1<v0!=v1<v3&&v2<v0!=v2<v3)add(v0,0),add(v3,0);else{var a=3*(v1-v2)-v0+v3,b=2*(v0+v2)-4*v1,c=v1-v0,count=Numerical.solveQuadratic(a,b,c,roots);add(v3,0);for(var i=0;i<count;i++){var t=roots[i],u=1-t;1e-8<=t&&t<=.99999999&&add(u*u*u*v0+3*u*u*t*v1+3*u*t*t*v2+t*t*t*v3,padding)}}}}},Base.each(["getBounds","getStrokeBounds","getHandleBounds"],(function(name){this[name]=function(){this._bounds||(this._bounds={});var bounds=this._bounds[name];return bounds||(bounds=this._bounds[name]=Path[name]([this._segment1,this._segment2],!1,this._path)),bounds.clone()}}),{}),Base.each({isStraight:function(p1,h1,h2,p2){if(h1.isZero()&&h2.isZero())return!0;var v=p2.subtract(p1);if(v.isZero())return!1;if(v.isCollinear(h1)&&v.isCollinear(h2)){var l=new Line(p1,p2);if(l.getDistance(p1.add(h1))<1e-7&&l.getDistance(p2.add(h2))<1e-7){var div=v.dot(v),s1=v.dot(h1)/div,s2=v.dot(h2)/div;return s1>=0&&s1<=1&&s2<=0&&s2>=-1}}return!1},isLinear:function(p1,h1,h2,p2){var third=p2.subtract(p1).divide(3);return h1.equals(third)&&h2.negate().equals(third)}},(function(test,name){this[name]=function(epsilon){var seg1=this._segment1,seg2=this._segment2;return test(seg1._point,seg1._handleOut,seg2._handleIn,seg2._point,epsilon)},this.statics[name]=function(v,epsilon){var x0=v[0],y0=v[1],x3=v[6],y3=v[7];return test(new Point(x0,y0),new Point(v[2]-x0,v[3]-y0),new Point(v[4]-x3,v[5]-y3),new Point(x3,y3),epsilon)}}),{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(epsilon){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(epsilon||0)},isCollinear:function(curve){return curve&&this.isStraight()&&curve.isStraight()&&this.getLine().isCollinear(curve.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-8},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-8}}),{beans:!1,getLocationAt:function(offset,_isTime){return this.getLocationAtTime(_isTime?offset:this.getTimeAt(offset))},getLocationAtTime:function(t){return null!=t&&t>=0&&t<=1?new CurveLocation(this,t):null},getTimeAt:function(offset,start){return Curve.getTimeAt(this.getValues(),offset,start)},getParameterAt:"#getTimeAt",getTimesWithTangent:function(){var tangent=Point.read(arguments);return tangent.isZero()?[]:Curve.getTimesWithTangent(this.getValues(),tangent)},getOffsetAtTime:function(t){return this.getPartLength(0,t)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(Point.read(arguments)))},getOffsetOf:function(){var loc=this.getLocationOf.apply(this,arguments);return loc?loc.getOffset():null},getTimeOf:function(){return Curve.getTimeOf(this.getValues(),Point.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var point=Point.read(arguments),values=this.getValues(),t=Curve.getNearestTime(values,point),pt=Curve.getPoint(values,t);return new CurveLocation(this,t,pt,null,point.getDistance(pt))},getNearestPoint:function(){var loc=this.getNearestLocation.apply(this,arguments);return loc?loc.getPoint():loc}},new function(){var methods=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return Base.each(methods,(function(name){this[name+"At"]=function(location,_isTime){var values=this.getValues();return Curve[name](values,_isTime?location:Curve.getTimeAt(values,location))},this[name+"AtTime"]=function(time){return Curve[name](this.getValues(),time)}}),{statics:{_evaluateMethods:methods}})},new function(){function getLengthIntegrand(v){var x0=v[0],y0=v[1],x1=v[2],y1=v[3],x2=v[4],y2=v[5],x3=v[6],y3=v[7],ax=9*(x1-x2)+3*(x3-x0),bx=6*(x0+x2)-12*x1,cx=3*(x1-x0),ay=9*(y1-y2)+3*(y3-y0),by=6*(y0+y2)-12*y1,cy=3*(y1-y0);return function(t){var dx=(ax*t+bx)*t+cx,dy=(ay*t+by)*t+cy;return Math.sqrt(dx*dx+dy*dy)}}function getIterations(a,b){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(b-a))))}function evaluate(v,t,type,normalized){if(null==t||t<0||t>1)return null;var x0=v[0],y0=v[1],x1=v[2],y1=v[3],x2=v[4],y2=v[5],x3=v[6],y3=v[7],isZero=Numerical.isZero;isZero(x1-x0)&&isZero(y1-y0)&&(x1=x0,y1=y0),isZero(x2-x3)&&isZero(y2-y3)&&(x2=x3,y2=y3);var x,y,cx=3*(x1-x0),bx=3*(x2-x1)-cx,ax=x3-x0-cx-bx,cy=3*(y1-y0),by=3*(y2-y1)-cy,ay=y3-y0-cy-by;if(0===type)x=0===t?x0:1===t?x3:((ax*t+bx)*t+cx)*t+x0,y=0===t?y0:1===t?y3:((ay*t+by)*t+cy)*t+y0;else{if(t<1e-8?(x=cx,y=cy):t>.99999999?(x=3*(x3-x2),y=3*(y3-y2)):(x=(3*ax*t+2*bx)*t+cx,y=(3*ay*t+2*by)*t+cy),normalized){0===x&&0===y&&(t<1e-8||t>.99999999)&&(x=x2-x1,y=y2-y1);var len=Math.sqrt(x*x+y*y);len&&(x/=len,y/=len)}if(3===type){x2=6*ax*t+2*bx,y2=6*ay*t+2*by;var d=Math.pow(x*x+y*y,1.5);x=0!==d?(x*y2-y*x2)/d:0,y=0}}return 2===type?new Point(y,-x):new Point(x,y)}return{statics:{classify:function(v){var x0=v[0],y0=v[1],x1=v[2],y1=v[3],x2=v[4],y2=v[5],x3=v[6],y3=v[7],a2=x1*(y0-y3)+y1*(x3-x0)+x0*y3-y0*x3,d3=3*(x2*(y1-y0)+y2*(x0-x1)+x1*y0-y1*x0),d2=d3-a2,d1=d2-a2+(x0*(y3-y2)+y0*(x2-x3)+x3*y2-y3*x2),l=Math.sqrt(d1*d1+d2*d2+d3*d3),s=0!==l?1/l:0,isZero=Numerical.isZero;function type(type,t1,t2){var hasRoots=t1!==undefined,t1Ok=hasRoots&&t1>0&&t1<1,t2Ok=hasRoots&&t2>0&&t2<1;return!hasRoots||(t1Ok||t2Ok)&&("loop"!==type||t1Ok&&t2Ok)||(type="arch",t1Ok=t2Ok=!1),{type,roots:t1Ok||t2Ok?t1Ok&&t2Ok?t1<t2?[t1,t2]:[t2,t1]:[t1Ok?t1:t2]:null}}if(d2*=s,d3*=s,isZero(d1*=s))return isZero(d2)?type(isZero(d3)?"line":"quadratic"):type("serpentine",d3/(3*d2));var d=3*d2*d2-4*d1*d3;if(isZero(d))return type("cusp",d2/(2*d1));var f1=d>0?Math.sqrt(d/3):Math.sqrt(-d),f2=2*d1;return type(d>0?"serpentine":"loop",(d2+f1)/f2,(d2-f1)/f2)},getLength:function(v,a,b,ds){if(a===undefined&&(a=0),b===undefined&&(b=1),Curve.isStraight(v)){var c=v;b<1&&(c=Curve.subdivide(c,b)[0],a/=b),a>0&&(c=Curve.subdivide(c,a)[1]);var dx=c[6]-c[0],dy=c[7]-c[1];return Math.sqrt(dx*dx+dy*dy)}return Numerical.integrate(ds||getLengthIntegrand(v),a,b,getIterations(a,b))},getTimeAt:function(v,offset,start){if(start===undefined&&(start=offset<0?1:0),0===offset)return start;var abs=Math.abs,forward=offset>0,a=forward?start:0,b=forward?1:start,ds=getLengthIntegrand(v),rangeLength=Curve.getLength(v,a,b,ds),diff=abs(offset)-rangeLength;if(abs(diff)<1e-12)return forward?b:a;if(diff>1e-12)return null;var guess=offset/rangeLength,length=0;return Numerical.findRoot((function f(t){return length+=Numerical.integrate(ds,start,t,getIterations(start,t)),start=t,length-offset}),ds,start+guess,a,b,32,1e-12)},getPoint:function(v,t){return evaluate(v,t,0,!1)},getTangent:function(v,t){return evaluate(v,t,1,!0)},getWeightedTangent:function(v,t){return evaluate(v,t,1,!1)},getNormal:function(v,t){return evaluate(v,t,2,!0)},getWeightedNormal:function(v,t){return evaluate(v,t,2,!1)},getCurvature:function(v,t){return evaluate(v,t,3,!1).x},getPeaks:function(v){var x0=v[0],y0=v[1],x1=v[2],y1=v[3],x2=v[4],y2=v[5],ax=3*x1-x0-3*x2+v[6],bx=3*x0-6*x1+3*x2,cx=-3*x0+3*x1,ay=3*y1-y0-3*y2+v[7],by=3*y0-6*y1+3*y2,cy=-3*y0+3*y1,roots=[];return Numerical.solveCubic(9*(ax*ax+ay*ay),9*(ax*bx+by*ay),2*(bx*bx+by*by)+3*(cx*ax+cy*ay),cx*bx+by*cy,roots,1e-8,.99999999),roots.sort()}}}},new function(){function addLocation(locations,include,c1,t1,c2,t2,overlap){var excludeStart=!overlap&&c1.getPrevious()===c2,excludeEnd=!overlap&&c1!==c2&&c1.getNext()===c2;if(null!==t1&&t1>=(excludeStart?1e-8:0)&&t1<=(excludeEnd?.99999999:1)&&null!==t2&&t2>=(excludeEnd?1e-8:0)&&t2<=(excludeStart?.99999999:1)){var loc1=new CurveLocation(c1,t1,null,overlap),loc2=new CurveLocation(c2,t2,null,overlap);loc1._intersection=loc2,loc2._intersection=loc1,include&&!include(loc1)||CurveLocation.insert(locations,loc1,!0)}}function addCurveIntersections(v1,v2,c1,c2,locations,include,flip,recursion,calls,tMin,tMax,uMin,uMax){if(++calls>=4096||++recursion>=40)return calls;var tMinClip,tMaxClip,q0x=v2[0],q0y=v2[1],q3x=v2[6],q3y=v2[7],getSignedDistance=Line.getSignedDistance,d1=getSignedDistance(q0x,q0y,q3x,q3y,v2[2],v2[3]),d2=getSignedDistance(q0x,q0y,q3x,q3y,v2[4],v2[5]),factor=d1*d2>0?3/4:4/9,dMin=factor*Math.min(0,d1,d2),dMax=factor*Math.max(0,d1,d2),dp0=getSignedDistance(q0x,q0y,q3x,q3y,v1[0],v1[1]),dp1=getSignedDistance(q0x,q0y,q3x,q3y,v1[2],v1[3]),dp2=getSignedDistance(q0x,q0y,q3x,q3y,v1[4],v1[5]),dp3=getSignedDistance(q0x,q0y,q3x,q3y,v1[6],v1[7]),hull=function getConvexHull(dq0,dq1,dq2,dq3){var hull,p0=[0,dq0],p1=[1/3,dq1],p2=[2/3,dq2],p3=[1,dq3],dist1=dq1-(2*dq0+dq3)/3,dist2=dq2-(dq0+2*dq3)/3;if(dist1*dist2<0)hull=[[p0,p1,p3],[p0,p2,p3]];else{var distRatio=dist1/dist2;hull=[distRatio>=2?[p0,p1,p3]:distRatio<=.5?[p0,p2,p3]:[p0,p1,p2,p3],[p0,p3]]}return(dist1||dist2)<0?hull.reverse():hull}(dp0,dp1,dp2,dp3),top=hull[0],bottom=hull[1];if(0===d1&&0===d2&&0===dp0&&0===dp1&&0===dp2&&0===dp3||null==(tMinClip=clipConvexHull(top,bottom,dMin,dMax))||null==(tMaxClip=clipConvexHull(top.reverse(),bottom.reverse(),dMin,dMax)))return calls;var tMinNew=tMin+(tMax-tMin)*tMinClip,tMaxNew=tMin+(tMax-tMin)*tMaxClip;if(Math.max(uMax-uMin,tMaxNew-tMinNew)<1e-9){var t=(tMinNew+tMaxNew)/2,u=(uMin+uMax)/2;addLocation(locations,include,flip?c2:c1,flip?u:t,flip?c1:c2,flip?t:u)}else{v1=Curve.getPart(v1,tMinClip,tMaxClip);var uDiff=uMax-uMin;if(tMaxClip-tMinClip>.8)if(tMaxNew-tMinNew>uDiff){t=(tMinNew+tMaxNew)/2;calls=addCurveIntersections(v2,(parts=Curve.subdivide(v1,.5))[0],c2,c1,locations,include,!flip,recursion,calls,uMin,uMax,tMinNew,t),calls=addCurveIntersections(v2,parts[1],c2,c1,locations,include,!flip,recursion,calls,uMin,uMax,t,tMaxNew)}else{var parts;u=(uMin+uMax)/2;calls=addCurveIntersections((parts=Curve.subdivide(v2,.5))[0],v1,c2,c1,locations,include,!flip,recursion,calls,uMin,u,tMinNew,tMaxNew),calls=addCurveIntersections(parts[1],v1,c2,c1,locations,include,!flip,recursion,calls,u,uMax,tMinNew,tMaxNew)}else calls=0===uDiff||uDiff>=1e-9?addCurveIntersections(v2,v1,c2,c1,locations,include,!flip,recursion,calls,uMin,uMax,tMinNew,tMaxNew):addCurveIntersections(v1,v2,c1,c2,locations,include,flip,recursion,calls,tMinNew,tMaxNew,uMin,uMax)}return calls}function clipConvexHull(hullTop,hullBottom,dMin,dMax){return hullTop[0][1]<dMin?clipConvexHullPart(hullTop,!0,dMin):hullBottom[0][1]>dMax?clipConvexHullPart(hullBottom,!1,dMax):hullTop[0][0]}function clipConvexHullPart(part,top,threshold){for(var px=part[0][0],py=part[0][1],i=1,l=part.length;i<l;i++){var qx=part[i][0],qy=part[i][1];if(top?qy>=threshold:qy<=threshold)return qy===threshold?qx:px+(threshold-py)*(qx-px)/(qy-py);px=qx,py=qy}return null}function getCurveLineIntersections(v,px,py,vx,vy){var isZero=Numerical.isZero;if(isZero(vx)&&isZero(vy)){var t=Curve.getTimeOf(v,new Point(px,py));return null===t?[]:[t]}for(var angle=Math.atan2(-vy,vx),sin=Math.sin(angle),cos=Math.cos(angle),rv=[],roots=[],i=0;i<8;i+=2){var x=v[i]-px,y=v[i+1]-py;rv.push(x*cos-y*sin,x*sin+y*cos)}return Curve.solveCubic(rv,1,0,roots,0,1),roots}function addCurveLineIntersections(v1,v2,c1,c2,locations,include,flip){for(var x1=v2[0],y1=v2[1],roots=getCurveLineIntersections(v1,x1,y1,v2[6]-x1,v2[7]-y1),i=0,l=roots.length;i<l;i++){var t1=roots[i],p1=Curve.getPoint(v1,t1),t2=Curve.getTimeOf(v2,p1);null!==t2&&addLocation(locations,include,flip?c2:c1,flip?t2:t1,flip?c1:c2,flip?t1:t2)}}function addLineIntersection(v1,v2,c1,c2,locations,include){var pt=Line.intersect(v1[0],v1[1],v1[6],v1[7],v2[0],v2[1],v2[6],v2[7]);pt&&addLocation(locations,include,c1,Curve.getTimeOf(v1,pt),c2,Curve.getTimeOf(v2,pt))}function getCurveIntersections(v1,v2,c1,c2,locations,include){var min=Math.min,max=Math.max;if(max(v1[0],v1[2],v1[4],v1[6])+1e-12>min(v2[0],v2[2],v2[4],v2[6])&&min(v1[0],v1[2],v1[4],v1[6])-1e-12<max(v2[0],v2[2],v2[4],v2[6])&&max(v1[1],v1[3],v1[5],v1[7])+1e-12>min(v2[1],v2[3],v2[5],v2[7])&&min(v1[1],v1[3],v1[5],v1[7])-1e-12<max(v2[1],v2[3],v2[5],v2[7])){var overlaps=getOverlaps(v1,v2);if(overlaps)for(var i=0;i<2;i++){var overlap=overlaps[i];addLocation(locations,include,c1,overlap[0],c2,overlap[1],!0)}else{var straight1=Curve.isStraight(v1),straight2=Curve.isStraight(v2),straight=straight1&&straight2,flip=straight1&&!straight2,before=locations.length;if((straight?addLineIntersection:straight1||straight2?addCurveLineIntersections:addCurveIntersections)(flip?v2:v1,flip?v1:v2,flip?c2:c1,flip?c1:c2,locations,include,flip,0,0,0,1,0,1),!straight||locations.length===before)for(i=0;i<4;i++){var t1=i>>1,t2=1&i,i1=6*t1,i2=6*t2,p1=new Point(v1[i1],v1[i1+1]),p2=new Point(v2[i2],v2[i2+1]);p1.isClose(p2,1e-12)&&addLocation(locations,include,c1,t1,c2,t2)}}}return locations}function getSelfIntersection(v1,c1,locations,include){var info=Curve.classify(v1);if("loop"===info.type){var roots=info.roots;addLocation(locations,include,c1,roots[0],c1,roots[1])}return locations}function getOverlaps(v1,v2){function getSquaredLineLength(v){var x=v[6]-v[0],y=v[7]-v[1];return x*x+y*y}var abs=Math.abs,getDistance=Line.getDistance,straight1=Curve.isStraight(v1),straight2=Curve.isStraight(v2),straightBoth=straight1&&straight2,flip=getSquaredLineLength(v1)<getSquaredLineLength(v2),l1=flip?v2:v1,l2=flip?v1:v2,px=l1[0],py=l1[1],vx=l1[6]-px,vy=l1[7]-py;if(getDistance(px,py,vx,vy,l2[0],l2[1],!0)<1e-7&&getDistance(px,py,vx,vy,l2[6],l2[7],!0)<1e-7)!straightBoth&&getDistance(px,py,vx,vy,l1[2],l1[3],!0)<1e-7&&getDistance(px,py,vx,vy,l1[4],l1[5],!0)<1e-7&&getDistance(px,py,vx,vy,l2[2],l2[3],!0)<1e-7&&getDistance(px,py,vx,vy,l2[4],l2[5],!0)<1e-7&&(straight1=straight2=straightBoth=!0);else if(straightBoth)return null;if(straight1^straight2)return null;for(var v=[v1,v2],pairs=[],i=0;i<4&&pairs.length<2;i++){var i1=1&i,i2=1^i1,t1=i>>1,t2=Curve.getTimeOf(v[i1],new Point(v[i2][t1?6:0],v[i2][t1?7:1]));if(null!=t2){var pair=i1?[t1,t2]:[t2,t1];(!pairs.length||abs(pair[0]-pairs[0][0])>1e-8&&abs(pair[1]-pairs[0][1])>1e-8)&&pairs.push(pair)}if(i>2&&!pairs.length)break}if(2!==pairs.length)pairs=null;else if(!straightBoth){var o1=Curve.getPart(v1,pairs[0][0],pairs[1][0]),o2=Curve.getPart(v2,pairs[0][1],pairs[1][1]);(abs(o2[2]-o1[2])>1e-7||abs(o2[3]-o1[3])>1e-7||abs(o2[4]-o1[4])>1e-7||abs(o2[5]-o1[5])>1e-7)&&(pairs=null)}return pairs}return{getIntersections:function(curve){var v1=this.getValues(),v2=curve&&curve!==this&&curve.getValues();return v2?getCurveIntersections(v1,v2,this,curve,[]):getSelfIntersection(v1,this,[])},statics:{getOverlaps,getIntersections:function getIntersections(curves1,curves2,include,matrix1,matrix2,_returnFirst){var self=!curves2;self&&(curves2=curves1);for(var length1=curves1.length,length2=curves2.length,values1=new Array(length1),values2=self?values1:new Array(length2),locations=[],i=0;i<length1;i++)values1[i]=curves1[i].getValues(matrix1);if(!self)for(i=0;i<length2;i++)values2[i]=curves2[i].getValues(matrix2);for(var boundsCollisions=CollisionDetection.findCurveBoundsCollisions(values1,values2,1e-7),index1=0;index1<length1;index1++){var curve1=curves1[index1],v1=values1[index1];self&&getSelfIntersection(v1,curve1,locations,include);var collisions1=boundsCollisions[index1];if(collisions1)for(var j=0;j<collisions1.length;j++){if(_returnFirst&&locations.length)return locations;var index2=collisions1[j];if(!self||index2>index1){var curve2=curves2[index2];getCurveIntersections(v1,values2[index2],curve1,curve2,locations,include)}}}return locations},getCurveLineIntersections,getTimesWithTangent:function getTimesWithTangent(v,tangent){var x0=v[0],y0=v[1],x1=v[2],y1=v[3],x2=v[4],y2=v[5],x3=v[6],y3=v[7],normalized=tangent.normalize(),tx=normalized.x,ty=normalized.y,ax=3*x3-9*x2+9*x1-3*x0,ay=3*y3-9*y2+9*y1-3*y0,bx=6*x2-12*x1+6*x0,by=6*y2-12*y1+6*y0,cx=3*x1-3*x0,cy=3*y1-3*y0,den=2*ax*ty-2*ay*tx,times=[];if(Math.abs(den)<Numerical.CURVETIME_EPSILON){if(0!=(den=ax*by-ay*bx)){var t=-(ax*cy-ay*cx)/den;t>=0&&t<=1&&times.push(t)}}else{var delta=(bx*bx-4*ax*cx)*ty*ty+(-2*bx*by+4*ay*cx+4*ax*cy)*tx*ty+(by*by-4*ay*cy)*tx*tx,k=bx*ty-by*tx;if(delta>=0&&0!=den){var d=Math.sqrt(delta),t0=-(k+d)/den,t1=(-k+d)/den;t0>=0&&t0<=1&&times.push(t0),t1>=0&&t1<=1&&times.push(t1)}}return times}}}}),CurveLocation=Base.extend({_class:"CurveLocation",initialize:function CurveLocation(curve,time,point,_overlap,_distance){if(time>=.99999999){var next=curve.getNext();next&&(time=0,curve=next)}this._setCurve(curve),this._time=time,this._point=point||curve.getPointAtTime(time),this._overlap=_overlap,this._distance=_distance,this._intersection=this._next=this._previous=null},_setPath:function(path){this._path=path,this._version=path?path._version:0},_setCurve:function(curve){this._setPath(curve._path),this._curve=curve,this._segment=null,this._segment1=curve._segment1,this._segment2=curve._segment2},_setSegment:function(segment){var curve=segment.getCurve();curve?this._setCurve(curve):(this._setPath(segment._path),this._segment1=segment,this._segment2=null),this._segment=segment,this._time=segment===this._segment1?0:1,this._point=segment._point.clone()},getSegment:function(){var segment=this._segment;if(!segment){var curve=this.getCurve(),time=this.getTime();0===time?segment=curve._segment1:1===time?segment=curve._segment2:null!=time&&(segment=curve.getPartLength(0,time)<curve.getPartLength(time,1)?curve._segment1:curve._segment2),this._segment=segment}return segment},getCurve:function(){var path=this._path,that=this;function trySegment(segment){var curve=segment&&segment.getCurve();if(curve&&null!=(that._time=curve.getTimeOf(that._point)))return that._setCurve(curve),curve}return path&&path._version!==this._version&&(this._time=this._offset=this._curveOffset=this._curve=null),this._curve||trySegment(this._segment)||trySegment(this._segment1)||trySegment(this._segment2.getPrevious())},getPath:function(){var curve=this.getCurve();return curve&&curve._path},getIndex:function(){var curve=this.getCurve();return curve&&curve.getIndex()},getTime:function(){var curve=this.getCurve(),time=this._time;return curve&&null==time?this._time=curve.getTimeOf(this._point):time},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var offset=this._offset;if(null==offset){offset=0;var path=this.getPath(),index=this.getIndex();if(path&&null!=index)for(var curves=path.getCurves(),i=0;i<index;i++)offset+=curves[i].getLength();this._offset=offset+=this.getCurveOffset()}return offset},getCurveOffset:function(){var offset=this._curveOffset;if(null==offset){var curve=this.getCurve(),time=this.getTime();this._curveOffset=offset=null!=time&&curve&&curve.getPartLength(0,time)}return offset},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var curve=this.getCurve(),res=curve&&curve.divideAtTime(this.getTime());return res&&this._setSegment(res._segment1),res},split:function(){var curve=this.getCurve(),path=curve._path,res=curve&&curve.splitAtTime(this.getTime());return res&&this._setSegment(path.getLastSegment()),res},equals:function(loc,_ignoreOther){var res=this===loc;if(!res&&loc instanceof CurveLocation){var c1=this.getCurve(),c2=loc.getCurve(),p1=c1._path;if(p1===c2._path){var abs=Math.abs,diff=abs(this.getOffset()-loc.getOffset()),i1=!_ignoreOther&&this._intersection,i2=!_ignoreOther&&loc._intersection;res=(diff<1e-7||p1&&abs(p1.getLength()-diff)<1e-7)&&(!i1&&!i2||i1&&i2&&i1.equals(i2,!0))}}return res},toString:function(){var parts=[],point=this.getPoint(),f=Formatter.instance;point&&parts.push("point: "+point);var index=this.getIndex();null!=index&&parts.push("index: "+index);var time=this.getTime();return null!=time&&parts.push("time: "+f.number(time)),null!=this._distance&&parts.push("distance: "+f.number(this._distance)),"{ "+parts.join(", ")+" }"},isTouching:function(){var inter=this._intersection;if(inter&&this.getTangent().isCollinear(inter.getTangent())){var curve1=this.getCurve(),curve2=inter.getCurve();return!(curve1.isStraight()&&curve2.isStraight()&&curve1.getLine().intersect(curve2.getLine()))}return!1},isCrossing:function(){var inter=this._intersection;if(!inter)return!1;var t1=this.getTime(),t2=inter.getTime(),tMax=1-1e-8,t1Inside=t1>=1e-8&&t1<=tMax,t2Inside=t2>=1e-8&&t2<=tMax;if(t1Inside&&t2Inside)return!this.isTouching();var c2=this.getCurve(),c1=c2&&t1<1e-8?c2.getPrevious():c2,c4=inter.getCurve(),c3=c4&&t2<1e-8?c4.getPrevious():c4;if(t1>tMax&&(c2=c2.getNext()),t2>tMax&&(c4=c4.getNext()),!(c1&&c2&&c3&&c4))return!1;var offsets=[];function addOffsets(curve,end){var v=curve.getValues(),roots=Curve.classify(v).roots||Curve.getPeaks(v),count=roots.length,offset=Curve.getLength(v,end&&count?roots[count-1]:0,!end&&count?roots[0]:1);offsets.push(count?offset:offset/32)}function isInRange(angle,min,max){return min<max?angle>min&&angle<max:angle>min||angle<max}t1Inside||(addOffsets(c1,!0),addOffsets(c2,!1)),t2Inside||(addOffsets(c3,!0),addOffsets(c4,!1));var pt=this.getPoint(),offset=Math.min.apply(Math,offsets),v2=t1Inside?c2.getTangentAtTime(t1):c2.getPointAt(offset).subtract(pt),v1=t1Inside?v2.negate():c1.getPointAt(-offset).subtract(pt),v4=t2Inside?c4.getTangentAtTime(t2):c4.getPointAt(offset).subtract(pt),v3=t2Inside?v4.negate():c3.getPointAt(-offset).subtract(pt),a1=v1.getAngle(),a2=v2.getAngle(),a3=v3.getAngle(),a4=v4.getAngle();return!!(t1Inside?isInRange(a1,a3,a4)^isInRange(a2,a3,a4)&&isInRange(a1,a4,a3)^isInRange(a2,a4,a3):isInRange(a3,a1,a2)^isInRange(a4,a1,a2)&&isInRange(a3,a2,a1)^isInRange(a4,a2,a1))},hasOverlap:function(){return!!this._overlap}},Base.each(Curve._evaluateMethods,(function(name){var get=name+"At";this[name]=function(){var curve=this.getCurve(),time=this.getTime();return null!=time&&curve&&curve[get](time,!0)}}),{preserve:!0}),new function(){function insert(locations,loc,merge){var length=locations.length,l=0,r=length-1;function search(index,dir){for(var i=index+dir;i>=-1&&i<=length;i+=dir){var loc2=locations[(i%length+length)%length];if(!loc.getPoint().isClose(loc2.getPoint(),1e-7))break;if(loc.equals(loc2))return loc2}return null}for(;l<=r;){var found,m=l+r>>>1,loc2=locations[m];if(merge&&(found=loc.equals(loc2)?loc2:search(m,-1)||search(m,1)))return loc._overlap&&(found._overlap=found._intersection._overlap=!0),found;var path1=loc.getPath(),path2=loc2.getPath();(path1!==path2?path1._id-path2._id:loc.getIndex()+loc.getTime()-(loc2.getIndex()+loc2.getTime()))<0?r=m-1:l=m+1}return locations.splice(l,0,loc),loc}return{statics:{insert,expand:function(locations){for(var expanded=locations.slice(),i=locations.length-1;i>=0;i--)insert(expanded,locations[i]._intersection,!1);return expanded}}}}),PathItem=Item.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function PathItem(){},statics:{create:function(arg){var data,segments,compound;if(Base.isPlainObject(arg)?(segments=arg.segments,data=arg.pathData):Array.isArray(arg)?segments=arg:"string"==typeof arg&&(data=arg),segments){var first=segments[0];compound=first&&Array.isArray(first[0])}else data&&(compound=(data.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(data));return new(compound?CompoundPath:Path)(arg)}},_asPathItem:function(){return this},isClockwise:function(){return this.getArea()>=0},setClockwise:function(clockwise){this.isClockwise()!=(clockwise=!!clockwise)&&this.reverse()},setPathData:function(data){var coords,previous,control,parts=data&&data.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),relative=!1,current=new Point,start=new Point;function getCoord(index,coord){var val=+coords[index];return relative&&(val+=current[coord]),val}function getPoint(index){return new Point(getCoord(index,"x"),getCoord(index+1,"y"))}this.clear();for(var i=0,l=parts&&parts.length;i<l;i++){var part=parts[i],command=part[0],lower=command.toLowerCase(),length=(coords=part.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g))&&coords.length;switch(relative=command===lower,"z"!==previous||/[mz]/.test(lower)||this.moveTo(current),lower){case"m":case"l":for(var move="m"===lower,j=0;j<length;j+=2)this[move?"moveTo":"lineTo"](current=getPoint(j)),move&&(start=current,move=!1);control=current;break;case"h":case"v":var coord="h"===lower?"x":"y";current=current.clone();for(j=0;j<length;j++)current[coord]=getCoord(j,coord),this.lineTo(current);control=current;break;case"c":for(j=0;j<length;j+=6)this.cubicCurveTo(getPoint(j),control=getPoint(j+2),current=getPoint(j+4));break;case"s":for(j=0;j<length;j+=4)this.cubicCurveTo(/[cs]/.test(previous)?current.multiply(2).subtract(control):current,control=getPoint(j),current=getPoint(j+2)),previous=lower;break;case"q":for(j=0;j<length;j+=4)this.quadraticCurveTo(control=getPoint(j),current=getPoint(j+2));break;case"t":for(j=0;j<length;j+=2)this.quadraticCurveTo(control=/[qt]/.test(previous)?current.multiply(2).subtract(control):current,current=getPoint(j)),previous=lower;break;case"a":for(j=0;j<length;j+=7)this.arcTo(current=getPoint(j+5),new Size(+coords[j],+coords[j+1]),+coords[j+2],+coords[j+4],+coords[j+3]);break;case"z":this.closePath(1e-12),current=start}previous=lower}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(point){var winding=point.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(point):{};return winding.onPath||!!("evenodd"===this.getFillRule()?1&winding.windingL||1&winding.windingR:winding.winding)},getIntersections:function(path,include,_matrix,_returnFirst){var self=this===path||!path,matrix1=this._matrix._orNullIfIdentity(),matrix2=self?matrix1:(_matrix||path._matrix)._orNullIfIdentity();return self||this.getBounds(matrix1).intersects(path.getBounds(matrix2),1e-12)?Curve.getIntersections(this.getCurves(),!self&&path.getCurves(),include,matrix1,matrix2,_returnFirst):[]},getCrossings:function(path){return this.getIntersections(path,(function(inter){return inter.isCrossing()}))},getNearestLocation:function(){for(var point=Point.read(arguments),curves=this.getCurves(),minDist=1/0,minLoc=null,i=0,l=curves.length;i<l;i++){var loc=curves[i].getNearestLocation(point);loc._distance<minDist&&(minDist=loc._distance,minLoc=loc)}return minLoc},getNearestPoint:function(){var loc=this.getNearestLocation.apply(this,arguments);return loc?loc.getPoint():loc},interpolate:function(from,to,factor){var isPath=!this._children,name=isPath?"_segments":"_children",itemsFrom=from[name],itemsTo=to[name],items=this[name];if(!itemsFrom||!itemsTo||itemsFrom.length!==itemsTo.length)throw new Error("Invalid operands in interpolate() call: "+from+", "+to);var current=items.length,length=itemsTo.length;if(current<length)for(var ctor=isPath?Segment:Path,i=current;i<length;i++)this.add(new ctor);else current>length&&this[isPath?"removeSegments":"removeChildren"](length,current);for(i=0;i<length;i++)items[i].interpolate(itemsFrom[i],itemsTo[i],factor);isPath&&(this.setClosed(from._closed),this._changed(9))},compare:function(path){var ok=!1;if(path){var paths1=this._children||[this],paths2=path._children?path._children.slice():[path],length1=paths1.length,length2=paths2.length,matched=[],count=0;ok=!0;for(var boundsOverlaps=CollisionDetection.findItemBoundsCollisions(paths1,paths2,Numerical.GEOMETRIC_EPSILON),i1=length1-1;i1>=0&&ok;i1--){var path1=paths1[i1];ok=!1;var pathBoundsOverlaps=boundsOverlaps[i1];if(pathBoundsOverlaps)for(var i2=pathBoundsOverlaps.length-1;i2>=0&&!ok;i2--)path1.compare(paths2[pathBoundsOverlaps[i2]])&&(matched[pathBoundsOverlaps[i2]]||(matched[pathBoundsOverlaps[i2]]=!0,count++),ok=!0)}ok=ok&&count===length2}return ok}}),Path=PathItem.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function Path(arg){this._closed=!1,this._segments=[],this._version=0;var args=arguments,segments=Array.isArray(arg)?"object"==typeof arg[0]?arg:args:!arg||arg.size!==undefined||arg.x===undefined&&arg.point===undefined?null:args;segments&&segments.length>0?this.setSegments(segments):(this._curves=undefined,this._segmentSelection=0,segments||"string"!=typeof arg||(this.setPathData(arg),arg=null)),this._initialize(!segments&&arg)},_equals:function(item){return this._closed===item._closed&&Base.equals(this._segments,item._segments)},copyContent:function(source){this.setSegments(source._segments),this._closed=source._closed},_changed:function _changed(flags){if(_changed.base.call(this,flags),8&flags){if(this._length=this._area=undefined,32&flags)this._version++;else if(this._curves)for(var i=0,l=this._curves.length;i<l;i++)this._curves[i]._changed()}else 64&flags&&(this._bounds=undefined)},getStyle:function(){var parent=this._parent;return(parent instanceof CompoundPath?parent:this)._style},getSegments:function(){return this._segments},setSegments:function(segments){var fullySelected=this.isFullySelected(),length=segments&&segments.length;if(this._segments.length=0,this._segmentSelection=0,this._curves=undefined,length){var last=segments[length-1];"boolean"==typeof last&&(this.setClosed(last),length--),this._add(Segment.readList(segments,0,{},length))}fullySelected&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var curves=this._curves,segments=this._segments;if(!curves){var length=this._countCurves();curves=this._curves=new Array(length);for(var i=0;i<length;i++)curves[i]=new Curve(this,segments[i],segments[i+1]||segments[0])}return curves},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var curves=this.getCurves();return curves[curves.length-1]},isClosed:function(){return this._closed},setClosed:function(closed){if(this._closed!=(closed=!!closed)){if(this._closed=closed,this._curves){var length=this._curves.length=this._countCurves();closed&&(this._curves[length-1]=new Curve(this,this._segments[length-1],this._segments[0]))}this._changed(41)}}},{beans:!0,getPathData:function(_matrix,_precision){var curX,curY,prevX,prevY,inX,inY,outX,outY,segments=this._segments,length=segments.length,f=new Formatter(_precision),coords=new Array(6),first=!0,parts=[];function addSegment(segment,skipLine){if(segment._transformCoordinates(_matrix,coords),curX=coords[0],curY=coords[1],first)parts.push("M"+f.pair(curX,curY)),first=!1;else if(inX=coords[2],inY=coords[3],inX===curX&&inY===curY&&outX===prevX&&outY===prevY){if(!skipLine){var dx=curX-prevX,dy=curY-prevY;parts.push(0===dx?"v"+f.number(dy):0===dy?"h"+f.number(dx):"l"+f.pair(dx,dy))}}else parts.push("c"+f.pair(outX-prevX,outY-prevY)+" "+f.pair(inX-prevX,inY-prevY)+" "+f.pair(curX-prevX,curY-prevY));prevX=curX,prevY=curY,outX=coords[4],outY=coords[5]}if(!length)return"";for(var i=0;i<length;i++)addSegment(segments[i]);return this._closed&&length>0&&(addSegment(segments[0],!0),parts.push("z")),parts.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(matrix){for(var segments=this._segments,coords=new Array(6),i=0,l=segments.length;i<l;i++)segments[i]._transformCoordinates(matrix,coords,!0);return!0},_add:function(segs,index){for(var segments=this._segments,curves=this._curves,amount=segs.length,append=null==index,i=(index=append?segments.length:index,0);i<amount;i++){var segment=segs[i];segment._path&&(segment=segs[i]=segment.clone()),segment._path=this,segment._index=index+i,segment._selection&&this._updateSelection(segment,0,segment._selection)}if(append)Base.push(segments,segs);else{segments.splice.apply(segments,[index,0].concat(segs));i=index+amount;for(var l=segments.length;i<l;i++)segments[i]._index=i}if(curves){var total=this._countCurves(),start=index>0&&index+amount-1===total?index-1:index,insert=start,end=Math.min(start+amount,total);segs._curves&&(curves.splice.apply(curves,[start,0].concat(segs._curves)),insert+=segs._curves.length);for(i=insert;i<end;i++)curves.splice(i,0,new Curve(this,null,null));this._adjustCurves(start,end)}return this._changed(41),segs},_adjustCurves:function(start,end){for(var curve,segments=this._segments,curves=this._curves,i=start;i<end;i++)(curve=curves[i])._path=this,curve._segment1=segments[i],curve._segment2=segments[i+1]||segments[0],curve._changed();(curve=curves[this._closed&&!start?segments.length-1:start-1])&&(curve._segment2=segments[start]||segments[0],curve._changed()),(curve=curves[end])&&(curve._segment1=segments[end],curve._changed())},_countCurves:function(){var length=this._segments.length;return!this._closed&&length>0?length-1:length},add:function(segment1){var args=arguments;return args.length>1&&"number"!=typeof segment1?this._add(Segment.readList(args)):this._add([Segment.read(args)])[0]},insert:function(index,segment1){var args=arguments;return args.length>2&&"number"!=typeof segment1?this._add(Segment.readList(args,1),index):this._add([Segment.read(args,1)],index)[0]},addSegment:function(){return this._add([Segment.read(arguments)])[0]},insertSegment:function(index){return this._add([Segment.read(arguments,1)],index)[0]},addSegments:function(segments){return this._add(Segment.readList(segments))},insertSegments:function(index,segments){return this._add(Segment.readList(segments),index)},removeSegment:function(index){return this.removeSegments(index,index+1)[0]||null},removeSegments:function(start,end,_includeCurves){start=start||0,end=Base.pick(end,this._segments.length);var segments=this._segments,curves=this._curves,count=segments.length,removed=segments.splice(start,end-start),amount=removed.length;if(!amount)return removed;for(var i=0;i<amount;i++){var segment=removed[i];segment._selection&&this._updateSelection(segment,segment._selection,0),segment._index=segment._path=null}i=start;for(var l=segments.length;i<l;i++)segments[i]._index=i;if(curves){var index=start>0&&end===count+(this._closed?1:0)?start-1:start;for(i=(curves=curves.splice(index,amount)).length-1;i>=0;i--)curves[i]._path=null;_includeCurves&&(removed._curves=curves.slice(1)),this._adjustCurves(index,index)}return this._changed(41),removed},clear:"#removeSegments",hasHandles:function(){for(var segments=this._segments,i=0,l=segments.length;i<l;i++)if(segments[i].hasHandles())return!0;return!1},clearHandles:function(){for(var segments=this._segments,i=0,l=segments.length;i<l;i++)segments[i].clearHandles()},getLength:function(){if(null==this._length){for(var curves=this.getCurves(),length=0,i=0,l=curves.length;i<l;i++)length+=curves[i].getLength();this._length=length}return this._length},getArea:function(){var area=this._area;if(null==area){var segments=this._segments,closed=this._closed;area=0;for(var i=0,l=segments.length;i<l;i++){var last=i+1===l;area+=Curve.getArea(Curve.getValues(segments[i],segments[last?0:i+1],null,last&&!closed))}this._area=area}return area},isFullySelected:function(){var length=this._segments.length;return this.isSelected()&&length>0&&this._segmentSelection===7*length},setFullySelected:function(selected){selected&&this._selectSegments(!0),this.setSelected(selected)},setSelection:function setSelection(selection){1&selection||this._selectSegments(!1),setSelection.base.call(this,selection)},_selectSegments:function(selected){var segments=this._segments,length=segments.length,selection=selected?7:0;this._segmentSelection=selection*length;for(var i=0;i<length;i++)segments[i]._selection=selection},_updateSelection:function(segment,oldSelection,newSelection){segment._selection=newSelection,(this._segmentSelection+=newSelection-oldSelection)>0&&this.setSelected(!0)},divideAt:function(location){var curve,loc=this.getLocationAt(location);return loc&&(curve=loc.getCurve().divideAt(loc.getCurveOffset()))?curve._segment1:null},splitAt:function(location){var loc=this.getLocationAt(location),index=loc&&loc.index,time=loc&&loc.time;time>.99999999&&(index++,time=0);var curves=this.getCurves();if(index>=0&&index<curves.length){time>=1e-8&&curves[index++].divideAtTime(time);var path,segs=this.removeSegments(index,this._segments.length,!0);return this._closed?(this.setClosed(!1),path=this):((path=new Path(Item.NO_INSERT)).insertAbove(this),path.copyAttributes(this)),path._add(segs,0),this.addSegment(segs[0]),path}return null},split:function(index,time){var curve,location=time===undefined?index:(curve=this.getCurves()[index])&&curve.getLocationAtTime(time);return null!=location?this.splitAt(location):null},join:function(path,tolerance){var epsilon=tolerance||0;if(path&&path!==this){var segments=path._segments,last1=this.getLastSegment(),last2=path.getLastSegment();if(!last2)return this;last1&&last1._point.isClose(last2._point,epsilon)&&path.reverse();var first2=path.getFirstSegment();if(last1&&last1._point.isClose(first2._point,epsilon))last1.setHandleOut(first2._handleOut),this._add(segments.slice(1));else{var first1=this.getFirstSegment();first1&&first1._point.isClose(first2._point,epsilon)&&path.reverse(),last2=path.getLastSegment(),first1&&first1._point.isClose(last2._point,epsilon)?(first1.setHandleIn(last2._handleIn),this._add(segments.slice(0,segments.length-1),0)):this._add(segments.slice())}path._closed&&this._add([segments[0]]),path.remove()}var first=this.getFirstSegment(),last=this.getLastSegment();return first!==last&&first._point.isClose(last._point,epsilon)&&(first.setHandleIn(last._handleIn),last.remove(),this.setClosed(!0)),this},reduce:function(options){for(var curves=this.getCurves(),simplify=options&&options.simplify,tolerance=simplify?1e-7:0,i=curves.length-1;i>=0;i--){var curve=curves[i];!curve.hasHandles()&&(!curve.hasLength(tolerance)||simplify&&curve.isCollinear(curve.getNext()))&&curve.remove()}return this},reverse:function(){this._segments.reverse();for(var i=0,l=this._segments.length;i<l;i++){var segment=this._segments[i],handleIn=segment._handleIn;segment._handleIn=segment._handleOut,segment._handleOut=handleIn,segment._index=i}this._curves=null,this._changed(9)},flatten:function(flatness){for(var parts=new PathFlattener(this,flatness||.25,256,!0).parts,length=parts.length,segments=[],i=0;i<length;i++)segments.push(new Segment(parts[i].curve.slice(0,2)));!this._closed&&length>0&&segments.push(new Segment(parts[length-1].curve.slice(6))),this.setSegments(segments)},simplify:function(tolerance){var segments=new PathFitter(this).fit(tolerance||2.5);return segments&&this.setSegments(segments),!!segments},smooth:function(options){var that=this,opts=options||{},type=opts.type||"asymmetric",segments=this._segments,length=segments.length,closed=this._closed;function getIndex(value,_default){var index=value&&value.index;if(null!=index){var path=value.path;if(path&&path!==that)throw new Error(value._class+" "+index+" of "+path+" is not part of "+that);_default&&value instanceof Curve&&index++}else index="number"==typeof value?value:_default;return Math.min(index<0&&closed?index%length:index<0?index+length:index,length-1)}var loop=closed&&opts.from===undefined&&opts.to===undefined,from=getIndex(opts.from,0),to=getIndex(opts.to,length-1);if(from>to)if(closed)from-=length;else{var tmp=from;from=to,to=tmp}if(/^(?:asymmetric|continuous)$/.test(type)){var asymmetric="asymmetric"===type,min=Math.min,amount=to-from+1,n=amount-1,padding=loop?min(amount,4):1,paddingLeft=padding,paddingRight=padding,knots=[];if(closed||(paddingLeft=min(1,from),paddingRight=min(1,length-to-1)),(n+=paddingLeft+paddingRight)<=1)return;for(var i=0,j=from-paddingLeft;i<=n;i++,j++)knots[i]=segments[(j<0?j+length:j)%length]._point;var x=knots[0]._x+2*knots[1]._x,y=knots[0]._y+2*knots[1]._y,f=2,n_1=n-1,rx=[x],ry=[y],rf=[f],px=[],py=[];for(i=1;i<n;i++){var internal=i<n_1,b=internal?4:asymmetric?2:7,u=internal?4:asymmetric?3:8,v=internal?2:asymmetric?0:1,m=(internal||asymmetric?1:2)/f;f=rf[i]=b-m,x=rx[i]=u*knots[i]._x+v*knots[i+1]._x-m*x,y=ry[i]=u*knots[i]._y+v*knots[i+1]._y-m*y}px[n_1]=rx[n_1]/rf[n_1],py[n_1]=ry[n_1]/rf[n_1];for(i=n-2;i>=0;i--)px[i]=(rx[i]-px[i+1])/rf[i],py[i]=(ry[i]-py[i+1])/rf[i];px[n]=(3*knots[n]._x-px[n_1])/2,py[n]=(3*knots[n]._y-py[n_1])/2;i=paddingLeft;var max=n-paddingRight;for(j=from;i<=max;i++,j++){var segment=segments[j<0?j+length:j],pt=segment._point,hx=px[i]-pt._x,hy=py[i]-pt._y;(loop||i<max)&&segment.setHandleOut(hx,hy),(loop||i>paddingLeft)&&segment.setHandleIn(-hx,-hy)}}else for(i=from;i<=to;i++)segments[i<0?i+length:i].smooth(opts,!loop&&i===from,!loop&&i===to)},toShape:function(insert){if(!this._closed)return null;var type,size,radius,topCenter,segments=this._segments;function isCollinear(i,j){var seg1=segments[i],seg2=seg1.getNext(),seg3=segments[j],seg4=seg3.getNext();return seg1._handleOut.isZero()&&seg2._handleIn.isZero()&&seg3._handleOut.isZero()&&seg4._handleIn.isZero()&&seg2._point.subtract(seg1._point).isCollinear(seg4._point.subtract(seg3._point))}function isArc(i){var seg1=segments[i],seg2=seg1.getNext(),handle1=seg1._handleOut,handle2=seg2._handleIn,kappa=.5522847498307936;if(handle1.isOrthogonal(handle2)){var pt1=seg1._point,pt2=seg2._point,corner=new Line(pt1,handle1,!0).intersect(new Line(pt2,handle2,!0),!0);return corner&&Numerical.isZero(handle1.getLength()/corner.subtract(pt1).getLength()-kappa)&&Numerical.isZero(handle2.getLength()/corner.subtract(pt2).getLength()-kappa)}return!1}function getDistance(i,j){return segments[i]._point.getDistance(segments[j]._point)}if(!this.hasHandles()&&4===segments.length&&isCollinear(0,2)&&isCollinear(1,3)&&function isOrthogonal(i){var seg2=segments[i],seg1=seg2.getPrevious(),seg3=seg2.getNext();return seg1._handleOut.isZero()&&seg2._handleIn.isZero()&&seg2._handleOut.isZero()&&seg3._handleIn.isZero()&&seg2._point.subtract(seg1._point).isOrthogonal(seg3._point.subtract(seg2._point))}(1)?(type=Shape.Rectangle,size=new Size(getDistance(0,3),getDistance(0,1)),topCenter=segments[1]._point.add(segments[2]._point).divide(2)):8===segments.length&&isArc(0)&&isArc(2)&&isArc(4)&&isArc(6)&&isCollinear(1,5)&&isCollinear(3,7)?(type=Shape.Rectangle,radius=(size=new Size(getDistance(1,6),getDistance(0,3))).subtract(new Size(getDistance(0,7),getDistance(1,2))).divide(2),topCenter=segments[3]._point.add(segments[4]._point).divide(2)):4===segments.length&&isArc(0)&&isArc(1)&&isArc(2)&&isArc(3)&&(Numerical.isZero(getDistance(0,2)-getDistance(1,3))?(type=Shape.Circle,radius=getDistance(0,2)/2):(type=Shape.Ellipse,radius=new Size(getDistance(2,0)/2,getDistance(3,1)/2)),topCenter=segments[1]._point),type){var center=this.getPosition(!0),shape=new type({center,size,radius,insert:!1});return shape.copyAttributes(this,!0),shape._matrix.prepend(this._matrix),shape.rotate(topCenter.subtract(center).getAngle()+90),(insert===undefined||insert)&&shape.insertAbove(this),shape}return null},toPath:"#clone",compare:function compare(path){if(!path||path instanceof CompoundPath)return compare.base.call(this,path);var curves1=this.getCurves(),curves2=path.getCurves(),length1=curves1.length,length2=curves2.length;if(!length1||!length2)return length1==length2;for(var pos2,end2,v1=curves1[0].getValues(),values2=[],pos1=0,end1=0,i=0;i<length2;i++){var v2=curves2[i].getValues();if(values2.push(v2),overlaps=Curve.getOverlaps(v1,v2)){pos2=!i&&overlaps[0][0]>0?length2-1:i,end2=overlaps[0][1];break}}var start2,abs=Math.abs;for(v2=values2[pos2];v1&&v2;){var overlaps;if(overlaps=Curve.getOverlaps(v1,v2))if(abs(overlaps[0][0]-end1)<1e-8){1===(end1=overlaps[1][0])&&(v1=++pos1<length1?curves1[pos1].getValues():null,end1=0);var t2=overlaps[0][1];if(abs(t2-end2)<1e-8){if(start2||(start2=[pos2,t2]),1===(end2=overlaps[1][1])&&(++pos2>=length2&&(pos2=0),v2=values2[pos2]||curves2[pos2].getValues(),end2=0),!v1)return start2[0]===pos2&&start2[1]===end2;continue}}break}return!1},_hitTestSelf:function(point,options,viewMatrix,strokeMatrix){var join,cap,miterLimit,area,loc,res,that=this,style=this.getStyle(),segments=this._segments,numSegments=segments.length,closed=this._closed,tolerancePadding=options._tolerancePadding,strokePadding=tolerancePadding,hitStroke=options.stroke&&style.hasStroke(),hitFill=options.fill&&style.hasFill(),hitCurves=options.curves,strokeRadius=hitStroke?style.getStrokeWidth()/2:hitFill&&options.tolerance>0||hitCurves?0:null;function isCloseEnough(pt,padding){return point.subtract(pt).divide(padding).length<=1}function checkSegmentPoint(seg,pt,name){if(!options.selected||pt.isSelected()){var anchor=seg._point;if(pt!==anchor&&(pt=pt.add(anchor)),isCloseEnough(pt,strokePadding))return new HitResult(name,that,{segment:seg,point:pt})}}function checkSegmentPoints(seg,ends){return(ends||options.segments)&&checkSegmentPoint(seg,seg._point,"segment")||!ends&&options.handles&&(checkSegmentPoint(seg,seg._handleIn,"handle-in")||checkSegmentPoint(seg,seg._handleOut,"handle-out"))}function addToArea(point){area.add(point)}function checkSegmentStroke(segment){var loc,isJoin=closed||segment._index>0&&segment._index<numSegments-1;return"round"===(isJoin?join:cap)?isCloseEnough(segment._point,strokePadding):(area=new Path({internal:!0,closed:!0}),isJoin?segment.isSmooth()||Path._addBevelJoin(segment,join,strokeRadius,miterLimit,null,strokeMatrix,addToArea,!0):"square"===cap&&Path._addSquareCap(segment,cap,strokeRadius,null,strokeMatrix,addToArea,!0),area.isEmpty()?void 0:area.contains(point)||(loc=area.getNearestLocation(point))&&isCloseEnough(loc.getPoint(),tolerancePadding))}if(null!==strokeRadius&&(strokeRadius>0?(join=style.getStrokeJoin(),cap=style.getStrokeCap(),miterLimit=style.getMiterLimit(),strokePadding=strokePadding.add(Path._getStrokePadding(strokeRadius,strokeMatrix))):join=cap="round"),!options.ends||options.segments||closed){if(options.segments||options.handles)for(var i=0;i<numSegments;i++)if(res=checkSegmentPoints(segments[i]))return res}else if(res=checkSegmentPoints(segments[0],!0)||checkSegmentPoints(segments[numSegments-1],!0))return res;if(null!==strokeRadius){if(loc=this.getNearestLocation(point)){var time=loc.getTime();0===time||1===time&&numSegments>1?checkSegmentStroke(loc.getSegment())||(loc=null):isCloseEnough(loc.getPoint(),strokePadding)||(loc=null)}if(!loc&&"miter"===join&&numSegments>1)for(i=0;i<numSegments;i++){var segment=segments[i];if(point.getDistance(segment._point)<=miterLimit*strokeRadius&&checkSegmentStroke(segment)){loc=segment.getLocation();break}}}return!loc&&hitFill&&this._contains(point)||loc&&!hitStroke&&!hitCurves?new HitResult("fill",this):loc?new HitResult(hitStroke?"stroke":"curve",this,{location:loc,point:loc.getPoint()}):null}},Base.each(Curve._evaluateMethods,(function(name){this[name+"At"]=function(offset){var loc=this.getLocationAt(offset);return loc&&loc[name]()}}),{beans:!1,getLocationOf:function(){for(var point=Point.read(arguments),curves=this.getCurves(),i=0,l=curves.length;i<l;i++){var loc=curves[i].getLocationOf(point);if(loc)return loc}return null},getOffsetOf:function(){var loc=this.getLocationOf.apply(this,arguments);return loc?loc.getOffset():null},getLocationAt:function(offset){if("number"==typeof offset){for(var curves=this.getCurves(),length=0,i=0,l=curves.length;i<l;i++){var start=length,curve=curves[i];if((length+=curve.getLength())>offset)return curve.getLocationAt(offset-start)}if(curves.length>0&&offset<=this.getLength())return new CurveLocation(curves[curves.length-1],1)}else if(offset&&offset.getPath&&offset.getPath()===this)return offset;return null},getOffsetsWithTangent:function(){var tangent=Point.read(arguments);if(tangent.isZero())return[];for(var offsets=[],curveStart=0,curves=this.getCurves(),i=0,l=curves.length;i<l;i++){for(var curve=curves[i],curveTimes=curve.getTimesWithTangent(tangent),j=0,m=curveTimes.length;j<m;j++){var offset=curveStart+curve.getOffsetAtTime(curveTimes[j]);offsets.indexOf(offset)<0&&offsets.push(offset)}curveStart+=curve.length}return offsets}}),new function(){function drawSegments(ctx,path,matrix){var curX,curY,prevX,prevY,inX,inY,outX,outY,segments=path._segments,length=segments.length,coords=new Array(6),first=!0;function drawSegment(segment){if(matrix)segment._transformCoordinates(matrix,coords),curX=coords[0],curY=coords[1];else{var point=segment._point;curX=point._x,curY=point._y}if(first)ctx.moveTo(curX,curY),first=!1;else{if(matrix)inX=coords[2],inY=coords[3];else{var handle=segment._handleIn;inX=curX+handle._x,inY=curY+handle._y}inX===curX&&inY===curY&&outX===prevX&&outY===prevY?ctx.lineTo(curX,curY):ctx.bezierCurveTo(outX,outY,inX,inY,curX,curY)}if(prevX=curX,prevY=curY,matrix)outX=coords[4],outY=coords[5];else{handle=segment._handleOut;outX=prevX+handle._x,outY=prevY+handle._y}}for(var i=0;i<length;i++)drawSegment(segments[i]);path._closed&&length>0&&drawSegment(segments[0])}return{_draw:function(ctx,param,viewMatrix,strokeMatrix){var dontStart=param.dontStart,dontPaint=param.dontFinish||param.clip,style=this.getStyle(),hasFill=style.hasFill(),hasStroke=style.hasStroke(),dashArray=style.getDashArray(),dashLength=!paper.support.nativeDash&&hasStroke&&dashArray&&dashArray.length;function getOffset(i){return dashArray[(i%dashLength+dashLength)%dashLength]}if(dontStart||ctx.beginPath(),(hasFill||hasStroke&&!dashLength||dontPaint)&&(drawSegments(ctx,this,strokeMatrix),this._closed&&ctx.closePath()),!dontPaint&&(hasFill||hasStroke)&&(this._setStyles(ctx,param,viewMatrix),hasFill&&(ctx.fill(style.getFillRule()),ctx.shadowColor="rgba(0,0,0,0)"),hasStroke)){if(dashLength){dontStart||ctx.beginPath();for(var to,flattener=new PathFlattener(this,.25,32,!1,strokeMatrix),length=flattener.length,from=-style.getDashOffset(),i=0;from>0;)from-=getOffset(i--)+getOffset(i--);for(;from<length;)to=from+getOffset(i++),(from>0||to>0)&&flattener.drawPart(ctx,Math.max(from,0),Math.max(to,0)),from=to+getOffset(i++)}ctx.stroke()}},_drawSelected:function(ctx,matrix){ctx.beginPath(),drawSegments(ctx,this,matrix),ctx.stroke(),function drawHandles(ctx,segments,matrix,size){if(!(size<=0))for(var pX,pY,half=size/2,miniSize=size-2,miniHalf=half-1,coords=new Array(6),i=0,l=segments.length;i<l;i++){var segment=segments[i],selection=segment._selection;if(segment._transformCoordinates(matrix,coords),pX=coords[0],pY=coords[1],2&selection&&drawHandle(2),4&selection&&drawHandle(4),ctx.fillRect(pX-half,pY-half,size,size),miniSize>0&&!(1&selection)){var fillStyle=ctx.fillStyle;ctx.fillStyle="#ffffff",ctx.fillRect(pX-miniHalf,pY-miniHalf,miniSize,miniSize),ctx.fillStyle=fillStyle}}function drawHandle(index){var hX=coords[index],hY=coords[index+1];pX==hX&&pY==hY||(ctx.beginPath(),ctx.moveTo(pX,pY),ctx.lineTo(hX,hY),ctx.stroke(),ctx.beginPath(),ctx.arc(hX,hY,half,0,2*Math.PI,!0),ctx.fill())}}(ctx,this._segments,matrix,paper.settings.handleSize)}}},new function(){function getCurrentSegment(that){var segments=that._segments;if(!segments.length)throw new Error("Use a moveTo() command first");return segments[segments.length-1]}return{moveTo:function(){var segments=this._segments;1===segments.length&&this.removeSegment(0),segments.length||this._add([new Segment(Point.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new Segment(Point.read(arguments))])},cubicCurveTo:function(){var args=arguments,handle1=Point.read(args),handle2=Point.read(args),to=Point.read(args),current=getCurrentSegment(this);current.setHandleOut(handle1.subtract(current._point)),this._add([new Segment(to,handle2.subtract(to))])},quadraticCurveTo:function(){var args=arguments,handle=Point.read(args),to=Point.read(args),current=getCurrentSegment(this)._point;this.cubicCurveTo(handle.add(current.subtract(handle).multiply(1/3)),handle.add(to.subtract(handle).multiply(1/3)),to)},curveTo:function(){var args=arguments,through=Point.read(args),to=Point.read(args),t=Base.pick(Base.read(args),.5),t1=1-t,current=getCurrentSegment(this)._point,handle=through.subtract(current.multiply(t1*t1)).subtract(to.multiply(t*t)).divide(2*t*t1);if(handle.isNaN())throw new Error("Cannot put a curve through points with parameter = "+t);this.quadraticCurveTo(handle,to)},arcTo:function(){var center,extent,vector,matrix,args=arguments,abs=Math.abs,sqrt=Math.sqrt,current=getCurrentSegment(this),from=current._point,to=Point.read(args),peek=Base.peek(args);if("boolean"==typeof(clockwise=Base.pick(peek,!0)))var through=(middle=from.add(to).divide(2)).add(middle.subtract(from).rotate(clockwise?-90:90));else if(Base.remain(args)<=2)through=to,to=Point.read(args);else if(!from.equals(to)){var radius=Size.read(args),isZero=Numerical.isZero;if(isZero(radius.width)||isZero(radius.height))return this.lineTo(to);var rotation=Base.read(args),clockwise=!!Base.read(args),large=!!Base.read(args),middle=from.add(to).divide(2),x=(pt=from.subtract(middle).rotate(-rotation)).x,y=pt.y,rx=abs(radius.width),ry=abs(radius.height),rxSq=rx*rx,rySq=ry*ry,xSq=x*x,ySq=y*y,factor=sqrt(xSq/rxSq+ySq/rySq);if(factor>1&&(rxSq=(rx*=factor)*rx,rySq=(ry*=factor)*ry),abs(factor=(rxSq*rySq-rxSq*ySq-rySq*xSq)/(rxSq*ySq+rySq*xSq))<1e-12&&(factor=0),factor<0)throw new Error("Cannot create an arc with the given arguments");center=new Point(rx*y/ry,-ry*x/rx).multiply((large===clockwise?-1:1)*sqrt(factor)).rotate(rotation).add(middle),extent=(vector=(matrix=(new Matrix).translate(center).rotate(rotation).scale(rx,ry))._inverseTransform(from)).getDirectedAngle(matrix._inverseTransform(to)),!clockwise&&extent>0?extent-=360:clockwise&&extent<0&&(extent+=360)}if(through){var l1=new Line(from.add(through).divide(2),through.subtract(from).rotate(90),!0),l2=new Line(through.add(to).divide(2),to.subtract(through).rotate(90),!0),line=new Line(from,to),throughSide=line.getSide(through);if(!(center=l1.intersect(l2,!0))){if(!throughSide)return this.lineTo(to);throw new Error("Cannot create an arc with the given arguments")}extent=(vector=from.subtract(center)).getDirectedAngle(to.subtract(center));var centerSide=line.getSide(center,!0);0===centerSide?extent=throughSide*abs(extent):throughSide===centerSide&&(extent+=extent<0?360:-360)}if(extent){for(var ext=abs(extent),count=ext>=360?4:Math.ceil((ext-1e-5)/90),inc=extent/count,half=inc*Math.PI/360,z=4/3*Math.sin(half)/(1+Math.cos(half)),segments=[],i=0;i<=count;i++){var pt=to,out=null;if(i<count&&(out=vector.rotate(90).multiply(z),matrix?(pt=matrix._transformPoint(vector),out=matrix._transformPoint(vector.add(out)).subtract(pt)):pt=center.add(vector)),i){var _in=vector.rotate(-90).multiply(z);matrix&&(_in=matrix._transformPoint(vector.add(_in)).subtract(pt)),segments.push(new Segment(pt,_in,out))}else current.setHandleOut(out);vector=vector.rotate(inc)}this._add(segments)}},lineBy:function(){var to=Point.read(arguments),current=getCurrentSegment(this)._point;this.lineTo(current.add(to))},curveBy:function(){var args=arguments,through=Point.read(args),to=Point.read(args),parameter=Base.read(args),current=getCurrentSegment(this)._point;this.curveTo(current.add(through),current.add(to),parameter)},cubicCurveBy:function(){var args=arguments,handle1=Point.read(args),handle2=Point.read(args),to=Point.read(args),current=getCurrentSegment(this)._point;this.cubicCurveTo(current.add(handle1),current.add(handle2),current.add(to))},quadraticCurveBy:function(){var args=arguments,handle=Point.read(args),to=Point.read(args),current=getCurrentSegment(this)._point;this.quadraticCurveTo(current.add(handle),current.add(to))},arcBy:function(){var args=arguments,current=getCurrentSegment(this)._point,point=current.add(Point.read(args)),clockwise=Base.pick(Base.peek(args),!0);"boolean"==typeof clockwise?this.arcTo(point,clockwise):this.arcTo(point,current.add(Point.read(args)))},closePath:function(tolerance){this.setClosed(!0),this.join(this,tolerance)}}},{_getBounds:function(matrix,options){var method=options.handle?"getHandleBounds":options.stroke?"getStrokeBounds":"getBounds";return Path[method](this._segments,this._closed,this,matrix,options)},statics:{getBounds:function(segments,closed,path,matrix,options,strokePadding){var first=segments[0];if(!first)return new Rectangle;var coords=new Array(6),prevCoords=first._transformCoordinates(matrix,new Array(6)),min=prevCoords.slice(0,2),max=min.slice(),roots=new Array(2);function processSegment(segment){segment._transformCoordinates(matrix,coords);for(var i=0;i<2;i++)Curve._addBounds(prevCoords[i],prevCoords[i+4],coords[i+2],coords[i],i,strokePadding?strokePadding[i]:0,min,max,roots);var tmp=prevCoords;prevCoords=coords,coords=tmp}for(var i=1,l=segments.length;i<l;i++)processSegment(segments[i]);return closed&&processSegment(first),new Rectangle(min[0],min[1],max[0]-min[0],max[1]-min[1])},getStrokeBounds:function(segments,closed,path,matrix,options){var style=path.getStyle(),stroke=style.hasStroke(),strokeWidth=style.getStrokeWidth(),strokeMatrix=stroke&&path._getStrokeMatrix(matrix,options),strokePadding=stroke&&Path._getStrokePadding(strokeWidth,strokeMatrix),bounds=Path.getBounds(segments,closed,path,matrix,options,strokePadding);if(!stroke)return bounds;var strokeRadius=strokeWidth/2,join=style.getStrokeJoin(),cap=style.getStrokeCap(),miterLimit=style.getMiterLimit(),joinBounds=new Rectangle(new Size(strokePadding));function addPoint(point){bounds=bounds.include(point)}function addRound(segment){bounds=bounds.unite(joinBounds.setCenter(segment._point.transform(matrix)))}function addJoin(segment,join){"round"===join||segment.isSmooth()?addRound(segment):Path._addBevelJoin(segment,join,strokeRadius,miterLimit,matrix,strokeMatrix,addPoint)}function addCap(segment,cap){"round"===cap?addRound(segment):Path._addSquareCap(segment,cap,strokeRadius,matrix,strokeMatrix,addPoint)}var length=segments.length-(closed?0:1);if(length>0){for(var i=1;i<length;i++)addJoin(segments[i],join);closed?addJoin(segments[0],join):(addCap(segments[0],cap),addCap(segments[segments.length-1],cap))}return bounds},_getStrokePadding:function(radius,matrix){if(!matrix)return[radius,radius];var hor=new Point(radius,0).transform(matrix),ver=new Point(0,radius).transform(matrix),phi=hor.getAngleInRadians(),a=hor.getLength(),b=ver.getLength(),sin=Math.sin(phi),cos=Math.cos(phi),tan=Math.tan(phi),tx=Math.atan2(b*tan,a),ty=Math.atan2(b,tan*a);return[Math.abs(a*Math.cos(tx)*cos+b*Math.sin(tx)*sin),Math.abs(b*Math.sin(ty)*cos+a*Math.cos(ty)*sin)]},_addBevelJoin:function(segment,join,radius,miterLimit,matrix,strokeMatrix,addPoint,isArea){var curve2=segment.getCurve(),curve1=curve2.getPrevious(),point=curve2.getPoint1().transform(matrix),normal1=curve1.getNormalAtTime(1).multiply(radius).transform(strokeMatrix),normal2=curve2.getNormalAtTime(0).multiply(radius).transform(strokeMatrix),angle=normal1.getDirectedAngle(normal2);if((angle<0||angle>=180)&&(normal1=normal1.negate(),normal2=normal2.negate()),isArea&&addPoint(point),addPoint(point.add(normal1)),"miter"===join){var corner=new Line(point.add(normal1),new Point(-normal1.y,normal1.x),!0).intersect(new Line(point.add(normal2),new Point(-normal2.y,normal2.x),!0),!0);corner&&point.getDistance(corner)<=miterLimit*radius&&addPoint(corner)}addPoint(point.add(normal2))},_addSquareCap:function(segment,cap,radius,matrix,strokeMatrix,addPoint,isArea){var point=segment._point.transform(matrix),loc=segment.getLocation(),normal=loc.getNormal().multiply(0===loc.getTime()?radius:-radius).transform(strokeMatrix);"square"===cap&&(isArea&&(addPoint(point.subtract(normal)),addPoint(point.add(normal))),point=point.add(normal.rotate(-90))),addPoint(point.add(normal)),addPoint(point.subtract(normal))},getHandleBounds:function(segments,closed,path,matrix,options){var strokePadding,joinPadding,style=path.getStyle();if(options.stroke&&style.hasStroke()){var strokeMatrix=path._getStrokeMatrix(matrix,options),strokeRadius=style.getStrokeWidth()/2,joinRadius=strokeRadius;"miter"===style.getStrokeJoin()&&(joinRadius=strokeRadius*style.getMiterLimit()),"square"===style.getStrokeCap()&&(joinRadius=Math.max(joinRadius,strokeRadius*Math.SQRT2)),strokePadding=Path._getStrokePadding(strokeRadius,strokeMatrix),joinPadding=Path._getStrokePadding(joinRadius,strokeMatrix)}for(var coords=new Array(6),x1=1/0,x2=-x1,y1=x1,y2=x2,i=0,l=segments.length;i<l;i++){segments[i]._transformCoordinates(matrix,coords);for(var j=0;j<6;j+=2){var padding=j?strokePadding:joinPadding,paddingX=padding?padding[0]:0,paddingY=padding?padding[1]:0,x=coords[j],y=coords[j+1],xn=x-paddingX,xx=x+paddingX,yn=y-paddingY,yx=y+paddingY;xn<x1&&(x1=xn),xx>x2&&(x2=xx),yn<y1&&(y1=yn),yx>y2&&(y2=yx)}}return new Rectangle(x1,y1,x2-x1,y2-y1)}}});Path.inject({statics:new function(){var kappa=.5522847498307936,ellipseSegments=[new Segment([-1,0],[0,kappa],[0,-kappa]),new Segment([0,-1],[-kappa,0],[kappa,0]),new Segment([1,0],[0,-kappa],[0,kappa]),new Segment([0,1],[kappa,0],[-kappa,0])];function createPath(segments,closed,args){var props=Base.getNamed(args),path=new Path(props&&(1==props.insert?Item.INSERT:0==props.insert?Item.NO_INSERT:null));return path._add(segments),path._closed=closed,path.set(props,Item.INSERT)}function createEllipse(center,radius,args){for(var segments=new Array(4),i=0;i<4;i++){var segment=ellipseSegments[i];segments[i]=new Segment(segment._point.multiply(radius).add(center),segment._handleIn.multiply(radius),segment._handleOut.multiply(radius))}return createPath(segments,!0,args)}return{Line:function(){var args=arguments;return createPath([new Segment(Point.readNamed(args,"from")),new Segment(Point.readNamed(args,"to"))],!1,args)},Circle:function(){var args=arguments,center=Point.readNamed(args,"center"),radius=Base.readNamed(args,"radius");return createEllipse(center,new Size(radius),args)},Rectangle:function(){var segments,args=arguments,rect=Rectangle.readNamed(args,"rectangle"),radius=Size.readNamed(args,"radius",0,{readNull:!0}),bl=rect.getBottomLeft(!0),tl=rect.getTopLeft(!0),tr=rect.getTopRight(!0),br=rect.getBottomRight(!0);if(!radius||radius.isZero())segments=[new Segment(bl),new Segment(tl),new Segment(tr),new Segment(br)];else{var rx=(radius=Size.min(radius,rect.getSize(!0).divide(2))).width,ry=radius.height,hx=rx*kappa,hy=ry*kappa;segments=[new Segment(bl.add(rx,0),null,[-hx,0]),new Segment(bl.subtract(0,ry),[0,hy]),new Segment(tl.add(0,ry),null,[0,-hy]),new Segment(tl.add(rx,0),[-hx,0],null),new Segment(tr.subtract(rx,0),null,[hx,0]),new Segment(tr.add(0,ry),[0,-hy],null),new Segment(br.subtract(0,ry),null,[0,hy]),new Segment(br.subtract(rx,0),[hx,0])]}return createPath(segments,!0,args)},RoundRectangle:"#Rectangle",Ellipse:function(){var args=arguments,ellipse=Shape._readEllipse(args);return createEllipse(ellipse.center,ellipse.radius,args)},Oval:"#Ellipse",Arc:function(){var args=arguments,from=Point.readNamed(args,"from"),through=Point.readNamed(args,"through"),to=Point.readNamed(args,"to"),props=Base.getNamed(args),path=new Path(props&&0==props.insert&&Item.NO_INSERT);return path.moveTo(from),path.arcTo(through,to),path.set(props)},RegularPolygon:function(){for(var args=arguments,center=Point.readNamed(args,"center"),sides=Base.readNamed(args,"sides"),radius=Base.readNamed(args,"radius"),step=360/sides,three=sides%3==0,vector=new Point(0,three?-radius:radius),offset=three?-1:.5,segments=new Array(sides),i=0;i<sides;i++)segments[i]=new Segment(center.add(vector.rotate((i+offset)*step)));return createPath(segments,!0,args)},Star:function(){for(var args=arguments,center=Point.readNamed(args,"center"),points=2*Base.readNamed(args,"points"),radius1=Base.readNamed(args,"radius1"),radius2=Base.readNamed(args,"radius2"),step=360/points,vector=new Point(0,-1),segments=new Array(points),i=0;i<points;i++)segments[i]=new Segment(center.add(vector.rotate(step*i).multiply(i%2?radius2:radius1)));return createPath(segments,!0,args)}}}});var CompoundPath=PathItem.extend({_class:"CompoundPath",_serializeFields:{children:[]},beans:!0,initialize:function CompoundPath(arg){this._children=[],this._namedChildren={},this._initialize(arg)||("string"==typeof arg?this.setPathData(arg):this.addChildren(Array.isArray(arg)?arg:arguments))},insertChildren:function insertChildren(index,items){var list=items,first=list[0];first&&"number"==typeof first[0]&&(list=[list]);for(var i=items.length-1;i>=0;i--){var item=list[i];list!==items||item instanceof Path||(list=Base.slice(list)),Array.isArray(item)?list[i]=new Path({segments:item,insert:!1}):item instanceof CompoundPath&&(list.splice.apply(list,[i,1].concat(item.removeChildren())),item.remove())}return insertChildren.base.call(this,index,list)},reduce:function reduce(options){for(var children=this._children,i=children.length-1;i>=0;i--){var path;(path=children[i].reduce(options)).isEmpty()&&path.remove()}return children.length?reduce.base.call(this):((path=new Path(Item.NO_INSERT)).copyAttributes(this),path.insertAbove(this),this.remove(),path)},isClosed:function(){for(var children=this._children,i=0,l=children.length;i<l;i++)if(!children[i]._closed)return!1;return!0},setClosed:function(closed){for(var children=this._children,i=0,l=children.length;i<l;i++)children[i].setClosed(closed)},getFirstSegment:function(){var first=this.getFirstChild();return first&&first.getFirstSegment()},getLastSegment:function(){var last=this.getLastChild();return last&&last.getLastSegment()},getCurves:function(){for(var children=this._children,curves=[],i=0,l=children.length;i<l;i++)Base.push(curves,children[i].getCurves());return curves},getFirstCurve:function(){var first=this.getFirstChild();return first&&first.getFirstCurve()},getLastCurve:function(){var last=this.getLastChild();return last&&last.getLastCurve()},getArea:function(){for(var children=this._children,area=0,i=0,l=children.length;i<l;i++)area+=children[i].getArea();return area},getLength:function(){for(var children=this._children,length=0,i=0,l=children.length;i<l;i++)length+=children[i].getLength();return length},getPathData:function(_matrix,_precision){for(var children=this._children,paths=[],i=0,l=children.length;i<l;i++){var child=children[i],mx=child._matrix;paths.push(child.getPathData(_matrix&&!mx.isIdentity()?_matrix.appended(mx):_matrix,_precision))}return paths.join("")},_hitTestChildren:function _hitTestChildren(point,options,viewMatrix){return _hitTestChildren.base.call(this,point,options.class===Path||"path"===options.type?options:Base.set({},options,{fill:!1}),viewMatrix)},_draw:function(ctx,param,viewMatrix,strokeMatrix){var children=this._children;if(children.length){param=param.extend({dontStart:!0,dontFinish:!0}),ctx.beginPath();for(var i=0,l=children.length;i<l;i++)children[i].draw(ctx,param,strokeMatrix);if(!param.clip){this._setStyles(ctx,param,viewMatrix);var style=this._style;style.hasFill()&&(ctx.fill(style.getFillRule()),ctx.shadowColor="rgba(0,0,0,0)"),style.hasStroke()&&ctx.stroke()}}},_drawSelected:function(ctx,matrix,selectionItems){for(var children=this._children,i=0,l=children.length;i<l;i++){var child=children[i],mx=child._matrix;selectionItems[child._id]||child._drawSelected(ctx,mx.isIdentity()?matrix:matrix.appended(mx))}}},new function(){function getCurrentPath(that,check){var children=that._children;if(check&&!children.length)throw new Error("Use a moveTo() command first");return children[children.length-1]}return Base.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],(function(key){this[key]=function(){var path=getCurrentPath(this,!0);path[key].apply(path,arguments)}}),{moveTo:function(){var current=getCurrentPath(this),path=current&&current.isEmpty()?current:new Path(Item.NO_INSERT);path!==current&&this.addChild(path),path.moveTo.apply(path,arguments)},moveBy:function(){var current=getCurrentPath(this,!0),last=current&&current.getLastSegment(),point=Point.read(arguments);this.moveTo(last?point.add(last._point):point)},closePath:function(tolerance){getCurrentPath(this,!0).closePath(tolerance)}})},Base.each(["reverse","flatten","simplify","smooth"],(function(key){this[key]=function(param){for(var res,children=this._children,i=0,l=children.length;i<l;i++)res=children[i][key](param)||res;return res}}),{}));PathItem.inject(new function(){var min=Math.min,max=Math.max,abs=Math.abs,operators={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};function getPaths(path){return path._children||[path]}function preparePath(path,resolve){var res=path.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);if(resolve){for(var paths=getPaths(res),i=0,l=paths.length;i<l;i++){(path=paths[i])._closed||path.isEmpty()||(path.closePath(1e-12),path.getFirstSegment().setHandleIn(0,0),path.getLastSegment().setHandleOut(0,0))}res=res.resolveCrossings().reorient("nonzero"===res.getFillRule(),!0)}return res}function createResult(paths,simplify,path1,path2,options){var result=new CompoundPath(Item.NO_INSERT);return result.addChildren(paths,!0),result=result.reduce({simplify}),options&&0==options.insert||result.insertAbove(path2&&path1.isSibling(path2)&&path1.getIndex()<path2.getIndex()?path2:path1),result.copyAttributes(path1,!0),result}function filterIntersection(inter){return inter.hasOverlap()||inter.isCrossing()}function traceBoolean(path1,path2,operation,options){if(options&&(0==options.trace||options.stroke)&&/^(subtract|intersect)$/.test(operation))return splitBoolean(path1,path2,operation);var _path1=preparePath(path1,!0),_path2=path2&&path1!==path2&&preparePath(path2,!0),operator=operators[operation];operator[operation]=!0,_path2&&(operator.subtract||operator.exclude)^_path2.isClockwise()^_path1.isClockwise()&&_path2.reverse();var paths,crossings=divideLocations(CurveLocation.expand(_path1.getIntersections(_path2,filterIntersection))),paths1=getPaths(_path1),paths2=_path2&&getPaths(_path2),segments=[],curves=[];function collectPaths(paths){for(var i=0,l=paths.length;i<l;i++){var path=paths[i];Base.push(segments,path._segments),Base.push(curves,path.getCurves()),path._overlapsOnly=!0}}function getCurves(indices){for(var list=[],i=0,l=indices&&indices.length;i<l;i++)list.push(curves[indices[i]]);return list}if(crossings.length){collectPaths(paths1),paths2&&collectPaths(paths2);for(var curvesValues=new Array(curves.length),i=0,l=curves.length;i<l;i++)curvesValues[i]=curves[i].getValues();var curveCollisions=CollisionDetection.findCurveBoundsCollisions(curvesValues,curvesValues,0,!0),curveCollisionsMap={};for(i=0;i<curves.length;i++){var curve=curves[i],id=curve._path._id;(curveCollisionsMap[id]=curveCollisionsMap[id]||{})[curve.getIndex()]={hor:getCurves(curveCollisions[i].hor),ver:getCurves(curveCollisions[i].ver)}}for(i=0,l=crossings.length;i<l;i++)propagateWinding(crossings[i]._segment,_path1,_path2,curveCollisionsMap,operator);for(i=0,l=segments.length;i<l;i++){var segment=segments[i],inter=segment._intersection;segment._winding||propagateWinding(segment,_path1,_path2,curveCollisionsMap,operator),inter&&inter._overlap||(segment._path._overlapsOnly=!1)}paths=tracePaths(segments,operator)}else paths=reorientPaths(paths2?paths1.concat(paths2):paths1.slice(),(function(w){return!!operator[w]}));return createResult(paths,!0,path1,path2,options)}function splitBoolean(path1,path2,operation){var _path1=preparePath(path1),_path2=preparePath(path2),crossings=_path1.getIntersections(_path2,filterIntersection),subtract="subtract"===operation,divide="divide"===operation,added={},paths=[];function addPath(path){if(!added[path._id]&&(divide||_path2.contains(path.getPointAt(path.getLength()/2))^subtract))return paths.unshift(path),added[path._id]=!0}for(var i=crossings.length-1;i>=0;i--){var path=crossings[i].split();path&&(addPath(path)&&path.getFirstSegment().setHandleIn(0,0),_path1.getLastSegment().setHandleOut(0,0))}return addPath(_path1),createResult(paths,!1,path1,path2)}function linkIntersections(from,to){for(var prev=from;prev;){if(prev===to)return;prev=prev._previous}for(;from._next&&from._next!==to;)from=from._next;if(!from._next){for(;to._previous;)to=to._previous;from._next=to,to._previous=from}}function clearCurveHandles(curves){for(var i=curves.length-1;i>=0;i--)curves[i].clearHandles()}function reorientPaths(paths,isInside,clockwise){var length=paths&&paths.length;if(length){var lookup=Base.each(paths,(function(path,i){this[path._id]={container:null,winding:path.isClockwise()?1:-1,index:i}}),{}),sorted=paths.slice().sort((function(a,b){return abs(b.getArea())-abs(a.getArea())})),first=sorted[0],collisions=CollisionDetection.findItemBoundsCollisions(sorted,null,Numerical.GEOMETRIC_EPSILON);null==clockwise&&(clockwise=first.isClockwise());for(var i=0;i<length;i++){var path1=sorted[i],entry1=lookup[path1._id],containerWinding=0,indices=collisions[i];if(indices)for(var point=null,j=indices.length-1;j>=0;j--)if(indices[j]<i){point=point||path1.getInteriorPoint();var path2=sorted[indices[j]];if(path2.contains(point)){var entry2=lookup[path2._id];containerWinding=entry2.winding,entry1.winding+=containerWinding,entry1.container=entry2.exclude?entry2.container:path2;break}}if(isInside(entry1.winding)===isInside(containerWinding))entry1.exclude=!0,paths[entry1.index]=null;else{var container=entry1.container;path1.setClockwise(container?!container.isClockwise():clockwise)}}}return paths}function divideLocations(locations,include,clearLater){var renormalizeLocs,prevCurve,prevTime,results=include&&[],clearHandles=!1,clearCurves=clearLater||[],clearLookup=clearLater&&{};function getId(curve){return curve._path._id+"."+curve._segment1._index}for(var i=(clearLater&&clearLater.length)-1;i>=0;i--){(curve=clearLater[i])._path&&(clearLookup[getId(curve)]=!0)}for(i=locations.length-1;i>=0;i--){var curve,segment,loc=locations[i],time=loc._time,origTime=time,exclude=include&&!include(loc);if((curve=loc._curve)&&(curve!==prevCurve?(clearHandles=!curve.hasHandles()||clearLookup&&clearLookup[getId(curve)],renormalizeLocs=[],prevTime=null,prevCurve=curve):prevTime>=1e-8&&(time/=prevTime)),exclude)renormalizeLocs&&renormalizeLocs.push(loc);else{if(include&&results.unshift(loc),prevTime=origTime,time<1e-8)segment=curve._segment1;else if(time>.99999999)segment=curve._segment2;else{var newCurve=curve.divideAtTime(time,!0);clearHandles&&clearCurves.push(curve,newCurve),segment=newCurve._segment1;for(var j=renormalizeLocs.length-1;j>=0;j--){var l=renormalizeLocs[j];l._time=(l._time-time)/(1-time)}}loc._setSegment(segment);var inter=segment._intersection,dest=loc._intersection;if(inter){linkIntersections(inter,dest);for(var other=inter;other;)linkIntersections(other._intersection,inter),other=other._next}else segment._intersection=dest}}return clearLater||clearCurveHandles(clearCurves),results||locations}function getWinding(point,curves,dir,closed,dontFlip){var vPrev,vClose,curvesList=Array.isArray(curves)?curves:curves[dir?"hor":"ver"],ia=dir?1:0,io=1^ia,pv=[point.x,point.y],pa=pv[ia],po=pv[io],qualityEpsilon=1e-6,paL=pa-1e-9,paR=pa+1e-9,windingL=0,windingR=0,pathWindingL=0,pathWindingR=0,onPath=!1,onAnyPath=!1,quality=1,roots=[];function addWinding(v){var o0=v[io+0],o3=v[io+6];if(!(po<min(o0,o3)||po>max(o0,o3))){var a0=v[ia+0],a1=v[ia+2],a2=v[ia+4],a3=v[ia+6];if(o0!==o3){var t=po===o0?0:po===o3||paL>max(a0,a1,a2,a3)||paR<min(a0,a1,a2,a3)?1:Curve.solveCubic(v,io,po,roots,0,1)>0?roots[0]:1,a=0===t?a0:1===t?a3:Curve.getPoint(v,t)[dir?"y":"x"],winding=o0>o3?1:-1,windingPrev=vPrev[io]>vPrev[io+6]?1:-1,a3Prev=vPrev[ia+6];return po!==o0?(a<paL?pathWindingL+=winding:a>paR?pathWindingR+=winding:onPath=!0,a>pa-qualityEpsilon&&a<pa+qualityEpsilon&&(quality/=2)):(winding!==windingPrev?a0<paL?pathWindingL+=winding:a0>paR&&(pathWindingR+=winding):a0!=a3Prev&&(a3Prev<paR&&a>paR?(pathWindingR+=winding,onPath=!0):a3Prev>paL&&a<paL&&(pathWindingL+=winding,onPath=!0)),quality/=4),vPrev=v,!dontFlip&&a>paL&&a<paR&&0===Curve.getTangent(v,t)[dir?"x":"y"]&&getWinding(point,curves,!dir,closed,!0)}(a0<paR&&a3>paL||a3<paR&&a0>paL)&&(onPath=!0)}}function handleCurve(v){var o0=v[io+0],o1=v[io+2],o2=v[io+4],o3=v[io+6];if(po<=max(o0,o1,o2,o3)&&po>=min(o0,o1,o2,o3))for(var res,a0=v[ia+0],a1=v[ia+2],a2=v[ia+4],a3=v[ia+6],monoCurves=paL>max(a0,a1,a2,a3)||paR<min(a0,a1,a2,a3)?[v]:Curve.getMonoCurves(v,dir),i=0,l=monoCurves.length;i<l;i++)if(res=addWinding(monoCurves[i]))return res}for(var i=0,l=curvesList.length;i<l;i++){var res,curve=curvesList[i],path=curve._path,v=curve.getValues();if(!(i&&curvesList[i-1]._path===path||(vPrev=null,path._closed||(vClose=Curve.getValues(path.getLastCurve().getSegment2(),curve.getSegment1(),null,!closed))[io]!==vClose[io+6]&&(vPrev=vClose),vPrev))){vPrev=v;for(var prev=path.getLastCurve();prev&&prev!==curve;){var v2=prev.getValues();if(v2[io]!==v2[io+6]){vPrev=v2;break}prev=prev.getPrevious()}}if(res=handleCurve(v))return res;if(i+1===l||curvesList[i+1]._path!==path){if(vClose&&(res=handleCurve(vClose)))return res;!onPath||pathWindingL||pathWindingR||(pathWindingL=pathWindingR=path.isClockwise(closed)^dir?1:-1),windingL+=pathWindingL,windingR+=pathWindingR,pathWindingL=pathWindingR=0,onPath&&(onAnyPath=!0,onPath=!1),vClose=null}}return windingL=abs(windingL),windingR=abs(windingR),{winding:max(windingL,windingR),windingL,windingR,quality,onPath:onAnyPath}}function propagateWinding(segment,path1,path2,curveCollisionsMap,operator){var chain=[],start=segment,totalLength=0;do{if(curve=segment.getCurve()){var length=curve.getLength();chain.push({segment,curve,length}),totalLength+=length}segment=segment.getNext()}while(segment&&!segment._intersection&&segment!==start);for(var offsets=[.5,.25,.75],winding={winding:0,quality:-1},i=0;i<offsets.length&&winding.quality<.5;i++){length=totalLength*offsets[i];for(var j=0,l=chain.length;j<l;j++){var entry=chain[j],curveLength=entry.length;if(length<=curveLength){var curve,path=(curve=entry.curve)._path,parent=path._parent,operand=parent instanceof CompoundPath?parent:path,t=Numerical.clamp(curve.getTimeAt(length),.001,.999),pt=curve.getPointAtTime(t),dir=abs(curve.getTangentAtTime(t).y)<Math.SQRT1_2,wind=null;if(operator.subtract&&path2){var pathWinding=(operand===path1?path2:path1)._getWinding(pt,dir,!0);if(operand===path1&&pathWinding.winding||operand===path2&&!pathWinding.winding){if(pathWinding.quality<1)continue;wind={winding:0,quality:1}}}(wind=wind||getWinding(pt,curveCollisionsMap[path._id][curve.getIndex()],dir,!0)).quality>winding.quality&&(winding=wind);break}length-=curveLength}}for(j=chain.length-1;j>=0;j--)chain[j].segment._winding=winding}function tracePaths(segments,operator){var starts,paths=[];function isValid(seg){var winding;return!(!seg||seg._visited||operator&&(!operator[(winding=seg._winding||{}).winding]||operator.unite&&2===winding.winding&&winding.windingL&&winding.windingR))}function isStart(seg){if(seg)for(var i=0,l=starts.length;i<l;i++)if(seg===starts[i])return!0;return!1}function visitPath(path){for(var segments=path._segments,i=0,l=segments.length;i<l;i++)segments[i]._visited=!0}function getCrossingSegments(segment,collectStarts){var inter=segment._intersection,start=inter,crossings=[];function collect(inter,end){for(;inter&&inter!==end;){var other=inter._segment,path=other&&other._path;if(path){var next=other.getNext()||path.getFirstSegment(),nextInter=next._intersection;other!==segment&&(isStart(other)||isStart(next)||next&&isValid(other)&&(isValid(next)||nextInter&&isValid(nextInter._segment)))&&crossings.push(other),collectStarts&&starts.push(other)}inter=inter._next}}if(collectStarts&&(starts=[segment]),inter){for(collect(inter);inter&&inter._previous;)inter=inter._previous;collect(inter,start)}return crossings}segments.sort((function(seg1,seg2){var inter1=seg1._intersection,inter2=seg2._intersection,over1=!(!inter1||!inter1._overlap),over2=!(!inter2||!inter2._overlap),path1=seg1._path,path2=seg2._path;return over1^over2?over1?1:-1:!inter1^!inter2?inter1?1:-1:path1!==path2?path1._id-path2._id:seg1._index-seg2._index}));for(var i=0,l=segments.length;i<l;i++){var branch,visited,handleIn,seg=segments[i],valid=isValid(seg),path=null,finished=!1,closed=!0,branches=[];if(valid&&seg._path._overlapsOnly){var path1=seg._path,path2=seg._intersection._segment._path;path1.compare(path2)&&(path1.getArea()&&paths.push(path1.clone(!1)),visitPath(path1),visitPath(path2),valid=!1)}for(;valid;){var first=!path,crossings=getCrossingSegments(seg,first),other=crossings.shift(),cross=!(finished=!first&&(isStart(seg)||isStart(other)))&&other;if(first&&(path=new Path(Item.NO_INSERT),branch=null),finished){(seg.isFirst()||seg.isLast())&&(closed=seg._path._closed),seg._visited=!0;break}if(cross&&branch&&(branches.push(branch),branch=null),branch||(cross&&crossings.push(seg),branch={start:path._segments.length,crossings,visited:visited=[],handleIn}),cross&&(seg=other),!isValid(seg)){path.removeSegments(branch.start);for(var j=0,k=visited.length;j<k;j++)visited[j]._visited=!1;visited.length=0;do{(seg=branch&&branch.crossings.shift())&&seg._path||(seg=null,(branch=branches.pop())&&(visited=branch.visited,handleIn=branch.handleIn))}while(branch&&!isValid(seg));if(!seg)break}var next=seg.getNext();path.add(new Segment(seg._point,handleIn,next&&seg._handleOut)),seg._visited=!0,visited.push(seg),seg=next||seg._path.getFirstSegment(),handleIn=next&&next._handleIn}finished&&(closed&&(path.getFirstSegment().setHandleIn(handleIn),path.setClosed(closed)),0!==path.getArea()&&paths.push(path))}return paths}return{_getWinding:function(point,dir,closed){return getWinding(point,this.getCurves(),dir,closed)},unite:function(path,options){return traceBoolean(this,path,"unite",options)},intersect:function(path,options){return traceBoolean(this,path,"intersect",options)},subtract:function(path,options){return traceBoolean(this,path,"subtract",options)},exclude:function(path,options){return traceBoolean(this,path,"exclude",options)},divide:function(path,options){return options&&(0==options.trace||options.stroke)?splitBoolean(this,path,"divide"):createResult([this.subtract(path,options),this.intersect(path,options)],!0,this,path,options)},resolveCrossings:function(){var children=this._children,paths=children||[this];function hasOverlap(seg,path){var inter=seg&&seg._intersection;return inter&&inter._overlap&&inter._path===path}var hasOverlaps=!1,hasCrossings=!1,intersections=this.getIntersections(null,(function(inter){return inter.hasOverlap()&&(hasOverlaps=!0)||inter.isCrossing()&&(hasCrossings=!0)})),clearCurves=hasOverlaps&&hasCrossings&&[];if(intersections=CurveLocation.expand(intersections),hasOverlaps)for(var overlaps=divideLocations(intersections,(function(inter){return inter.hasOverlap()}),clearCurves),i=overlaps.length-1;i>=0;i--){var overlap=overlaps[i],path=overlap._path,seg=overlap._segment,prev=seg.getPrevious(),next=seg.getNext();hasOverlap(prev,path)&&hasOverlap(next,path)&&(seg.remove(),prev._handleOut._set(0,0),next._handleIn._set(0,0),prev===seg||prev.getCurve().hasLength()||(next._handleIn.set(prev._handleIn),prev.remove()))}hasCrossings&&(divideLocations(intersections,hasOverlaps&&function(inter){var curve1=inter.getCurve(),seg1=inter.getSegment(),other=inter._intersection,curve2=other._curve,seg2=other._segment;if(curve1&&curve2&&curve1._path&&curve2._path)return!0;seg1&&(seg1._intersection=null),seg2&&(seg2._intersection=null)},clearCurves),clearCurves&&clearCurveHandles(clearCurves),paths=tracePaths(Base.each(paths,(function(path){Base.push(this,path._segments)}),[])));var item,length=paths.length;return length>1&&children?(paths!==children&&this.setChildren(paths),item=this):1!==length||children||(paths[0]!==this&&this.setSegments(paths[0].removeSegments()),item=this),item||((item=new CompoundPath(Item.NO_INSERT)).addChildren(paths),(item=item.reduce()).copyAttributes(this),this.replaceWith(item)),item},reorient:function(nonZero,clockwise){var children=this._children;return children&&children.length?this.setChildren(reorientPaths(this.removeChildren(),(function(w){return!!(nonZero?w:1&w)}),clockwise)):clockwise!==undefined&&this.setClockwise(clockwise),this},getInteriorPoint:function(){var point=this.getBounds().getCenter(!0);if(!this.contains(point)){for(var curves=this.getCurves(),y=point.y,intercepts=[],roots=[],i=0,l=curves.length;i<l;i++){var v=curves[i].getValues(),o0=v[1],o1=v[3],o2=v[5],o3=v[7];if(y>=min(o0,o1,o2,o3)&&y<=max(o0,o1,o2,o3))for(var monoCurves=Curve.getMonoCurves(v),j=0,m=monoCurves.length;j<m;j++){var mv=monoCurves[j],mo0=mv[1],mo3=mv[7];if(mo0!==mo3&&(y>=mo0&&y<=mo3||y>=mo3&&y<=mo0)){var x=y===mo0?mv[0]:y===mo3?mv[6]:1===Curve.solveCubic(mv,1,y,roots,0,1)?Curve.getPoint(mv,roots[0]).x:(mv[0]+mv[6])/2;intercepts.push(x)}}}intercepts.length>1&&(intercepts.sort((function(a,b){return a-b})),point.x=(intercepts[0]+intercepts[1])/2)}return point}}});var PathFlattener=Base.extend({_class:"PathFlattener",initialize:function(path,flatness,maxRecursion,ignoreStraight,matrix){var segment2,curves=[],parts=[],length=0,minSpan=1/(maxRecursion||32),segments=path._segments,segment1=segments[0];function addCurve(segment1,segment2){var curve=Curve.getValues(segment1,segment2,matrix);curves.push(curve),computeParts(curve,segment1._index,0,1)}function computeParts(curve,index,t1,t2){if(!(t2-t1>minSpan)||ignoreStraight&&Curve.isStraight(curve)||Curve.isFlatEnough(curve,flatness||.25)){var dx=curve[6]-curve[0],dy=curve[7]-curve[1],dist=Math.sqrt(dx*dx+dy*dy);dist>0&&(length+=dist,parts.push({offset:length,curve,index,time:t2}))}else{var halves=Curve.subdivide(curve,.5),tMid=(t1+t2)/2;computeParts(halves[0],index,t1,tMid),computeParts(halves[1],index,tMid,t2)}}for(var i=1,l=segments.length;i<l;i++)addCurve(segment1,segment2=segments[i]),segment1=segment2;path._closed&&addCurve(segment2||segment1,segments[0]),this.curves=curves,this.parts=parts,this.length=length,this.index=0},_get:function(offset){for(var i,parts=this.parts,length=parts.length,j=this.index;i=j,j&&!(parts[--j].offset<offset););for(;i<length;i++){var part=parts[i];if(part.offset>=offset){this.index=i;var prev=parts[i-1],prevTime=prev&&prev.index===part.index?prev.time:0,prevOffset=prev?prev.offset:0;return{index:part.index,time:prevTime+(part.time-prevTime)*(offset-prevOffset)/(part.offset-prevOffset)}}}return{index:parts[length-1].index,time:1}},drawPart:function(ctx,from,to){for(var start=this._get(from),end=this._get(to),i=start.index,l=end.index;i<=l;i++){var curve=Curve.getPart(this.curves[i],i===start.index?start.time:0,i===end.index?end.time:1);i===start.index&&ctx.moveTo(curve[0],curve[1]),ctx.bezierCurveTo.apply(ctx,curve.slice(2))}}},Base.each(Curve._evaluateMethods,(function(name){this[name+"At"]=function(offset){var param=this._get(offset);return Curve[name](this.curves[param.index],param.time)}}),{})),PathFitter=Base.extend({initialize:function(path){for(var prev,points=this.points=[],segments=path._segments,closed=path._closed,i=0,l=segments.length;i<l;i++){var point=segments[i].point;prev&&prev.equals(point)||points.push(prev=point.clone())}closed&&(points.unshift(points[points.length-1]),points.push(points[1])),this.closed=closed},fit:function(error){var points=this.points,length=points.length,segments=null;return length>0&&(segments=[new Segment(points[0])],length>1&&(this.fitCubic(segments,error,0,length-1,points[1].subtract(points[0]),points[length-2].subtract(points[length-1])),this.closed&&(segments.shift(),segments.pop()))),segments},fitCubic:function(segments,error,first,last,tan1,tan2){var points=this.points;if(last-first!=1){for(var split,uPrime=this.chordLengthParameterize(first,last),maxError=Math.max(error,error*error),parametersInOrder=!0,i=0;i<=4;i++){var curve=this.generateBezier(first,last,uPrime,tan1,tan2),max=this.findMaxError(first,last,curve,uPrime);if(max.error<error&&parametersInOrder)return void this.addCurve(segments,curve);if(split=max.index,max.error>=maxError)break;parametersInOrder=this.reparameterize(first,last,uPrime,curve),maxError=max.error}var tanCenter=points[split-1].subtract(points[split+1]);this.fitCubic(segments,error,first,split,tan1,tanCenter),this.fitCubic(segments,error,split,last,tanCenter.negate(),tan2)}else{var pt1=points[first],pt2=points[last],dist=pt1.getDistance(pt2)/3;this.addCurve(segments,[pt1,pt1.add(tan1.normalize(dist)),pt2.add(tan2.normalize(dist)),pt2])}},addCurve:function(segments,curve){segments[segments.length-1].setHandleOut(curve[1].subtract(curve[0])),segments.push(new Segment(curve[3],curve[2].subtract(curve[3])))},generateBezier:function(first,last,uPrime,tan1,tan2){for(var abs=Math.abs,points=this.points,pt1=points[first],pt2=points[last],C=[[0,0],[0,0]],X=[0,0],i=0,l=last-first+1;i<l;i++){var u=uPrime[i],t=1-u,b=3*u*t,b0=t*t*t,b1=b*t,b2=b*u,b3=u*u*u,a1=tan1.normalize(b1),a2=tan2.normalize(b2),tmp=points[first+i].subtract(pt1.multiply(b0+b1)).subtract(pt2.multiply(b2+b3));C[0][0]+=a1.dot(a1),C[0][1]+=a1.dot(a2),C[1][0]=C[0][1],C[1][1]+=a2.dot(a2),X[0]+=a1.dot(tmp),X[1]+=a2.dot(tmp)}var alpha1,alpha2,detC0C1=C[0][0]*C[1][1]-C[1][0]*C[0][1];if(abs(detC0C1)>1e-12){var detC0X=C[0][0]*X[1]-C[1][0]*X[0];alpha1=(X[0]*C[1][1]-X[1]*C[0][1])/detC0C1,alpha2=detC0X/detC0C1}else{var c0=C[0][0]+C[0][1],c1=C[1][0]+C[1][1];alpha1=alpha2=abs(c0)>1e-12?X[0]/c0:abs(c1)>1e-12?X[1]/c1:0}var handle1,handle2,segLength=pt2.getDistance(pt1),eps=1e-12*segLength;if(alpha1<eps||alpha2<eps)alpha1=alpha2=segLength/3;else{var line=pt2.subtract(pt1);handle1=tan1.normalize(alpha1),handle2=tan2.normalize(alpha2),handle1.dot(line)-handle2.dot(line)>segLength*segLength&&(alpha1=alpha2=segLength/3,handle1=handle2=null)}return[pt1,pt1.add(handle1||tan1.normalize(alpha1)),pt2.add(handle2||tan2.normalize(alpha2)),pt2]},reparameterize:function(first,last,u,curve){for(var i=first;i<=last;i++)u[i-first]=this.findRoot(curve,this.points[i],u[i-first]);i=1;for(var l=u.length;i<l;i++)if(u[i]<=u[i-1])return!1;return!0},findRoot:function(curve,point,u){for(var curve1=[],curve2=[],i=0;i<=2;i++)curve1[i]=curve[i+1].subtract(curve[i]).multiply(3);for(i=0;i<=1;i++)curve2[i]=curve1[i+1].subtract(curve1[i]).multiply(2);var pt=this.evaluate(3,curve,u),pt1=this.evaluate(2,curve1,u),pt2=this.evaluate(1,curve2,u),diff=pt.subtract(point),df=pt1.dot(pt1)+diff.dot(pt2);return Numerical.isMachineZero(df)?u:u-diff.dot(pt1)/df},evaluate:function(degree,curve,t){for(var tmp=curve.slice(),i=1;i<=degree;i++)for(var j=0;j<=degree-i;j++)tmp[j]=tmp[j].multiply(1-t).add(tmp[j+1].multiply(t));return tmp[0]},chordLengthParameterize:function(first,last){for(var u=[0],i=first+1;i<=last;i++)u[i-first]=u[i-first-1]+this.points[i].getDistance(this.points[i-1]);i=1;for(var m=last-first;i<=m;i++)u[i]/=u[m];return u},findMaxError:function(first,last,curve,u){for(var index=Math.floor((last-first+1)/2),maxDist=0,i=first+1;i<last;i++){var v=this.evaluate(3,curve,u[i-first]).subtract(this.points[i]),dist=v.x*v.x+v.y*v.y;dist>=maxDist&&(maxDist=dist,index=i)}return{error:maxDist,index}}}),TextItem=Item.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function TextItem(arg){this._content="",this._lines=[];var hasProps=arg&&Base.isPlainObject(arg)&&arg.x===undefined&&arg.y===undefined;this._initialize(hasProps&&arg,!hasProps&&Point.read(arguments))},_equals:function(item){return this._content===item._content},copyContent:function(source){this.setContent(source._content)},getContent:function(){return this._content},setContent:function(content){this._content=""+content,this._lines=this._content.split(/\r\n|\n|\r/gm),this._changed(521)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),PointText=TextItem.extend({_class:"PointText",initialize:function PointText(){TextItem.apply(this,arguments)},getPoint:function(){var point=this._matrix.getTranslation();return new LinkedPoint(point.x,point.y,this,"setPoint")},setPoint:function(){var point=Point.read(arguments);this.translate(point.subtract(this._matrix.getTranslation()))},_draw:function(ctx,param,viewMatrix){if(this._content){this._setStyles(ctx,param,viewMatrix);var lines=this._lines,style=this._style,hasFill=style.hasFill(),hasStroke=style.hasStroke(),leading=style.getLeading(),shadowColor=ctx.shadowColor;ctx.font=style.getFontStyle(),ctx.textAlign=style.getJustification();for(var i=0,l=lines.length;i<l;i++){ctx.shadowColor=shadowColor;var line=lines[i];hasFill&&(ctx.fillText(line,0,0),ctx.shadowColor="rgba(0,0,0,0)"),hasStroke&&ctx.strokeText(line,0,0),ctx.translate(0,leading)}}},_getBounds:function(matrix,options){var style=this._style,lines=this._lines,numLines=lines.length,justification=style.getJustification(),leading=style.getLeading(),width=this.getView().getTextWidth(style.getFontStyle(),lines),x=0;"left"!==justification&&(x-=width/("center"===justification?2:1));var rect=new Rectangle(x,numLines?-.75*leading:0,width,numLines*leading);return matrix?matrix._transformBounds(rect,rect):rect}}),Color=Base.extend(new function(){var colorCtx,types={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},componentParsers={},namedColors={transparent:[0,0,0,0]};var hsbIndices=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],converters={"rgb-hsb":function(r,g,b){var max=Math.max(r,g,b),delta=max-Math.min(r,g,b);return[0===delta?0:60*(max==r?(g-b)/delta+(g<b?6:0):max==g?(b-r)/delta+2:(r-g)/delta+4),0===max?0:delta/max,max]},"hsb-rgb":function(h,s,b){var i,f=(h=(h/60%6+6)%6)-(i=Math.floor(h)),v=[b,b*(1-s),b*(1-s*f),b*(1-s*(1-f))];return[v[(i=hsbIndices[i])[0]],v[i[1]],v[i[2]]]},"rgb-hsl":function(r,g,b){var max=Math.max(r,g,b),min=Math.min(r,g,b),delta=max-min,achromatic=0===delta,l=(max+min)/2;return[achromatic?0:60*(max==r?(g-b)/delta+(g<b?6:0):max==g?(b-r)/delta+2:(r-g)/delta+4),achromatic?0:l<.5?delta/(max+min):delta/(2-max-min),l]},"hsl-rgb":function(h,s,l){if(0===s)return[l,l,l];for(var t3s=[(h=(h/360%1+1)%1)+1/3,h,h-1/3],t2=l<.5?l*(1+s):l+s-l*s,t1=2*l-t2,c=[],i=0;i<3;i++){var t3=t3s[i];t3<0&&(t3+=1),t3>1&&(t3-=1),c[i]=6*t3<1?t1+6*(t2-t1)*t3:2*t3<1?t2:3*t3<2?t1+(t2-t1)*(2/3-t3)*6:t1}return c},"rgb-gray":function(r,g,b){return[.2989*r+.587*g+.114*b]},"gray-rgb":function(g){return[g,g,g]},"gray-hsb":function(g){return[0,0,g]},"gray-hsl":function(g){return[0,0,g]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return Base.each(types,(function(properties,type){componentParsers[type]=[],Base.each(properties,(function(name,index){var part=Base.capitalize(name),hasOverlap=/^(hue|saturation)$/.test(name),parser=componentParsers[type][index]="gradient"===type?"gradient"===name?function(value){var current=this._components[0];return current!==(value=Gradient.read(Array.isArray(value)?value:arguments,0,{readNull:!0}))&&(current&&current._removeOwner(this),value&&value._addOwner(this)),value}:function(){return Point.read(arguments,0,{readNull:"highlight"===name,clone:!0})}:function(value){return null==value||isNaN(value)?0:+value};this["get"+part]=function(){return this._type===type||hasOverlap&&/^hs[bl]$/.test(this._type)?this._components[index]:this._convert(type)[index]},this["set"+part]=function(value){this._type===type||hasOverlap&&/^hs[bl]$/.test(this._type)||(this._components=this._convert(type),this._properties=types[type],this._type=type),this._components[index]=parser.call(this,value),this._changed()}}),this)}),{_class:"Color",_readIndex:!0,initialize:function Color(arg){var type,components,alpha,values,args=arguments,reading=this.__read,read=0;Array.isArray(arg)&&(arg=(args=arg)[0]);var argType=null!=arg&&typeof arg;if("string"===argType&&arg in types&&(type=arg,arg=args[1],Array.isArray(arg)?(components=arg,alpha=args[2]):(reading&&(read=1),args=Base.slice(args,1),argType=typeof arg)),!components){if(values="number"===argType?args:"object"===argType&&null!=arg.length?arg:null){type||(type=values.length>=3?"rgb":"gray");var length=types[type].length;alpha=values[length],reading&&(read+=values===arguments?length+(null!=alpha?1:0):1),values.length>length&&(values=Base.slice(values,0,length))}else if("string"===argType){var converted=function fromCSS(string){var components,match=string.match(/^#([\da-f]{2})([\da-f]{2})([\da-f]{2})([\da-f]{2})?$/i)||string.match(/^#([\da-f])([\da-f])([\da-f])([\da-f])?$/i),type="rgb";if(match){var amount=match[4]?4:3;components=new Array(amount);for(var i=0;i<amount;i++){var value=match[i+1];components[i]=parseInt(1==value.length?value+value:value,16)/255}}else if(match=string.match(/^(rgb|hsl)a?\((.*)\)$/)){type=match[1],components=match[2].trim().split(/[,\s]+/g);for(var isHSL="hsl"===type,l=(i=0,Math.min(components.length,4));i<l;i++){var component=components[i];if(value=parseFloat(component),isHSL)if(0===i){var unit=component.match(/([a-z]*)$/)[1];value*={turn:360,rad:180/Math.PI,grad:.9}[unit]||1}else i<3&&(value/=100);else i<3&&(value/=/%$/.test(component)?100:255);components[i]=value}}else{var color=namedColors[string];if(!color)if(window){colorCtx||((colorCtx=CanvasProvider.getContext(1,1,{willReadFrequently:!0})).globalCompositeOperation="copy"),colorCtx.fillStyle="rgba(0,0,0,0)",colorCtx.fillStyle=string,colorCtx.fillRect(0,0,1,1);var data=colorCtx.getImageData(0,0,1,1).data;color=namedColors[string]=[data[0]/255,data[1]/255,data[2]/255]}else color=[0,0,0];components=color.slice()}return[type,components]}(arg);type=converted[0],4===(components=converted[1]).length&&(alpha=components[3],components.length--)}else if("object"===argType)if(arg.constructor===Color){if(type=arg._type,components=arg._components.slice(),alpha=arg._alpha,"gradient"===type)for(var i=1,l=components.length;i<l;i++){var point=components[i];point&&(components[i]=point.clone())}}else if(arg.constructor===Gradient)type="gradient",values=args;else{var properties=types[type="hue"in arg?"lightness"in arg?"hsl":"hsb":"gradient"in arg||"stops"in arg||"radial"in arg?"gradient":"gray"in arg?"gray":"rgb"],parsers=componentParsers[type];this._components=components=[];for(i=0,l=properties.length;i<l;i++){null==(value=arg[properties[i]])&&!i&&"gradient"===type&&"stops"in arg&&(value={stops:arg.stops,radial:arg.radial}),null!=(value=parsers[i].call(this,value))&&(components[i]=value)}alpha=arg.alpha}reading&&type&&(read=1)}if(this._type=type||"rgb",!components){this._components=components=[];for(i=0,l=(parsers=componentParsers[this._type]).length;i<l;i++){var value;null!=(value=parsers[i].call(this,values&&values[i]))&&(components[i]=value)}}return this._components=components,this._properties=types[this._type],this._alpha=alpha,reading&&(this.__read=read),this},set:"#initialize",_serialize:function(options,dictionary){var components=this.getComponents();return Base.serialize(/^(gray|rgb)$/.test(this._type)?components:[this._type].concat(components),options,!0,dictionary)},_changed:function(){this._canvasStyle=null,this._owner&&(this._setter?this._owner[this._setter](this):this._owner._changed(129))},_convert:function(type){var converter;return this._type===type?this._components.slice():(converter=converters[this._type+"-"+type])?converter.apply(this,this._components):converters["rgb-"+type].apply(this,converters[this._type+"-rgb"].apply(this,this._components))},convert:function(type){return new Color(type,this._convert(type),this._alpha)},getType:function(){return this._type},setType:function(type){this._components=this._convert(type),this._properties=types[type],this._type=type},getComponents:function(){var components=this._components.slice();return null!=this._alpha&&components.push(this._alpha),components},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(alpha){this._alpha=null==alpha?null:Math.min(Math.max(alpha,0),1),this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(color){var col=Base.isPlainValue(color,!0)?Color.read(arguments):color;return col===this||col&&this._class===col._class&&this._type===col._type&&this.getAlpha()===col.getAlpha()&&Base.equals(this._components,col._components)||!1},toString:function(){for(var properties=this._properties,parts=[],isGradient="gradient"===this._type,f=Formatter.instance,i=0,l=properties.length;i<l;i++){var value=this._components[i];null!=value&&parts.push(properties[i]+": "+(isGradient?value:f.number(value)))}return null!=this._alpha&&parts.push("alpha: "+f.number(this._alpha)),"{ "+parts.join(", ")+" }"},toCSS:function(hex){var components=this._convert("rgb"),alpha=hex||null==this._alpha?1:this._alpha;function convert(val){return Math.round(255*(val<0?0:val>1?1:val))}return components=[convert(components[0]),convert(components[1]),convert(components[2])],alpha<1&&components.push(alpha<0?0:alpha),hex?"#"+((1<<24)+(components[0]<<16)+(components[1]<<8)+components[2]).toString(16).slice(1):(4==components.length?"rgba(":"rgb(")+components.join(",")+")"},toCanvasStyle:function(ctx,matrix){if(this._canvasStyle)return this._canvasStyle;if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var canvasGradient,components=this._components,gradient=components[0],stops=gradient._stops,origin=components[1],destination=components[2],highlight=components[3],inverse=matrix&&matrix.inverted();if(inverse&&(origin=inverse._transformPoint(origin),destination=inverse._transformPoint(destination),highlight&&(highlight=inverse._transformPoint(highlight))),gradient._radial){var radius=destination.getDistance(origin);if(highlight){var vector=highlight.subtract(origin);vector.getLength()>radius&&(highlight=origin.add(vector.normalize(radius-.1)))}var start=highlight||origin;canvasGradient=ctx.createRadialGradient(start.x,start.y,0,origin.x,origin.y,radius)}else canvasGradient=ctx.createLinearGradient(origin.x,origin.y,destination.x,destination.y);for(var i=0,l=stops.length;i<l;i++){var stop=stops[i],offset=stop._offset;canvasGradient.addColorStop(null==offset?i/(l-1):offset,stop._color.toCanvasStyle())}return this._canvasStyle=canvasGradient},transform:function(matrix){if("gradient"===this._type){for(var components=this._components,i=1,l=components.length;i<l;i++){var point=components[i];matrix._transformPoint(point,point,!0)}this._changed()}},statics:{_types:types,random:function(){var random=Math.random;return new Color(random(),random(),random())},_setOwner:function(color,owner,setter){return color&&(color._owner&&owner&&color._owner!==owner&&(color=color.clone()),!color._owner^!owner&&(color._owner=owner||null,color._setter=setter||null)),color}}})},new function(){return Base.each({add:function(a,b){return a+b},subtract:function(a,b){return a-b},multiply:function(a,b){return a*b},divide:function(a,b){return a/b}},(function(operator,name){this[name]=function(color){color=Color.read(arguments);for(var type=this._type,components1=this._components,components2=color._convert(type),i=0,l=components1.length;i<l;i++)components2[i]=operator(components1[i],components2[i]);return new Color(type,components2,null!=this._alpha?operator(this._alpha,color.getAlpha()):null)}}),{})}),Gradient=Base.extend({_class:"Gradient",initialize:function Gradient(stops,radial){this._id=UID.get(),stops&&Base.isPlainObject(stops)&&(this.set(stops),stops=radial=null),null==this._stops&&this.setStops(stops||["white","black"]),null==this._radial&&this.setRadial("string"==typeof radial&&"radial"===radial||radial||!1)},_serialize:function(options,dictionary){return dictionary.add(this,(function(){return Base.serialize([this._stops,this._radial],options,!0,dictionary)}))},_changed:function(){for(var i=0,l=this._owners&&this._owners.length;i<l;i++)this._owners[i]._changed()},_addOwner:function(color){this._owners||(this._owners=[]),this._owners.push(color)},_removeOwner:function(color){var index=this._owners?this._owners.indexOf(color):-1;-1!=index&&(this._owners.splice(index,1),this._owners.length||(this._owners=undefined))},clone:function(){for(var stops=[],i=0,l=this._stops.length;i<l;i++)stops[i]=this._stops[i].clone();return new Gradient(stops,this._radial)},getStops:function(){return this._stops},setStops:function(stops){if(stops.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var _stops=this._stops;if(_stops)for(var i=0,l=_stops.length;i<l;i++)_stops[i]._owner=undefined;for(i=0,l=(_stops=this._stops=GradientStop.readList(stops,0,{clone:!0})).length;i<l;i++)_stops[i]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(radial){this._radial=radial,this._changed()},equals:function(gradient){if(gradient===this)return!0;if(gradient&&this._class===gradient._class){var stops1=this._stops,stops2=gradient._stops,length=stops1.length;if(length===stops2.length){for(var i=0;i<length;i++)if(!stops1[i].equals(stops2[i]))return!1;return!0}}return!1}}),GradientStop=Base.extend({_class:"GradientStop",initialize:function GradientStop(arg0,arg1){var color=arg0,offset=arg1;"object"==typeof arg0&&arg1===undefined&&(Array.isArray(arg0)&&"number"!=typeof arg0[0]?(color=arg0[0],offset=arg0[1]):("color"in arg0||"offset"in arg0||"rampPoint"in arg0)&&(color=arg0.color,offset=arg0.offset||arg0.rampPoint||0)),this.setColor(color),this.setOffset(offset)},clone:function(){return new GradientStop(this._color.clone(),this._offset)},_serialize:function(options,dictionary){var color=this._color,offset=this._offset;return Base.serialize(null==offset?[color]:[color,offset],options,!0,dictionary)},_changed:function(){this._owner&&this._owner._changed(129)},getOffset:function(){return this._offset},setOffset:function(offset){this._offset=offset,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){Color._setOwner(this._color,null),this._color=Color._setOwner(Color.read(arguments,0),this,"setColor"),this._changed()},equals:function(stop){return stop===this||stop&&this._class===stop._class&&this._color.equals(stop._color)&&this._offset==stop._offset||!1}}),Style=Base.extend(new function(){var itemDefaults={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new Point,selectedColor:null},groupDefaults=Base.set({},itemDefaults,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),textDefaults=Base.set({},groupDefaults,{fillColor:new Color}),flags={strokeWidth:193,strokeCap:193,strokeJoin:193,strokeScaling:201,miterLimit:193,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},item={beans:!0},fields={_class:"Style",beans:!0,initialize:function Style(style,_owner,_project){this._values={},this._owner=_owner,this._project=_owner&&_owner._project||_project||paper.project,this._defaults=!_owner||_owner instanceof Group?groupDefaults:_owner instanceof TextItem?textDefaults:itemDefaults,style&&this.set(style)}};return Base.each(groupDefaults,(function(value,key){var isColor=/Color$/.test(key),isPoint="shadowOffset"===key,part=Base.capitalize(key),flag=flags[key],set="set"+part,get="get"+part;fields[set]=function(value){var owner=this._owner,children=owner&&owner._children,applyToChildren=children&&children.length>0&&!(owner instanceof CompoundPath);if(applyToChildren)for(var i=0,l=children.length;i<l;i++)children[i]._style[set](value);if(("selectedColor"===key||!applyToChildren)&&key in this._defaults){var old=this._values[key];old!==value&&(isColor&&(old&&(Color._setOwner(old,null),old._canvasStyle=null),value&&value.constructor===Color&&(value=Color._setOwner(value,owner,applyToChildren&&set))),this._values[key]=value,owner&&owner._changed(flag||129))}},fields[get]=function(_dontMerge){var owner=this._owner,children=owner&&owner._children,applyToChildren=children&&children.length>0&&!(owner instanceof CompoundPath);if(applyToChildren&&!_dontMerge)for(var i=0,l=children.length;i<l;i++){var childValue=children[i]._style[get]();if(i){if(!Base.equals(value,childValue))return undefined}else value=childValue}else if(key in this._defaults){var value;if((value=this._values[key])===undefined)(value=this._defaults[key])&&value.clone&&(value=value.clone());else{var ctor=isColor?Color:isPoint?Point:null;!ctor||value&&value.constructor===ctor||(this._values[key]=value=ctor.read([value],0,{readNull:!0,clone:!0}))}}return value&&isColor&&(value=Color._setOwner(value,owner,applyToChildren&&set)),value},item[get]=function(_dontMerge){return this._style[get](_dontMerge)},item[set]=function(value){this._style[set](value)}})),Base.each({Font:"FontFamily",WindingRule:"FillRule"},(function(value,key){var get="get"+key,set="set"+key;fields[get]=item[get]="#get"+value,fields[set]=item[set]="#set"+value})),Item.inject(item),fields},{set:function(style){var isStyle=style instanceof Style,values=isStyle?style._values:style;if(values)for(var key in values)if(key in this._defaults){var value=values[key];this[key]=value&&isStyle&&value.clone?value.clone():value}},equals:function(style){function compare(style1,style2,secondary){var values1=style1._values,values2=style2._values,defaults2=style2._defaults;for(var key in values1){var value1=values1[key],value2=values2[key];if(!(secondary&&key in values2||Base.equals(value1,value2===undefined?defaults2[key]:value2)))return!1}return!0}return style===this||style&&this._class===style._class&&compare(this,style)&&compare(style,this,!0)||!1},_dispose:function(){var color;(color=this.getFillColor())&&(color._canvasStyle=null),(color=this.getStrokeColor())&&(color._canvasStyle=null),(color=this.getShadowColor())&&(color._canvasStyle=null)},hasFill:function(){var color=this.getFillColor();return!!color&&color.alpha>0},hasStroke:function(){var color=this.getStrokeColor();return!!color&&color.alpha>0&&this.getStrokeWidth()>0},hasShadow:function(){var color=this.getShadowColor();return!!color&&color.alpha>0&&(this.getShadowBlur()>0||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var fontSize=this.getFontSize();return this.getFontWeight()+" "+fontSize+(/[a-z]/i.test(fontSize+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function getLeading(){var leading=getLeading.base.call(this),fontSize=this.getFontSize();return/pt|em|%|px/.test(fontSize)&&(fontSize=this.getView().getPixelSize(fontSize)),null!=leading?leading:1.2*fontSize}}),DomElement=new function(){function handlePrefix(el,name,set,value){for(var prefixes=["","webkit","moz","Moz","ms","o"],suffix=name[0].toUpperCase()+name.substring(1),i=0;i<6;i++){var prefix=prefixes[i],key=prefix?prefix+suffix:name;if(key in el){if(!set)return el[key];el[key]=value;break}}}return{getStyles:function(el){var doc=el&&9!==el.nodeType?el.ownerDocument:el,view=doc&&doc.defaultView;return view&&view.getComputedStyle(el,"")},getBounds:function(el,viewport){var rect,doc=el.ownerDocument,body=doc.body,html=doc.documentElement;try{rect=el.getBoundingClientRect()}catch(e){rect={left:0,top:0,width:0,height:0}}var x=rect.left-(html.clientLeft||body.clientLeft||0),y=rect.top-(html.clientTop||body.clientTop||0);if(!viewport){var view=doc.defaultView;x+=view.pageXOffset||html.scrollLeft||body.scrollLeft,y+=view.pageYOffset||html.scrollTop||body.scrollTop}return new Rectangle(x,y,rect.width,rect.height)},getViewportBounds:function(el){var doc=el.ownerDocument,view=doc.defaultView,html=doc.documentElement;return new Rectangle(0,0,view.innerWidth||html.clientWidth,view.innerHeight||html.clientHeight)},getOffset:function(el,viewport){return DomElement.getBounds(el,viewport).getPoint()},getSize:function(el){return DomElement.getBounds(el,!0).getSize()},isInvisible:function(el){return DomElement.getSize(el).equals(new Size(0,0))},isInView:function(el){return!DomElement.isInvisible(el)&&DomElement.getViewportBounds(el).intersects(DomElement.getBounds(el,!0))},isInserted:function(el){return document.body.contains(el)},getPrefixed:function(el,name){return el&&handlePrefix(el,name)},setPrefixed:function(el,name,value){if("object"==typeof name)for(var key in name)handlePrefix(el,key,!0,name[key]);else handlePrefix(el,name,!0,value)}}},DomEvent={add:function(el,events){if(el)for(var type in events)for(var func=events[type],parts=type.split(/[\s,]+/g),i=0,l=parts.length;i<l;i++){var name=parts[i],options=el===document&&("touchstart"===name||"touchmove"===name)&&{passive:!1};el.addEventListener(name,func,options)}},remove:function(el,events){if(el)for(var type in events)for(var func=events[type],parts=type.split(/[\s,]+/g),i=0,l=parts.length;i<l;i++)el.removeEventListener(parts[i],func,!1)},getPoint:function(event){var pos=event.targetTouches?event.targetTouches.length?event.targetTouches[0]:event.changedTouches[0]:event;return new Point(pos.pageX||pos.clientX+document.documentElement.scrollLeft,pos.pageY||pos.clientY+document.documentElement.scrollTop)},getTarget:function(event){return event.target||event.srcElement},getRelatedTarget:function(event){return event.relatedTarget||event.toElement},getOffset:function(event,target){return DomEvent.getPoint(event).subtract(DomElement.getOffset(target||DomEvent.getTarget(event)))}};DomEvent.requestAnimationFrame=new function(){var timer,nativeRequest=DomElement.getPrefixed(window,"requestAnimationFrame"),requested=!1,callbacks=[];function handleCallbacks(){var functions=callbacks;callbacks=[];for(var i=0,l=functions.length;i<l;i++)functions[i]();(requested=nativeRequest&&callbacks.length)&&nativeRequest(handleCallbacks)}return function(callback){callbacks.push(callback),nativeRequest?requested||(nativeRequest(handleCallbacks),requested=!0):timer||(timer=setInterval(handleCallbacks,1e3/60))}};var View=Base.extend(Emitter,{_class:"View",initialize:function View(project,element){function getSize(name){return element[name]||parseInt(element.getAttribute(name),10)}function getCanvasSize(){var size=DomElement.getSize(element);return size.isNaN()||size.isZero()?new Size(getSize("width"),getSize("height")):size}var size;if(window&&element){this._id=element.getAttribute("id"),null==this._id&&element.setAttribute("id",this._id="paper-view-"+View._id++),DomEvent.add(element,this._viewEvents);if(DomElement.setPrefixed(element.style,{userDrag:"none",userSelect:"none",touchCallout:"none",contentZooming:"none",tapHighlightColor:"rgba(0,0,0,0)"}),PaperScope.hasAttribute(element,"resize")){var that=this;DomEvent.add(window,this._windowEvents={resize:function(){that.setViewSize(getCanvasSize())}})}if(size=getCanvasSize(),PaperScope.hasAttribute(element,"stats")&&"undefined"!=typeof Stats){this._stats=new Stats;var stats=this._stats.domElement,style=stats.style,offset=DomElement.getOffset(element);style.position="absolute",style.left=offset.x+"px",style.top=offset.y+"px",document.body.appendChild(stats)}}else size=new Size(element),element=null;this._project=project,this._scope=project._scope,this._element=element,this._pixelRatio||(this._pixelRatio=window&&window.devicePixelRatio||1),this._setElementSize(size.width,size.height),this._viewSize=size,View._views.push(this),View._viewsById[this._id]=this,(this._matrix=new Matrix)._owner=this,View._focused||(View._focused=this),this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!paper.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;View._focused===this&&(View._focused=null),View._views.splice(View._views.indexOf(this),1),delete View._viewsById[this._id];var project=this._project;return project._view===this&&(project._view=null),DomEvent.remove(this._element,this._viewEvents),DomEvent.remove(window,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:Base.each(Item._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),(function(name){this[name]={}}),{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(autoUpdate){this._autoUpdate=autoUpdate,autoUpdate&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var that=this;DomEvent.requestAnimationFrame((function(){if(that._requested=!1,that._animate){that.requestUpdate();var element=that._element;DomElement.getPrefixed(document,"hidden")&&"true"!==PaperScope.getAttribute(element,"keepalive")||!DomElement.isInView(element)||that._handleFrame()}that._autoUpdate&&that.update()})),this._requested=!0}},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){paper=this._scope;var now=Date.now()/1e3,delta=this._last?now-this._last:0;this._last=now,this.emit("frame",new Base({delta,time:this._time+=delta,count:this._count++})),this._stats&&this._stats.update()},_animateItem:function(item,animate){var items=this._frameItems;animate?(items[item._id]={item,time:0,count:0},1==++this._frameItemCount&&this.on("frame",this._handleFrameItems)):(delete items[item._id],0==--this._frameItemCount&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(event){for(var i in this._frameItems){var entry=this._frameItems[i];entry.item.emit("frame",new Base(event,{time:entry.time+=event.delta,count:entry.count++}))}},_changed:function(){this._project._changed(4097),this._bounds=this._decomposed=undefined},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return 72*this._pixelRatio},getViewSize:function(){var size=this._viewSize;return new LinkedSize(size.width,size.height,this,"setViewSize")},setViewSize:function(){var size=Size.read(arguments),delta=size.subtract(this._viewSize);delta.isZero()||(this._setElementSize(size.width,size.height),this._viewSize.set(size),this._changed(),this.emit("resize",{size,delta}),this._autoUpdate&&this.update())},_setElementSize:function(width,height){var element=this._element;element&&(element.width!==width&&(element.width=width),element.height!==height&&(element.height=height))},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new Rectangle(new Point,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return DomElement.isInView(this._element)},isInserted:function(){return DomElement.isInserted(this._element)},getPixelSize:function(size){var pixels,element=this._element;if(element){var parent=element.parentNode,temp=document.createElement("div");temp.style.fontSize=size,parent.appendChild(temp),pixels=parseFloat(DomElement.getStyles(temp).fontSize),parent.removeChild(temp)}else pixels=parseFloat(pixels);return pixels},getTextWidth:function(font,lines){return 0}},Base.each(["rotate","scale","shear","skew"],(function(key){var rotate="rotate"===key;this[key]=function(){var args=arguments,value=(rotate?Base:Point).read(args),center=Point.read(args,0,{readNull:!0});return this.transform((new Matrix)[key](value,center||this.getCenter(!0)))}}),{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var mx=new Matrix;return this.transform(mx.translate.apply(mx,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var center=Point.read(arguments);this.translate(this.getCenter().subtract(center))},getZoom:function(){var scaling=this._decompose().scaling;return(scaling.x+scaling.y)/2},setZoom:function(zoom){this.transform((new Matrix).scale(zoom/this.getZoom(),this.getCenter()))},getRotation:function(){return this._decompose().rotation},setRotation:function(rotation){var current=this.getRotation();null!=current&&null!=rotation&&this.rotate(rotation-current)},getScaling:function(){var scaling=this._decompose().scaling;return new LinkedPoint(scaling.x,scaling.y,this,"setScaling")},setScaling:function(){var current=this.getScaling(),scaling=Point.read(arguments,0,{clone:!0,readNull:!0});current&&scaling&&this.scale(scaling.x/current.x,scaling.y/current.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var matrix=this._matrix;matrix.set.apply(matrix,arguments)},transform:function(matrix){this._matrix.append(matrix)},scrollBy:function(){this.translate(Point.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(Point.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(Point.read(arguments))},getEventPoint:function(event){return this.viewToProject(DomEvent.getOffset(event,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(project,element){return document&&"string"==typeof element&&(element=document.getElementById(element)),new(window?CanvasView:View)(project,element)}}},new function(){if(window){var prevFocus,tempFocus,mousedown,mousemove,mouseup,dragging=!1,mouseDown=!1,navigator=window.navigator;navigator.pointerEnabled||navigator.msPointerEnabled?(mousedown="pointerdown MSPointerDown",mousemove="pointermove MSPointerMove",mouseup="pointerup pointercancel MSPointerUp MSPointerCancel"):(mousedown="touchstart",mousemove="touchmove",mouseup="touchend touchcancel","ontouchstart"in window&&navigator.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(mousedown+=" mousedown",mousemove+=" mousemove",mouseup+=" mouseup"));var viewEvents={},docEvents={mouseout:function(event){var view=View._focused,target=DomEvent.getRelatedTarget(event);if(view&&(!target||"HTML"===target.nodeName)){var offset=DomEvent.getOffset(event,view._element),x=offset.x,abs=Math.abs,ax=abs(x),diff=ax-(1<<25);offset.x=abs(diff)<ax?diff*(x<0?-1:1):x,handleMouseMove(view,event,view.viewToProject(offset))}},scroll:updateFocus};viewEvents[mousedown]=function(event){var view=View._focused=getView(event);dragging||(dragging=!0,view._handleMouseEvent("mousedown",event))},docEvents[mousemove]=function(event){var view=View._focused;if(!mouseDown){var target=getView(event);target?view!==target&&(view&&handleMouseMove(view,event),prevFocus||(prevFocus=view),view=View._focused=tempFocus=target):tempFocus&&tempFocus===view&&(prevFocus&&!prevFocus.isInserted()&&(prevFocus=null),view=View._focused=prevFocus,prevFocus=null,updateFocus())}view&&handleMouseMove(view,event)},docEvents[mousedown]=function(){mouseDown=!0},docEvents[mouseup]=function(event){var view=View._focused;view&&dragging&&view._handleMouseEvent("mouseup",event),mouseDown=dragging=!1},DomEvent.add(document,docEvents),DomEvent.add(window,{load:updateFocus});var downPoint,lastPoint,downItem,overItem,dragItem,clickItem,clickTime,dblClick,called=!1,prevented=!1,fallbacks={doubleclick:"click",mousedrag:"mousemove"},wasInView=!1,itemEventsMap={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:viewEvents,_handleMouseEvent:function(type,event,point){var itemEvents=this._itemEvents,hitItems=itemEvents.native[type],nativeMove="mousemove"===type,tool=this._scope.tool,view=this;function responds(type){return itemEvents.virtual[type]||view.responds(type)||tool&&tool.responds(type)}nativeMove&&dragging&&responds("mousedrag")&&(type="mousedrag"),point||(point=this.getEventPoint(event));var inView=this.getBounds().contains(point),hit=hitItems&&inView&&view._project.hitTest(point,{tolerance:0,fill:!0,stroke:!0}),hitItem=hit&&hit.item||null,handle=!1,mouse={};if(mouse[type.substr(5)]=!0,hitItems&&hitItem!==overItem&&(overItem&&emitMouseEvent(overItem,null,"mouseleave",event,point),hitItem&&emitMouseEvent(hitItem,null,"mouseenter",event,point),overItem=hitItem),wasInView^inView&&(emitMouseEvent(this,null,inView?"mouseenter":"mouseleave",event,point),inView?this:null,handle=!0),!inView&&!mouse.drag||point.equals(lastPoint)||(emitMouseEvents(this,hitItem,nativeMove?type:"mousemove",event,point,lastPoint),handle=!0),wasInView=inView,mouse.down&&inView||mouse.up&&downPoint){if(emitMouseEvents(this,hitItem,type,event,point,downPoint),mouse.down){if(dblClick=hitItem===clickItem&&Date.now()-clickTime<300,downItem=clickItem=hitItem,!prevented&&hitItem){for(var item=hitItem;item&&!item.responds("mousedrag");)item=item._parent;item&&(dragItem=hitItem)}downPoint=point}else mouse.up&&(prevented||hitItem!==downItem||(clickTime=Date.now(),emitMouseEvents(this,hitItem,dblClick?"doubleclick":"click",event,point,downPoint),dblClick=!1),downItem=dragItem=null);wasInView=!1,handle=!0}lastPoint=point,handle&&tool&&(called=tool._handleMouseEvent(type,event,point,mouse)||called),!1!==event.cancelable&&(called&&!mouse.move||mouse.down&&responds("mouseup"))&&event.preventDefault()},_handleKeyEvent:function(type,event,key,character){var keyEvent,scope=this._scope,tool=scope.tool;function emit(obj){obj.responds(type)&&(paper=scope,obj.emit(type,keyEvent=keyEvent||new KeyEvent(type,event,key,character)))}this.isVisible()&&(emit(this),tool&&tool.responds(type)&&emit(tool))},_countItemEvent:function(type,sign){var itemEvents=this._itemEvents,native=itemEvents.native,virtual=itemEvents.virtual;for(var key in itemEventsMap)native[key]=(native[key]||0)+(itemEventsMap[key][type]||0)*sign;virtual[type]=(virtual[type]||0)+sign},statics:{updateFocus,_resetState:function(){dragging=mouseDown=called=wasInView=!1,prevFocus=tempFocus=downPoint=lastPoint=downItem=overItem=dragItem=clickItem=clickTime=dblClick=null}}}}function getView(event){var target=DomEvent.getTarget(event);return target.getAttribute&&View._viewsById[target.getAttribute("id")]}function updateFocus(){var view=View._focused;if(!view||!view.isVisible())for(var i=0,l=View._views.length;i<l;i++)if((view=View._views[i]).isVisible()){View._focused=tempFocus=view;break}}function handleMouseMove(view,event,point){view._handleMouseEvent("mousemove",event,point)}function emitMouseEvent(obj,target,type,event,point,prevPoint,stopItem){var mouseEvent,stopped=!1;function emit(obj,type){if(obj.responds(type)){if(mouseEvent||(mouseEvent=new MouseEvent(type,event,point,target||obj,prevPoint?point.subtract(prevPoint):null)),obj.emit(type,mouseEvent)&&(called=!0,mouseEvent.prevented&&(prevented=!0),mouseEvent.stopped))return stopped=!0}else{var fallback=fallbacks[type];if(fallback)return emit(obj,fallback)}}for(;obj&&obj!==stopItem&&!emit(obj,type);)obj=obj._parent;return stopped}function emitMouseEvents(view,hitItem,type,event,point,prevPoint){return view._project.removeOn(type),prevented=called=!1,dragItem&&emitMouseEvent(dragItem,null,type,event,point,prevPoint)||hitItem&&hitItem!==dragItem&&!hitItem.isDescendant(dragItem)&&emitMouseEvent(hitItem,null,"mousedrag"===type?"mousemove":type,event,point,prevPoint,dragItem)||emitMouseEvent(view,dragItem||hitItem||view,type,event,point,prevPoint)}}),CanvasView=View.extend({_class:"CanvasView",initialize:function CanvasView(project,canvas){if(!(canvas instanceof window.HTMLCanvasElement)){var size=Size.read(arguments,1);if(size.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+Base.slice(arguments,1));canvas=CanvasProvider.getCanvas(size)}var ctx=this._context=canvas.getContext("2d");if(ctx.save(),this._pixelRatio=1,!/^off|false$/.test(PaperScope.getAttribute(canvas,"hidpi"))){var deviceRatio=window.devicePixelRatio||1,backingStoreRatio=DomElement.getPrefixed(ctx,"backingStorePixelRatio")||1;this._pixelRatio=deviceRatio/backingStoreRatio}View.call(this,project,canvas),this._needsUpdate=!0},remove:function remove(){return this._context.restore(),remove.base.call(this)},_setElementSize:function _setElementSize(width,height){var pixelRatio=this._pixelRatio;if(_setElementSize.base.call(this,width*pixelRatio,height*pixelRatio),1!==pixelRatio){var element=this._element,ctx=this._context;if(!PaperScope.hasAttribute(element,"resize")){var style=element.style;style.width=width+"px",style.height=height+"px"}ctx.restore(),ctx.save(),ctx.scale(pixelRatio,pixelRatio)}},getContext:function(){return this._context},getPixelSize:function getPixelSize(size){var pixels,agent=paper.agent;if(agent&&agent.firefox)pixels=getPixelSize.base.call(this,size);else{var ctx=this._context,prevFont=ctx.font;ctx.font=size+" serif",pixels=parseFloat(ctx.font),ctx.font=prevFont}return pixels},getTextWidth:function(font,lines){var ctx=this._context,prevFont=ctx.font,width=0;ctx.font=font;for(var i=0,l=lines.length;i<l;i++)width=Math.max(width,ctx.measureText(lines[i]).width);return ctx.font=prevFont,width},update:function(){if(!this._needsUpdate)return!1;var project=this._project,ctx=this._context,size=this._viewSize;return ctx.clearRect(0,0,size.width+1,size.height+1),project&&project.draw(ctx,this._matrix,this._pixelRatio),this._needsUpdate=!1,!0}}),Event=Base.extend({_class:"Event",initialize:function Event(event){this.event=event,this.type=event&&event.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return Key.modifiers}}),KeyEvent=Event.extend({_class:"KeyEvent",initialize:function KeyEvent(type,event,key,character){this.type=type,this.event=event,this.key=key,this.character=character},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),Key=new function(){var metaFixMap,downKey,keyLookup={"\t":"tab"," ":"space","\b":"backspace","":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},charLookup={tab:"\t",space:" ",enter:"\r"},keyMap={},charMap={},modifiers=new Base({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var agent=paper&&paper.agent;return agent&&agent.mac?this.meta:this.control}}});function getKey(event){var key=event.key||event.keyIdentifier;return key=/^U\+/.test(key)?String.fromCharCode(parseInt(key.substr(2),16)):/^Arrow[A-Z]/.test(key)?key.substr(5):"Unidentified"===key||key===undefined?String.fromCharCode(event.keyCode):key,keyLookup[key]||(key.length>1?Base.hyphenate(key):key.toLowerCase())}function handleKey(down,key,character,event){var name,view=View._focused;if(keyMap[key]=down,down?charMap[key]=character:delete charMap[key],key.length>1&&(name=Base.camelize(key))in modifiers){modifiers[name]=down;var agent=paper&&paper.agent;if("meta"===name&&agent&&agent.mac)if(down)metaFixMap={};else{for(var k in metaFixMap)k in charMap&&handleKey(!1,k,metaFixMap[k],event);metaFixMap=null}}else down&&metaFixMap&&(metaFixMap[key]=character);view&&view._handleKeyEvent(down?"keydown":"keyup",event,key,character)}return DomEvent.add(document,{keydown:function(event){var key=getKey(event),agent=paper&&paper.agent;key.length>1||agent&&agent.chrome&&(event.altKey||agent.mac&&event.metaKey||!agent.mac&&event.ctrlKey)?handleKey(!0,key,charLookup[key]||(key.length>1?"":key),event):downKey=key},keypress:function(event){if(downKey){var key=getKey(event),code=event.charCode,character=code>=32?String.fromCharCode(code):key.length>1?"":key;key!==downKey&&(key=character.toLowerCase()),handleKey(!0,key,character,event),downKey=null}},keyup:function(event){var key=getKey(event);key in charMap&&handleKey(!1,key,charMap[key],event)}}),DomEvent.add(window,{blur:function(event){for(var key in charMap)handleKey(!1,key,charMap[key],event)}}),{modifiers,isDown:function(key){return!!keyMap[key]}}},MouseEvent=Event.extend({_class:"MouseEvent",initialize:function MouseEvent(type,event,point,target,delta){this.type=type,this.event=event,this.point=point,this.target=target,this.delta=delta},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),ToolEvent=Event.extend({_class:"ToolEvent",_item:null,initialize:function ToolEvent(tool,type,event){this.tool=tool,this.type=type,this.event=event},_choosePoint:function(point,toolPoint){return point||(toolPoint?toolPoint.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(point){this._point=point},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(lastPoint){this._lastPoint=lastPoint},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(downPoint){this._downPoint=downPoint},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(middlePoint){this._middlePoint=middlePoint},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(delta){this._delta=delta},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(count){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=count},getItem:function(){if(!this._item){var result=this.tool._scope.project.hitTest(this.getPoint());if(result){for(var item=result.item,parent=item._parent;/^(Group|CompoundPath)$/.test(parent._class);)item=parent,parent=parent._parent;this._item=item}}return this._item},setItem:function(item){this._item=item},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),Tool=PaperScopeItem.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function Tool(props){PaperScopeItem.call(this),this._moveCount=-1,this._downCount=-1,this.set(props)},getMinDistance:function(){return this._minDistance},setMinDistance:function(minDistance){this._minDistance=minDistance,null!=minDistance&&null!=this._maxDistance&&minDistance>this._maxDistance&&(this._maxDistance=minDistance)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(maxDistance){this._maxDistance=maxDistance,null!=this._minDistance&&null!=maxDistance&&maxDistance<this._minDistance&&(this._minDistance=maxDistance)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(distance){this._minDistance=this._maxDistance=distance},_handleMouseEvent:function(type,event,point,mouse){paper=this._scope,mouse.drag&&!this.responds(type)&&(type="mousemove");var move=mouse.move||mouse.drag,responds=this.responds(type),minDistance=this.minDistance,maxDistance=this.maxDistance,called=!1,tool=this;function update(minDistance,maxDistance){var pt=point,toolPoint=move?tool._point:tool._downPoint||pt;if(move){if(tool._moveCount>=0&&pt.equals(toolPoint))return!1;if(toolPoint&&(null!=minDistance||null!=maxDistance)){var vector=pt.subtract(toolPoint),distance=vector.getLength();if(distance<(minDistance||0))return!1;maxDistance&&(pt=toolPoint.add(vector.normalize(Math.min(distance,maxDistance))))}tool._moveCount++}return tool._point=pt,tool._lastPoint=toolPoint||pt,mouse.down&&(tool._moveCount=-1,tool._downPoint=pt,tool._downCount++),!0}function emit(){responds&&(called=tool.emit(type,new ToolEvent(tool,type,event))||called)}if(mouse.down)update(),emit();else if(mouse.up)update(null,maxDistance),emit();else if(responds)for(;update(minDistance,maxDistance);)emit();return called}}),Tween=Base.extend(Emitter,{_class:"Tween",statics:{easings:new Base({linear:function(t){return t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return t*(2-t)},easeInOutQuad:function(t){return t<.5?2*t*t:2*(2-t)*t-1},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return--t*t*t+1},easeInOutCubic:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},easeInQuart:function(t){return t*t*t*t},easeOutQuart:function(t){return 1- --t*t*t*t},easeInOutQuart:function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t},easeInQuint:function(t){return t*t*t*t*t},easeOutQuint:function(t){return 1+--t*t*t*t*t},easeInOutQuint:function(t){return t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t}})},initialize:function Tween(object,from,to,duration,easing,start){this.object=object;var type=typeof easing,isFunction="function"===type;this.type=isFunction?type:"string"===type?easing:"linear",this.easing=isFunction?easing:Tween.easings[this.type],this.duration=duration,this.running=!1,this._then=null,this._startTime=null;var state=from||to;this._keys=state?Object.keys(state):[],this._parsedKeys=this._parseKeys(this._keys),this._from=state&&this._getState(from),this._to=state&&this._getState(to),!1!==start&&this.start()},then:function(then){return this._then=then,this},start:function(){return this._startTime=null,this.running=!0,this},stop:function(){return this.running=!1,this},update:function(progress){if(this.running){progress>=1&&(progress=1,this.running=!1);for(var factor=this.easing(progress),keys=this._keys,getValue=function(value){return"function"==typeof value?value(factor,progress):value},i=0,l=keys&&keys.length;i<l;i++){var key=keys[i],from=getValue(this._from[key]),to=getValue(this._to[key]),value=from&&to&&from.__add&&to.__add?to.__subtract(from).__multiply(factor).__add(from):(to-from)*factor+from;this._setProperty(this._parsedKeys[key],value)}this.responds("update")&&this.emit("update",new Base({progress,factor})),!this.running&&this._then&&this._then(this.object)}return this},_events:{onUpdate:{}},_handleFrame:function(time){var startTime=this._startTime,progress=startTime?(time-startTime)/this.duration:0;startTime||(this._startTime=time),this.update(progress)},_getState:function(state){for(var keys=this._keys,result={},i=0,l=keys.length;i<l;i++){var value,key=keys[i],path=this._parsedKeys[key],current=this._getProperty(path);if(state){var resolved=this._resolveValue(current,state[key]);this._setProperty(path,resolved),value=(value=this._getProperty(path))&&value.clone?value.clone():value,this._setProperty(path,current)}else value=current&&current.clone?current.clone():current;result[key]=value}return result},_resolveValue:function(current,value){if(value){if(Array.isArray(value)&&2===value.length){var operator=value[0];return operator&&operator.match&&operator.match(/^[+\-\*\/]=/)?this._calculate(current,operator[0],value[1]):value}if("string"==typeof value){var match=value.match(/^[+\-*/]=(.*)/);if(match){var parsed=JSON.parse(match[1].replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2": '));return this._calculate(current,value[0],parsed)}}}return value},_calculate:function(left,operator,right){return paper.PaperScript.calculateBinary(left,operator,right)},_parseKeys:function(keys){for(var parsed={},i=0,l=keys.length;i<l;i++){var key=keys[i],path=key.replace(/\.([^.]*)/g,"/$1").replace(/\[['"]?([^'"\]]*)['"]?\]/g,"/$1");parsed[key]=path.split("/")}return parsed},_getProperty:function(path,offset){for(var obj=this.object,i=0,l=path.length-(offset||0);i<l&&obj;i++)obj=obj[path[i]];return obj},_setProperty:function(path,value){var dest=this._getProperty(path,1);dest&&(dest[path[path.length-1]]=value)}}),Http_request=function(options){var xhr=new self.XMLHttpRequest;return xhr.open((options.method||"get").toUpperCase(),options.url,Base.pick(options.async,!0)),options.mimeType&&xhr.overrideMimeType(options.mimeType),xhr.onload=function(){var status=xhr.status;0===status||200===status?options.onLoad&&options.onLoad.call(xhr,xhr.responseText):xhr.onerror()},xhr.onerror=function(){var status=xhr.status,message='Could not load "'+options.url+'" (Status: '+status+")";if(!options.onError)throw new Error(message);options.onError(message,status)},xhr.send(null)},CanvasProvider=Base.exports.CanvasProvider={canvases:[],getCanvas:function(width,height,options){if(!window)return null;var canvas,clear=!0;"object"==typeof width&&(height=width.height,width=width.width),this.canvases.length?canvas=this.canvases.pop():(canvas=document.createElement("canvas"),clear=!1);var ctx=canvas.getContext("2d",options||{});if(!ctx)throw new Error("Canvas "+canvas+" is unable to provide a 2D context.");return canvas.width===width&&canvas.height===height?clear&&ctx.clearRect(0,0,width+1,height+1):(canvas.width=width,canvas.height=height),ctx.save(),canvas},getContext:function(width,height,options){var canvas=this.getCanvas(width,height,options);return canvas?canvas.getContext("2d",options||{}):null},release:function(obj){var canvas=obj&&obj.canvas?obj.canvas:obj;canvas&&canvas.getContext&&(canvas.getContext("2d").restore(),this.canvases.push(canvas))}},BlendMode=new function(){var sr,sg,sb,sa,br,bg,bb,ba,dr,dg,db,min=Math.min,max=Math.max,abs=Math.abs;function getLum(r,g,b){return.2989*r+.587*g+.114*b}function setLum(r,g,b,l){var d=l-getLum(r,g,b),mn=(l=getLum(dr=r+d,dg=g+d,db=b+d),min(dr,dg,db)),mx=max(dr,dg,db);if(mn<0){var lmn=l-mn;dr=l+(dr-l)*l/lmn,dg=l+(dg-l)*l/lmn,db=l+(db-l)*l/lmn}if(mx>255){var ln=255-l,mxl=mx-l;dr=l+(dr-l)*ln/mxl,dg=l+(dg-l)*ln/mxl,db=l+(db-l)*ln/mxl}}function getSat(r,g,b){return max(r,g,b)-min(r,g,b)}function setSat(r,g,b,s){var md,col=[r,g,b],mx=max(r,g,b),mn=min(r,g,b);md=0===min(mn=mn===r?0:mn===g?1:2,mx=mx===r?0:mx===g?1:2)?1===max(mn,mx)?2:1:0,col[mx]>col[mn]?(col[md]=(col[md]-col[mn])*s/(col[mx]-col[mn]),col[mx]=s):col[md]=col[mx]=0,col[mn]=0,dr=col[0],dg=col[1],db=col[2]}var modes={multiply:function(){dr=br*sr/255,dg=bg*sg/255,db=bb*sb/255},screen:function(){dr=br+sr-br*sr/255,dg=bg+sg-bg*sg/255,db=bb+sb-bb*sb/255},overlay:function(){dr=br<128?2*br*sr/255:255-2*(255-br)*(255-sr)/255,dg=bg<128?2*bg*sg/255:255-2*(255-bg)*(255-sg)/255,db=bb<128?2*bb*sb/255:255-2*(255-bb)*(255-sb)/255},"soft-light":function(){var t=sr*br/255;dr=t+br*(255-(255-br)*(255-sr)/255-t)/255,dg=(t=sg*bg/255)+bg*(255-(255-bg)*(255-sg)/255-t)/255,db=(t=sb*bb/255)+bb*(255-(255-bb)*(255-sb)/255-t)/255},"hard-light":function(){dr=sr<128?2*sr*br/255:255-2*(255-sr)*(255-br)/255,dg=sg<128?2*sg*bg/255:255-2*(255-sg)*(255-bg)/255,db=sb<128?2*sb*bb/255:255-2*(255-sb)*(255-bb)/255},"color-dodge":function(){dr=0===br?0:255===sr?255:min(255,255*br/(255-sr)),dg=0===bg?0:255===sg?255:min(255,255*bg/(255-sg)),db=0===bb?0:255===sb?255:min(255,255*bb/(255-sb))},"color-burn":function(){dr=255===br?255:0===sr?0:max(0,255-255*(255-br)/sr),dg=255===bg?255:0===sg?0:max(0,255-255*(255-bg)/sg),db=255===bb?255:0===sb?0:max(0,255-255*(255-bb)/sb)},darken:function(){dr=br<sr?br:sr,dg=bg<sg?bg:sg,db=bb<sb?bb:sb},lighten:function(){dr=br>sr?br:sr,dg=bg>sg?bg:sg,db=bb>sb?bb:sb},difference:function(){(dr=br-sr)<0&&(dr=-dr),(dg=bg-sg)<0&&(dg=-dg),(db=bb-sb)<0&&(db=-db)},exclusion:function(){dr=br+sr*(255-br-br)/255,dg=bg+sg*(255-bg-bg)/255,db=bb+sb*(255-bb-bb)/255},hue:function(){setSat(sr,sg,sb,getSat(br,bg,bb)),setLum(dr,dg,db,getLum(br,bg,bb))},saturation:function(){setSat(br,bg,bb,getSat(sr,sg,sb)),setLum(dr,dg,db,getLum(br,bg,bb))},luminosity:function(){setLum(br,bg,bb,getLum(sr,sg,sb))},color:function(){setLum(sr,sg,sb,getLum(br,bg,bb))},add:function(){dr=min(br+sr,255),dg=min(bg+sg,255),db=min(bb+sb,255)},subtract:function(){dr=max(br-sr,0),dg=max(bg-sg,0),db=max(bb-sb,0)},average:function(){dr=(br+sr)/2,dg=(bg+sg)/2,db=(bb+sb)/2},negation:function(){dr=255-abs(255-sr-br),dg=255-abs(255-sg-bg),db=255-abs(255-sb-bb)}},nativeModes=this.nativeModes=Base.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],(function(mode){this[mode]=!0}),{}),ctx=CanvasProvider.getContext(1,1,{willReadFrequently:!0});ctx&&(Base.each(modes,(function(func,mode){var darken="darken"===mode,ok=!1;ctx.save();try{ctx.fillStyle=darken?"#300":"#a00",ctx.fillRect(0,0,1,1),ctx.globalCompositeOperation=mode,ctx.globalCompositeOperation===mode&&(ctx.fillStyle=darken?"#a00":"#300",ctx.fillRect(0,0,1,1),ok=ctx.getImageData(0,0,1,1).data[0]!==darken?170:51)}catch(e){}ctx.restore(),nativeModes[mode]=ok})),CanvasProvider.release(ctx)),this.process=function(mode,srcContext,dstContext,alpha,offset){var srcCanvas=srcContext.canvas,normal="normal"===mode;if(normal||nativeModes[mode])dstContext.save(),dstContext.setTransform(1,0,0,1,0,0),dstContext.globalAlpha=alpha,normal||(dstContext.globalCompositeOperation=mode),dstContext.drawImage(srcCanvas,offset.x,offset.y),dstContext.restore();else{var process=modes[mode];if(!process)return;for(var dstData=dstContext.getImageData(offset.x,offset.y,srcCanvas.width,srcCanvas.height),dst=dstData.data,src=srcContext.getImageData(0,0,srcCanvas.width,srcCanvas.height).data,i=0,l=dst.length;i<l;i+=4){sr=src[i],br=dst[i],sg=src[i+1],bg=dst[i+1],sb=src[i+2],bb=dst[i+2],sa=src[i+3],ba=dst[i+3],process();var a1=sa*alpha/255,a2=1-a1;dst[i]=a1*dr+a2*br,dst[i+1]=a1*dg+a2*bg,dst[i+2]=a1*db+a2*bb,dst[i+3]=sa*alpha+a2*ba}dstContext.putImageData(dstData,offset.x,offset.y)}}},SvgElement=new function(){var svg="http://www.w3.org/2000/svg",xmlns="http://www.w3.org/2000/xmlns",xlink="http://www.w3.org/1999/xlink",attributeNamespace={href:xlink,xlink:xmlns,xmlns:xmlns+"/","xmlns:xlink":xmlns+"/"};function set(node,attributes,formatter){for(var name in attributes){var value=attributes[name],namespace=attributeNamespace[name];"number"==typeof value&&formatter&&(value=formatter.number(value)),namespace?node.setAttributeNS(namespace,name,value):node.setAttribute(name,value)}return node}return{svg,xmlns,xlink,create:function create(tag,attributes,formatter){return set(document.createElementNS(svg,tag),attributes,formatter)},get:function get(node,name){var namespace=attributeNamespace[name],value=namespace?node.getAttributeNS(namespace,name):node.getAttribute(name);return"null"===value?null:value},set}},SvgStyles=Base.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(item,value){return!value&&(item instanceof PathItem||item instanceof Shape||item instanceof TextItem)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},(function(entry,key){var part=Base.capitalize(key),lookup=entry[2];this[key]={type:entry[1],property:key,attribute:entry[0],toSVG:lookup,fromSVG:lookup&&Base.each(lookup,(function(value,name){this[value]=name}),{}),exportFilter:entry[3],get:"get"+part,set:"set"+part}}),{});new function(){var formatter;function getTransform(matrix,coordinates,center){var point,attrs=new Base,trans=matrix.getTranslation();coordinates&&(matrix.isInvertible()?(point=(matrix=matrix._shiftless())._inverseTransform(trans),trans=null):point=new Point,attrs[center?"cx":"x"]=point.x,attrs[center?"cy":"y"]=point.y);if(!matrix.isIdentity()){var decomposed=matrix.decompose();if(decomposed){var parts=[],angle=decomposed.rotation,scale=decomposed.scaling,skew=decomposed.skewing;trans&&!trans.isZero()&&parts.push("translate("+formatter.point(trans)+")"),angle&&parts.push("rotate("+formatter.number(angle)+")"),Numerical.isZero(scale.x-1)&&Numerical.isZero(scale.y-1)||parts.push("scale("+formatter.point(scale)+")"),skew.x&&parts.push("skewX("+formatter.number(skew.x)+")"),skew.y&&parts.push("skewY("+formatter.number(skew.y)+")"),attrs.transform=parts.join(" ")}else attrs.transform="matrix("+matrix.getValues().join(",")+")"}return attrs}function exportGroup(item,options){for(var attrs=getTransform(item._matrix),children=item._children,node=SvgElement.create("g",attrs,formatter),i=0,l=children.length;i<l;i++){var child=children[i],childNode=exportSVG(child,options);if(childNode)if(child.isClipMask()){var clip=SvgElement.create("clipPath");clip.appendChild(childNode),setDefinition(child,clip,"clip"),SvgElement.set(node,{"clip-path":"url(#"+clip.id+")"})}else node.appendChild(childNode)}return node}function exportShape(item){var type=item._type,radius=item._radius,attrs=getTransform(item._matrix,!0,"rectangle"!==type);if("rectangle"===type){type="rect";var size=item._size,width=size.width,height=size.height;attrs.x-=width/2,attrs.y-=height/2,attrs.width=width,attrs.height=height,radius.isZero()&&(radius=null)}return radius&&("circle"===type?attrs.r=radius:(attrs.rx=radius.width,attrs.ry=radius.height)),SvgElement.create(type,attrs,formatter)}var definitions,exporters={Group:exportGroup,Layer:exportGroup,Raster:function exportRaster(item,options){var attrs=getTransform(item._matrix,!0),size=item.getSize(),image=item.getImage();return attrs.x-=size.width/2,attrs.y-=size.height/2,attrs.width=size.width,attrs.height=size.height,attrs.href=0==options.embedImages&&image&&image.src||item.toDataURL(),SvgElement.create("image",attrs,formatter)},Path:function exportPath(item,options){var matchShapes=options.matchShapes;if(matchShapes){var shape=item.toShape(!1);if(shape)return exportShape(shape)}var type,segments=item._segments,length=segments.length,attrs=getTransform(item._matrix);if(matchShapes&&length>=2&&!item.hasHandles())if(length>2){type=item._closed?"polygon":"polyline";for(var parts=[],i=0;i<length;i++)parts.push(formatter.point(segments[i]._point));attrs.points=parts.join(" ")}else{type="line";var start=segments[0]._point,end=segments[1]._point;attrs.set({x1:start.x,y1:start.y,x2:end.x,y2:end.y})}else type="path",attrs.d=item.getPathData(null,options.precision);return SvgElement.create(type,attrs,formatter)},Shape:exportShape,CompoundPath:function exportCompoundPath(item,options){var attrs=getTransform(item._matrix),data=item.getPathData(null,options.precision);return data&&(attrs.d=data),SvgElement.create("path",attrs,formatter)},SymbolItem:function exportSymbolItem(item,options){var attrs=getTransform(item._matrix,!0),definition=item._definition,node=getDefinition(definition,"symbol"),definitionItem=definition._item,bounds=definitionItem.getStrokeBounds();return node||((node=SvgElement.create("symbol",{viewBox:formatter.rectangle(bounds)})).appendChild(exportSVG(definitionItem,options)),setDefinition(definition,node,"symbol")),attrs.href="#"+node.id,attrs.x+=bounds.x,attrs.y+=bounds.y,attrs.width=bounds.width,attrs.height=bounds.height,attrs.overflow="visible",SvgElement.create("use",attrs,formatter)},PointText:function exportText(item){var node=SvgElement.create("text",getTransform(item._matrix,!0),formatter);return node.textContent=item._content,node}};function applyStyle(item,node,isRoot){var attrs={},parent=!isRoot&&item.getParent(),style=[];return null!=item._name&&(attrs.id=item._name),Base.each(SvgStyles,(function(entry){var get=entry.get,type=entry.type,value=item[get]();if(entry.exportFilter?entry.exportFilter(item,value):!parent||!Base.equals(parent[get](),value)){if("color"===type&&null!=value){var alpha=value.getAlpha();alpha<1&&(attrs[entry.attribute+"-opacity"]=alpha)}"style"===type?style.push(entry.attribute+": "+value):attrs[entry.attribute]=null==value?"none":"color"===type?value.gradient?function exportGradient(color){var gradientNode=getDefinition(color,"color");if(!gradientNode){var attrs,gradient=color.getGradient(),radial=gradient._radial,origin=color.getOrigin(),destination=color.getDestination();if(radial){attrs={cx:origin.x,cy:origin.y,r:origin.getDistance(destination)};var highlight=color.getHighlight();highlight&&(attrs.fx=highlight.x,attrs.fy=highlight.y)}else attrs={x1:origin.x,y1:origin.y,x2:destination.x,y2:destination.y};attrs.gradientUnits="userSpaceOnUse",gradientNode=SvgElement.create((radial?"radial":"linear")+"Gradient",attrs,formatter);for(var stops=gradient._stops,i=0,l=stops.length;i<l;i++){var stop=stops[i],stopColor=stop._color,alpha=stopColor.getAlpha(),offset=stop._offset;attrs={offset:null==offset?i/(l-1):offset},stopColor&&(attrs["stop-color"]=stopColor.toCSS(!0)),alpha<1&&(attrs["stop-opacity"]=alpha),gradientNode.appendChild(SvgElement.create("stop",attrs,formatter))}setDefinition(color,gradientNode,"color")}return"url(#"+gradientNode.id+")"}(value):value.toCSS(!0):"array"===type?value.join(","):"lookup"===type?entry.toSVG[value]:value}})),style.length&&(attrs.style=style.join(";")),1===attrs.opacity&&delete attrs.opacity,item._visible||(attrs.visibility="hidden"),SvgElement.set(node,attrs,formatter)}function getDefinition(item,type){return definitions||(definitions={ids:{},svgs:{}}),item&&definitions.svgs[type+"-"+(item._id||item.__id||(item.__id=UID.get("svg")))]}function setDefinition(item,node,type){definitions||getDefinition();var typeId=definitions.ids[type]=(definitions.ids[type]||0)+1;node.id=type+"-"+typeId,definitions.svgs[type+"-"+(item._id||item.__id)]=node}function exportDefinitions(node,options){var svg=node,defs=null;if(definitions){for(var i in svg="svg"===node.nodeName.toLowerCase()&&node,definitions.svgs)defs||(svg||(svg=SvgElement.create("svg")).appendChild(node),defs=svg.insertBefore(SvgElement.create("defs"),svg.firstChild)),defs.appendChild(definitions.svgs[i]);definitions=null}return options.asString?(new self.XMLSerializer).serializeToString(svg):svg}function exportSVG(item,options,isRoot){var exporter=exporters[item._class],node=exporter&&exporter(item,options);if(node){var onExport=options.onExport;onExport&&(node=onExport(item,node,options)||node);var data=JSON.stringify(item._data);data&&"{}"!==data&&"null"!==data&&node.setAttribute("data-paper-data",data)}return node&&applyStyle(item,node,isRoot)}function setOptions(options){return options||(options={}),formatter=new Formatter(options.precision),options}Item.inject({exportSVG:function(options){return exportDefinitions(exportSVG(this,options=setOptions(options),!0),options)}}),Project.inject({exportSVG:function(options){options=setOptions(options);var children=this._children,view=this.getView(),bounds=Base.pick(options.bounds,"view"),mx=options.matrix||"view"===bounds&&view._matrix,matrix=mx&&Matrix.read([mx]),rect="view"===bounds?new Rectangle([0,0],view.getViewSize()):"content"===bounds?Item._getBounds(children,matrix,{stroke:!0}).rect:Rectangle.read([bounds],0,{readNull:!0}),attrs={version:"1.1",xmlns:SvgElement.svg,"xmlns:xlink":SvgElement.xlink};rect&&(attrs.width=rect.width,attrs.height=rect.height,(rect.x||0===rect.x||rect.y||0===rect.y)&&(attrs.viewBox=formatter.rectangle(rect)));var node=SvgElement.create("svg",attrs,formatter),parent=node;matrix&&!matrix.isIdentity()&&(parent=node.appendChild(SvgElement.create("g",getTransform(matrix),formatter)));for(var i=0,l=children.length;i<l;i++)parent.appendChild(exportSVG(children[i],options,!0));return exportDefinitions(node,options)}})},new function(){var rootSize,definitions={};function getValue(node,name,isString,allowNull,allowPercent,defaultValue){var value=SvgElement.get(node,name)||defaultValue,res=null==value?allowNull?null:isString?"":0:isString?value:parseFloat(value);return/%\s*$/.test(value)?res/100*(allowPercent?1:rootSize[/x|^width/.test(name)?"width":"height"]):res}function getPoint(node,x,y,allowNull,allowPercent,defaultX,defaultY){return x=getValue(node,x||"x",!1,allowNull,allowPercent,defaultX),y=getValue(node,y||"y",!1,allowNull,allowPercent,defaultY),!allowNull||null!=x&&null!=y?new Point(x,y):null}function getSize(node,w,h,allowNull,allowPercent){return w=getValue(node,w||"width",!1,allowNull,allowPercent),h=getValue(node,h||"height",!1,allowNull,allowPercent),!allowNull||null!=w&&null!=h?new Size(w,h):null}function convertValue(value,type,lookup){return"none"===value?null:"number"===type?parseFloat(value):"array"===type?value?value.split(/[\s,]+/g).map(parseFloat):[]:"color"===type?getDefinition(value)||value:"lookup"===type?lookup[value]:value}function importGroup(node,type,options,isRoot){var nodes=node.childNodes,isClip="clippath"===type,isDefs="defs"===type,item=new Group,project=item._project,currentStyle=project._currentStyle,children=[];if(isClip||isDefs||(item=applyAttributes(item,node,isRoot),project._currentStyle=item._style.clone()),isRoot)for(var defs=node.querySelectorAll("defs"),i=0,l=defs.length;i<l;i++)importNode(defs[i],options,!1);for(i=0,l=nodes.length;i<l;i++){var child,childNode=nodes[i];1!==childNode.nodeType||/^defs$/i.test(childNode.nodeName)||!(child=importNode(childNode,options,!1))||child instanceof SymbolDefinition||children.push(child)}return item.addChildren(children),isClip&&(item=applyAttributes(item.reduce(),node,isRoot)),project._currentStyle=currentStyle,(isClip||isDefs)&&(item.remove(),item=null),item}function importPoly(node,type){for(var coords=node.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),points=[],i=0,l=coords.length;i<l;i+=2)points.push(new Point(parseFloat(coords[i]),parseFloat(coords[i+1])));var path=new Path(points);return"polygon"===type&&path.closePath(),path}function importGradient(node,type){var gradient,id=(getValue(node,"href",!0)||"").substring(1),radial="radialgradient"===type;if(id)(gradient=definitions[id].getGradient())._radial^radial&&((gradient=gradient.clone())._radial=radial);else{for(var nodes=node.childNodes,stops=[],i=0,l=nodes.length;i<l;i++){var child=nodes[i];1===child.nodeType&&stops.push(applyAttributes(new GradientStop,child))}gradient=new Gradient(stops,radial)}var origin,destination,highlight,scaleToBounds="userSpaceOnUse"!==getValue(node,"gradientUnits",!0);return radial?(destination=(origin=getPoint(node,"cx","cy",!1,scaleToBounds,"50%","50%")).add(getValue(node,"r",!1,!1,scaleToBounds,"50%"),0),highlight=getPoint(node,"fx","fy",!0,scaleToBounds)):(origin=getPoint(node,"x1","y1",!1,scaleToBounds,"0%","0%"),destination=getPoint(node,"x2","y2",!1,scaleToBounds,"100%","0%")),applyAttributes(new Color(gradient,origin,destination,highlight),node)._scaleToBounds=scaleToBounds,null}var importers={"#document":function(node,type,options,isRoot){for(var nodes=node.childNodes,i=0,l=nodes.length;i<l;i++){var child=nodes[i];if(1===child.nodeType)return importNode(child,options,isRoot)}},g:importGroup,svg:importGroup,clippath:importGroup,polygon:importPoly,polyline:importPoly,path:function importPath(node){return PathItem.create(node.getAttribute("d"))},lineargradient:importGradient,radialgradient:importGradient,image:function(node){var raster=new Raster(getValue(node,"href",!0));return raster.on("load",(function(){var size=getSize(node);this.setSize(size);var center=getPoint(node).add(size.divide(2));this._matrix.append((new Matrix).translate(center))})),raster},symbol:function(node,type,options,isRoot){return new SymbolDefinition(importGroup(node,type,options,isRoot),!0)},defs:importGroup,use:function(node){var id=(getValue(node,"href",!0)||"").substring(1),definition=definitions[id],point=getPoint(node);return definition?definition instanceof SymbolDefinition?definition.place(point):definition.clone().translate(point):null},circle:function(node){return new Shape.Circle(getPoint(node,"cx","cy"),getValue(node,"r"))},ellipse:function(node){return new Shape.Ellipse({center:getPoint(node,"cx","cy"),radius:getSize(node,"rx","ry")})},rect:function(node){return new Shape.Rectangle(new Rectangle(getPoint(node),getSize(node)),getSize(node,"rx","ry"))},line:function(node){return new Path.Line(getPoint(node,"x1","y1"),getPoint(node,"x2","y2"))},text:function(node){var text=new PointText(getPoint(node).add(getPoint(node,"dx","dy")));return text.setContent(node.textContent.trim()||""),text},switch:importGroup};function applyTransform(item,value,name,node){if(item.transform){for(var transforms=(node.getAttribute(name)||"").split(/\)\s*/g),matrix=new Matrix,i=0,l=transforms.length;i<l;i++){var transform=transforms[i];if(!transform)break;for(var parts=transform.split(/\(\s*/),command=parts[0],v=parts[1].split(/[\s,]+/g),j=0,m=v.length;j<m;j++)v[j]=parseFloat(v[j]);switch(command){case"matrix":matrix.append(new Matrix(v[0],v[1],v[2],v[3],v[4],v[5]));break;case"rotate":matrix.rotate(v[0],v[1]||0,v[2]||0);break;case"translate":matrix.translate(v[0],v[1]||0);break;case"scale":matrix.scale(v);break;case"skewX":matrix.skew(v[0],0);break;case"skewY":matrix.skew(0,v[0])}}item.transform(matrix)}}function applyOpacity(item,value,name){var key="fill-opacity"===name?"getFillColor":"getStrokeColor",color=item[key]&&item[key]();color&&color.setAlpha(parseFloat(value))}var attributes=Base.set(Base.each(SvgStyles,(function(entry){this[entry.attribute]=function(item,value){if(item[entry.set]&&(item[entry.set](convertValue(value,entry.type,entry.fromSVG)),"color"===entry.type)){var color=item[entry.get]();if(color&&color._scaleToBounds){var bounds=item.getBounds();color.transform((new Matrix).translate(bounds.getPoint()).scale(bounds.getSize()))}}}}),{}),{id:function(item,value){definitions[value]=item,item.setName&&item.setName(value)},"clip-path":function(item,value){var clip=getDefinition(value);if(clip){if((clip=clip.clone()).setClipMask(!0),!(item instanceof Group))return new Group(clip,item);item.insertChild(0,clip)}},gradientTransform:applyTransform,transform:applyTransform,"fill-opacity":applyOpacity,"stroke-opacity":applyOpacity,visibility:function(item,value){item.setVisible&&item.setVisible("visible"===value)},display:function(item,value){item.setVisible&&item.setVisible(null!==value)},"stop-color":function(item,value){item.setColor&&item.setColor(value)},"stop-opacity":function(item,value){item._color&&item._color.setAlpha(parseFloat(value))},offset:function(item,value){if(item.setOffset){var percent=value.match(/(.*)%$/);item.setOffset(percent?percent[1]/100:parseFloat(value))}},viewBox:function(item,value,name,node,styles){var group,rect=new Rectangle(convertValue(value,"array")),size=getSize(node,null,null,!0);if(item instanceof Group){var scale=size?size.divide(rect.getSize()):1,matrix=(new Matrix).scale(scale).translate(rect.getPoint().negate());group=item}else item instanceof SymbolDefinition&&(size&&rect.setSize(size),group=item._item);if(group){if("visible"!==getAttribute(node,"overflow",styles)){var clip=new Shape.Rectangle(rect);clip.setClipMask(!0),group.addChild(clip)}matrix&&group.transform(matrix)}}});function getAttribute(node,name,styles){var attr=node.attributes[name],value=attr&&attr.value;if(!value&&node.style){var style=Base.camelize(name);(value=node.style[style])||styles.node[style]===styles.parent[style]||(value=styles.node[style])}return value?"none"===value?null:value:undefined}function applyAttributes(item,node,isRoot){var parent=node.parentNode,styles={node:DomElement.getStyles(node)||{},parent:!isRoot&&!/^defs$/i.test(parent.tagName)&&DomElement.getStyles(parent)||{}};return Base.each(attributes,(function(apply,name){var value=getAttribute(node,name,styles);item=value!==undefined&&apply(item,value,name,node,styles)||item})),item}function getDefinition(value){var match=value&&value.match(/\((?:["'#]*)([^"')]+)/),name=match&&match[1],res=name&&definitions[window?name.replace(window.location.href.split("#")[0]+"#",""):name];return res&&res._scaleToBounds&&((res=res.clone())._scaleToBounds=!0),res}function importNode(node,options,isRoot){var container,parent,next,type=node.nodeName.toLowerCase(),isElement="#document"!==type,body=document.body;isRoot&&isElement&&(rootSize=paper.getView().getSize(),rootSize=getSize(node,null,null,!0)||rootSize,container=SvgElement.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),parent=node.parentNode,next=node.nextSibling,container.appendChild(node),body.appendChild(container));var settings=paper.settings,applyMatrix=settings.applyMatrix,insertItems=settings.insertItems;settings.applyMatrix=!1,settings.insertItems=!1;var importer=importers[type],item=importer&&importer(node,type,options,isRoot)||null;if(settings.insertItems=insertItems,settings.applyMatrix=applyMatrix,item){!isElement||item instanceof Group||(item=applyAttributes(item,node,isRoot));var onImport=options.onImport,data=isElement&&node.getAttribute("data-paper-data");onImport&&(item=onImport(node,item,options)||item),options.expandShapes&&item instanceof Shape&&(item.remove(),item=item.toPath()),data&&(item._data=JSON.parse(data))}return container&&(body.removeChild(container),parent&&(next?parent.insertBefore(node,next):parent.appendChild(node))),isRoot&&(definitions={},item&&Base.pick(options.applyMatrix,applyMatrix)&&item.matrix.apply(!0,!0)),item}function importSVG(source,options,owner){if(!source)return null;options="function"==typeof options?{onLoad:options}:options||{};var scope=paper,item=null;function onLoad(svg){try{var node="object"==typeof svg?svg:(new self.DOMParser).parseFromString(svg.trim(),"image/svg+xml");if(!node.nodeName)throw node=null,new Error("Unsupported SVG source: "+source);paper=scope,item=importNode(node,options,!0),options&&!1===options.insert||owner._insertItem(undefined,item);var onLoad=options.onLoad;onLoad&&onLoad(item,svg)}catch(e){onError(e)}}function onError(message,status){var onError=options.onError;if(!onError)throw new Error(message);onError(message,status)}if("string"!=typeof source||/^[\s\S]*</.test(source)){if("undefined"!=typeof File&&source instanceof File){var reader=new FileReader;return reader.onload=function(){onLoad(reader.result)},reader.onerror=function(){onError(reader.error)},reader.readAsText(source)}onLoad(source)}else{var node=document.getElementById(source);node?onLoad(node):Http_request({url:source,async:!0,onLoad,onError})}return item}Item.inject({importSVG:function(node,options){return importSVG(node,options,this)}}),Project.inject({importSVG:function(node,options){return this.activate(),importSVG(node,options,this)}})},Base.exports.PaperScript=function(){var exports,module,mod,global=this,acorn=global.acorn;if(!acorn)try{acorn=__webpack_require__("./node_modules/acorn/dist/acorn.js")}catch(e){}acorn||(acorn=exports=module={},mod=function(exports){"use strict";var options,input,inputLen,sourceFile;exports.version="0.5.0",exports.parse=function(inpt,opts){return input=String(inpt),inputLen=input.length,setOptions(opts),initTokenState(),function parseTopLevel(program){lastStart=lastEnd=tokPos,options.locations&&(lastEndLoc=new line_loc_t),inFunction=strict=null,labels=[],readToken();var node=program||startNode(),first=!0;for(program||(node.body=[]);tokType!==_eof;){var stmt=parseStatement();node.body.push(stmt),first&&isUseStrict(stmt)&&setStrict(!0),first=!1}return finishNode(node,"Program")}(options.program)};var defaultOptions=exports.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,allowReturnOutsideFunction:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null};function setOptions(opts){for(var opt in options=opts||{},defaultOptions)Object.prototype.hasOwnProperty.call(options,opt)||(options[opt]=defaultOptions[opt]);sourceFile=options.sourceFile||null}var tokPos,tokStart,tokEnd,tokStartLoc,tokEndLoc,tokType,tokVal,tokRegexpAllowed,tokCurLine,tokLineStart,lastStart,lastEnd,lastEndLoc,inFunction,labels,strict,getLineInfo=exports.getLineInfo=function(input,offset){for(var line=1,cur=0;;){lineBreak.lastIndex=cur;var match=lineBreak.exec(input);if(!(match&&match.index<offset))break;++line,cur=match.index+match[0].length}return{line,column:offset-cur}};function raise(pos,message){var loc=getLineInfo(input,pos);message+=" ("+loc.line+":"+loc.column+")";var err=new SyntaxError(message);throw err.pos=pos,err.loc=loc,err.raisedAt=tokPos,err}exports.tokenize=function(inpt,opts){input=String(inpt),inputLen=input.length,setOptions(opts),initTokenState();var t={};function getToken(forceRegexp){return lastEnd=tokEnd,readToken(forceRegexp),t.start=tokStart,t.end=tokEnd,t.startLoc=tokStartLoc,t.endLoc=tokEndLoc,t.type=tokType,t.value=tokVal,t}return getToken.jumpTo=function(pos,reAllowed){var match;if(tokPos=pos,options.locations)for(tokCurLine=1,tokLineStart=lineBreak.lastIndex=0;(match=lineBreak.exec(input))&&match.index<pos;)++tokCurLine,tokLineStart=match.index+match[0].length;tokRegexpAllowed=reAllowed,skipSpace()},getToken};var empty=[],_num={type:"num"},_regexp={type:"regexp"},_string={type:"string"},_name={type:"name"},_eof={type:"eof"},_break={keyword:"break"},_case={keyword:"case",beforeExpr:!0},_catch={keyword:"catch"},_continue={keyword:"continue"},_debugger={keyword:"debugger"},_default={keyword:"default"},_do={keyword:"do",isLoop:!0},_else={keyword:"else",beforeExpr:!0},_finally={keyword:"finally"},_for={keyword:"for",isLoop:!0},_function={keyword:"function"},_if={keyword:"if"},_return={keyword:"return",beforeExpr:!0},_switch={keyword:"switch"},_throw={keyword:"throw",beforeExpr:!0},_try={keyword:"try"},_var={keyword:"var"},_while={keyword:"while",isLoop:!0},_with={keyword:"with"},_new={keyword:"new",beforeExpr:!0},_this={keyword:"this"},_null={keyword:"null",atomValue:null},_true={keyword:"true",atomValue:!0},_false={keyword:"false",atomValue:!1},_in={keyword:"in",binop:7,beforeExpr:!0},keywordTypes={break:_break,case:_case,catch:_catch,continue:_continue,debugger:_debugger,default:_default,do:_do,else:_else,finally:_finally,for:_for,function:_function,if:_if,return:_return,switch:_switch,throw:_throw,try:_try,var:_var,while:_while,with:_with,null:_null,true:_true,false:_false,new:_new,in:_in,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:_this,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},_bracketL={type:"[",beforeExpr:!0},_bracketR={type:"]"},_braceL={type:"{",beforeExpr:!0},_braceR={type:"}"},_parenL={type:"(",beforeExpr:!0},_parenR={type:")"},_comma={type:",",beforeExpr:!0},_semi={type:";",beforeExpr:!0},_colon={type:":",beforeExpr:!0},_dot={type:"."},_question={type:"?",beforeExpr:!0},_slash={binop:10,beforeExpr:!0},_eq={isAssign:!0,beforeExpr:!0},_assign={isAssign:!0,beforeExpr:!0},_incDec={postfix:!0,prefix:!0,isUpdate:!0},_prefix={prefix:!0,beforeExpr:!0},_logicalOR={binop:1,beforeExpr:!0},_logicalAND={binop:2,beforeExpr:!0},_bitwiseOR={binop:3,beforeExpr:!0},_bitwiseXOR={binop:4,beforeExpr:!0},_bitwiseAND={binop:5,beforeExpr:!0},_equality={binop:6,beforeExpr:!0},_relational={binop:7,beforeExpr:!0},_bitShift={binop:8,beforeExpr:!0},_plusMin={binop:9,prefix:!0,beforeExpr:!0},_multiplyModulo={binop:10,beforeExpr:!0};for(var kw in exports.tokTypes={bracketL:_bracketL,bracketR:_bracketR,braceL:_braceL,braceR:_braceR,parenL:_parenL,parenR:_parenR,comma:_comma,semi:_semi,colon:_colon,dot:_dot,question:_question,slash:_slash,eq:_eq,name:_name,eof:_eof,num:_num,regexp:_regexp,string:_string},keywordTypes)exports.tokTypes["_"+kw]=keywordTypes[kw];function makePredicate(words){words=words.split(" ");var f="",cats=[];out:for(var i=0;i<words.length;++i){for(var j=0;j<cats.length;++j)if(cats[j][0].length==words[i].length){cats[j].push(words[i]);continue out}cats.push([words[i]])}function compareTo(arr){if(1==arr.length)return f+="return str === "+JSON.stringify(arr[0])+";";f+="switch(str){";for(var i=0;i<arr.length;++i)f+="case "+JSON.stringify(arr[i])+":";f+="return true}return false;"}if(cats.length>3){for(cats.sort((function(a,b){return b.length-a.length})),f+="switch(str.length){",i=0;i<cats.length;++i){var cat=cats[i];f+="case "+cat[0].length+":",compareTo(cat)}f+="}"}else compareTo(words);return new Function("str",f)}var containsEsc,isReservedWord3=makePredicate("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),isReservedWord5=makePredicate("class enum extends super const export import"),isStrictReservedWord=makePredicate("implements interface let package private protected public static yield"),isStrictBadIdWord=makePredicate("eval arguments"),isKeyword=makePredicate("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),nonASCIIwhitespace=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,nonASCIIidentifierStartChars="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",nonASCIIidentifierStart=new RegExp("["+nonASCIIidentifierStartChars+"]"),nonASCIIidentifier=new RegExp("["+nonASCIIidentifierStartChars+"------------------------------------------------------------------------------------------------------------------------------------------]"),newline=/[\n\r\u2028\u2029]/,lineBreak=/\r\n|[\n\r\u2028\u2029]/g,isIdentifierStart=exports.isIdentifierStart=function(code){return code<65?36===code:code<91||(code<97?95===code:code<123||code>=170&&nonASCIIidentifierStart.test(String.fromCharCode(code)))},isIdentifierChar=exports.isIdentifierChar=function(code){return code<48?36===code:code<58||!(code<65)&&(code<91||(code<97?95===code:code<123||code>=170&&nonASCIIidentifier.test(String.fromCharCode(code))))};function line_loc_t(){this.line=tokCurLine,this.column=tokPos-tokLineStart}function initTokenState(){tokCurLine=1,tokPos=tokLineStart=0,tokRegexpAllowed=!0,skipSpace()}function finishToken(type,val){tokEnd=tokPos,options.locations&&(tokEndLoc=new line_loc_t),tokType=type,skipSpace(),tokVal=val,tokRegexpAllowed=type.beforeExpr}function skipBlockComment(){var match,startLoc=options.onComment&&options.locations&&new line_loc_t,start=tokPos,end=input.indexOf("*/",tokPos+=2);if(-1===end&&raise(tokPos-2,"Unterminated comment"),tokPos=end+2,options.locations)for(lineBreak.lastIndex=start;(match=lineBreak.exec(input))&&match.index<tokPos;)++tokCurLine,tokLineStart=match.index+match[0].length;options.onComment&&options.onComment(!0,input.slice(start+2,end),start,tokPos,startLoc,options.locations&&new line_loc_t)}function skipLineComment(){for(var start=tokPos,startLoc=options.onComment&&options.locations&&new line_loc_t,ch=input.charCodeAt(tokPos+=2);tokPos<inputLen&&10!==ch&&13!==ch&&8232!==ch&&8233!==ch;)++tokPos,ch=input.charCodeAt(tokPos);options.onComment&&options.onComment(!1,input.slice(start+2,tokPos),start,tokPos,startLoc,options.locations&&new line_loc_t)}function skipSpace(){for(;tokPos<inputLen;){var ch=input.charCodeAt(tokPos);if(32===ch)++tokPos;else if(13===ch)++tokPos,10===(next=input.charCodeAt(tokPos))&&++tokPos,options.locations&&(++tokCurLine,tokLineStart=tokPos);else if(10===ch||8232===ch||8233===ch)++tokPos,options.locations&&(++tokCurLine,tokLineStart=tokPos);else if(ch>8&&ch<14)++tokPos;else if(47===ch){var next;if(42===(next=input.charCodeAt(tokPos+1)))skipBlockComment();else{if(47!==next)break;skipLineComment()}}else if(160===ch)++tokPos;else{if(!(ch>=5760&&nonASCIIwhitespace.test(String.fromCharCode(ch))))break;++tokPos}}}function getTokenFromCode(code){switch(code){case 46:return function readToken_dot(){var next=input.charCodeAt(tokPos+1);return next>=48&&next<=57?readNumber(!0):(++tokPos,finishToken(_dot))}();case 40:return++tokPos,finishToken(_parenL);case 41:return++tokPos,finishToken(_parenR);case 59:return++tokPos,finishToken(_semi);case 44:return++tokPos,finishToken(_comma);case 91:return++tokPos,finishToken(_bracketL);case 93:return++tokPos,finishToken(_bracketR);case 123:return++tokPos,finishToken(_braceL);case 125:return++tokPos,finishToken(_braceR);case 58:return++tokPos,finishToken(_colon);case 63:return++tokPos,finishToken(_question);case 48:var next=input.charCodeAt(tokPos+1);if(120===next||88===next)return function readHexNumber(){tokPos+=2;var val=readInt(16);return null==val&&raise(tokStart+2,"Expected hexadecimal number"),isIdentifierStart(input.charCodeAt(tokPos))&&raise(tokPos,"Identifier directly after number"),finishToken(_num,val)}();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return readNumber(!1);case 34:case 39:return function readString(quote){tokPos++;for(var out="";;){tokPos>=inputLen&&raise(tokStart,"Unterminated string constant");var ch=input.charCodeAt(tokPos);if(ch===quote)return++tokPos,finishToken(_string,out);if(92===ch){ch=input.charCodeAt(++tokPos);var octal=/^[0-7]+/.exec(input.slice(tokPos,tokPos+3));for(octal&&(octal=octal[0]);octal&&parseInt(octal,8)>255;)octal=octal.slice(0,-1);if("0"===octal&&(octal=null),++tokPos,octal)strict&&raise(tokPos-2,"Octal literal in strict mode"),out+=String.fromCharCode(parseInt(octal,8)),tokPos+=octal.length-1;else switch(ch){case 110:out+="\n";break;case 114:out+="\r";break;case 120:out+=String.fromCharCode(readHexChar(2));break;case 117:out+=String.fromCharCode(readHexChar(4));break;case 85:out+=String.fromCharCode(readHexChar(8));break;case 116:out+="\t";break;case 98:out+="\b";break;case 118:out+="\v";break;case 102:out+="\f";break;case 48:out+="\0";break;case 13:10===input.charCodeAt(tokPos)&&++tokPos;case 10:options.locations&&(tokLineStart=tokPos,++tokCurLine);break;default:out+=String.fromCharCode(ch)}}else 13!==ch&&10!==ch&&8232!==ch&&8233!==ch||raise(tokStart,"Unterminated string constant"),out+=String.fromCharCode(ch),++tokPos}}(code);case 47:return function readToken_slash(){var next=input.charCodeAt(tokPos+1);return tokRegexpAllowed?(++tokPos,readRegexp()):61===next?finishOp(_assign,2):finishOp(_slash,1)}();case 37:case 42:return function readToken_mult_modulo(){return 61===input.charCodeAt(tokPos+1)?finishOp(_assign,2):finishOp(_multiplyModulo,1)}();case 124:case 38:return function readToken_pipe_amp(code){var next=input.charCodeAt(tokPos+1);return next===code?finishOp(124===code?_logicalOR:_logicalAND,2):61===next?finishOp(_assign,2):finishOp(124===code?_bitwiseOR:_bitwiseAND,1)}(code);case 94:return function readToken_caret(){return 61===input.charCodeAt(tokPos+1)?finishOp(_assign,2):finishOp(_bitwiseXOR,1)}();case 43:case 45:return function readToken_plus_min(code){var next=input.charCodeAt(tokPos+1);return next===code?45==next&&62==input.charCodeAt(tokPos+2)&&newline.test(input.slice(lastEnd,tokPos))?(tokPos+=3,skipLineComment(),skipSpace(),readToken()):finishOp(_incDec,2):61===next?finishOp(_assign,2):finishOp(_plusMin,1)}(code);case 60:case 62:return function readToken_lt_gt(code){var next=input.charCodeAt(tokPos+1),size=1;return next===code?(size=62===code&&62===input.charCodeAt(tokPos+2)?3:2,61===input.charCodeAt(tokPos+size)?finishOp(_assign,size+1):finishOp(_bitShift,size)):33==next&&60==code&&45==input.charCodeAt(tokPos+2)&&45==input.charCodeAt(tokPos+3)?(tokPos+=4,skipLineComment(),skipSpace(),readToken()):(61===next&&(size=61===input.charCodeAt(tokPos+2)?3:2),finishOp(_relational,size))}(code);case 61:case 33:return function readToken_eq_excl(code){return 61===input.charCodeAt(tokPos+1)?finishOp(_equality,61===input.charCodeAt(tokPos+2)?3:2):finishOp(61===code?_eq:_prefix,1)}(code);case 126:return finishOp(_prefix,1)}return!1}function readToken(forceRegexp){if(forceRegexp?tokPos=tokStart+1:tokStart=tokPos,options.locations&&(tokStartLoc=new line_loc_t),forceRegexp)return readRegexp();if(tokPos>=inputLen)return finishToken(_eof);var code=input.charCodeAt(tokPos);if(isIdentifierStart(code)||92===code)return readWord();var tok=getTokenFromCode(code);if(!1===tok){var ch=String.fromCharCode(code);if("\\"===ch||nonASCIIidentifierStart.test(ch))return readWord();raise(tokPos,"Unexpected character '"+ch+"'")}return tok}function finishOp(type,size){var str=input.slice(tokPos,tokPos+size);tokPos+=size,finishToken(type,str)}function readRegexp(){for(var escaped,inClass,start=tokPos;;){tokPos>=inputLen&&raise(start,"Unterminated regular expression");var ch=input.charAt(tokPos);if(newline.test(ch)&&raise(start,"Unterminated regular expression"),escaped)escaped=!1;else{if("["===ch)inClass=!0;else if("]"===ch&&inClass)inClass=!1;else if("/"===ch&&!inClass)break;escaped="\\"===ch}++tokPos}var content=input.slice(start,tokPos);++tokPos;var mods=readWord1();mods&&!/^[gmsiy]*$/.test(mods)&&raise(start,"Invalid regexp flag");try{var value=new RegExp(content,mods)}catch(e){e instanceof SyntaxError&&raise(start,e.message),raise(e)}return finishToken(_regexp,value)}function readInt(radix,len){for(var start=tokPos,total=0,i=0,e=null==len?1/0:len;i<e;++i){var val,code=input.charCodeAt(tokPos);if((val=code>=97?code-97+10:code>=65?code-65+10:code>=48&&code<=57?code-48:1/0)>=radix)break;++tokPos,total=total*radix+val}return tokPos===start||null!=len&&tokPos-start!==len?null:total}function readNumber(startsWithDot){var start=tokPos,isFloat=!1,octal=48===input.charCodeAt(tokPos);startsWithDot||null!==readInt(10)||raise(start,"Invalid number"),46===input.charCodeAt(tokPos)&&(++tokPos,readInt(10),isFloat=!0);var next=input.charCodeAt(tokPos);69!==next&&101!==next||(43!==(next=input.charCodeAt(++tokPos))&&45!==next||++tokPos,null===readInt(10)&&raise(start,"Invalid number"),isFloat=!0),isIdentifierStart(input.charCodeAt(tokPos))&&raise(tokPos,"Identifier directly after number");var val,str=input.slice(start,tokPos);return isFloat?val=parseFloat(str):octal&&1!==str.length?/[89]/.test(str)||strict?raise(start,"Invalid number"):val=parseInt(str,8):val=parseInt(str,10),finishToken(_num,val)}function readHexChar(len){var n=readInt(16,len);return null===n&&raise(tokStart,"Bad character escape sequence"),n}function readWord1(){containsEsc=!1;for(var word,first=!0,start=tokPos;;){var ch=input.charCodeAt(tokPos);if(isIdentifierChar(ch))containsEsc&&(word+=input.charAt(tokPos)),++tokPos;else{if(92!==ch)break;containsEsc||(word=input.slice(start,tokPos)),containsEsc=!0,117!=input.charCodeAt(++tokPos)&&raise(tokPos,"Expecting Unicode escape sequence \\uXXXX"),++tokPos;var esc=readHexChar(4),escStr=String.fromCharCode(esc);escStr||raise(tokPos-1,"Invalid Unicode escape"),(first?isIdentifierStart(esc):isIdentifierChar(esc))||raise(tokPos-4,"Invalid Unicode escape"),word+=escStr}first=!1}return containsEsc?word:input.slice(start,tokPos)}function readWord(){var word=readWord1(),type=_name;return!containsEsc&&isKeyword(word)&&(type=keywordTypes[word]),finishToken(type,word)}function next(){lastStart=tokStart,lastEnd=tokEnd,lastEndLoc=tokEndLoc,readToken()}function setStrict(strct){if(strict=strct,tokPos=tokStart,options.locations)for(;tokPos<tokLineStart;)tokLineStart=input.lastIndexOf("\n",tokLineStart-2)+1,--tokCurLine;skipSpace(),readToken()}function node_t(){this.type=null,this.start=tokStart,this.end=null}function node_loc_t(){this.start=tokStartLoc,this.end=null,null!==sourceFile&&(this.source=sourceFile)}function startNode(){var node=new node_t;return options.locations&&(node.loc=new node_loc_t),options.directSourceFile&&(node.sourceFile=options.directSourceFile),options.ranges&&(node.range=[tokStart,0]),node}function startNodeFrom(other){var node=new node_t;return node.start=other.start,options.locations&&(node.loc=new node_loc_t,node.loc.start=other.loc.start),options.ranges&&(node.range=[other.range[0],0]),node}function finishNode(node,type){return node.type=type,node.end=lastEnd,options.locations&&(node.loc.end=lastEndLoc),options.ranges&&(node.range[1]=lastEnd),node}function isUseStrict(stmt){return options.ecmaVersion>=5&&"ExpressionStatement"===stmt.type&&"Literal"===stmt.expression.type&&"use strict"===stmt.expression.value}function eat(type){if(tokType===type)return next(),!0}function canInsertSemicolon(){return!options.strictSemicolons&&(tokType===_eof||tokType===_braceR||newline.test(input.slice(lastEnd,tokStart)))}function semicolon(){eat(_semi)||canInsertSemicolon()||unexpected()}function expect(type){tokType===type?next():unexpected()}function unexpected(){raise(tokStart,"Unexpected token")}function checkLVal(expr){"Identifier"!==expr.type&&"MemberExpression"!==expr.type&&raise(expr.start,"Assigning to rvalue"),strict&&"Identifier"===expr.type&&isStrictBadIdWord(expr.name)&&raise(expr.start,"Assigning to "+expr.name+" in strict mode")}var loopLabel={kind:"loop"},switchLabel={kind:"switch"};function parseStatement(){(tokType===_slash||tokType===_assign&&"/="==tokVal)&&readToken(!0);var starttype=tokType,node=startNode();switch(starttype){case _break:case _continue:next();var isBreak=starttype===_break;eat(_semi)||canInsertSemicolon()?node.label=null:tokType!==_name?unexpected():(node.label=parseIdent(),semicolon());for(var i=0;i<labels.length;++i){var lab=labels[i];if(null==node.label||lab.name===node.label.name){if(null!=lab.kind&&(isBreak||"loop"===lab.kind))break;if(node.label&&isBreak)break}}return i===labels.length&&raise(node.start,"Unsyntactic "+starttype.keyword),finishNode(node,isBreak?"BreakStatement":"ContinueStatement");case _debugger:return next(),semicolon(),finishNode(node,"DebuggerStatement");case _do:return next(),labels.push(loopLabel),node.body=parseStatement(),labels.pop(),expect(_while),node.test=parseParenExpression(),semicolon(),finishNode(node,"DoWhileStatement");case _for:if(next(),labels.push(loopLabel),expect(_parenL),tokType===_semi)return parseFor(node,null);if(tokType===_var){var init=startNode();return next(),parseVar(init,!0),finishNode(init,"VariableDeclaration"),1===init.declarations.length&&eat(_in)?parseForIn(node,init):parseFor(node,init)}return init=parseExpression(!1,!0),eat(_in)?(checkLVal(init),parseForIn(node,init)):parseFor(node,init);case _function:return next(),parseFunction(node,!0);case _if:return next(),node.test=parseParenExpression(),node.consequent=parseStatement(),node.alternate=eat(_else)?parseStatement():null,finishNode(node,"IfStatement");case _return:return inFunction||options.allowReturnOutsideFunction||raise(tokStart,"'return' outside of function"),next(),eat(_semi)||canInsertSemicolon()?node.argument=null:(node.argument=parseExpression(),semicolon()),finishNode(node,"ReturnStatement");case _switch:next(),node.discriminant=parseParenExpression(),node.cases=[],expect(_braceL),labels.push(switchLabel);for(var cur,sawDefault;tokType!=_braceR;)if(tokType===_case||tokType===_default){var isCase=tokType===_case;cur&&finishNode(cur,"SwitchCase"),node.cases.push(cur=startNode()),cur.consequent=[],next(),isCase?cur.test=parseExpression():(sawDefault&&raise(lastStart,"Multiple default clauses"),sawDefault=!0,cur.test=null),expect(_colon)}else cur||unexpected(),cur.consequent.push(parseStatement());return cur&&finishNode(cur,"SwitchCase"),next(),labels.pop(),finishNode(node,"SwitchStatement");case _throw:return next(),newline.test(input.slice(lastEnd,tokStart))&&raise(lastEnd,"Illegal newline after throw"),node.argument=parseExpression(),semicolon(),finishNode(node,"ThrowStatement");case _try:if(next(),node.block=parseBlock(),node.handler=null,tokType===_catch){var clause=startNode();next(),expect(_parenL),clause.param=parseIdent(),strict&&isStrictBadIdWord(clause.param.name)&&raise(clause.param.start,"Binding "+clause.param.name+" in strict mode"),expect(_parenR),clause.guard=null,clause.body=parseBlock(),node.handler=finishNode(clause,"CatchClause")}return node.guardedHandlers=empty,node.finalizer=eat(_finally)?parseBlock():null,node.handler||node.finalizer||raise(node.start,"Missing catch or finally clause"),finishNode(node,"TryStatement");case _var:return next(),parseVar(node),semicolon(),finishNode(node,"VariableDeclaration");case _while:return next(),node.test=parseParenExpression(),labels.push(loopLabel),node.body=parseStatement(),labels.pop(),finishNode(node,"WhileStatement");case _with:return strict&&raise(tokStart,"'with' in strict mode"),next(),node.object=parseParenExpression(),node.body=parseStatement(),finishNode(node,"WithStatement");case _braceL:return parseBlock();case _semi:return next(),finishNode(node,"EmptyStatement");default:var maybeName=tokVal,expr=parseExpression();if(starttype===_name&&"Identifier"===expr.type&&eat(_colon)){for(i=0;i<labels.length;++i)labels[i].name===maybeName&&raise(expr.start,"Label '"+maybeName+"' is already declared");var kind=tokType.isLoop?"loop":tokType===_switch?"switch":null;return labels.push({name:maybeName,kind}),node.body=parseStatement(),labels.pop(),node.label=expr,finishNode(node,"LabeledStatement")}return node.expression=expr,semicolon(),finishNode(node,"ExpressionStatement")}}function parseParenExpression(){expect(_parenL);var val=parseExpression();return expect(_parenR),val}function parseBlock(allowStrict){var oldStrict,node=startNode(),first=!0,strict=!1;for(node.body=[],expect(_braceL);!eat(_braceR);){var stmt=parseStatement();node.body.push(stmt),first&&allowStrict&&isUseStrict(stmt)&&(oldStrict=strict,setStrict(strict=!0)),first=!1}return strict&&!oldStrict&&setStrict(!1),finishNode(node,"BlockStatement")}function parseFor(node,init){return node.init=init,expect(_semi),node.test=tokType===_semi?null:parseExpression(),expect(_semi),node.update=tokType===_parenR?null:parseExpression(),expect(_parenR),node.body=parseStatement(),labels.pop(),finishNode(node,"ForStatement")}function parseForIn(node,init){return node.left=init,node.right=parseExpression(),expect(_parenR),node.body=parseStatement(),labels.pop(),finishNode(node,"ForInStatement")}function parseVar(node,noIn){for(node.declarations=[],node.kind="var";;){var decl=startNode();if(decl.id=parseIdent(),strict&&isStrictBadIdWord(decl.id.name)&&raise(decl.id.start,"Binding "+decl.id.name+" in strict mode"),decl.init=eat(_eq)?parseExpression(!0,noIn):null,node.declarations.push(finishNode(decl,"VariableDeclarator")),!eat(_comma))break}return node}function parseExpression(noComma,noIn){var expr=parseMaybeAssign(noIn);if(!noComma&&tokType===_comma){var node=startNodeFrom(expr);for(node.expressions=[expr];eat(_comma);)node.expressions.push(parseMaybeAssign(noIn));return finishNode(node,"SequenceExpression")}return expr}function parseMaybeAssign(noIn){var left=function parseMaybeConditional(noIn){var expr=function parseExprOps(noIn){return parseExprOp(parseMaybeUnary(),-1,noIn)}(noIn);if(eat(_question)){var node=startNodeFrom(expr);return node.test=expr,node.consequent=parseExpression(!0),expect(_colon),node.alternate=parseExpression(!0,noIn),finishNode(node,"ConditionalExpression")}return expr}(noIn);if(tokType.isAssign){var node=startNodeFrom(left);return node.operator=tokVal,node.left=left,next(),node.right=parseMaybeAssign(noIn),checkLVal(left),finishNode(node,"AssignmentExpression")}return left}function parseExprOp(left,minPrec,noIn){var prec=tokType.binop;if(null!=prec&&(!noIn||tokType!==_in)&&prec>minPrec){var node=startNodeFrom(left);node.left=left,node.operator=tokVal;var op=tokType;return next(),node.right=parseExprOp(parseMaybeUnary(),prec,noIn),parseExprOp(finishNode(node,op===_logicalOR||op===_logicalAND?"LogicalExpression":"BinaryExpression"),minPrec,noIn)}return left}function parseMaybeUnary(){if(tokType.prefix){var node=startNode(),update=tokType.isUpdate;return node.operator=tokVal,node.prefix=!0,tokRegexpAllowed=!0,next(),node.argument=parseMaybeUnary(),update?checkLVal(node.argument):strict&&"delete"===node.operator&&"Identifier"===node.argument.type&&raise(node.start,"Deleting local variable in strict mode"),finishNode(node,update?"UpdateExpression":"UnaryExpression")}for(var expr=function parseExprSubscripts(){return parseSubscripts(parseExprAtom())}();tokType.postfix&&!canInsertSemicolon();)(node=startNodeFrom(expr)).operator=tokVal,node.prefix=!1,node.argument=expr,checkLVal(expr),next(),expr=finishNode(node,"UpdateExpression");return expr}function parseSubscripts(base,noCalls){var node;return eat(_dot)?((node=startNodeFrom(base)).object=base,node.property=parseIdent(!0),node.computed=!1,parseSubscripts(finishNode(node,"MemberExpression"),noCalls)):eat(_bracketL)?((node=startNodeFrom(base)).object=base,node.property=parseExpression(),node.computed=!0,expect(_bracketR),parseSubscripts(finishNode(node,"MemberExpression"),noCalls)):!noCalls&&eat(_parenL)?((node=startNodeFrom(base)).callee=base,node.arguments=parseExprList(_parenR,!1),parseSubscripts(finishNode(node,"CallExpression"),noCalls)):base}function parseExprAtom(){switch(tokType){case _this:var node=startNode();return next(),finishNode(node,"ThisExpression");case _name:return parseIdent();case _num:case _string:case _regexp:return(node=startNode()).value=tokVal,node.raw=input.slice(tokStart,tokEnd),next(),finishNode(node,"Literal");case _null:case _true:case _false:return(node=startNode()).value=tokType.atomValue,node.raw=tokType.keyword,next(),finishNode(node,"Literal");case _parenL:var tokStartLoc1=tokStartLoc,tokStart1=tokStart;next();var val=parseExpression();return val.start=tokStart1,val.end=tokEnd,options.locations&&(val.loc.start=tokStartLoc1,val.loc.end=tokEndLoc),options.ranges&&(val.range=[tokStart1,tokEnd]),expect(_parenR),val;case _bracketL:return node=startNode(),next(),node.elements=parseExprList(_bracketR,!0,!0),finishNode(node,"ArrayExpression");case _braceL:return function parseObj(){var node=startNode(),first=!0,sawGetSet=!1;for(node.properties=[],next();!eat(_braceR);){if(first)first=!1;else if(expect(_comma),options.allowTrailingCommas&&eat(_braceR))break;var kind,prop={key:parsePropertyName()},isGetSet=!1;if(eat(_colon)?(prop.value=parseExpression(!0),kind=prop.kind="init"):options.ecmaVersion>=5&&"Identifier"===prop.key.type&&("get"===prop.key.name||"set"===prop.key.name)?(isGetSet=sawGetSet=!0,kind=prop.kind=prop.key.name,prop.key=parsePropertyName(),tokType!==_parenL&&unexpected(),prop.value=parseFunction(startNode(),!1)):unexpected(),"Identifier"===prop.key.type&&(strict||sawGetSet))for(var i=0;i<node.properties.length;++i){var other=node.properties[i];if(other.key.name===prop.key.name){var conflict=kind==other.kind||isGetSet&&"init"===other.kind||"init"===kind&&("get"===other.kind||"set"===other.kind);conflict&&!strict&&"init"===kind&&"init"===other.kind&&(conflict=!1),conflict&&raise(prop.key.start,"Redefinition of property")}}node.properties.push(prop)}return finishNode(node,"ObjectExpression")}();case _function:return node=startNode(),next(),parseFunction(node,!1);case _new:return function parseNew(){var node=startNode();return next(),node.callee=parseSubscripts(parseExprAtom(),!0),eat(_parenL)?node.arguments=parseExprList(_parenR,!1):node.arguments=empty,finishNode(node,"NewExpression")}();default:unexpected()}}function parsePropertyName(){return tokType===_num||tokType===_string?parseExprAtom():parseIdent(!0)}function parseFunction(node,isStatement){tokType===_name?node.id=parseIdent():isStatement?unexpected():node.id=null,node.params=[];var first=!0;for(expect(_parenL);!eat(_parenR);)first?first=!1:expect(_comma),node.params.push(parseIdent());var oldInFunc=inFunction,oldLabels=labels;if(inFunction=!0,labels=[],node.body=parseBlock(!0),inFunction=oldInFunc,labels=oldLabels,strict||node.body.body.length&&isUseStrict(node.body.body[0]))for(var i=node.id?-1:0;i<node.params.length;++i){var id=i<0?node.id:node.params[i];if((isStrictReservedWord(id.name)||isStrictBadIdWord(id.name))&&raise(id.start,"Defining '"+id.name+"' in strict mode"),i>=0)for(var j=0;j<i;++j)id.name===node.params[j].name&&raise(id.start,"Argument name clash in strict mode")}return finishNode(node,isStatement?"FunctionDeclaration":"FunctionExpression")}function parseExprList(close,allowTrailingComma,allowEmpty){for(var elts=[],first=!0;!eat(close);){if(first)first=!1;else if(expect(_comma),allowTrailingComma&&options.allowTrailingCommas&&eat(close))break;allowEmpty&&tokType===_comma?elts.push(null):elts.push(parseExpression(!0))}return elts}function parseIdent(liberal){var node=startNode();return liberal&&"everywhere"==options.forbidReserved&&(liberal=!1),tokType===_name?(!liberal&&(options.forbidReserved&&(3===options.ecmaVersion?isReservedWord3:isReservedWord5)(tokVal)||strict&&isStrictReservedWord(tokVal))&&-1==input.slice(tokStart,tokEnd).indexOf("\\")&&raise(tokStart,"The keyword '"+tokVal+"' is reserved"),node.name=tokVal):liberal&&tokType.keyword?node.name=tokType.keyword:unexpected(),tokRegexpAllowed=!1,next(),finishNode(node,"Identifier")}},"object"==typeof exports&&"object"==typeof module?mod(exports):(__WEBPACK_AMD_DEFINE_ARRAY__=[exports],(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=mod)?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)===undefined||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)),acorn.version||(acorn=null));function parse(code,options){return(global.acorn||acorn).parse(code,options)}var binaryOperators={"+":"__add","-":"__subtract","*":"__multiply","/":"__divide","%":"__modulo","==":"__equals","!=":"__equals"},unaryOperators={"-":"__negate","+":"__self"},fields=Base.each(["add","subtract","multiply","divide","modulo","equals","negate"],(function(name){this["__"+name]="#"+name}),{__self:function(){return this}});function __$__(left,operator,right){var handler=binaryOperators[operator];if(left&&left[handler]){var res=left[handler](right);return"!="===operator?!res:res}switch(operator){case"+":return left+right;case"-":return left-right;case"*":return left*right;case"/":return left/right;case"%":return left%right;case"==":return left==right;case"!=":return left!=right}}function $__(operator,value){var handler=unaryOperators[operator];if(value&&value[handler])return value[handler]();switch(operator){case"+":return+value;case"-":return-value}}function compile(code,options){if(!code)return"";var insertions=[];function getOffset(offset){for(var i=0,l=insertions.length;i<l;i++){var insertion=insertions[i];if(insertion[0]>=offset)break;offset+=insertion[1]}return offset}function getCode(node){return code.substring(getOffset(node.range[0]),getOffset(node.range[1]))}function replaceCode(node,str){for(var start=getOffset(node.range[0]),end=getOffset(node.range[1]),insert=0,i=insertions.length-1;i>=0;i--)if(start>insertions[i][0]){insert=i+1;break}insertions.splice(insert,0,[start,str.length-end+start]),code=code.substring(0,start)+str+code.substring(end)}function handleOverloading(node,parent){switch(node.type){case"UnaryExpression":if(node.operator in unaryOperators&&"Literal"!==node.argument.type){var arg=getCode(node.argument);replaceCode(node,'$__("'+node.operator+'", '+arg+")")}break;case"BinaryExpression":if(node.operator in binaryOperators&&"Literal"!==node.left.type){var left=getCode(node.left),right=getCode(node.right),between=function getBetween(left,right){return code.substring(getOffset(left.range[1]),getOffset(right.range[0]))}(node.left,node.right),operator=node.operator;replaceCode(node,"__$__("+left+","+between.replace(new RegExp("\\"+operator),'"'+operator+'"')+", "+right+")")}break;case"UpdateExpression":case"AssignmentExpression":var parentType=parent&&parent.type;if(!("ForStatement"===parentType||"BinaryExpression"===parentType&&/^[=!<>]/.test(parent.operator)||"MemberExpression"===parentType&&parent.computed))if("UpdateExpression"===node.type){var str=(arg=getCode(node.argument))+" = "+(exp="__$__("+arg+', "'+node.operator[0]+'", 1)');node.prefix?str="("+str+")":"AssignmentExpression"!==parentType&&"VariableDeclarator"!==parentType&&"BinaryExpression"!==parentType||(getCode(parent.left||parent.id)===arg&&(str=exp),str=arg+"; "+str),replaceCode(node,str)}else if(/^.=$/.test(node.operator)&&"Literal"!==node.left.type){left=getCode(node.left),right=getCode(node.right);var exp=left+" = __$__("+left+', "'+node.operator[0]+'", '+right+")";replaceCode(node,/^\(.*\)$/.test(getCode(node))?"("+exp+")":exp)}}}var map,url=(options=options||{}).url||"",sourceMaps=options.sourceMaps,paperFeatures=options.paperFeatures||{},source=options.source||code,offset=options.offset||0,agent=paper.agent,version=agent.versionNumber,offsetCode=!1,lineBreaks=/\r\n|\n|\r/gm;if(sourceMaps&&(agent.chrome&&version>=30||agent.webkit&&version>=537.76||agent.firefox&&version>=23||agent.node)){if(agent.node)offset-=2;else if(window&&url&&!window.location.href.indexOf(url)){var html=document.getElementsByTagName("html")[0].innerHTML;offset=html.substr(0,html.indexOf(code)+1).match(lineBreaks).length+1}var mappings=["AA"+function encodeVLQ(value){var res="";for(value=(Math.abs(value)<<1)+(value<0?1:0);value||!res;){var next=31&value;(value>>=5)&&(next|=32),res+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[next]}return res}((offsetCode=offset>0&&!(agent.chrome&&version>=36||agent.safari&&version>=600||agent.firefox&&version>=40||agent.node))?0:offset)+"A"];mappings.length=(code.match(lineBreaks)||[]).length+1+(offsetCode?offset:0),map={version:3,file:url,names:[],mappings:mappings.join(";AACA"),sourceRoot:"",sources:[url],sourcesContent:[source]}}return!1===paperFeatures.operatorOverloading&&!1===paperFeatures.moduleExports||function walkAST(node,parent,paperFeatures){if(node){for(var key in node)if("range"!==key&&"loc"!==key){var value=node[key];if(Array.isArray(value))for(var i=0,l=value.length;i<l;i++)walkAST(value[i],node,paperFeatures);else value&&"object"==typeof value&&walkAST(value,node,paperFeatures)}!1!==paperFeatures.operatorOverloading&&handleOverloading(node,parent),!1!==paperFeatures.moduleExports&&function handleExports(node){switch(node.type){case"ExportDefaultDeclaration":replaceCode({range:[node.start,node.declaration.start]},"module.exports = ");break;case"ExportNamedDeclaration":var declaration=node.declaration,specifiers=node.specifiers;if(declaration){var declarations=declaration.declarations;declarations&&(declarations.forEach((function(dec){replaceCode(dec,"module.exports."+getCode(dec))})),replaceCode({range:[node.start,declaration.start+declaration.kind.length]},""))}else if(specifiers){var exports=specifiers.map((function(specifier){var name=getCode(specifier);return"module.exports."+name+" = "+name+"; "})).join("");exports&&replaceCode(node,exports)}}}(node)}}(parse(code,{ranges:!0,preserveParens:!0,sourceType:"module"}),null,paperFeatures),map&&(offsetCode&&(code=new Array(offset+1).join("\n")+code),/^(inline|both)$/.test(sourceMaps)&&(code+="\n//# sourceMappingURL=data:application/json;base64,"+self.btoa(unescape(encodeURIComponent(JSON.stringify(map))))),code+="\n//# sourceURL="+(url||"paperscript")),{url,source,code,map}}function execute(code,scope,options){paper=scope;var func,view=scope.getView(),tool=/\btool\.\w+|\s+on(?:Key|Mouse)(?:Up|Down|Move|Drag)\b/.test(code)&&!/\bnew\s+Tool\b/.test(code)?new Tool:null,toolHandlers=tool?tool._events:[],handlers=["onFrame","onResize"].concat(toolHandlers),params=[],args=[],compiled="object"==typeof code?code:compile(code,options);function expose(scope,hidden){for(var key in scope)!hidden&&/^_/.test(key)||!new RegExp("([\\b\\s\\W]|^)"+key.replace(/\$/g,"\\$")+"\\b").test(code)||(params.push(key),args.push(scope[key]))}code=compiled.code,expose({__$__,$__,paper:scope,tool},!0),expose(scope),code="var module = { exports: {} }; "+code,(exports=Base.each(handlers,(function(key){new RegExp("\\s+"+key+"\\b").test(code)&&(params.push(key),this.push("module.exports."+key+" = "+key+";"))}),[]).join("\n"))&&(code+="\n"+exports),code+="\nreturn module.exports;";var agent=paper.agent;if(document&&(agent.chrome||agent.firefox&&agent.versionNumber<40)){var script=document.createElement("script"),head=document.head||document.getElementsByTagName("head")[0];agent.firefox&&(code="\n"+code),script.appendChild(document.createTextNode("document.__paperscript__ = function("+params+") {"+code+"\n}")),head.appendChild(script),func=document.__paperscript__,delete document.__paperscript__,head.removeChild(script)}else func=Function(params,code);var exports,obj=(exports=func&&func.apply(scope,args))||{};return Base.each(toolHandlers,(function(key){var value=obj[key];value&&(tool[key]=value)})),view&&(obj.onResize&&view.setOnResize(obj.onResize),view.emit("resize",{size:view.size,delta:new Point}),obj.onFrame&&view.setOnFrame(obj.onFrame),view.requestUpdate()),exports}function loadScript(script){if(/^text\/(?:x-|)paperscript$/.test(script.type)&&"true"!==PaperScope.getAttribute(script,"ignore")){var canvasId=PaperScope.getAttribute(script,"canvas"),canvas=document.getElementById(canvasId),src=script.src||script.getAttribute("data-src"),async=PaperScope.hasAttribute(script,"async");if(!canvas)throw new Error('Unable to find canvas with id "'+canvasId+'"');var scope=PaperScope.get(canvas.getAttribute("data-paper-scope"))||(new PaperScope).setup(canvas);return canvas.setAttribute("data-paper-scope",scope._id),src?Http_request({url:src,async,mimeType:"text/plain",onLoad:function(code){execute(code,scope,src)}}):execute(script.innerHTML,scope,script.baseURI),script.setAttribute("data-paper-ignore","true"),scope}}function loadAll(){Base.each(document&&document.getElementsByTagName("script"),loadScript)}return Point.inject(fields),Size.inject(fields),Color.inject(fields),window&&("complete"===document.readyState?setTimeout(loadAll):DomEvent.add(window,{load:loadAll})),{compile,execute,load:function load(script){return script?loadScript(script):loadAll()},parse,calculateBinary:__$__,calculateUnary:$__}}.call(this);var paper=new(PaperScope.inject(Base.exports,{Base,Numerical,Key,DomEvent,DomElement,document,window,Symbol:SymbolDefinition,PlacedSymbol:SymbolItem}));return paper.agent.node&&__webpack_require__("?d469")(paper),(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=paper)?__WEBPACK_AMD_DEFINE_FACTORY__.call(exports,__webpack_require__,exports,module):__WEBPACK_AMD_DEFINE_FACTORY__)===undefined||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__),paper}).call(this,"object"==typeof self?self:null)},"./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js":module=>{"use strict";var stylesInDOM=[];function getIndexByIdentifier(identifier){for(var result=-1,i=0;i<stylesInDOM.length;i++)if(stylesInDOM[i].identifier===identifier){result=i;break}return result}function modulesToDom(list,options){for(var idCountMap={},identifiers=[],i=0;i<list.length;i++){var item=list[i],id=options.base?item[0]+options.base:item[0],count=idCountMap[id]||0,identifier="".concat(id," ").concat(count);idCountMap[id]=count+1;var indexByIdentifier=getIndexByIdentifier(identifier),obj={css:item[1],media:item[2],sourceMap:item[3],supports:item[4],layer:item[5]};if(-1!==indexByIdentifier)stylesInDOM[indexByIdentifier].references++,stylesInDOM[indexByIdentifier].updater(obj);else{var updater=addElementStyle(obj,options);options.byIndex=i,stylesInDOM.splice(i,0,{identifier,updater,references:1})}identifiers.push(identifier)}return identifiers}function addElementStyle(obj,options){var api=options.domAPI(options);api.update(obj);return function updater(newObj){if(newObj){if(newObj.css===obj.css&&newObj.media===obj.media&&newObj.sourceMap===obj.sourceMap&&newObj.supports===obj.supports&&newObj.layer===obj.layer)return;api.update(obj=newObj)}else api.remove()}}module.exports=function(list,options){var lastIdentifiers=modulesToDom(list=list||[],options=options||{});return function update(newList){newList=newList||[];for(var i=0;i<lastIdentifiers.length;i++){var index=getIndexByIdentifier(lastIdentifiers[i]);stylesInDOM[index].references--}for(var newLastIdentifiers=modulesToDom(newList,options),_i=0;_i<lastIdentifiers.length;_i++){var _index=getIndexByIdentifier(lastIdentifiers[_i]);0===stylesInDOM[_index].references&&(stylesInDOM[_index].updater(),stylesInDOM.splice(_index,1))}lastIdentifiers=newLastIdentifiers}}},"./node_modules/style-loader/dist/runtime/insertBySelector.js":module=>{"use strict";var memo={};module.exports=function insertBySelector(insert,style){var target=function getTarget(target){if(void 0===memo[target]){var styleTarget=document.querySelector(target);if(window.HTMLIFrameElement&&styleTarget instanceof window.HTMLIFrameElement)try{styleTarget=styleTarget.contentDocument.head}catch(e){styleTarget=null}memo[target]=styleTarget}return memo[target]}(insert);if(!target)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");target.appendChild(style)}},"./node_modules/style-loader/dist/runtime/insertStyleElement.js":module=>{"use strict";module.exports=function insertStyleElement(options){var element=document.createElement("style");return options.setAttributes(element,options.attributes),options.insert(element,options.options),element}},"./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";module.exports=function setAttributesWithoutAttributes(styleElement){var nonce=__webpack_require__.nc;nonce&&styleElement.setAttribute("nonce",nonce)}},"./node_modules/style-loader/dist/runtime/styleDomAPI.js":module=>{"use strict";module.exports=function domAPI(options){if("undefined"==typeof document)return{update:function update(){},remove:function remove(){}};var styleElement=options.insertStyleElement(options);return{update:function update(obj){!function apply(styleElement,options,obj){var css="";obj.supports&&(css+="@supports (".concat(obj.supports,") {")),obj.media&&(css+="@media ".concat(obj.media," {"));var needLayer=void 0!==obj.layer;needLayer&&(css+="@layer".concat(obj.layer.length>0?" ".concat(obj.layer):""," {")),css+=obj.css,needLayer&&(css+="}"),obj.media&&(css+="}"),obj.supports&&(css+="}");var sourceMap=obj.sourceMap;sourceMap&&"undefined"!=typeof btoa&&(css+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))))," */")),options.styleTagTransform(css,styleElement,options.options)}(styleElement,options,obj)},remove:function remove(){!function removeStyleElement(styleElement){if(null===styleElement.parentNode)return!1;styleElement.parentNode.removeChild(styleElement)}(styleElement)}}}},"./node_modules/style-loader/dist/runtime/styleTagTransform.js":module=>{"use strict";module.exports=function styleTagTransform(css,styleElement){if(styleElement.styleSheet)styleElement.styleSheet.cssText=css;else{for(;styleElement.firstChild;)styleElement.removeChild(styleElement.firstChild);styleElement.appendChild(document.createTextNode(css))}}},"./node_modules/tweakpane/dist/tweakpane.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function isEmpty(value){return null==value}function isObject$1(value){return null!==value&&"object"==typeof value}function isRecord(value){return null!==value&&"object"==typeof value}function deepEqualsArray(a1,a2){if(a1.length!==a2.length)return!1;for(let i=0;i<a1.length;i++)if(a1[i]!==a2[i])return!1;return!0}function deepMerge(r1,r2){return Array.from(new Set([...Object.keys(r1),...Object.keys(r2)])).reduce(((result,key)=>{const v1=r1[key],v2=r2[key];return isRecord(v1)&&isRecord(v2)?Object.assign(Object.assign({},result),{[key]:deepMerge(v1,v2)}):Object.assign(Object.assign({},result),{[key]:key in r2?v2:v1})}),{})}function isBinding(value){return!!isObject$1(value)&&"target"in value}__webpack_require__.d(__webpack_exports__,{Zv:()=>Pane});const CREATE_MESSAGE_MAP={alreadydisposed:()=>"View has been already disposed",invalidparams:context=>`Invalid parameters for '${context.name}'`,nomatchingcontroller:context=>`No matching controller for '${context.key}'`,nomatchingview:context=>`No matching view for '${JSON.stringify(context.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:context=>`Not compatible with  plugin '${context.id}'`,propertynotfound:context=>`Property '${context.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class TpError{static alreadyDisposed(){return new TpError({type:"alreadydisposed"})}static notBindable(){return new TpError({type:"notbindable"})}static notCompatible(bundleId,id){return new TpError({type:"notcompatible",context:{id:`${bundleId}.${id}`}})}static propertyNotFound(name){return new TpError({type:"propertynotfound",context:{name}})}static shouldNeverHappen(){return new TpError({type:"shouldneverhappen"})}constructor(config){var _a;this.message=null!==(_a=CREATE_MESSAGE_MAP[config.type](config.context))&&void 0!==_a?_a:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=config.type}toString(){return this.message}}class BindingTarget{constructor(obj,key){this.obj_=obj,this.key=key}static isBindable(obj){return null!==obj&&("object"==typeof obj||"function"==typeof obj)}read(){return this.obj_[this.key]}write(value){this.obj_[this.key]=value}writeProperty(name,value){const valueObj=this.read();if(!BindingTarget.isBindable(valueObj))throw TpError.notBindable();if(!(name in valueObj))throw TpError.propertyNotFound(name);valueObj[name]=value}}class Emitter{constructor(){this.observers_={}}on(eventName,handler,opt_options){var _a;let observers=this.observers_[eventName];return observers||(observers=this.observers_[eventName]=[]),observers.push({handler,key:null!==(_a=null==opt_options?void 0:opt_options.key)&&void 0!==_a?_a:handler}),this}off(eventName,key){const observers=this.observers_[eventName];return observers&&(this.observers_[eventName]=observers.filter((observer=>observer.key!==key))),this}emit(eventName,event){const observers=this.observers_[eventName];observers&&observers.forEach((observer=>{observer.handler(event)}))}}class ComplexValue{constructor(initialValue,config){var _a;this.constraint_=null==config?void 0:config.constraint,this.equals_=null!==(_a=null==config?void 0:config.equals)&&void 0!==_a?_a:(v1,v2)=>v1===v2,this.emitter=new Emitter,this.rawValue_=initialValue}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(rawValue){this.setRawValue(rawValue,{forceEmit:!1,last:!0})}setRawValue(rawValue,options){const opts=null!=options?options:{forceEmit:!1,last:!0},constrainedValue=this.constraint_?this.constraint_.constrain(rawValue):rawValue,prevValue=this.rawValue_;(!this.equals_(prevValue,constrainedValue)||opts.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=constrainedValue,this.emitter.emit("change",{options:opts,previousRawValue:prevValue,rawValue:constrainedValue,sender:this}))}}class PrimitiveValue{constructor(initialValue){this.emitter=new Emitter,this.value_=initialValue}get rawValue(){return this.value_}set rawValue(value){this.setRawValue(value,{forceEmit:!1,last:!0})}setRawValue(value,options){const opts=null!=options?options:{forceEmit:!1,last:!0},prevValue=this.value_;(prevValue!==value||opts.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=value,this.emitter.emit("change",{options:opts,previousRawValue:prevValue,rawValue:this.value_,sender:this}))}}class ReadonlyPrimitiveValue{constructor(value){this.emitter=new Emitter,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=value,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(ev){this.emitter.emit("beforechange",Object.assign(Object.assign({},ev),{sender:this}))}onValueChange_(ev){this.emitter.emit("change",Object.assign(Object.assign({},ev),{sender:this}))}}function createValue(initialValue,config){const constraint=null==config?void 0:config.constraint,equals=null==config?void 0:config.equals;return constraint||equals?new ComplexValue(initialValue,config):new PrimitiveValue(initialValue)}class ValueMap{constructor(valueMap){this.emitter=new Emitter,this.valMap_=valueMap;for(const key in this.valMap_){this.valMap_[key].emitter.on("change",(()=>{this.emitter.emit("change",{key,sender:this})}))}}static createCore(initialValue){return Object.keys(initialValue).reduce(((o,key)=>Object.assign(o,{[key]:createValue(initialValue[key])})),{})}static fromObject(initialValue){const core=this.createCore(initialValue);return new ValueMap(core)}get(key){return this.valMap_[key].rawValue}set(key,value){this.valMap_[key].rawValue=value}value(key){return this.valMap_[key]}}class DefiniteRangeConstraint{constructor(config){this.values=ValueMap.fromObject({max:config.max,min:config.min})}constrain(value){const max=this.values.get("max"),min=this.values.get("min");return Math.min(Math.max(value,min),max)}}class RangeConstraint{constructor(config){this.values=ValueMap.fromObject({max:config.max,min:config.min})}constrain(value){const max=this.values.get("max"),min=this.values.get("min");let result=value;return isEmpty(min)||(result=Math.max(result,min)),isEmpty(max)||(result=Math.min(result,max)),result}}class StepConstraint{constructor(step,origin=0){this.step=step,this.origin=origin}constrain(value){const o=this.origin%this.step;return o+Math.round((value-o)/this.step)*this.step}}class NumberLiteralNode{constructor(text){this.text=text}evaluate(){return Number(this.text)}toString(){return this.text}}const BINARY_OPERATION_MAP={"**":(v1,v2)=>Math.pow(v1,v2),"*":(v1,v2)=>v1*v2,"/":(v1,v2)=>v1/v2,"%":(v1,v2)=>v1%v2,"+":(v1,v2)=>v1+v2,"-":(v1,v2)=>v1-v2,"<<":(v1,v2)=>v1<<v2,">>":(v1,v2)=>v1>>v2,">>>":(v1,v2)=>v1>>>v2,"&":(v1,v2)=>v1&v2,"^":(v1,v2)=>v1^v2,"|":(v1,v2)=>v1|v2};class BinaryOperationNode{constructor(operator,left,right){this.left=left,this.operator=operator,this.right=right}evaluate(){const op=BINARY_OPERATION_MAP[this.operator];if(!op)throw new Error(`unexpected binary operator: '${this.operator}`);return op(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const UNARY_OPERATION_MAP={"+":v=>v,"-":v=>-v,"~":v=>~v};class UnaryOperationNode{constructor(operator,expr){this.operator=operator,this.expression=expr}evaluate(){const op=UNARY_OPERATION_MAP[this.operator];if(!op)throw new Error(`unexpected unary operator: '${this.operator}`);return op(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function combineReader(parsers){return(text,cursor)=>{for(let i=0;i<parsers.length;i++){const result=parsers[i](text,cursor);if(""!==result)return result}return""}}function readWhitespace(text,cursor){var _a;const m=text.substr(cursor).match(/^\s+/);return null!==(_a=m&&m[0])&&void 0!==_a?_a:""}function readDecimalDigits(text,cursor){var _a;const m=text.substr(cursor).match(/^[0-9]+/);return null!==(_a=m&&m[0])&&void 0!==_a?_a:""}function readExponentPart(text,cursor){const e=text.substr(cursor,1);if(cursor+=1,"e"!==e.toLowerCase())return"";const si=function readSignedInteger(text,cursor){const ds=readDecimalDigits(text,cursor);if(""!==ds)return ds;const sign=text.substr(cursor,1);if("-"!==sign&&"+"!==sign)return"";const sds=readDecimalDigits(text,cursor+=1);return""===sds?"":sign+sds}(text,cursor);return""===si?"":e+si}function readDecimalIntegerLiteral(text,cursor){const ch=text.substr(cursor,1);if("0"===ch)return ch;const nzd=function readNonZeroDigit(text,cursor){const ch=text.substr(cursor,1);return ch.match(/^[1-9]$/)?ch:""}(text,cursor);return cursor+=nzd.length,""===nzd?"":nzd+readDecimalDigits(text,cursor)}const readDecimalLiteral=combineReader([function readDecimalLiteral1(text,cursor){const dil=readDecimalIntegerLiteral(text,cursor);if(cursor+=dil.length,""===dil)return"";const dot=text.substr(cursor,1);if(cursor+=dot.length,"."!==dot)return"";const dds=readDecimalDigits(text,cursor);return dil+dot+dds+readExponentPart(text,cursor+=dds.length)},function readDecimalLiteral2(text,cursor){const dot=text.substr(cursor,1);if(cursor+=dot.length,"."!==dot)return"";const dds=readDecimalDigits(text,cursor);return cursor+=dds.length,""===dds?"":dot+dds+readExponentPart(text,cursor)},function readDecimalLiteral3(text,cursor){const dil=readDecimalIntegerLiteral(text,cursor);return cursor+=dil.length,""===dil?"":dil+readExponentPart(text,cursor)}]);const readNonDecimalIntegerLiteral=combineReader([function readBinaryIntegerLiteral(text,cursor){const prefix=text.substr(cursor,2);if(cursor+=prefix.length,"0b"!==prefix.toLowerCase())return"";const bds=function parseBinaryDigits(text,cursor){var _a;const m=text.substr(cursor).match(/^[01]+/);return null!==(_a=m&&m[0])&&void 0!==_a?_a:""}(text,cursor);return""===bds?"":prefix+bds},function readOctalIntegerLiteral(text,cursor){const prefix=text.substr(cursor,2);if(cursor+=prefix.length,"0o"!==prefix.toLowerCase())return"";const ods=function readOctalDigits(text,cursor){var _a;const m=text.substr(cursor).match(/^[0-7]+/);return null!==(_a=m&&m[0])&&void 0!==_a?_a:""}(text,cursor);return""===ods?"":prefix+ods},function readHexIntegerLiteral(text,cursor){const prefix=text.substr(cursor,2);if(cursor+=prefix.length,"0x"!==prefix.toLowerCase())return"";const hds=function readHexDigits(text,cursor){var _a;const m=text.substr(cursor).match(/^[0-9a-f]+/i);return null!==(_a=m&&m[0])&&void 0!==_a?_a:""}(text,cursor);return""===hds?"":prefix+hds}]),readNumericLiteral=combineReader([readNonDecimalIntegerLiteral,readDecimalLiteral]);function parsePrimaryExpression(text,cursor){var _a;return null!==(_a=function parseLiteral(text,cursor){const num=readNumericLiteral(text,cursor);return cursor+=num.length,""===num?null:{evaluable:new NumberLiteralNode(num),cursor}}(text,cursor))&&void 0!==_a?_a:function parseParenthesizedExpression(text,cursor){const op=text.substr(cursor,1);if(cursor+=op.length,"("!==op)return null;const expr=parseExpression(text,cursor);if(!expr)return null;cursor=expr.cursor,cursor+=readWhitespace(text,cursor).length;const cl=text.substr(cursor,1);return cursor+=cl.length,")"!==cl?null:{evaluable:expr.evaluable,cursor}}(text,cursor)}function readBinaryOperator(ops,text,cursor){cursor+=readWhitespace(text,cursor).length;const op=ops.filter((op=>text.startsWith(op,cursor)))[0];return op?(cursor+=op.length,{cursor:cursor+=readWhitespace(text,cursor).length,operator:op}):null}const parseBinaryOperationExpression=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce(((parser,ops)=>function createBinaryOperationExpressionParser(exprParser,ops){return(text,cursor)=>{const firstExpr=exprParser(text,cursor);if(!firstExpr)return null;cursor=firstExpr.cursor;let expr=firstExpr.evaluable;for(;;){const op=readBinaryOperator(ops,text,cursor);if(!op)break;cursor=op.cursor;const nextExpr=exprParser(text,cursor);if(!nextExpr)return null;cursor=nextExpr.cursor,expr=new BinaryOperationNode(op.operator,expr,nextExpr.evaluable)}return expr?{cursor,evaluable:expr}:null}}(parser,ops)),(function parseUnaryExpression(text,cursor){const expr=parsePrimaryExpression(text,cursor);if(expr)return expr;const op=text.substr(cursor,1);if(cursor+=op.length,"+"!==op&&"-"!==op&&"~"!==op)return null;const num=parseUnaryExpression(text,cursor);return num?{cursor:cursor=num.cursor,evaluable:new UnaryOperationNode(op,num.evaluable)}:null}));function parseExpression(text,cursor){return cursor+=readWhitespace(text,cursor).length,parseBinaryOperationExpression(text,cursor)}function parseNumber(text){var _a;const r=function parseEcmaNumberExpression(text){const expr=parseExpression(text,0);return expr?expr.cursor+readWhitespace(text,expr.cursor).length!==text.length?null:expr.evaluable:null}(text);return null!==(_a=null==r?void 0:r.evaluate())&&void 0!==_a?_a:null}function numberFromUnknown(value){if("number"==typeof value)return value;if("string"==typeof value){const pv=parseNumber(value);if(!isEmpty(pv))return pv}return 0}function numberToString(value){return String(value)}function createNumberFormatter(digits){return value=>value.toFixed(Math.max(Math.min(digits,20),0))}function mapRange(value,start1,end1,start2,end2){return start2+(value-start1)/(end1-start1)*(end2-start2)}function getDecimalDigits(value){return String(value.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function constrainRange(value,min,max){return Math.min(Math.max(value,min),max)}function loopRange(value,max){return(value%max+max)%max}function getSuitableDecimalDigits(params,rawValue){return isEmpty(params.step)?Math.max(getDecimalDigits(rawValue),2):getDecimalDigits(params.step)}function getSuitableKeyScale(params){var _a;return null!==(_a=params.step)&&void 0!==_a?_a:1}function getSuitablePointerScale(params,rawValue){var _a;const base=Math.abs(null!==(_a=params.step)&&void 0!==_a?_a:rawValue);return 0===base?.1:Math.pow(10,Math.floor(Math.log10(base))-1)}function createStepConstraint(params,initialValue){return isEmpty(params.step)?null:new StepConstraint(params.step,initialValue)}function createRangeConstraint(params){return isEmpty(params.max)||isEmpty(params.min)?isEmpty(params.max)&&isEmpty(params.min)?null:new RangeConstraint({max:params.max,min:params.min}):new DefiniteRangeConstraint({max:params.max,min:params.min})}function createNumberTextPropsObject(params,initialValue){var _a,_b,_c;return{formatter:null!==(_a=params.format)&&void 0!==_a?_a:createNumberFormatter(getSuitableDecimalDigits(params,initialValue)),keyScale:null!==(_b=params.keyScale)&&void 0!==_b?_b:getSuitableKeyScale(params),pointerScale:null!==(_c=params.pointerScale)&&void 0!==_c?_c:getSuitablePointerScale(params,initialValue)}}function createNumberTextInputParamsParser(p){return{format:p.optional.function,keyScale:p.optional.number,max:p.optional.number,min:p.optional.number,pointerScale:p.optional.number,step:p.optional.number}}function createPointAxis(config){return{constraint:config.constraint,textProps:ValueMap.fromObject(createNumberTextPropsObject(config.params,config.initialValue))}}class BladeApi{constructor(controller){this.controller=controller}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(disabled){this.controller.viewProps.set("disabled",disabled)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(hidden){this.controller.viewProps.set("hidden",hidden)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(state){return this.controller.importState(state)}exportState(){return this.controller.exportState()}}class TpEvent{constructor(target){this.target=target}}class TpChangeEvent extends TpEvent{constructor(target,value,last){super(target),this.value=value,this.last=null==last||last}}class TpFoldEvent extends TpEvent{constructor(target,expanded){super(target),this.expanded=expanded}}class TpTabSelectEvent extends TpEvent{constructor(target,index){super(target),this.index=index}}class TpMouseEvent extends TpEvent{constructor(target,nativeEvent){super(target),this.native=nativeEvent}}class BindingApi extends BladeApi{constructor(controller){super(controller),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new Emitter,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(label){this.controller.labelController.props.set("label",label)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(tag){this.controller.tag=tag}on(eventName,handler){const bh=handler.bind(this);return this.emitter_.on(eventName,(ev=>{bh(ev)}),{key:handler}),this}off(eventName,handler){return this.emitter_.off(eventName,handler),this}refresh(){this.controller.value.fetch()}onValueChange_(ev){const value=this.controller.value;this.emitter_.emit("change",new TpChangeEvent(this,value.binding.target.read(),ev.options.last))}}class InputBindingValue{constructor(value,binding){this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=binding,this.value_=value,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.emitter=new Emitter}get rawValue(){return this.value_.rawValue}set rawValue(rawValue){this.value_.rawValue=rawValue}setRawValue(rawValue,options){this.value_.setRawValue(rawValue,options)}fetch(){this.value_.rawValue=this.binding.read()}push(){this.binding.write(this.value_.rawValue)}onValueBeforeChange_(ev){this.emitter.emit("beforechange",Object.assign(Object.assign({},ev),{sender:this}))}onValueChange_(ev){this.push(),this.emitter.emit("change",Object.assign(Object.assign({},ev),{sender:this}))}}function createMicroParserBuilder(parse){return optional=>v=>{if(!optional&&void 0===v)return{succeeded:!1,value:void 0};if(optional&&void 0===v)return{succeeded:!0,value:void 0};const result=parse(v);return void 0!==result?{succeeded:!0,value:result}:{succeeded:!1,value:void 0}}}function createMicroParserBuilders(optional){return{custom:parse=>createMicroParserBuilder(parse)(optional),boolean:createMicroParserBuilder((v=>"boolean"==typeof v?v:void 0))(optional),number:createMicroParserBuilder((v=>"number"==typeof v?v:void 0))(optional),string:createMicroParserBuilder((v=>"string"==typeof v?v:void 0))(optional),function:createMicroParserBuilder((v=>"function"==typeof v?v:void 0))(optional),constant:value=>createMicroParserBuilder((v=>v===value?value:void 0))(optional),raw:createMicroParserBuilder((v=>v))(optional),object:keyToParserMap=>createMicroParserBuilder((v=>{if(function isObject(value){return null!==value&&"object"==typeof value}(v))return function parseObject(value,keyToParserMap){return Object.keys(keyToParserMap).reduce(((tmp,key)=>{if(void 0===tmp)return;const result=(0,keyToParserMap[key])(value[key]);return result.succeeded?Object.assign(Object.assign({},tmp),{[key]:result.value}):void 0}),{})}(v,keyToParserMap)}))(optional),array:itemParser=>createMicroParserBuilder((v=>{if(Array.isArray(v))return function parseArray(value,parseItem){return value.reduce(((tmp,item)=>{if(void 0===tmp)return;const result=parseItem(item);return result.succeeded&&void 0!==result.value?[...tmp,result.value]:void 0}),[])}(v,itemParser)}))(optional)}}const MicroParsers={optional:createMicroParserBuilders(!0),required:createMicroParserBuilders(!1)};function parseRecord(value,keyToParserMap){const map=keyToParserMap(MicroParsers),result=MicroParsers.required.object(map)(value);return result.succeeded?result.value:void 0}function importBladeState(state,superImport,parser,callback){if(superImport&&!superImport(state))return!1;const result=parseRecord(state,parser);return!!result&&callback(result)}function exportBladeState(superExport,thisState){var _a;return deepMerge(null!==(_a=null==superExport?void 0:superExport())&&void 0!==_a?_a:{},thisState)}function isValueBladeController(bc){return"value"in bc}function isBindingValue(v){if(!isObject$1(v)||!("binding"in v))return!1;return isBinding(v.binding)}const SVG_NS="http://www.w3.org/2000/svg";function forceReflow(element){element.offsetHeight}function supportsTouch(doc){return void 0!==doc.ontouchstart}function getWindowDocument(){return function getGlobalObject(){return globalThis}().document}const ICON_ID_TO_INNER_HTML_MAP={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function createSvgIconElement(document,iconId){const elem=document.createElementNS(SVG_NS,"svg");return elem.innerHTML=ICON_ID_TO_INNER_HTML_MAP[iconId],elem}function insertElementAt(parentElement,element,index){parentElement.insertBefore(element,parentElement.children[index])}function removeElement(element){element.parentElement&&element.parentElement.removeChild(element)}function removeChildElements(element){for(;element.children.length>0;)element.removeChild(element.children[0])}function findNextTarget(ev){return ev.relatedTarget?ev.relatedTarget:"explicitOriginalTarget"in ev?ev.explicitOriginalTarget:null}function bindValue(value,applyValue){value.emitter.on("change",(ev=>{applyValue(ev.rawValue)})),applyValue(value.rawValue)}function bindValueMap(valueMap,key,applyValue){bindValue(valueMap.value(key),applyValue)}const PREFIX="tp";function ClassName(viewName){return(opt_elementName,opt_modifier)=>[PREFIX,"-",viewName,"v",opt_elementName?`_${opt_elementName}`:"",opt_modifier?`-${opt_modifier}`:""].join("")}const cn$r=ClassName("lbl");class LabelView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(cn$r()),config.viewProps.bindClassModifiers(this.element);const labelElem=doc.createElement("div");labelElem.classList.add(cn$r("l")),bindValueMap(config.props,"label",(value=>{isEmpty(value)?this.element.classList.add(cn$r(void 0,"nol")):(this.element.classList.remove(cn$r(void 0,"nol")),function removeChildNodes(element){for(;element.childNodes.length>0;)element.removeChild(element.childNodes[0])}(labelElem),labelElem.appendChild(function createLabelNode(doc,label){const frag=doc.createDocumentFragment();return label.split("\n").map((line=>doc.createTextNode(line))).forEach(((lineNode,index)=>{index>0&&frag.appendChild(doc.createElement("br")),frag.appendChild(lineNode)})),frag}(doc,value)))})),this.element.appendChild(labelElem),this.labelElement=labelElem;const valueElem=doc.createElement("div");valueElem.classList.add(cn$r("v")),this.element.appendChild(valueElem),this.valueElement=valueElem}}class LabelController{constructor(doc,config){this.props=config.props,this.valueController=config.valueController,this.viewProps=config.valueController.viewProps,this.view=new LabelView(doc,{props:config.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(state){return importBladeState(state,null,(p=>({label:p.optional.string})),(result=>(this.props.set("label",result.label),!0)))}exportProps(){return exportBladeState(null,{label:this.props.get("label")})}}const cn$q=ClassName(""),POS_TO_CLASS_NAME_MAP={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class BladeController{constructor(config){this.parent_=null,this.blade=config.blade,this.view=config.view,this.viewProps=config.viewProps;const elem=this.view.element;this.blade.value("positions").emitter.on("change",(()=>{["veryfirst","first","last","verylast"].forEach((pos=>{elem.classList.remove(cn$q(void 0,POS_TO_CLASS_NAME_MAP[pos]))})),this.blade.get("positions").forEach((pos=>{elem.classList.add(cn$q(void 0,POS_TO_CLASS_NAME_MAP[pos]))}))})),this.viewProps.handleDispose((()=>{removeElement(elem)}))}get parent(){return this.parent_}set parent(parent){this.parent_=parent,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(state){return importBladeState(state,null,(p=>({disabled:p.required.boolean,hidden:p.required.boolean})),(result=>(this.viewProps.importState(result),!0)))}exportState(){return exportBladeState(null,Object.assign({},this.viewProps.exportState()))}}class LabeledValueBladeController extends BladeController{constructor(doc,config){if(config.value!==config.valueController.value)throw TpError.shouldNeverHappen();const viewProps=config.valueController.viewProps,lc=new LabelController(doc,{blade:config.blade,props:config.props,valueController:config.valueController});super(Object.assign(Object.assign({},config),{view:new LabelView(doc,{props:config.props,viewProps}),viewProps})),this.labelController=lc,this.value=config.value,this.valueController=config.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(state){return importBladeState(state,(s=>{var _a,_b,_c;return super.importState(s)&&this.labelController.importProps(s)&&(null===(_c=null===(_b=(_a=this.valueController).importProps)||void 0===_b?void 0:_b.call(_a,state))||void 0===_c||_c)}),(p=>({value:p.optional.raw})),(result=>(result.value&&(this.value.rawValue=result.value),!0)))}exportState(){var _a,_b,_c;return exportBladeState((()=>super.exportState()),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),null!==(_c=null===(_b=(_a=this.valueController).exportProps)||void 0===_b?void 0:_b.call(_a))&&void 0!==_c?_c:{}))}}function excludeValue(state){const result=Object.assign({},state);return delete result.value,result}class BindingController extends LabeledValueBladeController{constructor(doc,config){super(doc,config),this.tag=config.tag}importState(state){return importBladeState(state,(_s=>super.importState(excludeValue(state))),(p=>({tag:p.optional.string})),(result=>(this.tag=result.tag,!0)))}exportState(){return exportBladeState((()=>excludeValue(super.exportState())),{binding:{key:this.value.binding.target.key,value:this.value.binding.target.read()},tag:this.tag})}}class InputBindingController extends BindingController{importState(state){return importBladeState(state,(s=>super.importState(s)),(p=>({binding:p.required.object({value:p.required.raw})})),(result=>(this.value.binding.inject(result.binding.value),this.value.fetch(),!0)))}}function isInputBindingController(bc){return isValueBladeController(bc)&&function isInputBindingValue(v){if(!("binding"in v))return!1;const b=v.binding;return isBinding(b)&&"read"in b&&"write"in b}(bc.value)}function fillBuffer(buffer,bufferSize){for(;buffer.length<bufferSize;)buffer.push(void 0)}function createTrimmedBuffer(buffer){const index=buffer.indexOf(void 0);return index<0?buffer:buffer.slice(0,index)}class MonitorBindingValue{constructor(config){this.emitter=new Emitter,this.onTick_=this.onTick_.bind(this),this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=config.binding,this.value_=createValue(function initializeBuffer(bufferSize){const buffer=[];return fillBuffer(buffer,bufferSize),buffer}(config.bufferSize)),this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.ticker=config.ticker,this.ticker.emitter.on("tick",this.onTick_),this.fetch()}get rawValue(){return this.value_.rawValue}set rawValue(rawValue){this.value_.rawValue=rawValue}setRawValue(rawValue,options){this.value_.setRawValue(rawValue,options)}fetch(){this.value_.rawValue=function createPushedBuffer(buffer,newValue){const newBuffer=[...createTrimmedBuffer(buffer),newValue];return newBuffer.length>buffer.length?newBuffer.splice(0,newBuffer.length-buffer.length):fillBuffer(newBuffer,buffer.length),newBuffer}(this.value_.rawValue,this.binding.read())}onTick_(){this.fetch()}onValueBeforeChange_(ev){this.emitter.emit("beforechange",Object.assign(Object.assign({},ev),{sender:this}))}onValueChange_(ev){this.emitter.emit("change",Object.assign(Object.assign({},ev),{sender:this}))}}class MonitorBindingController extends BindingController{exportState(){return exportBladeState((()=>super.exportState()),{binding:{readonly:!0}})}}function isMonitorBindingController(bc){return isValueBladeController(bc)&&function isMonitorBindingValue(v){if(!("binding"in v))return!1;const b=v.binding;return isBinding(b)&&"read"in b&&!("write"in b)}(bc.value)}class ButtonApi extends BladeApi{get label(){return this.controller.labelController.props.get("label")}set label(label){this.controller.labelController.props.set("label",label)}get title(){var _a;return null!==(_a=this.controller.buttonController.props.get("title"))&&void 0!==_a?_a:""}set title(title){this.controller.buttonController.props.set("title",title)}on(eventName,handler){const bh=handler.bind(this);return this.controller.buttonController.emitter.on(eventName,(ev=>{bh(new TpMouseEvent(this,ev.nativeEvent))})),this}off(eventName,handler){return this.controller.buttonController.emitter.off(eventName,handler),this}}function valueToClassName(elem,className){return value=>{!function applyClass(elem,className,active){active?elem.classList.add(className):elem.classList.remove(className)}(elem,className,value)}}function bindValueToTextContent(value,elem){bindValue(value,(text=>{elem.textContent=null!=text?text:""}))}const cn$p=ClassName("btn");class ButtonView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(cn$p()),config.viewProps.bindClassModifiers(this.element);const buttonElem=doc.createElement("button");buttonElem.classList.add(cn$p("b")),config.viewProps.bindDisabled(buttonElem),this.element.appendChild(buttonElem),this.buttonElement=buttonElem;const titleElem=doc.createElement("div");titleElem.classList.add(cn$p("t")),bindValueToTextContent(config.props.value("title"),titleElem),this.buttonElement.appendChild(titleElem)}}class ButtonController{constructor(doc,config){this.emitter=new Emitter,this.onClick_=this.onClick_.bind(this),this.props=config.props,this.viewProps=config.viewProps,this.view=new ButtonView(doc,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(state){return importBladeState(state,null,(p=>({title:p.optional.string})),(result=>(this.props.set("title",result.title),!0)))}exportProps(){return exportBladeState(null,{title:this.props.get("title")})}onClick_(ev){this.emitter.emit("click",{nativeEvent:ev,sender:this})}}class ButtonBladeController extends BladeController{constructor(doc,config){const bc=new ButtonController(doc,{props:config.buttonProps,viewProps:config.viewProps}),lc=new LabelController(doc,{blade:config.blade,props:config.labelProps,valueController:bc});super({blade:config.blade,view:lc.view,viewProps:config.viewProps}),this.buttonController=bc,this.labelController=lc}importState(state){return importBladeState(state,(s=>super.importState(s)&&this.buttonController.importProps(s)&&this.labelController.importProps(s)),(()=>({})),(()=>!0))}exportState(){return exportBladeState((()=>super.exportState()),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}class Semver{constructor(text){const[core,prerelease]=text.split("-"),coreComps=core.split(".");this.major=parseInt(coreComps[0],10),this.minor=parseInt(coreComps[1],10),this.patch=parseInt(coreComps[2],10),this.prerelease=null!=prerelease?prerelease:null}toString(){const core=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[core,this.prerelease].join("-"):core}}const VERSION$1=new Semver("2.0.3");function createPlugin(plugin){return Object.assign({core:VERSION$1},plugin)}const ButtonBladePlugin=createPlugin({id:"button",type:"blade",accept(params){const result=parseRecord(params,(p=>({title:p.required.string,view:p.required.constant("button"),label:p.optional.string})));return result?{params:result}:null},controller:args=>new ButtonBladeController(args.document,{blade:args.blade,buttonProps:ValueMap.fromObject({title:args.params.title}),labelProps:ValueMap.fromObject({label:args.params.label}),viewProps:args.viewProps}),api:args=>args.controller instanceof ButtonBladeController?new ButtonApi(args.controller):null});class RackApi{constructor(controller,pool){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=controller,this.emitter_=new Emitter,this.pool_=pool;this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map((bc=>this.pool_.createApi(bc)))}addBinding(object,key,opt_params){const params=null!=opt_params?opt_params:{},doc=this.controller_.element.ownerDocument,bc=this.pool_.createBinding(doc,function createBindingTarget(obj,key){if(!BindingTarget.isBindable(obj))throw TpError.notBindable();return new BindingTarget(obj,key)}(object,key),params),api=this.pool_.createBindingApi(bc);return this.add(api,params.index)}addFolder(params){return function addFolderAsBlade(api,params){return api.addBlade(Object.assign(Object.assign({},params),{view:"folder"}))}(this,params)}addButton(params){return function addButtonAsBlade(api,params){return api.addBlade(Object.assign(Object.assign({},params),{view:"button"}))}(this,params)}addTab(params){return function addTabAsBlade(api,params){return api.addBlade(Object.assign(Object.assign({},params),{view:"tab"}))}(this,params)}add(api,opt_index){const bc=api.controller;return this.controller_.rack.add(bc,opt_index),api}remove(api){this.controller_.rack.remove(api.controller)}addBlade(params){const doc=this.controller_.element.ownerDocument,bc=this.pool_.createBlade(doc,params),api=this.pool_.createApi(bc);return this.add(api,params.index)}on(eventName,handler){const bh=handler.bind(this);return this.emitter_.on(eventName,(ev=>{bh(ev)}),{key:handler}),this}off(eventName,handler){return this.emitter_.off(eventName,handler),this}refresh(){this.children.forEach((c=>{(function isRefreshable(value){return!!isObject$1(value)&&"refresh"in value&&"function"==typeof value.refresh})(c)&&c.refresh()}))}onRackValueChange_(ev){const bc=ev.bladeController,api=this.pool_.createApi(bc),binding=isBindingValue(bc.value)?bc.value.binding:null;this.emitter_.emit("change",new TpChangeEvent(api,binding?binding.target.read():bc.value.rawValue,ev.options.last))}}class ContainerBladeApi extends BladeApi{constructor(controller,pool){super(controller),this.rackApi_=new RackApi(controller.rackController,pool)}refresh(){this.rackApi_.refresh()}}class ContainerBladeController extends BladeController{constructor(config){super({blade:config.blade,view:config.view,viewProps:config.rackController.viewProps}),this.rackController=config.rackController}importState(state){return importBladeState(state,(s=>super.importState(s)),(p=>({children:p.required.array(p.required.raw)})),(result=>this.rackController.rack.children.every(((c,index)=>c.importState(result.children[index])))))}exportState(){return exportBladeState((()=>super.exportState()),{children:this.rackController.rack.children.map((c=>c.exportState()))})}}function isContainerBladeController(bc){return"rackController"in bc}class NestedOrderedSet{constructor(extract){this.emitter=new Emitter,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=extract}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(callback){for(const item of this.allItems())if(callback(item))return item;return null}includes(item){return this.cache_.has(item)}add(item,opt_index){if(this.includes(item))throw TpError.shouldNeverHappen();const index=void 0!==opt_index?opt_index:this.items_.length;this.items_.splice(index,0,item),this.cache_.add(item);const subList=this.extract_(item);subList&&(subList.emitter.on("add",this.onSubListAdd_),subList.emitter.on("remove",this.onSubListRemove_),subList.allItems().forEach((i=>{this.cache_.add(i)}))),this.emitter.emit("add",{index,item,root:this,target:this})}remove(item){const index=this.items_.indexOf(item);if(index<0)return;this.items_.splice(index,1),this.cache_.delete(item);const subList=this.extract_(item);subList&&(subList.allItems().forEach((i=>{this.cache_.delete(i)})),subList.emitter.off("add",this.onSubListAdd_),subList.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index,item,root:this,target:this})}onSubListAdd_(ev){this.cache_.add(ev.item),this.emitter.emit("add",{index:ev.index,item:ev.item,root:this,target:ev.target})}onSubListRemove_(ev){this.cache_.delete(ev.item),this.emitter.emit("remove",{index:ev.index,item:ev.item,root:this,target:ev.target})}}function findSubBladeControllerSet(bc){return isContainerBladeController(bc)?bc.rackController.rack.bcSet_:null}class Rack{constructor(config){var _a,_b;this.emitter=new Emitter,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=null!==(_a=config.blade)&&void 0!==_a?_a:null,null===(_b=this.blade_)||void 0===_b||_b.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=config.viewProps,this.bcSet_=new NestedOrderedSet(findSubBladeControllerSet),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(bc,opt_index){var _a;null===(_a=bc.parent)||void 0===_a||_a.remove(bc),bc.parent=this,this.bcSet_.add(bc,opt_index)}remove(bc){bc.parent=null,this.bcSet_.remove(bc)}find(finder){return this.bcSet_.allItems().filter(finder)}onSetAdd_(ev){this.updatePositions_();const root=ev.target===ev.root;if(this.emitter.emit("add",{bladeController:ev.item,index:ev.index,root,sender:this}),!root)return;const bc=ev.item;if(bc.viewProps.emitter.on("change",this.onChildViewPropsChange_),bc.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),bc.viewProps.handleDispose(this.onChildDispose_),isValueBladeController(bc))bc.value.emitter.on("change",this.onChildValueChange_);else if(isContainerBladeController(bc)){const rack=bc.rackController.rack;if(rack){const emitter=rack.emitter;emitter.on("layout",this.onRackLayout_),emitter.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(ev){this.updatePositions_();const root=ev.target===ev.root;if(this.emitter.emit("remove",{bladeController:ev.item,root,sender:this}),!root)return;const bc=ev.item;if(isValueBladeController(bc))bc.value.emitter.off("change",this.onChildValueChange_);else if(isContainerBladeController(bc)){const rack=bc.rackController.rack;if(rack){const emitter=rack.emitter;emitter.off("layout",this.onRackLayout_),emitter.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const visibleItems=this.bcSet_.items.filter((bc=>!bc.viewProps.get("hidden"))),firstVisibleItem=visibleItems[0],lastVisibleItem=visibleItems[visibleItems.length-1];this.bcSet_.items.forEach((bc=>{const ps=[];bc===firstVisibleItem&&(ps.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||ps.push("veryfirst")),bc===lastVisibleItem&&(ps.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||ps.push("verylast")),bc.blade.set("positions",ps)}))}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(_ev){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter((bc=>bc.viewProps.get("disposed"))).forEach((bc=>{this.bcSet_.remove(bc)}))}onChildValueChange_(ev){const bc=function findValueBladeController(bcs,v){for(let i=0;i<bcs.length;i++){const bc=bcs[i];if(isValueBladeController(bc)&&bc.value===v)return bc}return null}(this.find(isValueBladeController),ev.sender);if(!bc)throw TpError.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:bc,options:ev.options,sender:this})}onRackLayout_(_){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(ev){this.emitter.emit("valuechange",{bladeController:ev.bladeController,options:ev.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class RackController{constructor(config){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=config.element,this.viewProps=config.viewProps;const rack=new Rack({blade:config.root?void 0:config.blade,viewProps:config.viewProps});rack.emitter.on("add",this.onRackAdd_),rack.emitter.on("remove",this.onRackRemove_),this.rack=rack,this.viewProps.handleDispose((()=>{for(let i=this.rack.children.length-1;i>=0;i--){this.rack.children[i].viewProps.set("disposed",!0)}}))}onRackAdd_(ev){ev.root&&insertElementAt(this.element,ev.bladeController.view.element,ev.index)}onRackRemove_(ev){ev.root&&removeElement(ev.bladeController.view.element)}}function createBlade(){return new ValueMap({positions:createValue([],{equals:deepEqualsArray})})}class Foldable extends ValueMap{constructor(valueMap){super(valueMap)}static create(expanded){const coreObj={completed:!0,expanded,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},core=ValueMap.createCore(coreObj);return new Foldable(core)}get styleExpanded(){var _a;return null!==(_a=this.get("temporaryExpanded"))&&void 0!==_a?_a:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const exHeight=this.get("expandedHeight");return this.get("shouldFixHeight")&&!isEmpty(exHeight)?`${exHeight}px`:"auto"}bindExpandedClass(elem,expandedClassName){const onExpand=()=>{this.styleExpanded?elem.classList.add(expandedClassName):elem.classList.remove(expandedClassName)};bindValueMap(this,"expanded",onExpand),bindValueMap(this,"temporaryExpanded",onExpand)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function applyHeight(foldable,elem){elem.style.height=foldable.styleHeight}function bindFoldable(foldable,elem){foldable.value("expanded").emitter.on("beforechange",(()=>{if(foldable.set("completed",!1),isEmpty(foldable.get("expandedHeight"))){const h=function computeExpandedFolderHeight(folder,containerElement){let height=0;return function disableTransitionTemporarily(element,callback){const t=element.style.transition;element.style.transition="none",callback(),element.style.transition=t}(containerElement,(()=>{folder.set("expandedHeight",null),folder.set("temporaryExpanded",!0),forceReflow(containerElement),height=containerElement.clientHeight,folder.set("temporaryExpanded",null),forceReflow(containerElement)})),height}(foldable,elem);h>0&&foldable.set("expandedHeight",h)}foldable.set("shouldFixHeight",!0),forceReflow(elem)})),foldable.emitter.on("change",(()=>{applyHeight(foldable,elem)})),applyHeight(foldable,elem),elem.addEventListener("transitionend",(ev=>{"height"===ev.propertyName&&foldable.cleanUpTransition()}))}class FolderApi extends ContainerBladeApi{constructor(controller,pool){super(controller,pool),this.emitter_=new Emitter,this.controller.foldable.value("expanded").emitter.on("change",(ev=>{this.emitter_.emit("fold",new TpFoldEvent(this,ev.sender.rawValue))})),this.rackApi_.on("change",(ev=>{this.emitter_.emit("change",ev)}))}get expanded(){return this.controller.foldable.get("expanded")}set expanded(expanded){this.controller.foldable.set("expanded",expanded)}get title(){return this.controller.props.get("title")}set title(title){this.controller.props.set("title",title)}get children(){return this.rackApi_.children}addBinding(object,key,opt_params){return this.rackApi_.addBinding(object,key,opt_params)}addFolder(params){return this.rackApi_.addFolder(params)}addButton(params){return this.rackApi_.addButton(params)}addTab(params){return this.rackApi_.addTab(params)}add(api,opt_index){return this.rackApi_.add(api,opt_index)}remove(api){this.rackApi_.remove(api)}addBlade(params){return this.rackApi_.addBlade(params)}on(eventName,handler){const bh=handler.bind(this);return this.emitter_.on(eventName,(ev=>{bh(ev)}),{key:handler}),this}off(eventName,handler){return this.emitter_.off(eventName,handler),this}}const bladeContainerClassName=ClassName("cnt");class FolderView{constructor(doc,config){var _a;this.className_=ClassName(null!==(_a=config.viewName)&&void 0!==_a?_a:"fld"),this.element=doc.createElement("div"),this.element.classList.add(this.className_(),bladeContainerClassName()),config.viewProps.bindClassModifiers(this.element),this.foldable_=config.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),bindValueMap(this.foldable_,"completed",valueToClassName(this.element,this.className_(void 0,"cpl")));const buttonElem=doc.createElement("button");buttonElem.classList.add(this.className_("b")),bindValueMap(config.props,"title",(title=>{isEmpty(title)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))})),config.viewProps.bindDisabled(buttonElem),this.element.appendChild(buttonElem),this.buttonElement=buttonElem;const indentElem=doc.createElement("div");indentElem.classList.add(this.className_("i")),this.element.appendChild(indentElem);const titleElem=doc.createElement("div");titleElem.classList.add(this.className_("t")),bindValueToTextContent(config.props.value("title"),titleElem),this.buttonElement.appendChild(titleElem),this.titleElement=titleElem;const markElem=doc.createElement("div");markElem.classList.add(this.className_("m")),this.buttonElement.appendChild(markElem);const containerElem=doc.createElement("div");containerElem.classList.add(this.className_("c")),this.element.appendChild(containerElem),this.containerElement=containerElem}}class FolderController extends ContainerBladeController{constructor(doc,config){var _a;const foldable=Foldable.create(null===(_a=config.expanded)||void 0===_a||_a),view=new FolderView(doc,{foldable,props:config.props,viewName:config.root?"rot":void 0,viewProps:config.viewProps});super(Object.assign(Object.assign({},config),{rackController:new RackController({blade:config.blade,element:view.containerElement,root:config.root,viewProps:config.viewProps}),view})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=config.props,this.foldable=foldable,bindFoldable(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",(()=>{this.foldable.cleanUpTransition()})),this.rackController.rack.emitter.on("remove",(()=>{this.foldable.cleanUpTransition()})),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(state){return importBladeState(state,(s=>super.importState(s)),(p=>({expanded:p.required.boolean,title:p.optional.string})),(result=>(this.foldable.set("expanded",result.expanded),this.props.set("title",result.title),!0)))}exportState(){return exportBladeState((()=>super.exportState()),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const FolderBladePlugin=createPlugin({id:"folder",type:"blade",accept(params){const result=parseRecord(params,(p=>({title:p.required.string,view:p.required.constant("folder"),expanded:p.optional.boolean})));return result?{params:result}:null},controller:args=>new FolderController(args.document,{blade:args.blade,expanded:args.params.expanded,props:ValueMap.fromObject({title:args.params.title}),viewProps:args.viewProps}),api:args=>args.controller instanceof FolderController?new FolderApi(args.controller,args.pool):null}),cn$o=ClassName("");function valueToModifier(elem,modifier){return valueToClassName(elem,cn$o(void 0,modifier))}class ViewProps extends ValueMap{constructor(valueMap){var _a;super(valueMap),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=function createReadonlyValue(value){return[new ReadonlyPrimitiveValue(value),(rawValue,options)=>{value.setRawValue(rawValue,options)}]}(createValue(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),null===(_a=this.get("parent"))||void 0===_a||_a.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(opt_initialValue){var _a,_b,_c;const initialValue=null!=opt_initialValue?opt_initialValue:{};return new ViewProps(ValueMap.createCore({disabled:null!==(_a=initialValue.disabled)&&void 0!==_a&&_a,disposed:!1,hidden:null!==(_b=initialValue.hidden)&&void 0!==_b&&_b,parent:null!==(_c=initialValue.parent)&&void 0!==_c?_c:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(elem){bindValue(this.globalDisabled_,valueToModifier(elem,"disabled")),bindValueMap(this,"hidden",valueToModifier(elem,"hidden"))}bindDisabled(target){bindValue(this.globalDisabled_,(disabled=>{target.disabled=disabled}))}bindTabIndex(elem){bindValue(this.globalDisabled_,(disabled=>{elem.tabIndex=disabled?-1:0}))}handleDispose(callback){this.value("disposed").emitter.on("change",(disposed=>{disposed&&callback()}))}importState(state){this.set("disabled",state.disabled),this.set("hidden",state.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const parent=this.get("parent");return!!parent&&parent.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(ev){var _a;const prevParent=ev.previousRawValue;null==prevParent||prevParent.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),null===(_a=this.get("parent"))||void 0===_a||_a.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const cn$n=ClassName("tbp");class TabPageView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(cn$n()),config.viewProps.bindClassModifiers(this.element);const containerElem=doc.createElement("div");containerElem.classList.add(cn$n("c")),this.element.appendChild(containerElem),this.containerElement=containerElem}}const cn$m=ClassName("tbi");class TabItemView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(cn$m()),config.viewProps.bindClassModifiers(this.element),bindValueMap(config.props,"selected",(selected=>{selected?this.element.classList.add(cn$m(void 0,"sel")):this.element.classList.remove(cn$m(void 0,"sel"))}));const buttonElem=doc.createElement("button");buttonElem.classList.add(cn$m("b")),config.viewProps.bindDisabled(buttonElem),this.element.appendChild(buttonElem),this.buttonElement=buttonElem;const titleElem=doc.createElement("div");titleElem.classList.add(cn$m("t")),bindValueToTextContent(config.props.value("title"),titleElem),this.buttonElement.appendChild(titleElem),this.titleElement=titleElem}}class TabItemController{constructor(doc,config){this.emitter=new Emitter,this.onClick_=this.onClick_.bind(this),this.props=config.props,this.viewProps=config.viewProps,this.view=new TabItemView(doc,{props:config.props,viewProps:config.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class TabPageController extends ContainerBladeController{constructor(doc,config){const view=new TabPageView(doc,{viewProps:config.viewProps});super(Object.assign(Object.assign({},config),{rackController:new RackController({blade:config.blade,element:view.containerElement,viewProps:config.viewProps}),view})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new TabItemController(doc,{props:config.itemProps,viewProps:ViewProps.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=config.props,bindValueMap(this.props,"selected",(selected=>{this.itemController.props.set("selected",selected),this.viewProps.set("hidden",!selected)}))}get itemController(){return this.ic_}importState(state){return importBladeState(state,(s=>super.importState(s)),(p=>({selected:p.required.boolean,title:p.required.string})),(result=>(this.ic_.props.set("selected",result.selected),this.ic_.props.set("title",result.title),!0)))}exportState(){return exportBladeState((()=>super.exportState()),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class TabApi extends ContainerBladeApi{constructor(controller,pool){super(controller,pool),this.emitter_=new Emitter,this.onSelect_=this.onSelect_.bind(this),this.pool_=pool,this.rackApi_.on("change",(ev=>{this.emitter_.emit("change",ev)})),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(params){const doc=this.controller.view.element.ownerDocument,pc=new TabPageController(doc,{blade:createBlade(),itemProps:ValueMap.fromObject({selected:!1,title:params.title}),props:ValueMap.fromObject({selected:!1}),viewProps:ViewProps.create()}),papi=this.pool_.createApi(pc);return this.rackApi_.add(papi,params.index)}removePage(index){this.rackApi_.remove(this.rackApi_.children[index])}on(eventName,handler){const bh=handler.bind(this);return this.emitter_.on(eventName,(ev=>{bh(ev)}),{key:handler}),this}off(eventName,handler){return this.emitter_.off(eventName,handler),this}onSelect_(ev){this.emitter_.emit("select",new TpTabSelectEvent(this,ev.rawValue))}}class TabPageApi extends ContainerBladeApi{get title(){var _a;return null!==(_a=this.controller.itemController.props.get("title"))&&void 0!==_a?_a:""}set title(title){this.controller.itemController.props.set("title",title)}get selected(){return this.controller.props.get("selected")}set selected(selected){this.controller.props.set("selected",selected)}get children(){return this.rackApi_.children}addButton(params){return this.rackApi_.addButton(params)}addFolder(params){return this.rackApi_.addFolder(params)}addTab(params){return this.rackApi_.addTab(params)}add(api,opt_index){this.rackApi_.add(api,opt_index)}remove(api){this.rackApi_.remove(api)}addBinding(object,key,opt_params){return this.rackApi_.addBinding(object,key,opt_params)}addBlade(params){return this.rackApi_.addBlade(params)}}class Tab{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=createValue(!0),this.selectedIndex=createValue(-1),this.items_=[]}add(item,opt_index){const index=null!=opt_index?opt_index:this.items_.length;this.items_.splice(index,0,item),item.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(item){const index=this.items_.indexOf(item);index<0||(this.items_.splice(index,1),item.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(0===this.items_.length)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);const firstSelIndex=this.items_.findIndex((s=>s.rawValue));firstSelIndex<0?(this.items_.forEach(((s,i)=>{s.rawValue=0===i})),this.selectedIndex.rawValue=0):(this.items_.forEach(((s,i)=>{s.rawValue=i===firstSelIndex})),this.selectedIndex.rawValue=firstSelIndex),this.empty.rawValue=!1}onItemSelectedChange_(ev){if(ev.rawValue){const index=this.items_.findIndex((s=>s===ev.sender));this.items_.forEach(((s,i)=>{s.rawValue=i===index})),this.selectedIndex.rawValue=index}else this.keepSelection_()}}const cn$l=ClassName("tab");class TabView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(cn$l(),bladeContainerClassName()),config.viewProps.bindClassModifiers(this.element),bindValue(config.empty,valueToClassName(this.element,cn$l(void 0,"nop")));const titleElem=doc.createElement("div");titleElem.classList.add(cn$l("t")),this.element.appendChild(titleElem),this.itemsElement=titleElem;const indentElem=doc.createElement("div");indentElem.classList.add(cn$l("i")),this.element.appendChild(indentElem);const contentsElem=doc.createElement("div");contentsElem.classList.add(cn$l("c")),this.element.appendChild(contentsElem),this.contentsElement=contentsElem}}class TabController extends ContainerBladeController{constructor(doc,config){const tab=new Tab,view=new TabView(doc,{empty:tab.empty,viewProps:config.viewProps});super({blade:config.blade,rackController:new RackController({blade:config.blade,element:view.contentsElement,viewProps:config.viewProps}),view}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const rack=this.rackController.rack;rack.emitter.on("add",this.onRackAdd_),rack.emitter.on("remove",this.onRackRemove_),this.tab=tab}add(pc,opt_index){this.rackController.rack.add(pc,opt_index)}remove(index){this.rackController.rack.remove(this.rackController.rack.children[index])}onRackAdd_(ev){if(!ev.root)return;const pc=ev.bladeController;insertElementAt(this.view.itemsElement,pc.itemController.view.element,ev.index),pc.itemController.viewProps.set("parent",this.viewProps),this.tab.add(pc.props.value("selected"))}onRackRemove_(ev){if(!ev.root)return;const pc=ev.bladeController;removeElement(pc.itemController.view.element),pc.itemController.viewProps.set("parent",null),this.tab.remove(pc.props.value("selected"))}}const TabBladePlugin=createPlugin({id:"tab",type:"blade",accept(params){const result=parseRecord(params,(p=>({pages:p.required.array(p.required.object({title:p.required.string})),view:p.required.constant("tab")})));return result&&0!==result.pages.length?{params:result}:null},controller(args){const c=new TabController(args.document,{blade:args.blade,viewProps:args.viewProps});return args.params.pages.forEach((p=>{const pc=new TabPageController(args.document,{blade:createBlade(),itemProps:ValueMap.fromObject({selected:!1,title:p.title}),props:ValueMap.fromObject({selected:!1}),viewProps:ViewProps.create()});c.add(pc)})),c},api:args=>args.controller instanceof TabController?new TabApi(args.controller,args.pool):args.controller instanceof TabPageController?new TabPageApi(args.controller,args.pool):null});class ListInputBindingApi extends BindingApi{get options(){return this.controller.valueController.props.get("options")}set options(options){this.controller.valueController.props.set("options",options)}}class ManualTicker{constructor(){this.disabled=!1,this.emitter=new Emitter}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class IntervalTicker{constructor(doc,interval){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=doc,this.emitter=new Emitter,this.interval_=interval,this.setTimer_()}get disabled(){return this.disabled_}set disabled(inactive){this.disabled_=inactive,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(null===this.timerId_)return;const win=this.doc_.defaultView;win&&win.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const win=this.doc_.defaultView;win&&(this.timerId_=win.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class CompositeConstraint{constructor(constraints){this.constraints=constraints}constrain(value){return this.constraints.reduce(((result,c)=>c.constrain(result)),value)}}function findConstraint(c,constraintClass){if(c instanceof constraintClass)return c;if(c instanceof CompositeConstraint){const result=c.constraints.reduce(((tmpResult,sc)=>tmpResult||(sc instanceof constraintClass?sc:null)),null);if(result)return result}return null}class ListConstraint{constructor(options){this.values=ValueMap.fromObject({options})}constrain(value){const opts=this.values.get("options");if(0===opts.length)return value;return opts.filter((item=>item.value===value)).length>0?value:opts[0].value}}function parseListOptions(value){var _a;const p=MicroParsers;return Array.isArray(value)?null===(_a=parseRecord({items:value},(p=>({items:p.required.array(p.required.object({text:p.required.string,value:p.required.raw}))}))))||void 0===_a?void 0:_a.items:"object"==typeof value?p.required.raw(value).value:void 0}function normalizeListOptions(options){if(Array.isArray(options))return options;const items=[];return Object.keys(options).forEach((text=>{items.push({text,value:options[text]})})),items}function createListConstraint(options){return isEmpty(options)?null:new ListConstraint(normalizeListOptions(options))}const cn$k=ClassName("lst");class ListView{constructor(doc,config){this.onValueChange_=this.onValueChange_.bind(this),this.props_=config.props,this.element=doc.createElement("div"),this.element.classList.add(cn$k()),config.viewProps.bindClassModifiers(this.element);const selectElem=doc.createElement("select");selectElem.classList.add(cn$k("s")),config.viewProps.bindDisabled(selectElem),this.element.appendChild(selectElem),this.selectElement=selectElem;const markElem=doc.createElement("div");markElem.classList.add(cn$k("m")),markElem.appendChild(createSvgIconElement(doc,"dropdown")),this.element.appendChild(markElem),config.value.emitter.on("change",this.onValueChange_),this.value_=config.value,bindValueMap(this.props_,"options",(opts=>{removeChildElements(this.selectElement),opts.forEach((item=>{const optionElem=doc.createElement("option");optionElem.textContent=item.text,this.selectElement.appendChild(optionElem)})),this.update_()}))}update_(){const values=this.props_.get("options").map((o=>o.value));this.selectElement.selectedIndex=values.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class ListController{constructor(doc,config){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=config.props,this.value=config.value,this.viewProps=config.viewProps,this.view=new ListView(doc,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const selectElem=e.currentTarget;this.value.rawValue=this.props.get("options")[selectElem.selectedIndex].value}importProps(state){return importBladeState(state,null,(p=>({options:p.required.custom(parseListOptions)})),(result=>(this.props.set("options",normalizeListOptions(result.options)),!0)))}exportProps(){return exportBladeState(null,{options:this.props.get("options")})}}const cn$j=ClassName("pop");class PopupView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(cn$j()),config.viewProps.bindClassModifiers(this.element),bindValue(config.shows,valueToClassName(this.element,cn$j(void 0,"v")))}}class PopupController{constructor(doc,config){this.shows=createValue(!1),this.viewProps=config.viewProps,this.view=new PopupView(doc,{shows:this.shows,viewProps:this.viewProps})}}const cn$i=ClassName("txt");class TextView{constructor(doc,config){this.onChange_=this.onChange_.bind(this),this.element=doc.createElement("div"),this.element.classList.add(cn$i()),config.viewProps.bindClassModifiers(this.element),this.props_=config.props,this.props_.emitter.on("change",this.onChange_);const inputElem=doc.createElement("input");inputElem.classList.add(cn$i("i")),inputElem.type="text",config.viewProps.bindDisabled(inputElem),this.element.appendChild(inputElem),this.inputElement=inputElem,config.value.emitter.on("change",this.onChange_),this.value_=config.value,this.refresh()}refresh(){const formatter=this.props_.get("formatter");this.inputElement.value=formatter(this.value_.rawValue)}onChange_(){this.refresh()}}class TextController{constructor(doc,config){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=config.parser,this.props=config.props,this.value=config.value,this.viewProps=config.viewProps,this.view=new TextView(doc,{props:config.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const value=e.currentTarget.value,parsedValue=this.parser_(value);isEmpty(parsedValue)||(this.value.rawValue=parsedValue),this.view.refresh()}}function boolFromUnknown(value){return"false"!==value&&!!value}function BooleanFormatter(value){return function boolToString(value){return String(value)}(value)}const innerFormatter=createNumberFormatter(0);function formatPercentage(value){return innerFormatter(value)+"%"}function stringFromUnknown(value){return String(value)}function formatString(value){return value}function connectValues({primary,secondary,forward,backward}){let changing=!1;function preventFeedback(callback){changing||(changing=!0,callback(),changing=!1)}primary.emitter.on("change",(ev=>{preventFeedback((()=>{secondary.setRawValue(forward(primary.rawValue,secondary.rawValue),ev.options)}))})),secondary.emitter.on("change",(ev=>{preventFeedback((()=>{primary.setRawValue(backward(primary.rawValue,secondary.rawValue),ev.options)})),preventFeedback((()=>{secondary.setRawValue(forward(primary.rawValue,secondary.rawValue),ev.options)}))})),preventFeedback((()=>{secondary.setRawValue(forward(primary.rawValue,secondary.rawValue),{forceEmit:!1,last:!0})}))}function getStepForKey(keyScale,keys){const step=keyScale*(keys.altKey?.1:1)*(keys.shiftKey?10:1);return keys.upKey?+step:keys.downKey?-step:0}function getVerticalStepKeys(ev){return{altKey:ev.altKey,downKey:"ArrowDown"===ev.key,shiftKey:ev.shiftKey,upKey:"ArrowUp"===ev.key}}function getHorizontalStepKeys(ev){return{altKey:ev.altKey,downKey:"ArrowLeft"===ev.key,shiftKey:ev.shiftKey,upKey:"ArrowRight"===ev.key}}function isArrowKey(key){return function isVerticalArrowKey(key){return"ArrowUp"===key||"ArrowDown"===key}(key)||"ArrowLeft"===key||"ArrowRight"===key}function computeOffset$1(ev,elem){var _a,_b;const win=elem.ownerDocument.defaultView,rect=elem.getBoundingClientRect();return{x:ev.pageX-((null!==(_a=win&&win.scrollX)&&void 0!==_a?_a:0)+rect.left),y:ev.pageY-((null!==(_b=win&&win.scrollY)&&void 0!==_b?_b:0)+rect.top)}}class PointerHandler{constructor(element){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=element,this.emitter=new Emitter,element.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),element.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),element.addEventListener("touchend",this.onTouchEnd_),element.addEventListener("mousedown",this.onMouseDown_)}computePosition_(offset){const rect=this.elem_.getBoundingClientRect();return{bounds:{width:rect.width,height:rect.height},point:offset?{x:offset.x,y:offset.y}:null}}onMouseDown_(ev){var _a;ev.preventDefault(),null===(_a=ev.currentTarget)||void 0===_a||_a.focus();const doc=this.elem_.ownerDocument;doc.addEventListener("mousemove",this.onDocumentMouseMove_),doc.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:ev.altKey,data:this.computePosition_(computeOffset$1(ev,this.elem_)),sender:this,shiftKey:ev.shiftKey})}onDocumentMouseMove_(ev){this.emitter.emit("move",{altKey:ev.altKey,data:this.computePosition_(computeOffset$1(ev,this.elem_)),sender:this,shiftKey:ev.shiftKey})}onDocumentMouseUp_(ev){const doc=this.elem_.ownerDocument;doc.removeEventListener("mousemove",this.onDocumentMouseMove_),doc.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:ev.altKey,data:this.computePosition_(computeOffset$1(ev,this.elem_)),sender:this,shiftKey:ev.shiftKey})}onTouchStart_(ev){ev.preventDefault();const touch=ev.targetTouches.item(0),rect=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:ev.altKey,data:this.computePosition_(touch?{x:touch.clientX-rect.left,y:touch.clientY-rect.top}:void 0),sender:this,shiftKey:ev.shiftKey}),this.lastTouch_=touch}onTouchMove_(ev){const touch=ev.targetTouches.item(0),rect=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:ev.altKey,data:this.computePosition_(touch?{x:touch.clientX-rect.left,y:touch.clientY-rect.top}:void 0),sender:this,shiftKey:ev.shiftKey}),this.lastTouch_=touch}onTouchEnd_(ev){var _a;const touch=null!==(_a=ev.targetTouches.item(0))&&void 0!==_a?_a:this.lastTouch_,rect=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:ev.altKey,data:this.computePosition_(touch?{x:touch.clientX-rect.left,y:touch.clientY-rect.top}:void 0),sender:this,shiftKey:ev.shiftKey})}}const cn$h=ClassName("txt");class NumberTextView{constructor(doc,config){this.onChange_=this.onChange_.bind(this),this.props_=config.props,this.props_.emitter.on("change",this.onChange_),this.element=doc.createElement("div"),this.element.classList.add(cn$h(),cn$h(void 0,"num")),config.arrayPosition&&this.element.classList.add(cn$h(void 0,config.arrayPosition)),config.viewProps.bindClassModifiers(this.element);const inputElem=doc.createElement("input");inputElem.classList.add(cn$h("i")),inputElem.type="text",config.viewProps.bindDisabled(inputElem),this.element.appendChild(inputElem),this.inputElement=inputElem,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=config.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(cn$h()),this.inputElement.classList.add(cn$h("i"));const knobElem=doc.createElement("div");knobElem.classList.add(cn$h("k")),this.element.appendChild(knobElem),this.knobElement=knobElem;const guideElem=doc.createElementNS(SVG_NS,"svg");guideElem.classList.add(cn$h("g")),this.knobElement.appendChild(guideElem);const bodyElem=doc.createElementNS(SVG_NS,"path");bodyElem.classList.add(cn$h("gb")),guideElem.appendChild(bodyElem),this.guideBodyElem_=bodyElem;const headElem=doc.createElementNS(SVG_NS,"path");headElem.classList.add(cn$h("gh")),guideElem.appendChild(headElem),this.guideHeadElem_=headElem;const tooltipElem=doc.createElement("div");tooltipElem.classList.add(ClassName("tt")()),this.knobElement.appendChild(tooltipElem),this.tooltipElem_=tooltipElem,config.value.emitter.on("change",this.onChange_),this.value=config.value,this.refresh()}onDraggingChange_(ev){if(null===ev.rawValue)return void this.element.classList.remove(cn$h(void 0,"drg"));this.element.classList.add(cn$h(void 0,"drg"));const x=ev.rawValue/this.props_.get("pointerScale"),aox=x+(x>0?-1:x<0?1:0),adx=constrainRange(-aox,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${aox+adx},0 L${aox},4 L${aox+adx},8`,`M ${x},-1 L${x},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${x},4`);const formatter=this.props_.get("formatter");this.tooltipElem_.textContent=formatter(this.value.rawValue),this.tooltipElem_.style.left=`${x}px`}refresh(){const formatter=this.props_.get("formatter");this.inputElement.value=formatter(this.value.rawValue)}onChange_(){this.refresh()}}class NumberTextController{constructor(doc,config){var _a;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=config.parser,this.props=config.props,this.sliderProps_=null!==(_a=config.sliderProps)&&void 0!==_a?_a:null,this.value=config.value,this.viewProps=config.viewProps,this.dragging_=createValue(null),this.view=new NumberTextView(doc,{arrayPosition:config.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const ph=new PointerHandler(this.view.knobElement);ph.emitter.on("down",this.onPointerDown_),ph.emitter.on("move",this.onPointerMove_),ph.emitter.on("up",this.onPointerUp_)}constrainValue_(value){var _a,_b;const min=null===(_a=this.sliderProps_)||void 0===_a?void 0:_a.get("min"),max=null===(_b=this.sliderProps_)||void 0===_b?void 0:_b.get("max");let v=value;return void 0!==min&&(v=Math.max(v,min)),void 0!==max&&(v=Math.min(v,max)),v}onInputChange_(e){const value=e.currentTarget.value,parsedValue=this.parser_(value);isEmpty(parsedValue)||(this.value.rawValue=this.constrainValue_(parsedValue)),this.view.refresh()}onInputKeyDown_(ev){const step=getStepForKey(this.props.get("keyScale"),getVerticalStepKeys(ev));0!==step&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+step),{forceEmit:!1,last:!1})}onInputKeyUp_(ev){0!==getStepForKey(this.props.get("keyScale"),getVerticalStepKeys(ev))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(data){if(!data.point)return null;const dx=data.point.x-data.bounds.width/2;return this.constrainValue_(this.originRawValue_+dx*this.props.get("pointerScale"))}onPointerMove_(ev){const v=this.computeDraggingValue_(ev.data);null!==v&&(this.value.setRawValue(v,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(ev){const v=this.computeDraggingValue_(ev.data);null!==v&&(this.value.setRawValue(v,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const cn$g=ClassName("sld");class SliderView{constructor(doc,config){this.onChange_=this.onChange_.bind(this),this.props_=config.props,this.props_.emitter.on("change",this.onChange_),this.element=doc.createElement("div"),this.element.classList.add(cn$g()),config.viewProps.bindClassModifiers(this.element);const trackElem=doc.createElement("div");trackElem.classList.add(cn$g("t")),config.viewProps.bindTabIndex(trackElem),this.element.appendChild(trackElem),this.trackElement=trackElem;const knobElem=doc.createElement("div");knobElem.classList.add(cn$g("k")),this.trackElement.appendChild(knobElem),this.knobElement=knobElem,config.value.emitter.on("change",this.onChange_),this.value=config.value,this.update_()}update_(){const p=constrainRange(mapRange(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${p}%`}onChange_(){this.update_()}}class SliderController{constructor(doc,config){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=config.value,this.viewProps=config.viewProps,this.props=config.props,this.view=new SliderView(doc,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new PointerHandler(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(d,opts){d.point&&this.value.setRawValue(mapRange(constrainRange(d.point.x,0,d.bounds.width),0,d.bounds.width,this.props.get("min"),this.props.get("max")),opts)}onPointerDownOrMove_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerUp_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!0,last:!0})}onKeyDown_(ev){const step=getStepForKey(this.props.get("keyScale"),getHorizontalStepKeys(ev));0!==step&&this.value.setRawValue(this.value.rawValue+step,{forceEmit:!1,last:!1})}onKeyUp_(ev){0!==getStepForKey(this.props.get("keyScale"),getHorizontalStepKeys(ev))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const cn$f=ClassName("sldtxt");class SliderTextView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(cn$f());const sliderElem=doc.createElement("div");sliderElem.classList.add(cn$f("s")),this.sliderView_=config.sliderView,sliderElem.appendChild(this.sliderView_.element),this.element.appendChild(sliderElem);const textElem=doc.createElement("div");textElem.classList.add(cn$f("t")),this.textView_=config.textView,textElem.appendChild(this.textView_.element),this.element.appendChild(textElem)}}class SliderTextController{constructor(doc,config){this.value=config.value,this.viewProps=config.viewProps,this.sliderC_=new SliderController(doc,{props:config.sliderProps,value:config.value,viewProps:this.viewProps}),this.textC_=new NumberTextController(doc,{parser:config.parser,props:config.textProps,sliderProps:config.sliderProps,value:config.value,viewProps:config.viewProps}),this.view=new SliderTextView(doc,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(state){return importBladeState(state,null,(p=>({max:p.required.number,min:p.required.number})),(result=>{const sliderProps=this.sliderC_.props;return sliderProps.set("max",result.max),sliderProps.set("min",result.min),!0}))}exportProps(){const sliderProps=this.sliderC_.props;return exportBladeState(null,{max:sliderProps.get("max"),min:sliderProps.get("min")})}}function createSliderTextProps(config){return{sliderProps:new ValueMap({keyScale:config.keyScale,max:config.max,min:config.min}),textProps:new ValueMap({formatter:createValue(config.formatter),keyScale:config.keyScale,pointerScale:createValue(config.pointerScale)})}}const CSS_VAR_MAP={containerUnitSize:"cnt-usz"};function getCssVar(key){return`--${CSS_VAR_MAP[key]}`}function createPointDimensionParser(p){return createNumberTextInputParamsParser(p)}function parsePointDimensionParams(value){if(isRecord(value))return parseRecord(value,createPointDimensionParser)}function createDimensionConstraint(params,initialValue){if(!params)return;const constraints=[],cs=createStepConstraint(params,initialValue);cs&&constraints.push(cs);const rs=createRangeConstraint(params);return rs&&constraints.push(rs),new CompositeConstraint(constraints)}function parsePickerLayout(value){if("inline"===value||"popup"===value)return value}function writePrimitive(target,value){target.write(value)}const cn$e=ClassName("ckb");class CheckboxView{constructor(doc,config){this.onValueChange_=this.onValueChange_.bind(this),this.element=doc.createElement("div"),this.element.classList.add(cn$e()),config.viewProps.bindClassModifiers(this.element);const labelElem=doc.createElement("label");labelElem.classList.add(cn$e("l")),this.element.appendChild(labelElem),this.labelElement=labelElem;const inputElem=doc.createElement("input");inputElem.classList.add(cn$e("i")),inputElem.type="checkbox",this.labelElement.appendChild(inputElem),this.inputElement=inputElem,config.viewProps.bindDisabled(this.inputElement);const wrapperElem=doc.createElement("div");wrapperElem.classList.add(cn$e("w")),this.labelElement.appendChild(wrapperElem);const markElem=createSvgIconElement(doc,"check");wrapperElem.appendChild(markElem),config.value.emitter.on("change",this.onValueChange_),this.value=config.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class CheckboxController{constructor(doc,config){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=config.value,this.viewProps=config.viewProps,this.view=new CheckboxView(doc,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(ev){const inputElem=ev.currentTarget;this.value.rawValue=inputElem.checked,ev.preventDefault(),ev.stopPropagation()}onLabelMouseDown_(ev){ev.preventDefault()}}const BooleanInputPlugin=createPlugin({id:"input-bool",type:"input",accept:(value,params)=>{if("boolean"!=typeof value)return null;const result=parseRecord(params,(p=>({options:p.optional.custom(parseListOptions),readonly:p.optional.constant(!1)})));return result?{initialValue:value,params:result}:null},binding:{reader:_args=>boolFromUnknown,constraint:args=>function createConstraint$6(params){const constraints=[],lc=createListConstraint(params.options);return lc&&constraints.push(lc),new CompositeConstraint(constraints)}(args.params),writer:_args=>writePrimitive},controller:args=>{const doc=args.document,value=args.value,c=args.constraint,lc=c&&findConstraint(c,ListConstraint);return lc?new ListController(doc,{props:new ValueMap({options:lc.values.value("options")}),value,viewProps:args.viewProps}):new CheckboxController(doc,{value,viewProps:args.viewProps})},api:args=>"boolean"!=typeof args.controller.value.rawValue?null:args.controller.valueController instanceof ListController?new ListInputBindingApi(args.controller):null}),cn$d=ClassName("col");class ColorView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(cn$d()),config.foldable.bindExpandedClass(this.element,cn$d(void 0,"expanded")),bindValueMap(config.foldable,"completed",valueToClassName(this.element,cn$d(void 0,"cpl")));const headElem=doc.createElement("div");headElem.classList.add(cn$d("h")),this.element.appendChild(headElem);const swatchElem=doc.createElement("div");swatchElem.classList.add(cn$d("s")),headElem.appendChild(swatchElem),this.swatchElement=swatchElem;const textElem=doc.createElement("div");if(textElem.classList.add(cn$d("t")),headElem.appendChild(textElem),this.textElement=textElem,"inline"===config.pickerLayout){const pickerElem=doc.createElement("div");pickerElem.classList.add(cn$d("p")),this.element.appendChild(pickerElem),this.pickerElement=pickerElem}else this.pickerElement=null}}function hsvToRgbInt(h,s,v){const hp=loopRange(h,360),sp=constrainRange(s/100,0,1),vp=constrainRange(v/100,0,1),c=vp*sp,x=c*(1-Math.abs(hp/60%2-1)),m=vp-c;let rp,gp,bp;return[rp,gp,bp]=hp>=0&&hp<60?[c,x,0]:hp>=60&&hp<120?[x,c,0]:hp>=120&&hp<180?[0,c,x]:hp>=180&&hp<240?[0,x,c]:hp>=240&&hp<300?[x,0,c]:[c,0,x],[255*(rp+m),255*(gp+m),255*(bp+m)]}function removeAlphaComponent(comps){return[comps[0],comps[1],comps[2]]}function appendAlphaComponent(comps,alpha){return[comps[0],comps[1],comps[2],alpha]}const MODE_CONVERTER_MAP={hsl:{hsl:(h,s,l)=>[h,s,l],hsv:function hslToHsvInt(h,s,l){const sd=l+s*(100-Math.abs(2*l-100))/200;return[h,0!==sd?s*(100-Math.abs(2*l-100))/sd:0,l+s*(100-Math.abs(2*l-100))/200]},rgb:function hslToRgbInt(h,s,l){const hp=(h%360+360)%360,sp=constrainRange(s/100,0,1),lp=constrainRange(l/100,0,1),c=(1-Math.abs(2*lp-1))*sp,x=c*(1-Math.abs(hp/60%2-1)),m=lp-c/2;let rp,gp,bp;return[rp,gp,bp]=hp>=0&&hp<60?[c,x,0]:hp>=60&&hp<120?[x,c,0]:hp>=120&&hp<180?[0,c,x]:hp>=180&&hp<240?[0,x,c]:hp>=240&&hp<300?[x,0,c]:[c,0,x],[255*(rp+m),255*(gp+m),255*(bp+m)]}},hsv:{hsl:function hsvToHslInt(h,s,v){const sd=100-Math.abs(v*(200-s)/100-100);return[h,0!==sd?s*v/sd:0,v*(200-s)/200]},hsv:(h,s,v)=>[h,s,v],rgb:hsvToRgbInt},rgb:{hsl:function rgbToHslInt(r,g,b){const rp=constrainRange(r/255,0,1),gp=constrainRange(g/255,0,1),bp=constrainRange(b/255,0,1),cmax=Math.max(rp,gp,bp),cmin=Math.min(rp,gp,bp),c=cmax-cmin;let h=0,s=0;const l=(cmin+cmax)/2;return 0!==c&&(s=c/(1-Math.abs(cmax+cmin-1)),h=rp===cmax?(gp-bp)/c:gp===cmax?2+(bp-rp)/c:4+(rp-gp)/c,h=h/6+(h<0?1:0)),[360*h,100*s,100*l]},hsv:function rgbToHsvInt(r,g,b){const rp=constrainRange(r/255,0,1),gp=constrainRange(g/255,0,1),bp=constrainRange(b/255,0,1),cmax=Math.max(rp,gp,bp),d=cmax-Math.min(rp,gp,bp);let h;return h=0===d?0:cmax===rp?((gp-bp)/d%6+6)%6*60:cmax===gp?60*((bp-rp)/d+2):60*((rp-gp)/d+4),[h,100*(0===cmax?0:d/cmax),100*cmax]},rgb:(r,g,b)=>[r,g,b]}};function getColorMaxComponents(mode,type){return["float"===type?1:"rgb"===mode?255:360,"float"===type?1:"rgb"===mode?255:100,"float"===type?1:"rgb"===mode?255:100]}function constrainColorComponents(components,mode,type){var _a;const ms=getColorMaxComponents(mode,type);return["rgb"===mode?constrainRange(components[0],0,ms[0]):(hue=components[0],max=ms[0],hue===max?max:loopRange(hue,max)),constrainRange(components[1],0,ms[1]),constrainRange(components[2],0,ms[2]),constrainRange(null!==(_a=components[3])&&void 0!==_a?_a:1,0,1)];var hue,max}function convertColorType(comps,mode,from,to){const fms=getColorMaxComponents(mode,from),tms=getColorMaxComponents(mode,to);return comps.map(((c,index)=>c/fms[index]*tms[index]))}function convertColor(components,from,to){const intComps=convertColorType(components,from.mode,from.type,"int");return convertColorType(MODE_CONVERTER_MAP[from.mode][to.mode](...intComps),to.mode,"int",to.type)}class IntColor{static black(){return new IntColor([0,0,0],"rgb")}constructor(comps,mode){this.type="int",this.mode=mode,this.comps_=constrainColorComponents(comps,mode,this.type)}getComponents(opt_mode){return appendAlphaComponent(convertColor(removeAlphaComponent(this.comps_),{mode:this.mode,type:this.type},{mode:null!=opt_mode?opt_mode:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const rgbComps=this.getComponents("rgb");return{r:rgbComps[0],g:rgbComps[1],b:rgbComps[2],a:rgbComps[3]}}}const cn$c=ClassName("colp");class ColorPickerView{constructor(doc,config){this.alphaViews_=null,this.element=doc.createElement("div"),this.element.classList.add(cn$c()),config.viewProps.bindClassModifiers(this.element);const hsvElem=doc.createElement("div");hsvElem.classList.add(cn$c("hsv"));const svElem=doc.createElement("div");svElem.classList.add(cn$c("sv")),this.svPaletteView_=config.svPaletteView,svElem.appendChild(this.svPaletteView_.element),hsvElem.appendChild(svElem);const hElem=doc.createElement("div");hElem.classList.add(cn$c("h")),this.hPaletteView_=config.hPaletteView,hElem.appendChild(this.hPaletteView_.element),hsvElem.appendChild(hElem),this.element.appendChild(hsvElem);const rgbElem=doc.createElement("div");if(rgbElem.classList.add(cn$c("rgb")),this.textsView_=config.textsView,rgbElem.appendChild(this.textsView_.element),this.element.appendChild(rgbElem),config.alphaViews){this.alphaViews_={palette:config.alphaViews.palette,text:config.alphaViews.text};const aElem=doc.createElement("div");aElem.classList.add(cn$c("a"));const apElem=doc.createElement("div");apElem.classList.add(cn$c("ap")),apElem.appendChild(this.alphaViews_.palette.element),aElem.appendChild(apElem);const atElem=doc.createElement("div");atElem.classList.add(cn$c("at")),atElem.appendChild(this.alphaViews_.text.element),aElem.appendChild(atElem),this.element.appendChild(aElem)}}get allFocusableElements(){const elems=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map((v=>v.inputElement))];return this.alphaViews_&&elems.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),elems}}function parseColorType(value){return"int"===value?"int":"float"===value?"float":void 0}function parseColorInputParams(params){return parseRecord(params,(p=>({color:p.optional.object({alpha:p.optional.boolean,type:p.optional.custom(parseColorType)}),expanded:p.optional.boolean,picker:p.optional.custom(parsePickerLayout),readonly:p.optional.constant(!1)})))}function getKeyScaleForColor(forAlpha){return forAlpha?.1:1}function extractColorType(params){var _a;return null===(_a=params.color)||void 0===_a?void 0:_a.type}class FloatColor{constructor(comps,mode){this.type="float",this.mode=mode,this.comps_=constrainColorComponents(comps,mode,this.type)}getComponents(opt_mode){return appendAlphaComponent(convertColor(removeAlphaComponent(this.comps_),{mode:this.mode,type:this.type},{mode:null!=opt_mode?opt_mode:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const rgbComps=this.getComponents("rgb");return{r:rgbComps[0],g:rgbComps[1],b:rgbComps[2],a:rgbComps[3]}}}const TYPE_TO_CONSTRUCTOR_MAP={int:(comps,mode)=>new IntColor(comps,mode),float:(comps,mode)=>new FloatColor(comps,mode)};function createColor(comps,mode,type){return TYPE_TO_CONSTRUCTOR_MAP[type](comps,mode)}function mapColorType(c,type){if(c.type===type)return c;if(function isIntColor(c){return"int"===c.type}(c)&&"float"===type)return function convertIntToFloat(ci){const comps=ci.getComponents(),ms=getColorMaxComponents(ci.mode,"int");return new FloatColor([mapRange(comps[0],0,ms[0],0,1),mapRange(comps[1],0,ms[1],0,1),mapRange(comps[2],0,ms[2],0,1),comps[3]],ci.mode)}(c);if(function isFloatColor(c){return"float"===c.type}(c)&&"int"===type)return function convertFloatToInt(cf){const comps=cf.getComponents(),ms=getColorMaxComponents(cf.mode,"int");return new IntColor([Math.round(mapRange(comps[0],0,1,0,ms[0])),Math.round(mapRange(comps[1],0,1,0,ms[1])),Math.round(mapRange(comps[2],0,1,0,ms[2])),comps[3]],cf.mode)}(c);throw TpError.shouldNeverHappen()}function parseCssNumberOrPercentage(text,max){const m=text.match(/^(.+)%$/);return m?Math.min(.01*parseFloat(m[1])*max,max):Math.min(parseFloat(text),max)}const ANGLE_TO_DEG_MAP={deg:angle=>angle,grad:angle=>360*angle/400,rad:angle=>360*angle/(2*Math.PI),turn:angle=>360*angle};function parseCssNumberOrAngle(text){const m=text.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!m)return parseFloat(text);const angle=parseFloat(m[1]),unit=m[2];return ANGLE_TO_DEG_MAP[unit](angle)}function parseFunctionalRgbColorComponents(text){const m=text.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!m)return null;const comps=[parseCssNumberOrPercentage(m[1],255),parseCssNumberOrPercentage(m[2],255),parseCssNumberOrPercentage(m[3],255)];return isNaN(comps[0])||isNaN(comps[1])||isNaN(comps[2])?null:comps}function parseFunctionalRgbColor(text){const comps=parseFunctionalRgbColorComponents(text);return comps?new IntColor(comps,"rgb"):null}function parseFunctionalRgbaColorComponents(text){const m=text.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!m)return null;const comps=[parseCssNumberOrPercentage(m[1],255),parseCssNumberOrPercentage(m[2],255),parseCssNumberOrPercentage(m[3],255),parseCssNumberOrPercentage(m[4],1)];return isNaN(comps[0])||isNaN(comps[1])||isNaN(comps[2])||isNaN(comps[3])?null:comps}function parseFunctionalRgbaColor(text){const comps=parseFunctionalRgbaColorComponents(text);return comps?new IntColor(comps,"rgb"):null}function parseFunctionalHslColorComponents(text){const m=text.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!m)return null;const comps=[parseCssNumberOrAngle(m[1]),parseCssNumberOrPercentage(m[2],100),parseCssNumberOrPercentage(m[3],100)];return isNaN(comps[0])||isNaN(comps[1])||isNaN(comps[2])?null:comps}function parseFunctionalHslColor(text){const comps=parseFunctionalHslColorComponents(text);return comps?new IntColor(comps,"hsl"):null}function parseHslaColorComponents(text){const m=text.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!m)return null;const comps=[parseCssNumberOrAngle(m[1]),parseCssNumberOrPercentage(m[2],100),parseCssNumberOrPercentage(m[3],100),parseCssNumberOrPercentage(m[4],1)];return isNaN(comps[0])||isNaN(comps[1])||isNaN(comps[2])||isNaN(comps[3])?null:comps}function parseFunctionalHslaColor(text){const comps=parseHslaColorComponents(text);return comps?new IntColor(comps,"hsl"):null}function parseHexRgbColorComponents(text){const mRgb=text.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(mRgb)return[parseInt(mRgb[1]+mRgb[1],16),parseInt(mRgb[2]+mRgb[2],16),parseInt(mRgb[3]+mRgb[3],16)];const mRrggbb=text.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return mRrggbb?[parseInt(mRrggbb[1],16),parseInt(mRrggbb[2],16),parseInt(mRrggbb[3],16)]:null}function parseHexRgbColor(text){const comps=parseHexRgbColorComponents(text);return comps?new IntColor(comps,"rgb"):null}function parseHexRgbaColorComponents(text){const mRgb=text.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(mRgb)return[parseInt(mRgb[1]+mRgb[1],16),parseInt(mRgb[2]+mRgb[2],16),parseInt(mRgb[3]+mRgb[3],16),mapRange(parseInt(mRgb[4]+mRgb[4],16),0,255,0,1)];const mRrggbb=text.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return mRrggbb?[parseInt(mRrggbb[1],16),parseInt(mRrggbb[2],16),parseInt(mRrggbb[3],16),mapRange(parseInt(mRrggbb[4],16),0,255,0,1)]:null}function parseHexRgbaColor(text){const comps=parseHexRgbaColorComponents(text);return comps?new IntColor(comps,"rgb"):null}function parseObjectRgbColorComponents(text){const m=text.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!m)return null;const comps=[parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3])];return isNaN(comps[0])||isNaN(comps[1])||isNaN(comps[2])?null:comps}function createObjectRgbColorParser(type){return text=>{const comps=parseObjectRgbColorComponents(text);return comps?createColor(comps,"rgb",type):null}}function parseObjectRgbaColorComponents(text){const m=text.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!m)return null;const comps=[parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3]),parseFloat(m[4])];return isNaN(comps[0])||isNaN(comps[1])||isNaN(comps[2])||isNaN(comps[3])?null:comps}function createObjectRgbaColorParser(type){return text=>{const comps=parseObjectRgbaColorComponents(text);return comps?createColor(comps,"rgb",type):null}}const PARSER_AND_RESULT=[{parser:parseHexRgbColorComponents,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:parseHexRgbaColorComponents,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:parseFunctionalRgbColorComponents,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:parseFunctionalRgbaColorComponents,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:parseFunctionalHslColorComponents,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:parseHslaColorComponents,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:parseObjectRgbColorComponents,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:parseObjectRgbaColorComponents,result:{alpha:!0,mode:"rgb",notation:"object"}}];function detectStringColorFormat(text,type="int"){const r=function detectStringColor(text){return PARSER_AND_RESULT.reduce(((prev,{parser,result:detection})=>prev||(parser(text)?detection:null)),null)}(text);return r?"hex"===r.notation&&"float"!==type?Object.assign(Object.assign({},r),{type:"int"}):"func"===r.notation?Object.assign(Object.assign({},r),{type}):null:null}function createColorStringParser(type){const parsers=[parseHexRgbColor,parseHexRgbaColor,parseFunctionalRgbColor,parseFunctionalRgbaColor,parseFunctionalHslColor,parseFunctionalHslaColor];"int"===type&&parsers.push(createObjectRgbColorParser("int"),createObjectRgbaColorParser("int")),"float"===type&&parsers.push(createObjectRgbColorParser("float"),createObjectRgbaColorParser("float"));const parser=function composeParsers(parsers){return text=>parsers.reduce(((result,parser)=>null!==result?result:parser(text)),null)}(parsers);return text=>{const result=parser(text);return result?mapColorType(result,type):null}}function readIntColorString(value){const parser=createColorStringParser("int");if("string"!=typeof value)return IntColor.black();const result=parser(value);return null!=result?result:IntColor.black()}function zerofill(comp){const hex=constrainRange(Math.floor(comp),0,255).toString(16);return 1===hex.length?`0${hex}`:hex}function colorToHexRgbString(value,prefix="#"){return`${prefix}${removeAlphaComponent(value.getComponents("rgb")).map(zerofill).join("")}`}function colorToHexRgbaString(value,prefix="#"){const rgbaComps=value.getComponents("rgb");return`${prefix}${[rgbaComps[0],rgbaComps[1],rgbaComps[2],255*rgbaComps[3]].map(zerofill).join("")}`}function colorToFunctionalRgbString(value){const formatter=createNumberFormatter(0);return`rgb(${removeAlphaComponent(mapColorType(value,"int").getComponents("rgb")).map((comp=>formatter(comp))).join(", ")})`}function colorToFunctionalRgbaString(value){const aFormatter=createNumberFormatter(2),rgbFormatter=createNumberFormatter(0);return`rgba(${mapColorType(value,"int").getComponents("rgb").map(((comp,index)=>(3===index?aFormatter:rgbFormatter)(comp))).join(", ")})`}function colorToObjectRgbString(value,type){const formatter=createNumberFormatter("float"===type?2:0),names=["r","g","b"];return`{${removeAlphaComponent(mapColorType(value,type).getComponents("rgb")).map(((comp,index)=>`${names[index]}: ${formatter(comp)}`)).join(", ")}}`}function createObjectRgbColorFormatter(type){return value=>colorToObjectRgbString(value,type)}function colorToObjectRgbaString(value,type){const aFormatter=createNumberFormatter(2),rgbFormatter=createNumberFormatter("float"===type?2:0),names=["r","g","b","a"];return`{${mapColorType(value,type).getComponents("rgb").map(((comp,index)=>`${names[index]}: ${(3===index?aFormatter:rgbFormatter)(comp)}`)).join(", ")}}`}function createObjectRgbaColorFormatter(type){return value=>colorToObjectRgbaString(value,type)}const FORMAT_AND_STRINGIFIERS=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:colorToHexRgbString},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:colorToHexRgbaString},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:colorToFunctionalRgbString},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:colorToFunctionalRgbaString},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function colorToFunctionalHslString(value){const formatters=[createNumberFormatter(0),formatPercentage,formatPercentage];return`hsl(${removeAlphaComponent(mapColorType(value,"int").getComponents("hsl")).map(((comp,index)=>formatters[index](comp))).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function colorToFunctionalHslaString(value){const formatters=[createNumberFormatter(0),formatPercentage,formatPercentage,createNumberFormatter(2)];return`hsla(${mapColorType(value,"int").getComponents("hsl").map(((comp,index)=>formatters[index](comp))).join(", ")})`}},...["int","float"].reduce(((prev,type)=>[...prev,{format:{alpha:!1,mode:"rgb",notation:"object",type},stringifier:createObjectRgbColorFormatter(type)},{format:{alpha:!0,mode:"rgb",notation:"object",type},stringifier:createObjectRgbaColorFormatter(type)}]),[])];function findColorStringifier(format){return FORMAT_AND_STRINGIFIERS.reduce(((prev,fas)=>prev||(function equalsStringColorFormat(f1,f2){return f1.alpha===f2.alpha&&f1.mode===f2.mode&&f1.notation===f2.notation&&f1.type===f2.type}(fas.format,format)?fas.stringifier:null)),null)}const cn$b=ClassName("apl");class APaletteView{constructor(doc,config){this.onValueChange_=this.onValueChange_.bind(this),this.value=config.value,this.value.emitter.on("change",this.onValueChange_),this.element=doc.createElement("div"),this.element.classList.add(cn$b()),config.viewProps.bindClassModifiers(this.element),config.viewProps.bindTabIndex(this.element);const barElem=doc.createElement("div");barElem.classList.add(cn$b("b")),this.element.appendChild(barElem);const colorElem=doc.createElement("div");colorElem.classList.add(cn$b("c")),barElem.appendChild(colorElem),this.colorElem_=colorElem;const markerElem=doc.createElement("div");markerElem.classList.add(cn$b("m")),this.element.appendChild(markerElem),this.markerElem_=markerElem;const previewElem=doc.createElement("div");previewElem.classList.add(cn$b("p")),this.markerElem_.appendChild(previewElem),this.previewElem_=previewElem,this.update_()}update_(){const c=this.value.rawValue,rgbaComps=c.getComponents("rgb"),leftColor=new IntColor([rgbaComps[0],rgbaComps[1],rgbaComps[2],0],"rgb"),rightColor=new IntColor([rgbaComps[0],rgbaComps[1],rgbaComps[2],255],"rgb"),gradientComps=["to right",colorToFunctionalRgbaString(leftColor),colorToFunctionalRgbaString(rightColor)];this.colorElem_.style.background=`linear-gradient(${gradientComps.join(",")})`,this.previewElem_.style.backgroundColor=colorToFunctionalRgbaString(c);const left=mapRange(rgbaComps[3],0,1,0,100);this.markerElem_.style.left=`${left}%`}onValueChange_(){this.update_()}}class APaletteController{constructor(doc,config){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=config.value,this.viewProps=config.viewProps,this.view=new APaletteView(doc,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new PointerHandler(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(d,opts){if(!d.point)return;const alpha=d.point.x/d.bounds.width,c=this.value.rawValue,[h,s,v]=c.getComponents("hsv");this.value.setRawValue(new IntColor([h,s,v,alpha],"hsv"),opts)}onPointerDown_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerMove_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerUp_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!0,last:!0})}onKeyDown_(ev){const step=getStepForKey(getKeyScaleForColor(!0),getHorizontalStepKeys(ev));if(0===step)return;const c=this.value.rawValue,[h,s,v,a]=c.getComponents("hsv");this.value.setRawValue(new IntColor([h,s,v,a+step],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(ev){0!==getStepForKey(getKeyScaleForColor(!0),getHorizontalStepKeys(ev))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const cn$a=ClassName("coltxt");class ColorTextsView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(cn$a()),config.viewProps.bindClassModifiers(this.element);const modeElem=doc.createElement("div");modeElem.classList.add(cn$a("m")),this.modeElem_=function createModeSelectElement(doc){const selectElem=doc.createElement("select");return selectElem.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}].reduce(((frag,item)=>{const optElem=doc.createElement("option");return optElem.textContent=item.text,optElem.value=item.value,frag.appendChild(optElem),frag}),doc.createDocumentFragment())),selectElem}(doc),this.modeElem_.classList.add(cn$a("ms")),modeElem.appendChild(this.modeSelectElement),config.viewProps.bindDisabled(this.modeElem_);const modeMarkerElem=doc.createElement("div");modeMarkerElem.classList.add(cn$a("mm")),modeMarkerElem.appendChild(createSvgIconElement(doc,"dropdown")),modeElem.appendChild(modeMarkerElem),this.element.appendChild(modeElem);const inputsElem=doc.createElement("div");inputsElem.classList.add(cn$a("w")),this.element.appendChild(inputsElem),this.inputsElem_=inputsElem,this.inputViews_=config.inputViews,this.applyInputViews_(),bindValue(config.mode,(mode=>{this.modeElem_.value=mode}))}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(inputViews){this.inputViews_=inputViews,this.applyInputViews_()}applyInputViews_(){removeChildElements(this.inputsElem_);const doc=this.element.ownerDocument;this.inputViews_.forEach((v=>{const compElem=doc.createElement("div");compElem.classList.add(cn$a("c")),compElem.appendChild(v.element),this.inputsElem_.appendChild(compElem)}))}}function createConstraint$5(mode,type,index){const max=getColorMaxComponents(mode,type)[index];return new DefiniteRangeConstraint({min:0,max})}function createComponentControllers(doc,config){const cc={colorMode:config.colorMode,colorType:config.colorType,parser:parseNumber,viewProps:config.viewProps};return[0,1,2].map((i=>{const c=function createComponentController(doc,config,index){return new NumberTextController(doc,{arrayPosition:0===index?"fst":2===index?"lst":"mid",parser:config.parser,props:ValueMap.fromObject({formatter:(type=config.colorType,createNumberFormatter("float"===type?2:0)),keyScale:getKeyScaleForColor(!1),pointerScale:"float"===config.colorType?.01:1}),value:createValue(0,{constraint:createConstraint$5(config.colorMode,config.colorType,index)}),viewProps:config.viewProps});var type}(doc,cc,i);return connectValues({primary:config.value,secondary:c.value,forward:p=>mapColorType(p,config.colorType).getComponents(config.colorMode)[i],backward(p,s){const pickedMode=config.colorMode,comps=mapColorType(p,config.colorType).getComponents(pickedMode);comps[i]=s;return mapColorType(createColor(appendAlphaComponent(removeAlphaComponent(comps),comps[3]),pickedMode,config.colorType),"int")}}),c}))}class ColorTextsController{constructor(doc,config){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=config.colorType,this.value=config.value,this.viewProps=config.viewProps,this.colorMode=createValue(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(doc),this.view=new ColorTextsView(doc,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(doc){const mode=this.colorMode.rawValue;return function isColorMode(mode){return"hex"!==mode}(mode)?createComponentControllers(doc,{colorMode:mode,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):function createHexController(doc,config){const c=new TextController(doc,{parser:createColorStringParser("int"),props:ValueMap.fromObject({formatter:colorToHexRgbString}),value:createValue(IntColor.black()),viewProps:config.viewProps});return connectValues({primary:config.value,secondary:c.value,forward:p=>new IntColor(removeAlphaComponent(p.getComponents()),p.mode),backward:(p,s)=>new IntColor(appendAlphaComponent(removeAlphaComponent(s.getComponents(p.mode)),p.getComponents()[3]),p.mode)}),[c]}(doc,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(ev){const selectElem=ev.currentTarget;this.colorMode.rawValue=selectElem.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map((cc=>cc.view))}}const cn$9=ClassName("hpl");class HPaletteView{constructor(doc,config){this.onValueChange_=this.onValueChange_.bind(this),this.value=config.value,this.value.emitter.on("change",this.onValueChange_),this.element=doc.createElement("div"),this.element.classList.add(cn$9()),config.viewProps.bindClassModifiers(this.element),config.viewProps.bindTabIndex(this.element);const colorElem=doc.createElement("div");colorElem.classList.add(cn$9("c")),this.element.appendChild(colorElem);const markerElem=doc.createElement("div");markerElem.classList.add(cn$9("m")),this.element.appendChild(markerElem),this.markerElem_=markerElem,this.update_()}update_(){const c=this.value.rawValue,[h]=c.getComponents("hsv");this.markerElem_.style.backgroundColor=colorToFunctionalRgbString(new IntColor([h,100,100],"hsv"));const left=mapRange(h,0,360,0,100);this.markerElem_.style.left=`${left}%`}onValueChange_(){this.update_()}}class HPaletteController{constructor(doc,config){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=config.value,this.viewProps=config.viewProps,this.view=new HPaletteView(doc,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new PointerHandler(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(d,opts){if(!d.point)return;const hue=mapRange(constrainRange(d.point.x,0,d.bounds.width),0,d.bounds.width,0,360),c=this.value.rawValue,[,s,v,a]=c.getComponents("hsv");this.value.setRawValue(new IntColor([hue,s,v,a],"hsv"),opts)}onPointerDown_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerMove_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerUp_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!0,last:!0})}onKeyDown_(ev){const step=getStepForKey(getKeyScaleForColor(!1),getHorizontalStepKeys(ev));if(0===step)return;const c=this.value.rawValue,[h,s,v,a]=c.getComponents("hsv");this.value.setRawValue(new IntColor([h+step,s,v,a],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(ev){0!==getStepForKey(getKeyScaleForColor(!1),getHorizontalStepKeys(ev))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const cn$8=ClassName("svp");class SvPaletteView{constructor(doc,config){this.onValueChange_=this.onValueChange_.bind(this),this.value=config.value,this.value.emitter.on("change",this.onValueChange_),this.element=doc.createElement("div"),this.element.classList.add(cn$8()),config.viewProps.bindClassModifiers(this.element),config.viewProps.bindTabIndex(this.element);const canvasElem=doc.createElement("canvas");canvasElem.height=64,canvasElem.width=64,canvasElem.classList.add(cn$8("c")),this.element.appendChild(canvasElem),this.canvasElement=canvasElem;const markerElem=doc.createElement("div");markerElem.classList.add(cn$8("m")),this.element.appendChild(markerElem),this.markerElem_=markerElem,this.update_()}update_(){const ctx=function getCanvasContext(canvasElement){const win=canvasElement.ownerDocument.defaultView;return win&&"document"in win?canvasElement.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!ctx)return;const hsvComps=this.value.rawValue.getComponents("hsv"),width=this.canvasElement.width,height=this.canvasElement.height,imgData=ctx.getImageData(0,0,width,height),data=imgData.data;for(let iy=0;iy<height;iy++)for(let ix=0;ix<width;ix++){const s=mapRange(ix,0,width,0,100),v=mapRange(iy,0,height,100,0),rgbComps=hsvToRgbInt(hsvComps[0],s,v),i=4*(iy*width+ix);data[i]=rgbComps[0],data[i+1]=rgbComps[1],data[i+2]=rgbComps[2],data[i+3]=255}ctx.putImageData(imgData,0,0);const left=mapRange(hsvComps[1],0,100,0,100);this.markerElem_.style.left=`${left}%`;const top=mapRange(hsvComps[2],0,100,100,0);this.markerElem_.style.top=`${top}%`}onValueChange_(){this.update_()}}class SvPaletteController{constructor(doc,config){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=config.value,this.viewProps=config.viewProps,this.view=new SvPaletteView(doc,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new PointerHandler(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(d,opts){if(!d.point)return;const saturation=mapRange(d.point.x,0,d.bounds.width,0,100),value=mapRange(d.point.y,0,d.bounds.height,100,0),[h,,,a]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new IntColor([h,saturation,value,a],"hsv"),opts)}onPointerDown_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerMove_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerUp_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!0,last:!0})}onKeyDown_(ev){isArrowKey(ev.key)&&ev.preventDefault();const[h,s,v,a]=this.value.rawValue.getComponents("hsv"),keyScale=getKeyScaleForColor(!1),ds=getStepForKey(keyScale,getHorizontalStepKeys(ev)),dv=getStepForKey(keyScale,getVerticalStepKeys(ev));0===ds&&0===dv||this.value.setRawValue(new IntColor([h,s+ds,v+dv,a],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(ev){const keyScale=getKeyScaleForColor(!1),ds=getStepForKey(keyScale,getHorizontalStepKeys(ev)),dv=getStepForKey(keyScale,getVerticalStepKeys(ev));0===ds&&0===dv||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class ColorPickerController{constructor(doc,config){this.value=config.value,this.viewProps=config.viewProps,this.hPaletteC_=new HPaletteController(doc,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new SvPaletteController(doc,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=config.supportsAlpha?{palette:new APaletteController(doc,{value:this.value,viewProps:this.viewProps}),text:new NumberTextController(doc,{parser:parseNumber,props:ValueMap.fromObject({pointerScale:.01,keyScale:.1,formatter:createNumberFormatter(2)}),value:createValue(0,{constraint:new DefiniteRangeConstraint({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&connectValues({primary:this.value,secondary:this.alphaIcs_.text.value,forward:p=>p.getComponents()[3],backward:(p,s)=>{const comps=p.getComponents();return comps[3]=s,new IntColor(comps,p.mode)}}),this.textsC_=new ColorTextsController(doc,{colorType:config.colorType,value:this.value,viewProps:this.viewProps}),this.view=new ColorPickerView(doc,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:config.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}const cn$7=ClassName("colsw");class ColorSwatchView{constructor(doc,config){this.onValueChange_=this.onValueChange_.bind(this),config.value.emitter.on("change",this.onValueChange_),this.value=config.value,this.element=doc.createElement("div"),this.element.classList.add(cn$7()),config.viewProps.bindClassModifiers(this.element);const swatchElem=doc.createElement("div");swatchElem.classList.add(cn$7("sw")),this.element.appendChild(swatchElem),this.swatchElem_=swatchElem;const buttonElem=doc.createElement("button");buttonElem.classList.add(cn$7("b")),config.viewProps.bindDisabled(buttonElem),this.element.appendChild(buttonElem),this.buttonElement=buttonElem,this.update_()}update_(){const value=this.value.rawValue;this.swatchElem_.style.backgroundColor=colorToHexRgbaString(value)}onValueChange_(){this.update_()}}class ColorSwatchController{constructor(doc,config){this.value=config.value,this.viewProps=config.viewProps,this.view=new ColorSwatchView(doc,{value:this.value,viewProps:this.viewProps})}}class ColorController{constructor(doc,config){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=config.value,this.viewProps=config.viewProps,this.foldable_=Foldable.create(config.expanded),this.swatchC_=new ColorSwatchController(doc,{value:this.value,viewProps:this.viewProps});const buttonElem=this.swatchC_.view.buttonElement;buttonElem.addEventListener("blur",this.onButtonBlur_),buttonElem.addEventListener("click",this.onButtonClick_),this.textC_=new TextController(doc,{parser:config.parser,props:ValueMap.fromObject({formatter:config.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new ColorView(doc,{foldable:this.foldable_,pickerLayout:config.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===config.pickerLayout?new PopupController(doc,{viewProps:this.viewProps}):null;const pickerC=new ColorPickerController(doc,{colorType:config.colorType,supportsAlpha:config.supportsAlpha,value:this.value,viewProps:this.viewProps});pickerC.view.allFocusableElements.forEach((elem=>{elem.addEventListener("blur",this.onPopupChildBlur_),elem.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=pickerC,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(pickerC.view.element),connectValues({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:p=>p,backward:(_,s)=>s})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),bindFoldable(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const elem=this.view.element,nextTarget=e.relatedTarget;nextTarget&&elem.contains(nextTarget)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(ev){if(!this.popC_)return;const elem=this.popC_.view.element,nextTarget=findNextTarget(ev);nextTarget&&elem.contains(nextTarget)||nextTarget&&nextTarget===this.swatchC_.view.buttonElement&&!supportsTouch(elem.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(ev){this.popC_?"Escape"===ev.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===ev.key&&this.swatchC_.view.buttonElement.focus()}}function colorToRgbNumber(value){return removeAlphaComponent(value.getComponents("rgb")).reduce(((result,comp)=>result<<8|255&Math.floor(comp)),0)}function colorToRgbaNumber(value){return value.getComponents("rgb").reduce(((result,comp,index)=>result<<8|255&Math.floor(3===index?255*comp:comp)),0)>>>0}function colorFromRgbNumber(value){return"number"!=typeof value?IntColor.black():function numberToRgbColor(num){return new IntColor([num>>16&255,num>>8&255,255&num],"rgb")}(value)}function colorFromRgbaNumber(value){return"number"!=typeof value?IntColor.black():function numberToRgbaColor(num){return new IntColor([num>>24&255,num>>16&255,num>>8&255,mapRange(255&num,0,255,0,1)],"rgb")}(value)}function isRgbColorComponent(obj,key){return"object"==typeof obj&&!isEmpty(obj)&&(key in obj&&"number"==typeof obj[key])}function isRgbColorObject(obj){return isRgbColorComponent(obj,"r")&&isRgbColorComponent(obj,"g")&&isRgbColorComponent(obj,"b")}function isRgbaColorObject(obj){return isRgbColorObject(obj)&&isRgbColorComponent(obj,"a")}function isColorObject(obj){return isRgbColorObject(obj)}function equalsColor(v1,v2){if(v1.mode!==v2.mode)return!1;if(v1.type!==v2.type)return!1;const comps1=v1.getComponents(),comps2=v2.getComponents();for(let i=0;i<comps1.length;i++)if(comps1[i]!==comps2[i])return!1;return!0}function createColorComponentsFromRgbObject(obj){return"a"in obj?[obj.r,obj.g,obj.b,obj.a]:[obj.r,obj.g,obj.b]}function createColorObjectWriter(supportsAlpha,type){return(target,inValue)=>{supportsAlpha?function writeRgbaColorObject(target,value,type){const obj=mapColorType(value,type).toRgbaObject();target.writeProperty("r",obj.r),target.writeProperty("g",obj.g),target.writeProperty("b",obj.b),target.writeProperty("a",obj.a)}(target,inValue,type):function writeRgbColorObject(target,value,type){const obj=mapColorType(value,type).toRgbaObject();target.writeProperty("r",obj.r),target.writeProperty("g",obj.g),target.writeProperty("b",obj.b)}(target,inValue,type)}}const NumberColorInputPlugin=createPlugin({id:"input-color-number",type:"input",accept:(value,params)=>{if("number"!=typeof value)return null;if(!function isForColor(params){return"color"in params||"color"===params.view}(params))return null;const result=parseColorInputParams(params);return result?{initialValue:value,params:Object.assign(Object.assign({},result),{supportsAlpha:(inputParams=params,!!(null===(_a=null==inputParams?void 0:inputParams.color)||void 0===_a?void 0:_a.alpha))})}:null;var inputParams,_a},binding:{reader:args=>args.params.supportsAlpha?colorFromRgbaNumber:colorFromRgbNumber,equals:equalsColor,writer:args=>function createColorNumberWriter(supportsAlpha){const colorToNumber=supportsAlpha?colorToRgbaNumber:colorToRgbNumber;return(target,value)=>{writePrimitive(target,colorToNumber(value))}}(args.params.supportsAlpha)},controller:args=>{var _a,_b,supportsAlpha;return new ColorController(args.document,{colorType:"int",expanded:null!==(_a=args.params.expanded)&&void 0!==_a&&_a,formatter:(supportsAlpha=args.params.supportsAlpha,supportsAlpha?v=>colorToHexRgbaString(v,"0x"):v=>colorToHexRgbString(v,"0x")),parser:createColorStringParser("int"),pickerLayout:null!==(_b=args.params.picker)&&void 0!==_b?_b:"popup",supportsAlpha:args.params.supportsAlpha,value:args.value,viewProps:args.viewProps})}});function createColorObjectBindingReader(type){return value=>{const c=function colorFromObject(value,type){if(!isColorObject(value))return mapColorType(IntColor.black(),type);if("int"===type){const comps=createColorComponentsFromRgbObject(value);return new IntColor(comps,"rgb")}if("float"===type){const comps=createColorComponentsFromRgbObject(value);return new FloatColor(comps,"rgb")}return mapColorType(IntColor.black(),"int")}(value,type);return mapColorType(c,"int")}}function createColorObjectFormatter(supportsAlpha,type){return value=>supportsAlpha?colorToObjectRgbaString(value,type):colorToObjectRgbString(value,type)}const ObjectColorInputPlugin=createPlugin({id:"input-color-object",type:"input",accept:(value,params)=>{var _a;if(!isColorObject(value))return null;const result=parseColorInputParams(params);return result?{initialValue:value,params:Object.assign(Object.assign({},result),{colorType:null!==(_a=extractColorType(params))&&void 0!==_a?_a:"int"})}:null},binding:{reader:args=>createColorObjectBindingReader(args.params.colorType),equals:equalsColor,writer:args=>createColorObjectWriter(function shouldSupportAlpha(initialValue){return isRgbaColorObject(initialValue)}(args.initialValue),args.params.colorType)},controller:args=>{var _a,_b;const supportsAlpha=isRgbaColorObject(args.initialValue);return new ColorController(args.document,{colorType:args.params.colorType,expanded:null!==(_a=args.params.expanded)&&void 0!==_a&&_a,formatter:createColorObjectFormatter(supportsAlpha,args.params.colorType),parser:createColorStringParser("int"),pickerLayout:null!==(_b=args.params.picker)&&void 0!==_b?_b:"popup",supportsAlpha,value:args.value,viewProps:args.viewProps})}}),StringColorInputPlugin=createPlugin({id:"input-color-string",type:"input",accept:(value,params)=>{if("string"!=typeof value)return null;if("text"===params.view)return null;const format=detectStringColorFormat(value,extractColorType(params));if(!format)return null;const stringifier=findColorStringifier(format);if(!stringifier)return null;const result=parseColorInputParams(params);return result?{initialValue:value,params:Object.assign(Object.assign({},result),{format,stringifier})}:null},binding:{reader:()=>readIntColorString,equals:equalsColor,writer:args=>{const writer=function createColorStringWriter(format){const stringify=findColorStringifier(format);return stringify?(target,value)=>{writePrimitive(target,stringify(value))}:null}(args.params.format);if(!writer)throw TpError.notBindable();return writer}},controller:args=>{var _a,_b;return new ColorController(args.document,{colorType:args.params.format.type,expanded:null!==(_a=args.params.expanded)&&void 0!==_a&&_a,formatter:args.params.stringifier,parser:createColorStringParser("int"),pickerLayout:null!==(_b=args.params.picker)&&void 0!==_b?_b:"popup",supportsAlpha:args.params.format.alpha,value:args.value,viewProps:args.viewProps})}});class PointNdConstraint{constructor(config){this.components=config.components,this.asm_=config.assembly}constrain(value){const comps=this.asm_.toComponents(value).map(((comp,index)=>{var _a,_b;return null!==(_b=null===(_a=this.components[index])||void 0===_a?void 0:_a.constrain(comp))&&void 0!==_b?_b:comp}));return this.asm_.fromComponents(comps)}}const cn$6=ClassName("pndtxt");class PointNdTextView{constructor(doc,config){this.textViews=config.textViews,this.element=doc.createElement("div"),this.element.classList.add(cn$6()),this.textViews.forEach((v=>{const axisElem=doc.createElement("div");axisElem.classList.add(cn$6("a")),axisElem.appendChild(v.element),this.element.appendChild(axisElem)}))}}class PointNdTextController{constructor(doc,config){this.value=config.value,this.viewProps=config.viewProps,this.acs_=config.axes.map(((_,index)=>function createAxisController(doc,config,index){return new NumberTextController(doc,{arrayPosition:0===index?"fst":index===config.axes.length-1?"lst":"mid",parser:config.parser,props:config.axes[index].textProps,value:createValue(0,{constraint:config.axes[index].constraint}),viewProps:config.viewProps})}(doc,config,index))),this.acs_.forEach(((c,index)=>{connectValues({primary:this.value,secondary:c.value,forward:p=>config.assembly.toComponents(p)[index],backward:(p,s)=>{const comps=config.assembly.toComponents(p);return comps[index]=s,config.assembly.fromComponents(comps)}})})),this.view=new PointNdTextView(doc,{textViews:this.acs_.map((ac=>ac.view))})}get textControllers(){return this.acs_}}class SliderInputBindingApi extends BindingApi{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(max){this.controller.valueController.sliderController.props.set("max",max)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(max){this.controller.valueController.sliderController.props.set("min",max)}}const NumberInputPlugin=createPlugin({id:"input-number",type:"input",accept:(value,params)=>{if("number"!=typeof value)return null;const result=parseRecord(params,(p=>Object.assign(Object.assign({},createNumberTextInputParamsParser(p)),{options:p.optional.custom(parseListOptions),readonly:p.optional.constant(!1)})));return result?{initialValue:value,params:result}:null},binding:{reader:_args=>numberFromUnknown,constraint:args=>function createConstraint$4(params,initialValue){const constraints=[],sc=createStepConstraint(params,initialValue);sc&&constraints.push(sc);const rc=createRangeConstraint(params);rc&&constraints.push(rc);const lc=createListConstraint(params.options);return lc&&constraints.push(lc),new CompositeConstraint(constraints)}(args.params,args.initialValue),writer:_args=>writePrimitive},controller:args=>{const value=args.value,c=args.constraint,lc=c&&findConstraint(c,ListConstraint);if(lc)return new ListController(args.document,{props:new ValueMap({options:lc.values.value("options")}),value,viewProps:args.viewProps});const textPropsObj=createNumberTextPropsObject(args.params,value.rawValue),drc=c&&findConstraint(c,DefiniteRangeConstraint);return drc?new SliderTextController(args.document,Object.assign(Object.assign({},createSliderTextProps(Object.assign(Object.assign({},textPropsObj),{keyScale:createValue(textPropsObj.keyScale),max:drc.values.value("max"),min:drc.values.value("min")}))),{parser:parseNumber,value,viewProps:args.viewProps})):new NumberTextController(args.document,{parser:parseNumber,props:ValueMap.fromObject(textPropsObj),value,viewProps:args.viewProps})},api:args=>"number"!=typeof args.controller.value.rawValue?null:args.controller.valueController instanceof SliderTextController?new SliderInputBindingApi(args.controller):args.controller.valueController instanceof ListController?new ListInputBindingApi(args.controller):null});class Point2d{constructor(x=0,y=0){this.x=x,this.y=y}getComponents(){return[this.x,this.y]}static isObject(obj){if(isEmpty(obj))return!1;const x=obj.x,y=obj.y;return"number"==typeof x&&"number"==typeof y}static equals(v1,v2){return v1.x===v2.x&&v1.y===v2.y}toObject(){return{x:this.x,y:this.y}}}const Point2dAssembly={toComponents:p=>p.getComponents(),fromComponents:comps=>new Point2d(...comps)},cn$5=ClassName("p2d");class Point2dView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(cn$5()),config.viewProps.bindClassModifiers(this.element),bindValue(config.expanded,valueToClassName(this.element,cn$5(void 0,"expanded")));const headElem=doc.createElement("div");headElem.classList.add(cn$5("h")),this.element.appendChild(headElem);const buttonElem=doc.createElement("button");buttonElem.classList.add(cn$5("b")),buttonElem.appendChild(createSvgIconElement(doc,"p2dpad")),config.viewProps.bindDisabled(buttonElem),headElem.appendChild(buttonElem),this.buttonElement=buttonElem;const textElem=doc.createElement("div");if(textElem.classList.add(cn$5("t")),headElem.appendChild(textElem),this.textElement=textElem,"inline"===config.pickerLayout){const pickerElem=doc.createElement("div");pickerElem.classList.add(cn$5("p")),this.element.appendChild(pickerElem),this.pickerElement=pickerElem}else this.pickerElement=null}}const cn$4=ClassName("p2dp");class Point2dPickerView{constructor(doc,config){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=config.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=doc.createElement("div"),this.element.classList.add(cn$4()),"popup"===config.layout&&this.element.classList.add(cn$4(void 0,"p")),config.viewProps.bindClassModifiers(this.element);const padElem=doc.createElement("div");padElem.classList.add(cn$4("p")),config.viewProps.bindTabIndex(padElem),this.element.appendChild(padElem),this.padElement=padElem;const svgElem=doc.createElementNS(SVG_NS,"svg");svgElem.classList.add(cn$4("g")),this.padElement.appendChild(svgElem),this.svgElem_=svgElem;const xAxisElem=doc.createElementNS(SVG_NS,"line");xAxisElem.classList.add(cn$4("ax")),xAxisElem.setAttributeNS(null,"x1","0"),xAxisElem.setAttributeNS(null,"y1","50%"),xAxisElem.setAttributeNS(null,"x2","100%"),xAxisElem.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(xAxisElem);const yAxisElem=doc.createElementNS(SVG_NS,"line");yAxisElem.classList.add(cn$4("ax")),yAxisElem.setAttributeNS(null,"x1","50%"),yAxisElem.setAttributeNS(null,"y1","0"),yAxisElem.setAttributeNS(null,"x2","50%"),yAxisElem.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(yAxisElem);const lineElem=doc.createElementNS(SVG_NS,"line");lineElem.classList.add(cn$4("l")),lineElem.setAttributeNS(null,"x1","50%"),lineElem.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(lineElem),this.lineElem_=lineElem;const markerElem=doc.createElement("div");markerElem.classList.add(cn$4("m")),this.padElement.appendChild(markerElem),this.markerElem_=markerElem,config.value.emitter.on("change",this.onValueChange_),this.value=config.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[x,y]=this.value.rawValue.getComponents(),max=this.props_.get("max"),px=mapRange(x,-max,+max,0,100),py=mapRange(y,-max,+max,0,100),ipy=this.props_.get("invertsY")?100-py:py;this.lineElem_.setAttributeNS(null,"x2",`${px}%`),this.lineElem_.setAttributeNS(null,"y2",`${ipy}%`),this.markerElem_.style.left=`${px}%`,this.markerElem_.style.top=`${ipy}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function computeOffset(ev,keyScales,invertsY){return[getStepForKey(keyScales[0],getHorizontalStepKeys(ev)),getStepForKey(keyScales[1],getVerticalStepKeys(ev))*(invertsY?1:-1)]}class Point2dPickerController{constructor(doc,config){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=config.props,this.value=config.value,this.viewProps=config.viewProps,this.view=new Point2dPickerView(doc,{layout:config.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new PointerHandler(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(d,opts){if(!d.point)return;const max=this.props.get("max"),px=mapRange(d.point.x,0,d.bounds.width,-max,+max),py=mapRange(this.props.get("invertsY")?d.bounds.height-d.point.y:d.point.y,0,d.bounds.height,-max,+max);this.value.setRawValue(new Point2d(px,py),opts)}onPointerDown_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerMove_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerUp_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!0,last:!0})}onPadKeyDown_(ev){isArrowKey(ev.key)&&ev.preventDefault();const[dx,dy]=computeOffset(ev,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));0===dx&&0===dy||this.value.setRawValue(new Point2d(this.value.rawValue.x+dx,this.value.rawValue.y+dy),{forceEmit:!1,last:!1})}onPadKeyUp_(ev){const[dx,dy]=computeOffset(ev,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));0===dx&&0===dy||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Point2dController{constructor(doc,config){var _a,_b;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=config.value,this.viewProps=config.viewProps,this.foldable_=Foldable.create(config.expanded),this.popC_="popup"===config.pickerLayout?new PopupController(doc,{viewProps:this.viewProps}):null;const padC=new Point2dPickerController(doc,{layout:config.pickerLayout,props:new ValueMap({invertsY:createValue(config.invertsY),max:createValue(config.max),xKeyScale:config.axes[0].textProps.value("keyScale"),yKeyScale:config.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});padC.view.allFocusableElements.forEach((elem=>{elem.addEventListener("blur",this.onPopupChildBlur_),elem.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=padC,this.textC_=new PointNdTextController(doc,{assembly:Point2dAssembly,axes:config.axes,parser:config.parser,value:this.value,viewProps:this.viewProps}),this.view=new Point2dView(doc,{expanded:this.foldable_.value("expanded"),pickerLayout:config.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(_a=this.view.buttonElement)||void 0===_a||_a.addEventListener("blur",this.onPadButtonBlur_),null===(_b=this.view.buttonElement)||void 0===_b||_b.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),connectValues({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:p=>p,backward:(_,s)=>s})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),bindFoldable(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const elem=this.view.element,nextTarget=e.relatedTarget;nextTarget&&elem.contains(nextTarget)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(ev){if(!this.popC_)return;const elem=this.popC_.view.element,nextTarget=findNextTarget(ev);nextTarget&&elem.contains(nextTarget)||nextTarget&&nextTarget===this.view.buttonElement&&!supportsTouch(elem.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(ev){this.popC_?"Escape"===ev.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===ev.key&&this.view.buttonElement.focus()}}function point2dFromUnknown(value){return Point2d.isObject(value)?new Point2d(value.x,value.y):new Point2d}function writePoint2d(target,value){target.writeProperty("x",value.x),target.writeProperty("y",value.y)}function getSuitableMaxDimensionValue(params,rawValue){var _a,_b;if(!isEmpty(params.min)||!isEmpty(params.max))return Math.max(Math.abs(null!==(_a=params.min)&&void 0!==_a?_a:0),Math.abs(null!==(_b=params.max)&&void 0!==_b?_b:0));const step=getSuitableKeyScale(params);return Math.max(10*Math.abs(step),10*Math.abs(rawValue))}function getSuitableMax(params,initialValue){var _a,_b;const xr=getSuitableMaxDimensionValue(deepMerge(params,null!==(_a=params.x)&&void 0!==_a?_a:{}),initialValue.x),yr=getSuitableMaxDimensionValue(deepMerge(params,null!==(_b=params.y)&&void 0!==_b?_b:{}),initialValue.y);return Math.max(xr,yr)}function shouldInvertY(params){if(!("y"in params))return!1;const yParams=params.y;return!!yParams&&("inverted"in yParams&&!!yParams.inverted)}const Point2dInputPlugin=createPlugin({id:"input-point2d",type:"input",accept:(value,params)=>{if(!Point2d.isObject(value))return null;const result=parseRecord(params,(p=>Object.assign(Object.assign({},createPointDimensionParser(p)),{expanded:p.optional.boolean,picker:p.optional.custom(parsePickerLayout),readonly:p.optional.constant(!1),x:p.optional.custom(parsePointDimensionParams),y:p.optional.object(Object.assign(Object.assign({},createPointDimensionParser(p)),{inverted:p.optional.boolean}))})));return result?{initialValue:value,params:result}:null},binding:{reader:()=>point2dFromUnknown,constraint:args=>function createConstraint$3(params,initialValue){return new PointNdConstraint({assembly:Point2dAssembly,components:[createDimensionConstraint(Object.assign(Object.assign({},params),params.x),initialValue.x),createDimensionConstraint(Object.assign(Object.assign({},params),params.y),initialValue.y)]})}(args.params,args.initialValue),equals:Point2d.equals,writer:()=>writePoint2d},controller:args=>{var _a,_b;const doc=args.document,value=args.value,c=args.constraint,dParams=[args.params.x,args.params.y];return new Point2dController(doc,{axes:value.rawValue.getComponents().map(((comp,i)=>{var _a;return createPointAxis({constraint:c.components[i],initialValue:comp,params:deepMerge(args.params,null!==(_a=dParams[i])&&void 0!==_a?_a:{})})})),expanded:null!==(_a=args.params.expanded)&&void 0!==_a&&_a,invertsY:shouldInvertY(args.params),max:getSuitableMax(args.params,value.rawValue),parser:parseNumber,pickerLayout:null!==(_b=args.params.picker)&&void 0!==_b?_b:"popup",value,viewProps:args.viewProps})}});class Point3d{constructor(x=0,y=0,z=0){this.x=x,this.y=y,this.z=z}getComponents(){return[this.x,this.y,this.z]}static isObject(obj){if(isEmpty(obj))return!1;const x=obj.x,y=obj.y,z=obj.z;return"number"==typeof x&&"number"==typeof y&&"number"==typeof z}static equals(v1,v2){return v1.x===v2.x&&v1.y===v2.y&&v1.z===v2.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Point3dAssembly={toComponents:p=>p.getComponents(),fromComponents:comps=>new Point3d(...comps)};function point3dFromUnknown(value){return Point3d.isObject(value)?new Point3d(value.x,value.y,value.z):new Point3d}function writePoint3d(target,value){target.writeProperty("x",value.x),target.writeProperty("y",value.y),target.writeProperty("z",value.z)}const Point3dInputPlugin=createPlugin({id:"input-point3d",type:"input",accept:(value,params)=>{if(!Point3d.isObject(value))return null;const result=parseRecord(params,(p=>Object.assign(Object.assign({},createPointDimensionParser(p)),{readonly:p.optional.constant(!1),x:p.optional.custom(parsePointDimensionParams),y:p.optional.custom(parsePointDimensionParams),z:p.optional.custom(parsePointDimensionParams)})));return result?{initialValue:value,params:result}:null},binding:{reader:_args=>point3dFromUnknown,constraint:args=>function createConstraint$2(params,initialValue){return new PointNdConstraint({assembly:Point3dAssembly,components:[createDimensionConstraint(Object.assign(Object.assign({},params),params.x),initialValue.x),createDimensionConstraint(Object.assign(Object.assign({},params),params.y),initialValue.y),createDimensionConstraint(Object.assign(Object.assign({},params),params.z),initialValue.z)]})}(args.params,args.initialValue),equals:Point3d.equals,writer:_args=>writePoint3d},controller:args=>{const value=args.value,c=args.constraint,dParams=[args.params.x,args.params.y,args.params.z];return new PointNdTextController(args.document,{assembly:Point3dAssembly,axes:value.rawValue.getComponents().map(((comp,i)=>{var _a;return createPointAxis({constraint:c.components[i],initialValue:comp,params:deepMerge(args.params,null!==(_a=dParams[i])&&void 0!==_a?_a:{})})})),parser:parseNumber,value,viewProps:args.viewProps})}});class Point4d{constructor(x=0,y=0,z=0,w=0){this.x=x,this.y=y,this.z=z,this.w=w}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(obj){if(isEmpty(obj))return!1;const x=obj.x,y=obj.y,z=obj.z,w=obj.w;return"number"==typeof x&&"number"==typeof y&&"number"==typeof z&&"number"==typeof w}static equals(v1,v2){return v1.x===v2.x&&v1.y===v2.y&&v1.z===v2.z&&v1.w===v2.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Point4dAssembly={toComponents:p=>p.getComponents(),fromComponents:comps=>new Point4d(...comps)};function point4dFromUnknown(value){return Point4d.isObject(value)?new Point4d(value.x,value.y,value.z,value.w):new Point4d}function writePoint4d(target,value){target.writeProperty("x",value.x),target.writeProperty("y",value.y),target.writeProperty("z",value.z),target.writeProperty("w",value.w)}const Point4dInputPlugin=createPlugin({id:"input-point4d",type:"input",accept:(value,params)=>{if(!Point4d.isObject(value))return null;const result=parseRecord(params,(p=>Object.assign(Object.assign({},createPointDimensionParser(p)),{readonly:p.optional.constant(!1),w:p.optional.custom(parsePointDimensionParams),x:p.optional.custom(parsePointDimensionParams),y:p.optional.custom(parsePointDimensionParams),z:p.optional.custom(parsePointDimensionParams)})));return result?{initialValue:value,params:result}:null},binding:{reader:_args=>point4dFromUnknown,constraint:args=>function createConstraint$1(params,initialValue){return new PointNdConstraint({assembly:Point4dAssembly,components:[createDimensionConstraint(Object.assign(Object.assign({},params),params.x),initialValue.x),createDimensionConstraint(Object.assign(Object.assign({},params),params.y),initialValue.y),createDimensionConstraint(Object.assign(Object.assign({},params),params.z),initialValue.z),createDimensionConstraint(Object.assign(Object.assign({},params),params.w),initialValue.w)]})}(args.params,args.initialValue),equals:Point4d.equals,writer:_args=>writePoint4d},controller:args=>{const value=args.value,c=args.constraint,dParams=[args.params.x,args.params.y,args.params.z,args.params.w];return new PointNdTextController(args.document,{assembly:Point4dAssembly,axes:value.rawValue.getComponents().map(((comp,i)=>{var _a;return createPointAxis({constraint:c.components[i],initialValue:comp,params:deepMerge(args.params,null!==(_a=dParams[i])&&void 0!==_a?_a:{})})})),parser:parseNumber,value,viewProps:args.viewProps})}});const StringInputPlugin=createPlugin({id:"input-string",type:"input",accept:(value,params)=>{if("string"!=typeof value)return null;const result=parseRecord(params,(p=>({readonly:p.optional.constant(!1),options:p.optional.custom(parseListOptions)})));return result?{initialValue:value,params:result}:null},binding:{reader:_args=>stringFromUnknown,constraint:args=>function createConstraint(params){const constraints=[],lc=createListConstraint(params.options);return lc&&constraints.push(lc),new CompositeConstraint(constraints)}(args.params),writer:_args=>writePrimitive},controller:args=>{const doc=args.document,value=args.value,c=args.constraint,lc=c&&findConstraint(c,ListConstraint);return lc?new ListController(doc,{props:new ValueMap({options:lc.values.value("options")}),value,viewProps:args.viewProps}):new TextController(doc,{parser:v=>v,props:ValueMap.fromObject({formatter:formatString}),value,viewProps:args.viewProps})},api:args=>"string"!=typeof args.controller.value.rawValue?null:args.controller.valueController instanceof ListController?new ListInputBindingApi(args.controller):null}),Constants={monitor:{defaultInterval:200,defaultRows:3}},cn$3=ClassName("mll");class MultiLogView{constructor(doc,config){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=config.formatter,this.element=doc.createElement("div"),this.element.classList.add(cn$3()),config.viewProps.bindClassModifiers(this.element);const textareaElem=doc.createElement("textarea");textareaElem.classList.add(cn$3("i")),textareaElem.style.height=`calc(var(${getCssVar("containerUnitSize")}) * ${config.rows})`,textareaElem.readOnly=!0,config.viewProps.bindDisabled(textareaElem),this.element.appendChild(textareaElem),this.textareaElem_=textareaElem,config.value.emitter.on("change",this.onValueUpdate_),this.value=config.value,this.update_()}update_(){const elem=this.textareaElem_,shouldScroll=elem.scrollTop===elem.scrollHeight-elem.clientHeight,lines=[];this.value.rawValue.forEach((value=>{void 0!==value&&lines.push(this.formatter_(value))})),elem.textContent=lines.join("\n"),shouldScroll&&(elem.scrollTop=elem.scrollHeight)}onValueUpdate_(){this.update_()}}class MultiLogController{constructor(doc,config){this.value=config.value,this.viewProps=config.viewProps,this.view=new MultiLogView(doc,{formatter:config.formatter,rows:config.rows,value:this.value,viewProps:this.viewProps})}}const cn$2=ClassName("sgl");class SingleLogView{constructor(doc,config){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=config.formatter,this.element=doc.createElement("div"),this.element.classList.add(cn$2()),config.viewProps.bindClassModifiers(this.element);const inputElem=doc.createElement("input");inputElem.classList.add(cn$2("i")),inputElem.readOnly=!0,inputElem.type="text",config.viewProps.bindDisabled(inputElem),this.element.appendChild(inputElem),this.inputElement=inputElem,config.value.emitter.on("change",this.onValueUpdate_),this.value=config.value,this.update_()}update_(){const values=this.value.rawValue,lastValue=values[values.length-1];this.inputElement.value=void 0!==lastValue?this.formatter_(lastValue):""}onValueUpdate_(){this.update_()}}class SingleLogController{constructor(doc,config){this.value=config.value,this.viewProps=config.viewProps,this.view=new SingleLogView(doc,{formatter:config.formatter,value:this.value,viewProps:this.viewProps})}}const BooleanMonitorPlugin=createPlugin({id:"monitor-bool",type:"monitor",accept:(value,params)=>{if("boolean"!=typeof value)return null;const result=parseRecord(params,(p=>({readonly:p.required.constant(!0),rows:p.optional.number})));return result?{initialValue:value,params:result}:null},binding:{reader:_args=>boolFromUnknown},controller:args=>{var _a;return 1===args.value.rawValue.length?new SingleLogController(args.document,{formatter:BooleanFormatter,value:args.value,viewProps:args.viewProps}):new MultiLogController(args.document,{formatter:BooleanFormatter,rows:null!==(_a=args.params.rows)&&void 0!==_a?_a:Constants.monitor.defaultRows,value:args.value,viewProps:args.viewProps})}});class GraphLogMonitorBindingApi extends BindingApi{get max(){return this.controller.valueController.props.get("max")}set max(max){this.controller.valueController.props.set("max",max)}get min(){return this.controller.valueController.props.get("min")}set min(min){this.controller.valueController.props.set("min",min)}}const cn$1=ClassName("grl");class GraphLogView{constructor(doc,config){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=doc.createElement("div"),this.element.classList.add(cn$1()),config.viewProps.bindClassModifiers(this.element),this.formatter_=config.formatter,this.props_=config.props,this.cursor_=config.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const svgElem=doc.createElementNS(SVG_NS,"svg");svgElem.classList.add(cn$1("g")),svgElem.style.height=`calc(var(${getCssVar("containerUnitSize")}) * ${config.rows})`,this.element.appendChild(svgElem),this.svgElem_=svgElem;const lineElem=doc.createElementNS(SVG_NS,"polyline");this.svgElem_.appendChild(lineElem),this.lineElem_=lineElem;const tooltipElem=doc.createElement("div");tooltipElem.classList.add(cn$1("t"),ClassName("tt")()),this.element.appendChild(tooltipElem),this.tooltipElem_=tooltipElem,config.value.emitter.on("change",this.onValueUpdate_),this.value=config.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const{clientWidth:w,clientHeight:h}=this.element,maxIndex=this.value.rawValue.length-1,min=this.props_.get("min"),max=this.props_.get("max"),points=[];this.value.rawValue.forEach(((v,index)=>{if(void 0===v)return;const x=mapRange(index,0,maxIndex,0,w),y=mapRange(v,min,max,h,0);points.push([x,y].join(","))})),this.lineElem_.setAttributeNS(null,"points",points.join(" "));const tooltipElem=this.tooltipElem_,value=this.value.rawValue[this.cursor_.rawValue];if(void 0===value)return void tooltipElem.classList.remove(cn$1("t","a"));const tx=mapRange(this.cursor_.rawValue,0,maxIndex,0,w),ty=mapRange(value,min,max,h,0);tooltipElem.style.left=`${tx}px`,tooltipElem.style.top=`${ty}px`,tooltipElem.textContent=`${this.formatter_(value)}`,tooltipElem.classList.contains(cn$1("t","a"))||(tooltipElem.classList.add(cn$1("t","a"),cn$1("t","in")),forceReflow(tooltipElem),tooltipElem.classList.remove(cn$1("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class GraphLogController{constructor(doc,config){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=config.props,this.value=config.value,this.viewProps=config.viewProps,this.cursor_=createValue(-1),this.view=new GraphLogView(doc,{cursor:this.cursor_,formatter:config.formatter,rows:config.rows,props:this.props,value:this.value,viewProps:this.viewProps}),supportsTouch(doc)){const ph=new PointerHandler(this.view.element);ph.emitter.on("down",this.onGraphPointerDown_),ph.emitter.on("move",this.onGraphPointerMove_),ph.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}importProps(state){return importBladeState(state,null,(p=>({max:p.required.number,min:p.required.number})),(result=>(this.props.set("max",result.max),this.props.set("min",result.min),!0)))}exportProps(){return exportBladeState(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(ev){const{clientWidth:w}=this.view.element;this.cursor_.rawValue=Math.floor(mapRange(ev.offsetX,0,w,0,this.value.rawValue.length))}onGraphPointerDown_(ev){this.onGraphPointerMove_(ev)}onGraphPointerMove_(ev){ev.data.point?this.cursor_.rawValue=Math.floor(mapRange(ev.data.point.x,0,ev.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function createFormatter(params){return isEmpty(params.format)?createNumberFormatter(2):params.format}function shouldShowGraph(params){return"graph"===params.view}const NumberMonitorPlugin=createPlugin({id:"monitor-number",type:"monitor",accept:(value,params)=>{if("number"!=typeof value)return null;const result=parseRecord(params,(p=>({format:p.optional.function,max:p.optional.number,min:p.optional.number,readonly:p.required.constant(!0),rows:p.optional.number,view:p.optional.string})));return result?{initialValue:value,params:result}:null},binding:{defaultBufferSize:params=>shouldShowGraph(params)?64:1,reader:_args=>numberFromUnknown},controller:args=>shouldShowGraph(args.params)?function createGraphMonitor(args){var _a,_b,_c;return new GraphLogController(args.document,{formatter:createFormatter(args.params),rows:null!==(_a=args.params.rows)&&void 0!==_a?_a:Constants.monitor.defaultRows,props:ValueMap.fromObject({max:null!==(_b=args.params.max)&&void 0!==_b?_b:100,min:null!==(_c=args.params.min)&&void 0!==_c?_c:0}),value:args.value,viewProps:args.viewProps})}(args):function createTextMonitor(args){var _a;return 1===args.value.rawValue.length?new SingleLogController(args.document,{formatter:createFormatter(args.params),value:args.value,viewProps:args.viewProps}):new MultiLogController(args.document,{formatter:createFormatter(args.params),rows:null!==(_a=args.params.rows)&&void 0!==_a?_a:Constants.monitor.defaultRows,value:args.value,viewProps:args.viewProps})}(args),api:args=>args.controller.valueController instanceof GraphLogController?new GraphLogMonitorBindingApi(args.controller):null}),StringMonitorPlugin=createPlugin({id:"monitor-string",type:"monitor",accept:(value,params)=>{if("string"!=typeof value)return null;const result=parseRecord(params,(p=>({multiline:p.optional.boolean,readonly:p.required.constant(!0),rows:p.optional.number})));return result?{initialValue:value,params:result}:null},binding:{reader:_args=>stringFromUnknown},controller:args=>{var _a;const value=args.value;return value.rawValue.length>1||args.params.multiline?new MultiLogController(args.document,{formatter:formatString,rows:null!==(_a=args.params.rows)&&void 0!==_a?_a:Constants.monitor.defaultRows,value,viewProps:args.viewProps}):new SingleLogController(args.document,{formatter:formatString,value,viewProps:args.viewProps})}});class ReadWriteBinding{constructor(config){this.target=config.target,this.reader_=config.reader,this.writer_=config.writer}read(){return this.reader_(this.target.read())}write(value){this.writer_(this.target,value)}inject(value){this.write(this.reader_(value))}}class ReadonlyBinding{constructor(config){this.target=config.target,this.reader_=config.reader}read(){return this.reader_(this.target.read())}}function createTicker(document,interval){return 0===interval?new ManualTicker:new IntervalTicker(document,null!=interval?interval:Constants.monitor.defaultInterval)}class PluginPool{constructor(apiCache){this.pluginsMap_={blades:[],inputs:[],monitors:[]},this.apiCache_=apiCache}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(bundleId,r){if(!function isCompatible(ver){return!!ver&&ver.major===VERSION$1.major}(r.core))throw TpError.notCompatible(bundleId,r.id);"blade"===r.type?this.pluginsMap_.blades.unshift(r):"input"===r.type?this.pluginsMap_.inputs.unshift(r):"monitor"===r.type&&this.pluginsMap_.monitors.unshift(r)}createInput_(document,target,params){return this.pluginsMap_.inputs.reduce(((result,plugin)=>null!=result?result:function createInputBindingController(plugin,args){var _a;const result=plugin.accept(args.target.read(),args.params);if(isEmpty(result))return null;const valueArgs={target:args.target,initialValue:result.initialValue,params:result.params},params=parseRecord(args.params,(p=>({disabled:p.optional.boolean,hidden:p.optional.boolean,label:p.optional.string,tag:p.optional.string}))),reader=plugin.binding.reader(valueArgs),constraint=plugin.binding.constraint?plugin.binding.constraint(valueArgs):void 0,binding=new ReadWriteBinding({reader,target:args.target,writer:plugin.binding.writer(valueArgs)}),value=new InputBindingValue(createValue(reader(result.initialValue),{constraint,equals:plugin.binding.equals}),binding),controller=plugin.controller({constraint,document:args.document,initialValue:result.initialValue,params:result.params,value,viewProps:ViewProps.create({disabled:null==params?void 0:params.disabled,hidden:null==params?void 0:params.hidden})});return new InputBindingController(args.document,{blade:createBlade(),props:ValueMap.fromObject({label:"label"in args.params?null!==(_a=null==params?void 0:params.label)&&void 0!==_a?_a:null:args.target.key}),tag:null==params?void 0:params.tag,value,valueController:controller})}(plugin,{document,target,params})),null)}createMonitor_(document,target,params){return this.pluginsMap_.monitors.reduce(((result,plugin)=>null!=result?result:function createMonitorBindingController(plugin,args){var _a,_b,_c;const result=plugin.accept(args.target.read(),args.params);if(isEmpty(result))return null;const bindingArgs={target:args.target,initialValue:result.initialValue,params:result.params},params=parseRecord(args.params,(p=>({bufferSize:p.optional.number,disabled:p.optional.boolean,hidden:p.optional.boolean,interval:p.optional.number,label:p.optional.string}))),reader=plugin.binding.reader(bindingArgs),bufferSize=null!==(_b=null!==(_a=null==params?void 0:params.bufferSize)&&void 0!==_a?_a:plugin.binding.defaultBufferSize&&plugin.binding.defaultBufferSize(result.params))&&void 0!==_b?_b:1,value=new MonitorBindingValue({binding:new ReadonlyBinding({reader,target:args.target}),bufferSize,ticker:createTicker(args.document,null==params?void 0:params.interval)}),controller=plugin.controller({document:args.document,params:result.params,value,viewProps:ViewProps.create({disabled:null==params?void 0:params.disabled,hidden:null==params?void 0:params.hidden})});return controller.viewProps.bindDisabled(value.ticker),controller.viewProps.handleDispose((()=>{value.ticker.dispose()})),new MonitorBindingController(args.document,{blade:createBlade(),props:ValueMap.fromObject({label:"label"in args.params?null!==(_c=null==params?void 0:params.label)&&void 0!==_c?_c:null:args.target.key}),value,valueController:controller})}(plugin,{document,params,target})),null)}createBinding(doc,target,params){if(isEmpty(target.read()))throw new TpError({context:{key:target.key},type:"nomatchingcontroller"});const ic=this.createInput_(doc,target,params);if(ic)return ic;const mc=this.createMonitor_(doc,target,params);if(mc)return mc;throw new TpError({context:{key:target.key},type:"nomatchingcontroller"})}createBlade(document,params){const bc=this.pluginsMap_.blades.reduce(((result,plugin)=>null!=result?result:function createBladeController(plugin,args){const ac=plugin.accept(args.params);if(!ac)return null;const params=parseRecord(args.params,(p=>({disabled:p.optional.boolean,hidden:p.optional.boolean})));return plugin.controller({blade:createBlade(),document:args.document,params:Object.assign(Object.assign({},ac.params),{disabled:null==params?void 0:params.disabled,hidden:null==params?void 0:params.hidden}),viewProps:ViewProps.create({disabled:null==params?void 0:params.disabled,hidden:null==params?void 0:params.hidden})})}(plugin,{document,params})),null);if(!bc)throw new TpError({type:"nomatchingview",context:{params}});return bc}createInputBindingApi_(bc){const api=this.pluginsMap_.inputs.reduce(((result,plugin)=>{var _a,_b;return result||(null!==(_b=null===(_a=plugin.api)||void 0===_a?void 0:_a.call(plugin,{controller:bc}))&&void 0!==_b?_b:null)}),null);return this.apiCache_.add(bc,null!=api?api:new BindingApi(bc))}createMonitorBindingApi_(bc){const api=this.pluginsMap_.monitors.reduce(((result,plugin)=>{var _a,_b;return result||(null!==(_b=null===(_a=plugin.api)||void 0===_a?void 0:_a.call(plugin,{controller:bc}))&&void 0!==_b?_b:null)}),null);return this.apiCache_.add(bc,null!=api?api:new BindingApi(bc))}createBindingApi(bc){if(this.apiCache_.has(bc))return this.apiCache_.get(bc);if(isInputBindingController(bc))return this.createInputBindingApi_(bc);if(isMonitorBindingController(bc))return this.createMonitorBindingApi_(bc);throw TpError.shouldNeverHappen()}createApi(bc){if(this.apiCache_.has(bc))return this.apiCache_.get(bc);if(function isBindingController(bc){return isValueBladeController(bc)&&isBindingValue(bc.value)}(bc))return this.createBindingApi(bc);const api=this.pluginsMap_.blades.reduce(((result,plugin)=>null!=result?result:plugin.api({controller:bc,pool:this})),null);if(!api)throw TpError.shouldNeverHappen();return this.apiCache_.add(bc,api)}}const sharedCache=new class BladeApiCache{constructor(){this.map_=new Map}get(bc){var _a;return null!==(_a=this.map_.get(bc))&&void 0!==_a?_a:null}has(bc){return this.map_.has(bc)}add(bc,api){return this.map_.set(bc,api),bc.viewProps.handleDispose((()=>{this.map_.delete(bc)})),api}};class ListBladeApi extends BladeApi{constructor(controller){super(controller),this.emitter_=new Emitter,this.controller.value.emitter.on("change",(ev=>{this.emitter_.emit("change",new TpChangeEvent(this,ev.rawValue))}))}get label(){return this.controller.labelController.props.get("label")}set label(label){this.controller.labelController.props.set("label",label)}get options(){return this.controller.valueController.props.get("options")}set options(options){this.controller.valueController.props.set("options",options)}get value(){return this.controller.value.rawValue}set value(value){this.controller.value.rawValue=value}on(eventName,handler){const bh=handler.bind(this);return this.emitter_.on(eventName,(ev=>{bh(ev)}),{key:handler}),this}off(eventName,handler){return this.emitter_.off(eventName,handler),this}}class SeparatorBladeApi extends BladeApi{}class SliderBladeApi extends BladeApi{constructor(controller){super(controller),this.emitter_=new Emitter,this.controller.value.emitter.on("change",(ev=>{this.emitter_.emit("change",new TpChangeEvent(this,ev.rawValue))}))}get label(){return this.controller.labelController.props.get("label")}set label(label){this.controller.labelController.props.set("label",label)}get max(){return this.controller.valueController.sliderController.props.get("max")}set max(max){this.controller.valueController.sliderController.props.set("max",max)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(min){this.controller.valueController.sliderController.props.set("min",min)}get value(){return this.controller.value.rawValue}set value(value){this.controller.value.rawValue=value}on(eventName,handler){const bh=handler.bind(this);return this.emitter_.on(eventName,(ev=>{bh(ev)}),{key:handler}),this}off(eventName,handler){return this.emitter_.off(eventName,handler),this}}class TextBladeApi extends BladeApi{constructor(controller){super(controller),this.emitter_=new Emitter,this.controller.value.emitter.on("change",(ev=>{this.emitter_.emit("change",new TpChangeEvent(this,ev.rawValue))}))}get label(){return this.controller.labelController.props.get("label")}set label(label){this.controller.labelController.props.set("label",label)}get formatter(){return this.controller.valueController.props.get("formatter")}set formatter(formatter){this.controller.valueController.props.set("formatter",formatter)}get value(){return this.controller.value.rawValue}set value(value){this.controller.value.rawValue=value}on(eventName,handler){const bh=handler.bind(this);return this.emitter_.on(eventName,(ev=>{bh(ev)}),{key:handler}),this}off(eventName,handler){return this.emitter_.off(eventName,handler),this}}const ListBladePlugin={id:"list",type:"blade",core:VERSION$1,accept(params){const result=parseRecord(params,(p=>({options:p.required.custom(parseListOptions),value:p.required.raw,view:p.required.constant("list"),label:p.optional.string})));return result?{params:result}:null},controller(args){const lc=new ListConstraint(normalizeListOptions(args.params.options)),value=createValue(args.params.value,{constraint:lc}),ic=new ListController(args.document,{props:new ValueMap({options:lc.values.value("options")}),value,viewProps:args.viewProps});return new LabeledValueBladeController(args.document,{blade:args.blade,props:ValueMap.fromObject({label:args.params.label}),value,valueController:ic})},api:args=>args.controller instanceof LabeledValueBladeController&&args.controller.valueController instanceof ListController?new ListBladeApi(args.controller):null};class RootApi extends FolderApi{constructor(controller,pool){super(controller,pool)}get element(){return this.controller.view.element}}class RootController extends FolderController{constructor(doc,config){super(doc,{expanded:config.expanded,blade:config.blade,props:config.props,root:!0,viewProps:config.viewProps})}}const cn=ClassName("spr");class SeparatorView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(cn()),config.viewProps.bindClassModifiers(this.element);const hrElem=doc.createElement("hr");hrElem.classList.add(cn("r")),this.element.appendChild(hrElem)}}class SeparatorController extends BladeController{constructor(doc,config){super(Object.assign(Object.assign({},config),{view:new SeparatorView(doc,{viewProps:config.viewProps})}))}}const SeparatorBladePlugin={id:"separator",type:"blade",core:VERSION$1,accept(params){const result=parseRecord(params,(p=>({view:p.required.constant("separator")})));return result?{params:result}:null},controller:args=>new SeparatorController(args.document,{blade:args.blade,viewProps:args.viewProps}),api:args=>args.controller instanceof SeparatorController?new SeparatorBladeApi(args.controller):null},SliderBladePlugin={id:"slider",type:"blade",core:VERSION$1,accept(params){const result=parseRecord(params,(p=>({max:p.required.number,min:p.required.number,view:p.required.constant("slider"),format:p.optional.function,label:p.optional.string,value:p.optional.number})));return result?{params:result}:null},controller(args){var _a,_b;const initialValue=null!==(_a=args.params.value)&&void 0!==_a?_a:0,drc=new DefiniteRangeConstraint({max:args.params.max,min:args.params.min}),v=createValue(initialValue,{constraint:drc}),vc=new SliderTextController(args.document,Object.assign(Object.assign({},createSliderTextProps({formatter:null!==(_b=args.params.format)&&void 0!==_b?_b:numberToString,keyScale:createValue(1),max:drc.values.value("max"),min:drc.values.value("min"),pointerScale:getSuitablePointerScale(args.params,initialValue)})),{parser:parseNumber,value:v,viewProps:args.viewProps}));return new LabeledValueBladeController(args.document,{blade:args.blade,props:ValueMap.fromObject({label:args.params.label}),value:v,valueController:vc})},api:args=>args.controller instanceof LabeledValueBladeController&&args.controller.valueController instanceof SliderTextController?new SliderBladeApi(args.controller):null},TextBladePlugin={id:"text",type:"blade",core:VERSION$1,accept(params){const result=parseRecord(params,(p=>({parse:p.required.function,value:p.required.raw,view:p.required.constant("text"),format:p.optional.function,label:p.optional.string})));return result?{params:result}:null},controller(args){var _a;const v=createValue(args.params.value),ic=new TextController(args.document,{parser:args.params.parse,props:ValueMap.fromObject({formatter:null!==(_a=args.params.format)&&void 0!==_a?_a:v=>String(v)}),value:v,viewProps:args.viewProps});return new LabeledValueBladeController(args.document,{blade:args.blade,props:ValueMap.fromObject({label:args.params.label}),value:v,valueController:ic})},api:args=>args.controller instanceof LabeledValueBladeController&&args.controller.valueController instanceof TextController?new TextBladeApi(args.controller):null};class Pane extends RootApi{constructor(opt_config){var _a,_b;const config=null!=opt_config?opt_config:{},doc=null!==(_a=config.document)&&void 0!==_a?_a:getWindowDocument(),pool=function createDefaultPluginPool(){const pool=new PluginPool(sharedCache);return[Point2dInputPlugin,Point3dInputPlugin,Point4dInputPlugin,StringInputPlugin,NumberInputPlugin,StringColorInputPlugin,ObjectColorInputPlugin,NumberColorInputPlugin,BooleanInputPlugin,BooleanMonitorPlugin,StringMonitorPlugin,NumberMonitorPlugin,ButtonBladePlugin,FolderBladePlugin,TabBladePlugin].forEach((p=>{pool.register("core",p)})),pool}();super(new RootController(doc,{expanded:config.expanded,blade:createBlade(),props:ValueMap.fromObject({title:config.title}),viewProps:ViewProps.create()}),pool),this.pool_=pool,this.containerElem_=null!==(_b=config.container)&&void 0!==_b?_b:function createDefaultWrapperElement(doc){const elem=doc.createElement("div");return elem.classList.add(ClassName("dfw")()),doc.body&&doc.body.appendChild(elem),elem}(doc),this.containerElem_.appendChild(this.element),this.doc_=doc,this.usesDefaultWrapper_=!config.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw TpError.alreadyDisposed();return this.doc_}dispose(){const containerElem=this.containerElem_;if(!containerElem)throw TpError.alreadyDisposed();if(this.usesDefaultWrapper_){const parentElem=containerElem.parentElement;parentElem&&parentElem.removeChild(containerElem)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(bundle){bundle.css&&function embedStyle(doc,id,css){if(doc.querySelector(`style[data-tp-style=${id}]`))return;const styleElem=doc.createElement("style");styleElem.dataset.tpStyle=id,styleElem.textContent=css,doc.head.appendChild(styleElem)}(this.document,`plugin-${bundle.id}`,bundle.css);("plugin"in bundle?[bundle.plugin]:"plugins"in bundle?bundle.plugins:[]).forEach((p=>{this.pool_.register(bundle.id,p)}))}setUpDefaultPlugins_(){this.registerPlugin({id:"default",css:'.tp-tbiv_b,.tp-coltxtv_ms,.tp-colswv_b,.tp-ckbv_i,.tp-sglv_i,.tp-mllv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-rotv_b,.tp-fldv_b,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tbpv_c>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-vp))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tbpv_c>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--cnt-usp)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tbpv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tbpv_c>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tbpv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tbpv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tbpv_c>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tbpv_c>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--bld-br);border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tbpv_c .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tbpv_c>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tbpv_c>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--bld-br)}.tp-tbpv_c .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--bld-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);overflow:hidden;padding-left:var(--cnt-hp);padding-right:calc(4px + var(--cnt-usz) + var(--cnt-hp));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-hp) + (var(--cnt-usz) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-vp);padding-top:var(--cnt-vp);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-sglv_i,.tp-mllv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-sglv_i::-webkit-scrollbar,.tp-mllv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-sglv_i::-webkit-scrollbar-corner,.tp-mllv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-sglv_i::-webkit-scrollbar-thumb,.tp-mllv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-rotv{--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-br: var(--tp-base-border-radius, 6px);--bs-ff: var(--tp-base-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--bld-br: var(--tp-blade-border-radius, 2px);--bld-hp: var(--tp-blade-horizontal-padding, 4px);--bld-vw: var(--tp-blade-value-width, 160px);--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--cnt-hp: var(--tp-container-horizontal-padding, 4px);--cnt-vp: var(--tp-container-vertical-padding, 4px);--cnt-usp: var(--tp-container-unit-spacing, 4px);--cnt-usz: var(--tp-container-unit-size, 20px);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--bld-br);cursor:pointer;display:block;height:var(--cnt-usz);position:relative;width:var(--cnt-usz)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--cnt-usp);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--cnt-usp)}.tp-colpv_rgb{display:flex;margin-top:var(--cnt-usp);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-vp);padding-top:calc(var(--cnt-vp) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-hp));position:absolute;right:calc(-1*var(--cnt-hp));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--bld-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--cnt-usz)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--bld-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--bld-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{cursor:pointer;display:block;height:var(--cnt-usz);left:0;position:absolute;top:0;width:var(--cnt-usz)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--bld-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--bld-br);color:var(--lbl-fg);cursor:pointer;height:var(--cnt-usz);line-height:var(--cnt-usz);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--cnt-usz)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-hp);padding-right:var(--cnt-hp)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--bld-vw)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 var(--bld-hp);width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--cnt-usz)*3);line-height:var(--cnt-usz);padding-left:var(--bld-hp);padding-right:var(--bld-hp);resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--cnt-usp);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-p2dpv{padding-left:calc(var(--cnt-usz) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:var(--bld-vw);padding:var(--cnt-vp) var(--cnt-hp);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--cnt-usz);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--bld-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--cnt-usz) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-hp) + 4px);padding-right:calc(var(--cnt-hp) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);opacity:.5;overflow:hidden;position:relative;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-tbpv_c{padding-bottom:var(--cnt-vp);padding-left:4px;padding-top:var(--cnt-vp)}.tp-txtv{position:relative}.tp-txtv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:calc(var(--bld-hp) - 5px);position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--cnt-usz) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--bld-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--bs-ff);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--cnt-usz) + var(--cnt-hp));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0;transition-delay:0s;transition-duration:0s}.tp-rotv.tp-rotv-not>.tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst.tp-fldv-expanded>.tp-fldv_b{transition-delay:0s;transition-duration:0s}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}',plugins:[ListBladePlugin,SeparatorBladePlugin,SliderBladePlugin,TabBladePlugin,TextBladePlugin]})}}new Semver("4.0.3")}}]);